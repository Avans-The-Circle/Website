import{a as getDefaultExportFromCjs}from"./_commonjsHelpers-15fb5e92.js";function _mergeNamespaces(z,H){return H.forEach(function(I){I&&typeof I!="string"&&!Array.isArray(I)&&Object.keys(I).forEach(function(E){if(E!=="default"&&!(E in z)){var f=Object.getOwnPropertyDescriptor(I,E);Object.defineProperty(z,E,f.get?f:{enumerable:!0,get:function(){return I[E]}})}})}),Object.freeze(Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}))}var AgoraRTCSDK_min$2={exports:{}};/*! AgoraRTC|BUILD v3.6.10-0-g9f81d6e-dirty */(function(module,exports){(function(z,H){module.exports=H()})(window,function(){return function(z){var H={};function I(E){if(H[E])return H[E].exports;var f=H[E]={i:E,l:!1,exports:{}};return z[E].call(f.exports,f,f.exports,I),f.l=!0,f.exports}return I.m=z,I.c=H,I.d=function(E,f,S){I.o(E,f)||Object.defineProperty(E,f,{enumerable:!0,get:S})},I.r=function(E){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},I.t=function(E,f){if(1&f&&(E=I(E)),8&f||4&f&&typeof E=="object"&&E&&E.__esModule)return E;var S=Object.create(null);if(I.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:E}),2&f&&typeof E!="string")for(var g in E)I.d(S,g,function(y){return E[y]}.bind(null,g));return S},I.n=function(E){var f=E&&E.__esModule?function(){return E.default}:function(){return E};return I.d(f,"a",f),f},I.o=function(E,f){return Object.prototype.hasOwnProperty.call(E,f)},I.p="",I(I.s=96)}([function(z,H,I){I.r(H);var E,f=I(11),S=I.n(f),g=function(){var O=new Date;return O.toTimeString().split(" ")[0]+":"+O.getMilliseconds()},y=I(14),s=I(2),m=I(1),r=I(48),a=I.n(r),d=I(49),T=I.n(d),C=new Array(32).fill(void 0);function v(O){return C[O]}C.push(void 0,null,!0,!1);var u=C.length;function b(O){var w=v(O);return function(U){U<36||(C[U]=u,u=U)}(O),w}var R=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});R.decode();var D=null;function _(){return D!==null&&D.buffer===E.memory.buffer||(D=new Uint8Array(E.memory.buffer)),D}function j(O,w){return R.decode(_().subarray(O,O+w))}function q(O){u===C.length&&C.push(C.length+1);var w=u;return u=C[w],C[w]=O,w}var B=0,W=new TextEncoder("utf-8"),k=typeof W.encodeInto=="function"?function(O,w){return W.encodeInto(O,w)}:function(O,w){var U=W.encode(O);return w.set(U),{read:O.length,written:U.length}},p=null;function n(){return p!==null&&p.buffer===E.memory.buffer||(p=new Int32Array(E.memory.buffer)),p}var N=function(){function O(){a()(this,O)}return T()(O,[{key:"free",value:function(){var w=this.ptr;this.ptr=0,E.__wbg_signmanager_free(w)}},{key:"get_digest",value:function(w){return b(E.signmanager_get_digest(this.ptr,q(w)))}}],[{key:"__wrap",value:function(w){var U=Object.create(O.prototype);return U.ptr=w,U}},{key:"new",value:function(){var w=E.signmanager_new();return O.__wrap(w)}}]),O}(),l=!1,t=null,x,o=0,h="free",L=[],M=[],G=0;(t?Promise.resolve(t):new Promise(function(O){l||E||function w(){var U={wbg:{}};U.wbg.__wbindgen_object_drop_ref=function(le){b(le)},U.wbg.__wbindgen_string_new=function(le,ee){return q(j(le,ee))},U.wbg.__wbindgen_string_get=function(le,ee){var A=v(ee),fe=typeof A=="string"?A:void 0,Ee=fe==null?0:function(he,_e,c){if(c===void 0){var P=W.encode(he),F=_e(P.length);return _().subarray(F,F+P.length).set(P),B=P.length,F}for(var X=he.length,ne=(F=_e(X),_()),V=0;V<X;V++){var K=he.charCodeAt(V);if(K>127)break;ne[F+V]=K}if(V!==X){V!==0&&(he=he.slice(V)),F=c(F,X,X=V+3*he.length);var te=_().subarray(F+V,F+X);V+=k(he,te).written}return B=V,F}(fe,E.__wbindgen_malloc,E.__wbindgen_realloc),ge=B;n()[le/4+1]=ge,n()[le/4+0]=Ee},U.wbg.__wbindgen_throw=function(le,ee){throw new Error(j(le,ee))};for(var $=Uint8Array.from(atob("55ZBgM/2Bzm2JGhNn//ljJsSorhWUYE66a1Hf8O7pfQGR2zfol8qRP6CDhsi3iG7nFZu9stSyPq/qu2Rr2w8QkTGP6Gm2cg3J5qsQgq5bcHA9mDpGv/b24uEwsixZVl1eGkdV4SB/6ayw2v48hLmNA+w5UlnTCiWwerzESQPidpSUMbamXL3pU815EQm12GhhZ9aWzo568gdZvXevBc/WHfFKQSuTgWva4e4eSmW7UxpH8sY4HlDsCTMu0WwEB8B95XsZwOp3GLgfOQmJBw036DgIKU+XGn4KpIEq77WE/h6R7sZKsFUp+u+2cDnW7IPNe7xfd9areFo0EUh0/9K9CqxUkLqMB5hlgS1fwQHRzKPhQ7gALyc6HwMCPooS0M1NrzjdfH3vUn0PeQ1GBlnrnXgiu8TunfHg5TcbBfPEbxbyiiow1Np+VEBlHNh00PiAWyu024NHaPbDGfMtzu4WF02fgkh8Pxb7bCSpCZndjTytQgAzfZxk2bbe6NoHHFnsviqYzHVpxoPEk7icHRWcZC28d2muthq673KCMQay1fJcPqSTuYhWUZS5eylIguT33lP+TBbOWQI8KtCzBN5FzqILfKzRkzrJ3L192BUF8SILdwmriv10HU9ZlQAyQA1VdegnzOl/dYk2GGsB3724y7w/7aJLHJzEfwrfIzFd5CoAft7ct+zQW2G4Wm2kpoz6uJfgrNyykQgwCO6pkPy1ADrBUuJon9ySjhgcFru6AKa99wTlIhzBw3FKFt9Aa1/1KWWy7W1wAIGzRTs/7rLXRkKFjNqGVXBdoVNTpHFtfEFsuX0X98ISr0Bennlx0h2Yl/CGNb5Kc7i3bio1XJHX24avcMsEAwfdfskCki4/dkStn7QC97YJC3z+7gD84IiEEeGcnn7gHJyeALr0ssbqDUcKqxEyheyFs9FToJziLB+eYw6nMQLmYTrQyrg3b+3YBdgx7pzNEDSyz3tmaPaikwcLSyB/Igo6U/oP/fS2TZLtmN03m4iS76YrDJAgI+2W1GboabuixVcLdxm6SQ4CzUnHSPl1knhcGhW/+OcKa53tB5j5C4wEpiENv6T9PUu4K0YwtEAqFbd/eN2wVAYCKn/nlVA8uiESxCfgs0411mRFk4i1pixJLPP5AFPG9QFZnj6X19TqmhmIhl8D6Q1rOvPCqPZV/z04HjayX4qPzPzP/5NVilN/sHhQe7ulriGmU/3rj5QEuiOymsL7EdCQMc/4mXDPdVrDBfbt6dnv11oLYGmqOP1oSBj02FtsmYrMn9pRg7HJoCh86jAnzuOYn4tGnQ4gw/89sb64NAXcoIbTIjyiHBAQCCK2Yn4I/fNF10rkQlvSvkpqLG2eYpJmpWrcouNDEUtJFR607oNraLdmUKyLc1g7SNpS+ofp1FL6rua/HFSrb5kTF2Vcy2gl+6MACbFRChKoP/un7IbYJuOima/JWFZcs/MXokIx+ijuqjMtVKaYRTzNI5ncPa2y/EXTNdUUFpMhbE7sa39Uoh6Hci/viXy2KFTNbiw+BkWOPnyOr04LjIYKlJ8ud/KvjuvNUGQOHJvj6tpZJxj97tr0OrgZCAxSHGU5JQfqEd/U0QfzGM8Wh3zdsnd9LhoIIRJAtyA2PmjwJk4zTxeYlgwPqAVTU3+9bA1QD+jLZZ3Ffk3MRq+Ar2RT8YN6ASR4bItt3omBj0LJe0zeGY3OzfhljL6LA1m4+IUp+CzeWo0aEjnvRk3iCJeajgdC+NUGB5qh8PWKtBeC58woavnRjvRNphXS4b9M7Aymcfq26B2YY2lS+wLf763OnGJlVdV/srgyAUJJZjarxom4zrYy23kLFB8zFzWuwSMue5Xm1YWape91JGDuRLIctrJWU47/XfLm6Zgei4xOwq1RcjikGuaZtDwcFg9aKtO+JOGJsCjy9AiPnmt+rmdX83GsT3KtTETnLv6ZQcnGtmt4H8AjFgGYePdQc40cj8VAOV8NCLspyW5w63b3g37GXJrzjm9Fym3fh27psjo5RuTs7XCSrNENxKm9jCcXPqWxyuXJSn6dhdWnw5SAnUjixXviWS4HsnYjw4Xt4cSwkqCB9naLstVXt5D2HgG4fzHFNHvnETft0mrhU81IBDTSyNFdDvFEX8cifoc6FcNq7pzXlotl2ZS1FIzNXddZrdXpBNYZPV52gtCok6ePpUR/Y8jyJpE9P3q8dmFVivVGgmKTcBKMDDbzeOfl4MpOGBtBX/Lab/kzqG42sTyOyGUyOoFXYGMUWJ33GPI2KNa/mW8zVl+imshfbj7PiK1qRUn74KjAkH4wjKnu50AONYUaiveSdwnEc1zCjZSJ3dmBKSxhWAcO2PdHBg5m9+JCiPGCVfK9dzoM8Bm7xx9noJiqt4hNiVa5di1Fd1JRN4rnd1DbKglKpAVSoqvJPxmuyH56TFE4BQjhfKbDMZezQJqx+KXDiW1JWGeDYaPVBWPYeZX6STIzC/DjS7UFlqoKgGGAGP17x8wmMRE6O/axG5jDzloCGxCmrymT0ZGCh4g54O1iDYUtmJr7Bo1d+H9RQj2Y10BxcMkLFTIZVjm9e3vtIbeRx0OdXE1Ou37J/WeJZyPXn1fszvp/KonCqVnt862LrxfoB/0sF5gk4Y/f6LVneU5hun9/V1OVre9XrnDBhcVaQa9Ye6gs8sHW9HCNchaFbkUpxSiyxVEFZIlbejbjSPFlkYOLhtQHduwZWRHWA9akqykJNG3PKvOZAaJG5nWQq8+e4K0JF/AXTKIIr4J7zDt8ZR4xb9T2gxjl1nfqzidMRIY5B4rkw0oetta+j8rqkFpTEGA+hU/tw7bDtpkPYvCguwncnCjwULNFT9I9jXx3H4Ws3WWMCit29F7kGq2Ka+rU/MjnuP0lsXkoB1rr8LawHH5gaf8rajq/BhKrGTIfjDiZG5qz+L7SZBZsMSZZ9pM1QhKju+GTD9iC+9HlhfXMtj94gz8U4h7eGXziEO7lo7LwLL6/DVMrGbkv68JYUYhGz2yBm/8cbQEh5vhakbhmpv1K6XYM9rzdsd9bwYcYt3cfKE3m+/NrUa42+RpJBdFg7cAmxsZ7/0TMyVw6Aqu2gzldb2ag4iLrPNEyW1ywaJ2DXMgPi/sjnDzhuo+vIUrc86j4ZLhT4GAN6uqwbnXq5UDzX7TfuB48oMvvE1sK5q6owkdWfklgnC6pSBpK7wl+e3kuvaYnGRGJJMBQuVgWL1awHrVtfOTsSE1vc0ZdG+a/Jbza6pHbyfi5L7FXJAGdQTk0EP3VT54+F7RZ/MJ9fj56aMxzhJRwQJ6df3cM26qSc5bW/zP3PFXypTOBwzCvVtwGQzkGvDW7XGwgLbTNHDpQXOd2BQ5Zd9bjQqGg+S+kIqWZVZCqVLfyFPF9bEOHfPepL6nRDJUD2l5uRnXqeTvidaSIoqS1Fbc6mLPtYnbp6uuts6Qo8TbMzFuI7NuaPuKnQIyVu7vUGJ8jg1uVOjlMNKdVtLPr9/ZEKVZVj7lsFA+nm3zRjjr1DRKhr/wY1CI1iXKVTeQZ0i2PSnN99j4iVTSwNAYQLWWD+KyZ/xRLVxmZQPuSkLeKBRAkavxjWnIFQb1dn72wMSUdcB9cNCNJNdyTkrl44MRR+pUuiVrTAnTlzL33X32eEYwT+vn564yxFJLUDyIMNjJ0nx+GreKSOglI2et0kAwRHKYFclH9GVTiVlB0TWeUJGD+7JYogF7BizjTGyPOUEWQCguIEmtC4fHD5461T80Z3Mp7rhNTI+Cswuknr9hrIZmpRyFSrSrP8R4S1Cf34Tu4RNrDxpofVK9nGTklZPsYM6eiP29Lx264fsX9oLdYhq7vCwcrRMJ1a5d0QHXUYRV5IqTFBoUSpxkQ6IHHL8ckM4NCzwk8K0CA3pj5Jp2a9wZjfKq7R/eukzQFuhMxV2qgHf2E3t7/SA8N7sMvsmF0p3J96QRE3rA85ekH1q8nrBVujlIqahmL0Qto3+JxdqAfnKMCblQGSKVWZgWLMm82MG/9pjhdkMzG7C2GRLGMty2y8NhX1pZWHNbLOmvaC424LNz/Nl5tkPv7fVbCT2ItB+/dx3ZhVhmgSLd1zL+2PsNFmj7VGBruTttezlo1mDKErjY27nTswjf2fY/Uq8lPcVAgRpJM+m7jS/8dk8cdl7fkY7Tuj4TfiSe0tiNSoJgZwom4+9haoBQ65AifaB7pUiTc0MAXCvG+nDydkRIbKx5fL6gAlyMAnBbQf+Qh1naLfzzwLVTP0EEyoenW2W1zKqfMql5rwGlyCB9mSa2s25yHf4SDSBlgEVMJtplpRgegZvDakpWDKgx3UR4W7yKW+RD7bd7rEa/GQmA/q0RYAOIaXfO/2CgEUPtNhPS2uqy29lBYFPPv5SHQ0t/jRxQLBpe09ateAWKypt9TWS7Z5gynOePS5M2NC16AhF0Xz6s7DUjtI0xNho9Y6GK16J5V8HqHypV/OAz7+VBzTaiR57XGH4r62GoAiJqfWOM7okzKCeeSBnOIKPHtwgM0SQbvCvv7rmS6ZAacu4BbXZ5R9gOhdR9H3bi7lWLBNnqqLPIy0k6m4XBhtl40B6z/5AcJxjtKfwvIExl7VsQRqbW8gpPMsmJZfSp3uC35g1AkP+BJlju3RVoFZNo3JR18A5uc60NGD4zvzIdGTAOth4ZAZx0ZGQItHuNcLz/0CiavJdkjD65h4avf1vf7LFZ1uogJz6vLK3uDisXIBIGkXOlIpxTdjjjTQt6Khy50bYbXsG9JBrSUGhsBWpeRUnq2cZWOifhfueY95gFIDAu37oKR3FQ1YxGMg3UMq+L2VN2rtqodelSHof8SyYZVQWs7L0bjtgolId1tAAjHI7J1/+JIRXeUBjjaGGQAU+az9XFfiqn+VRAGG8JDdP/WmEqjhYpcy00LIBIBzCF9I9mbXCv8IX9fhPlI5NqWGO/v0ikpfn+hb5U16FcPYsx+xLb4la6nSbvrTDP5MthPyeLIIY7ZE/rNU4ajgPmI0/3RvD7WtEbo8UGPjnev55N2ELuFpEPzkNu9MzXqq8K0cWxk4lT2DQPi3rDO8x8i5jX7wWQi8e0neCMb0SUO67zRfaekZONGfaFl47LByciUuy5dhqxMPokhTE2WbzxqCyt/s2TqG66R0ocYHmzv9f7tJ+TES8NFyzL3fhNoZoW5IxWNE+stYWutd3LPwa7HKhhRAbl5uCEbEGjrUzTXwbzG0qvpmNtpnYnmKjzTaSAFNCxfw9edcjaxCiRKKIDd6GS/eDsGBgTvJexDfwGmVWm9jadZhee9jRFiZFtL6m7sY1oQa8F9ycxSuPANXCqWkApcaEfQLkt1yyfeRs5yC5O/6XGJ4TEtJmCTPJFRr95au20STIPgkoEF1mzZ+5ZRtWKUYuWJVZDwcA/lTy6oYp0/d0LGPRUXnXRm0qtIXQVdnoVhKZPeWACt9rujRL57MEDi2kHtfV/ucu+k03bN0fQlbalUJ0faY99GC6L8MO8MXTSmqDAxNSpqpIFPhgHgAg0YK/GZhlQjbQXE4tMDEDO9obNfp4W6m8fdznMesSSRINBG5FDf//DkT9pSRQsIdSg4VK7W7j2d2jsQUIyjJmbd/2zCTaqh0Yq0cH6mS/5g/cq3eGOiJbaCNo6oVwGURzXVAeVaGIfJFhd2A59sVp+rVfe1f8B6bVbCLIKgGUgpUokO0vTg6ouAxXGQKtveMhhBT83ukPIRZ02+qF1kvM+nNCVy8uzrB0+W9QIKbMio2m/7zW78xd5Tf9itocpLbRuNC5cuS/GyRGXw6fzFzjM1UITlQ5dlvoyYxuvb7ol4S1MyhkfMNZbif6/xic0wB3uSScez3oFTRbCHBd0cbJL3cLwfQjCBpGBrRVC7174qW4XWnw0eYGSSzTVSEDOlMaTUIGJO+s7/z8JxaZprcEsoB4+vt9/+uwtM/iyqLVPidu8ZTh+F1rsEWKwZhDAg/giVc6VzRq+DJCrhn81b/LYlLJOdgoAjID2VnwgU+mQhCL6KhgIqqiVraD25UIYEqxMcZ1aRcZvHa8x5gh5onPtsVcl53Xek9BOYqkyj64acX921zwqoY0lmNA81NE7BzVts3cwWDZ4Dk6uuzwtfJuJc7vVS+fdVDEg3ATwC9oG5/Vb1swTyzTsl2V4m+93bSQo5STFG5AruTDWTym6Lxtt4OrAeIVgdoyTJL+keHiHTNiL0/nO5oYwftSQK1aYBuA0e12t/FVN+LsCk0L/hfCCcke89LuP4d46qnFo3NLpHb+NFrvekXVT4GiZgMW2H0orIY0TpS15wlxVUaGCUo7YSN0yWDRU5+p41dCOs5/vXq1do7K+Byjj35/mPlQ+VEDqqF7OIBQrXfHgCXYPy8ye3Ih3io+tYA6nK0/2clIERrpA0AMHKLTGEO7q/IzIcOCwYN9W/ISH4v4uk9MhzNu7Fg2IPCq5CQF1GLuzQu+wNv2h94NIA2UJydawv5X2bHkZjv+kB/WQCYjxUNEU8ssUdxDZstpv2qNAHmI6BMD84olxMiwFdK5J80zc9x7de/cz3ZNIkkGIpMCZJqKKkaLVo1MLnR/h/hQeUvfqJmvkPeIre3EjnliNkKJKL0KNaupHzY7Eoztaj0cNOhJ5dxIRB2is3kLcSK1FZswRJR0B5OXX+Q4UlFIrhR10lIge3Fg5DnaGoZoOyFaaHztrdF251JubDsCZRDSWA0y6ysykO+h4jhXtuWF7D5Wp7B4Hx3EQvKsmPPZYcLevowjlWghHbRBEhwPI3bzjhNWXlqtym5ObYAeYxuHyvyYue2X4651f7Om3+m8KT7Y/JqLWXwgayCdzxHuJidti1ITuf/oXzeCfTRbG5ytXlDk/epX061W6BO074jI7nV518OkYtRJDnPqdDFAf0uWcATfk0h17+gP7GHjy0Rc0Ive9XmvA6gCkoMjNjMEA7GQ3xy7e12DzfNpIfND7GKKojMifTrvkDXrfa3o4wNYktY6/VlBdHtrcH9F7uMWICej/BjZXVX83WFGcVHx3nOXxSL59kE9bSmHc3Xp8iDbPuSG5GIRp3fTFHnmTzzGedl6al2gUbGFKtkC0jFNtKTk2rr8LEObiGgfCoSpTWknvAYDQBoj93s0KiRNPOqgY++Xka2cQiDwqUsLl8/i57YC/V6sy5/NvhViRRZgCzcyjNHGzZsYA5YMtUntyfC1gNFP7cL3AwVA+326NJI7MQJoxTqcHL/YhntsnYTR5R6GVVvFYIlW8Nv9qn3daoGXMz0MoAsXpCzbiHZ0XWkfw2qlJkmZjgQtMAEhHXNgokGRPfOprmtlvNZaNlGB1EjQTVX1Y4tCyJFZhdhID4CowB23uQF16NifyxH+DGnQrnxeklnG7UQV2BRVdr6ZEKZYv7Gj+PbpojzAskvbdtaFsataqPrLDoejjc6ZfPA5zA0iYcCvcNjzuy9SuT0uG8NWMTLv2OsImL++PQV1sifUENAwi4O3yBvzTy4J77B7mMBpjCYGXAyjFGFZL4eAazSmvZ8thJ0FFW+keLHL+ft1dQBKmXY6JatelGebcIC/PyLBHdfX9bRcauGg4xEO7mMl8AjlcPMczkPniNQpiQFqcDJYrFGoxMV2hskxMn0bRQT8Ajc6w6sQYkGl0CQUImPrGfie9dsk4mrCLMIFOqcm0WT8O8AiREEGmooBTO7WI0qk506NsV7ffvc0rVJERJKcyRyCmFZdTSn/SrBfjV7SXT3pQlgluoY4FBUCDDkzwBgjkrE1oFUA3ls+xVP10w5jjBIMwKBSQqRVAEDXw+Dyj+jH3ila8czULWsCKhWd4qGsMFN7++OGBAz9eXHjAO9m++mTXF6qiyG35Q+61yjYQKsBrjR4NNexrwVGqBwAZA6cr5mp8AhoyzPomJ6TLfWEJjEeRI3QsX5oQkNuyF7u650QFka+VjFeNRY6ALklleTW9I0v4ABKDCXTGkjv80vqVNk+FTL0bJK7ndSjjMJD7OBFIEywBPJFrxTdyzocmxEgG0zu1VDgsQuXITYCx1RRty89A/F+CdSAlbMlIkptCC0GrF/jFS8PAU+6TNV1eBqJrCr9BgH1mth8FtdfE7druR+xyZKn5idfUKzGW6ACGF4M61IRoSs9o6xmaj3dnAVQvFWUsMcR6MI3xTKJNyMxkhXhhvT0IxialnG7i/BBzXfMXYh5jl4BXzCSNlxU4+aboEgIDr48/+pfj8J3WcNccFfzV6eiX05qkNktmafoBcxrEsrM8WQV0VVSRybQyXPOqJ1yndwBI6BOGO9oGxGDAd+HcKaZlptCMJsR1Cp3m7F9HpBFSu/NYVj+WSDY7jWSFBlTBSCFyyPEUn8S9NmBVa+mwGVsz0Q+fxe23w1w6wVO7sVnZqRpmXJeXg72QFkl7Qda1lBzn/FW+rRwLvFxCsuad67Wmzab1RJdzPGsuq8AzW6tL+JiwW/VPUSBbBmV1+EjqQ28x1u9W5Eoy7zhsU8NT87CtNbZ0lPEpsoWMewxC80kPanfWPrQXmixWDXXz7uf1kBTr1J/iYuls7fUsyAChXjKcKOaCF4ySqkhMTGmjNqYiG5joBUi/SZpWvgxk28pyIPhf28YULINiqmbWPBKuTCLFruV7JfRgGM87XfNEFc7tgnYx503k/0UXJfpmjx6wKbKcvV5fqrctx+OrIn++TxRxSKlTScEIwd2vG5mg/p5wsQDpiD+X91XbkReKLB25Jvp/IJaJh715RXqBzwCwlY3URonyy+oZoTD8Ym8XMMv/dMllh0LCFZkZFn2gYcLG9iO+I5S/GyxwjajQLQtwH7o+n50vimC+ES8ePOpPDwlu4oG8KhS7NL/OTdIWPIHbSa6/9DfjOq9W66EpaK57R78PpEzVNLkTP2L6lllqDT6SDhIDIvQS3SQbxG96khXgvW/rME+tiXFXi+BC0udi9keyGlc3sLBN3CP3QXzswhBGTxvz2LmRMkU3rLuSkYR1Gzr7vj1VxTN1y1iciA0DswsPZ38eB6X10Uzk6HZqjzBK+EJ5osJJJ/s3b0MFRIWYlM15TPm1uzeOk1zQ96quClQLEZbpxmV/eAduIotXUYQZjWAkTulBJt7kw9uEnLo7OpZrf8k+0ZQP0agcOTLbfrekHji86Mxr7rTwve82mePKoAkkEthE45VI+f1VqpyWNW1kbBbVVfuatKt6MEKqyTUyxSFGHk81kY7CxkgMNexiikN0+IeiUNsfuktjfOAiMfDhbTe4rtxSEPvO4CCUGaktA58TGnSO8rHdCicmGkNrwWsnXgUWjhp8bllNcnQN10TbwxYPAwQKW/JJiYQadr4THXO+vWudiq3I47vqmEM/Ab3Dlq11Q7RmRWntYOEyESbTI8PZYwbtsmjcSwBtTAIHQ5h3I633h3FpOkT2c0PlMjzj0Q/OuqaTVt639fowVppqvSlNcK5KupBnrxfKHQK+SoKSuaO8PNMkYkbcEAc9F0I4uzPfRVP/q5QkvJVsVoJ8BEWW/q1+kivHEMQfb+J2NfJjSTG+WhjHjL8eqi7FgfVewxwmqG9IOnTkwDjAHUaJMIyhVkadW/+GQjLyNP4zyHcLAdWcB5zQ2kc/blAx2RKfG+ON3RfC+iQ5Th7V2i5abkoy0pjfyOwTjIvaq9slSCtoNGBZggBDOiWwau0CX4NAIThFyqu9VWCLr8TsqhQZvQP+xrywovGs6A079U7YBjhEXyQw4Q3rbQY1EQnxTPXNlHfn9vQnuhsJnzx6PZrCqry8fidPz2U1scmAMVPHxa/injIf+hDziEU02xWm9ou67OgebktON9V6wwVotoNOzVNJhiDBlHbktBwOjX1BlJHybLox5y/7NhR7uc8f85O6xdxueabhwtJjYcBzac56v6RbuI9IRvPzOnNbltj8Hh0ftwwhWyHAyiEat0oDSEVZ925jmxJKAqTo4/uHnkozgMDsnkzXPXBDJ1sDTawXy23mXuTJOYV6ZVWrervMaGGGQpgQjAnfP7KPZro+OKt/MpnoM0NeGQgIFAiH7dU7Nl1QbcMiwO6/5nIosJtrFB8w1kpqb6OjI9BgZHG1nzTMGA++HNrl4WQNcq3SajD4C9utQYAu/fETPFMMJeCDwHRCnPuRAlqJ5t0E5h3Wlh1Nw57LQ36kDjC3lS9w0a89eI8ym6BzEA25Cdz3LQAyz94Fvjqp7MyHrpm3PzmsV/tbSLF9NJBjFmzWPQ8Tfgvj3fi8dg78tXvEatqtUhLxsNp2VCU6IzSqafxWw93+Wk47skJv5qxM+tv7CrpYKvWLEylJNEXlh7GHm9UenNf2/szZOl+54P4ZWksh1r6+rphL68QYhmqW7DqKVrc2rjzPYcvFDmKtCGL/F62i3riMV9z+LoLnuVaMn4dtpNNFmQEQ4uEhDfLYU4x8G2OHCz7gnxLCa4zE4CFo9m/+ECmdzziVumHM/P00/BESH2rxUYMBL8/9NRG5fiskFJr4AO0qNUKUCgTRgEiFsTbGXtP4DTTzc8ZAmfNJuJQE5Kp7W7U7QZnBXKepfSHkYTEqgOhqo95Jw9i56kYGt4BWwX50mC27CCW92SVMl4tbUEhBDSB36zgztz5Zts0563Kjc34B+6ZUnMIk+BiQNvqSkZHnk3rHNSaYthO72IWLIxij0hcv7n228yc82FsQLK9jmptjY6estDfH3OSMaAj+poCLKwRFXvXWb6jwM9mG4nu1yug0Cc4L89w4EYek6dnV17VBfIxB2dmFFQdp0kqx3BM9gdMAr0KS7WLOSf3cn5eDItDLP2UW7MWaIR+GJ0EGcEL3ejBdu0to6vDh04JcRMNU55usmSn3jp74myzWE3azMIT96wr39F62c3G/ldGskbqTIMTk3gMg61vNBQ0cJSIxVdcgNb3xFDowwVyIqYz54F8Rqg0uQE4FIiUGZxJhND/AWhkukqIqLLZEpxj07kPBN6Zb2pWht/X5JrC8yJzPlvFhfJndQ4jcgjFyhvymr/a17uxTKHpKNWDEoL4nNa9/Prf7TYRw6Gyo6vcwYcUHk17SMb9aEdVnx24msNCDEKbj0OVzRaA3gFJeXZPObqJKvWqFlavGpxXnP+4ZYTl0Dmcri6vMdwX687ApG+ygiGHZDwNzU68F4JMPQ9JB45vLkCsE2w50QNP1kJZlI56dVGzfK1MyRqP4J6VshesfOT4hzR6MYq373IoONlLvENdYXN6pTxo5eRzQkwk2tZ1zmZqczCytqTEhpweKcBCCZ/FhizgLm8/x5ScBlO0wEXHZm90mpmL1gR/J2CUnz3wDU99YFFKqm01AZ8q2S5Fnh81CbD687c7K2OjWlZgdvEJA9M0JT3eKdIRd9GCx6g1TO5PWTE8OOphUDKdazyYnmMqFhFxfJ//cWJTsgYbol2a7Ob/Q69Fy3kb9K7aZLzH+Kl/uCzWnqTOrQonVL7LTFPr7wbTaepfAl5zSgMInjrGXY+Gspw+fCNgEU1zyC0Suum6VFyHBjdKWft7strrOXqOSQwxsYXp4F013mN9gZyu4Hc84A4dzIHN5UNXmxNn+vPjS82JM6klySWB9pLCzLBUgXiMDllaG6fT2PSBv/b+yaruyWBVcpsOKuEaQ37W3A3t9YFRcgB5rFMDjwOn3c0lfsg+5V+dBX2EmWLTSelNZkeq67CFnxaKtnlsAJRPBqYvoWVZcJKn0zSelrO2TwnailO7zgAHaMRmQYbXo9beBs16JWf7V8LjYGS/DYUKTTE1zKECC/pK1EKf6mxIgmV+mJ+Mc8h04qep+okIIEXaN351J3N0VUk7cEEaOLE1rFF3W4vqRcodPfbLqINF6QtTsfny1+O46J5ahlamZEyxglZtpjEkKd9yKDsgwnzqoAPN5o76IsI+FRaBc8u1qLBWxpKU615chTVegNFR5V4o1T2JGwVkueD6CjAhOplPnRyv8sauMnMy2wEMARR6AmCQ8S5ebL0nCEqjSztMoUyAEjQ6FDYqkGweu48DkBR5HjwlBloKVawYcDezxKBH8WWnMpJKZj1Ol+OHMmg5iq9xDswLx0iTNkujgatOkeRU0c/GmSSH+7GTTMLQJdj51l3EkojjEwWOjw8XBOm88GqC4bWPEE+U/5XYtZNJG/X4FYjgIvVd69RYVbMEMfPSKJ825e3XQ6RBesp/G+lkMk4VIxRakyUBPLO1u0UYnNG9ExAnPdOO0OfFvcPOL9rBJO8bR+q9Lp9/i+fH32KkaNR2WgoxQY3FY+rS2NUvtCOgZAaF9vny16WG/3zeUtRP9V28PcGivAHAwwCcRk0D0iohjAfgL/EKXJkr8gIFqbNq7lXUFRKqMbpBa182ol77SqJq1M5setGUJuSBKqYBYKdDZv3XdT/u6J5aKKkLvA5ez6PuWX0RT7kELSKDKfg9w9nwSmMmJHjbnr0blM2WvpiirR/nLid6SRN9+5KoLUb+pLw3QzD8JlS3X2q0m4BNRxfltr5KWqryOuuGDt6IOHSE8/zqGXMiTqgrUOfDH58NoWe0te4mFc1GxswvhZXWJZmaWaMJo2SBnuXa7+jIfFbnhNH74Z6jygwcqXsldYfI/Zh8BZbqTh2I7Hu44dilfbX8Uh18NVB3phRnTwpUonKquUs/iZXRnDFjtEmKg2YRQm2CP1FWRb/B92HqJlHT7Hs/Tpl3RrlxvkoskpNlW53/6Ujse0fkHLNeUm97TlDsaRXpfZkR1uWMTwhPv4oYM2Bv941R+c7nQ0yBdFNVQpZRkpejmIfjFrdQUA7DPwR69aq6Pzmk3IXarIMKG6R4MBdkB3j3HWxohnZLWpaNy/BMxS+84e4vPPfO/7+nLWVZsdpUY/nGDkQts0NGnRpZK/lW60tmncMoTepY5fMbow1GyKhqSXLbOZkz59l8DG9v9ZHPwA1roKz3MW/j2tN/U+lPQVYXTa6h1ePQkSWR2bp9OHmCCvT6s8v9PVG2ufK7dkbpY500gNx7fdArzH3yCjY33Fa5TbOuybLNdW8juJyJtikDn+5jMnMzIWP/+v12XkaXj195xk6eOKuvA5zeKk1i1PrSnmWA46Ca2ldgNqJ0rvLqM9X2EPn/QuMjLnLg0iVJ4H4r5S2PgpGdSdfVoiX/rBAq6yVDc30v8DOUae4oquSM0YDCIafLQ+hvEmB5b/f+QsTFtAR0zIVWeLyYbmrx3g9gHhVRfelCz9/exh19AGsyXcwuSaBiCzQIoctYvyhhkdCsC/cdZDce/1Fav35JQt+RJFAjiMRQhCdE4eS3SmfsREHe9LZa0ElOLhxxvs5uS/SnMYssyK9FxiucRjjOqfaIp2N8CmuNJqg3WvtMk+MlbAYeji9K94rx6U7nj9L1TGhVcAyz+Gb4sib21AW94HRzWbTrRKEkx5+KLE69Vc+8Cj1Vu2GkZ1AA2E4kaJ2aTjsEL2C0srAINXRAjnxwI3p5ED0NRYn9sT1iY9GPBJwhhd6WXEJ/Z44D0rufaDOA8dUj1SIqywRs2b7SjYcCYS8eefkwdWlpN0DvnecdwHVc3TqyCcUy7K2PMS2l2KZHzZfLCTCPaPq/NVc/Nlc5hVJoFvnNUpKWZcTsxVeHfH1mnELREECq9YES9v6FcvONCxXLQmf0k3S2dyNmsxbvlXM0u7lSqkx81md0rad3E33PPuPpDGM9UiBhSeJn3Sejmx+LdLCiZYcVxow59nCqrUmXGAbsR4O7wVQzyHdL6DX5s8k5BjHXlONz0PaIqS89xMhkYetMw6w7JZ5c/oJBH2jdZPbS6KbR0RpEe16BATLzU4QiHybxArrjBM8MKKP8Zz6MVbg/d8yb76U8nQzCK4Eqa5ombBm7/6xo2dR9O/ByfcU6qDu+efdLFAP4LiCr6C3aihDPjigUYuy0voLuX3Flevl7xXRtRZ4Vc48j2tgA7tK0wqv4OjLwCzZJn9lYIQuScQBEFMBjA6Vj8FTp4h3OphB6g0uA13nTnVLmKQ+zfELl+6znWX5nCWvbwak0t3q4qwWK3MAPKE2vqDEeCsFKvmJ2Ws+VOqnrA+ekCk9jaszBsZd71InADWijT4SHnyVmc55dv5ivXl1fED4vwNrxbiZHWeGinS3ImcoDAT1vGiLpP/D3NaiIPq9A2h5DT5SgaCVCh0JKu7DKsHjW9ZAACRxHgTSo5jrVWUJfGKweg2auQuittVidB+JaCdwYd0x9oJ4jyI5UygrB9Nzi2gbLVcCnpu+1ytsiWCbJb1Xxas8FhG/EX86taG6flZZauhaGnpRyfBB5ojGdsdPBVHEtb8R951oaNTvKXK7CddSeWaeOi2FIDPEhWhAk19RzuR9wSKEwvvi8nQFz649+fUlBMuDL7VmUBSsC1ExWwqY+uSdNKowEkpsBb+/KpWl6oGxymyR/e4uKjipBJrVPXg0nE2j6HL2JbCHNh01lV+/+6FUglhV8GTypzdvdfhYc7t0ZYtkyH/17wDakU7r1GAdUIXXmtxamhK2FdelBa4BPryblCC9gJG9htJue9LMrNS7mM6gbRA1xSFnWNsziDuGZeS3Dcu4bjsWaIebrgNnxpl/pLGxV5EtkFwDeh8fPyfPU8CZAM/Ljk3+Vi7jUtNZmZM8+f7d4wlUIkTHiAULRUKu0ODFIeyk20BiqLB7vvAT342SIDP+z5FPaa6Tjyqh/AsX2jFhbeIXKxDMb8fid0jHAWk6JKhswbtvtP6bDz+lYjvXIPwV1Y+nyft2uM8c1aUxmDHAUmZnJBvZXT43mxjXDHP05R1/dKfoExcgcYzv3wO5mazi7ugS01z6oUmByKtfQ6fA2+MQynPCoDHcp1eDtag/E3HQpHMWAgGkNh9wWR5Y48YG0W4CgvOrngI111j/x+MIuH5xFlVkxqptSjW+hnVbt9qxtXndEH5RtnxWfd9eP+kli/x3LU1WGsZVAkVElXD274LBGK0bMveEUbj/6EpnocEnvRSlglpE4GiAO5S4JdYb4uYd6oeK8vuZvTQaWMS3dEIJ2ssCxWz8DqYmc/b38ynz0DWCCeF1gCyipaLG2Kq9wqfHz3S6m7CS+H42nmDYAz2dYcx77M8purGOS5tQ4aykJXIDQBwHjIGSU+52M+1OV53rp4B3JbIXecQWEjfk9gkVoz8T6HJbIhFgm3quNMk+cIyRHlj/BdURXY8o7H7dBQfsdpLJhAsxS/1JtMkY8JoP4YdyOxzJY5x/+A9scOTXvPVoQAMqgmP899s6GvRtzNFGXLX7VHSnUj7VPO8K1qxaS/a/6v/YhRlUtNgnqnth3Jo/DKbdhdPn6HgB9YjU5GuN1uPyUXZJDZYfFwMfdqNPVoI8d1csoHMK5tquGoK060mIwBHMk3pFGqBosajr9g/5kBPrrtuIIEPFZnaAKSCQqLdeQq2B6Bs8WxD8+DfzGJ2nu0Xeb58spPoiHZAVV+I5lRUseUE0IA4E844UzFYADNYcLBW3zsP7aWzLnUZoQPuIDR3FX3bkM5mCunvXaPSi4PRkKnItEv8/OYiq8RSKQcaTwxX9YgdNbgPuXLwb5ARofv0Zj3WpHhNnlTq2Qu/lwvM3PUaqv8L7kpFqQR9aRaXfFanbLgbyxJ2kAx9oA1kRMyH3JXI06oQhRiZQ1LtWz+QKKxme0zAgI2q6/dmYApsA7WGeBae5+Y3eqkqDjXyS7Q+LzYgrM3EiqGHsibaKZKgFecxpGiMLXY5+kkuDKBdMkj2Bd8uTKI+aTWpu97gNp78fm891zYuT68sIEzE5JggpWjlWFSpzYayxvnOxJ3JYK/q8WbCy14KhtCFhdLOxCEAvyqXN3K+oP52ZzdxHiCAac5LX2TO5CTmkxp6zCT5JZDIBgnnmQU8GBowEvogfPni17fE1sljd55P2C4mWCNDr8l3hMH+4zpyZqp3iFbJx20nGtU+9LJozl0OxNrk/c0C9chEe+k4vUECnUaXbS8JqdnymqbZ1SCI+4+1BYMW4nzYKDLaqL3Nm08C/Ug7zNg2BuwhWepXrkqaRX58LCWLPDQyUzn369E1drtekeuNcI4SgdmyQZ/7xhXZ6sOKg9G/HEiJQsriRQThvHz4BhaFaXic4nlrz4LhUthGBLbnnB6tufJizYx4c6b2rY1E63pLDA8QdZsTOD7euNMku1a0T2nNQ9rOPBYPDyksaP+EmKTvqcgRycKMtzhHh37mAqVERuzIIMs/zXE9jGBpJBBWb8KCPZne6Sxw0+UFlY6/VeXJUHunHXY1csfc40Tw95XrkpLzxqX/LrsaYM7Y0UQ/Qe6PTjMQUXDseSMhYwHTXCohySQ+1fIjz/yjZWRFI1/a4d9eQzWLoGjz8O8ldPhzhpWFwwlaR0T1gpMP3VeHvDOx4RJocHJOSRQ+H4/nHJsiuXWDKowYZZW8Jk9vUiw2jExedn7glAsC/bgN1NrgIp1y+y3tmLd2V9x7yKVC+QK6MOFq19dlQflj350qUavBULMCTn0BvCRQY4q6VjniU6XHISUsaApCVoQeevAOuCUFcnwWfK+44XDo1qSpPF1wcnbH7N9aO+AzD212PgFlGkXlaQ3Gbfz9XIUMjulgGUREelr6IX+tR2K9H/yep959z5WLXlZ81Z8HCIV8CyU0JKYzkIeFqf6o2ywb2O73oRi7i8F6Vcn2zU1VWZpLfSXgTNkRtqM7r5s13UimLWtAVZs97rLcMRlwXzYp98ZnKvQLj/dpKn8nfNnU9V2Bp90frlQedeKt6zd4mPR53FKQ1J4r95n1G8ph0XG37DC9b185sWbnoyC4Q1iUvyy5IOxBrIqbqn/JSUWzdrlOiZGDJrU5IGuzUl5TaupUTIgFeLfT6uh0gIEJ5nZQ/8XjB0mmEZxTvocrU/BFoOaUvV/N48W3W/aQu5nR3KwsSByfSDAEq6qBqTVTkZtkaAd/1Rie2jkdRlZvxFMu0MGnLc0SHPII8eOz/bjfIhSQhAb38dSRcFmfRb+fpDrDHeazED6EHNayy0kESoRG+XFbJa6xWB6OlbwHVDwdO9Ka7bIOqLRHpZjwXmv/2DR9nu+2xwxE39cBHq/7Vv99HcvH8ZJeGmgHr8mBKQmOCTkvLkxf5k4FrqZuNpaRNhCB3puFuF5d2nnQbhgAaANLMCYAiGsJhX2bFM/r3BGhR/dkGPXeBQUJ4tTARQnVqA07mW/42Dv2k7Wa7hWU/wv7FTIWLwWyHX0Vqdg4BHrlJ7zh+b+T6fH+W3d53LS5rkXK5GIctMIttK+osfGYIvOD0BkkXBJR0EYUmteToIxpoaMVKZmCRC2BbmBLdUTIZiI1kVYKYnq9Q5xMGODu+6vCT2ofvYE0pmGbQ9Ln6wnBDYZUD/BL9rmiPn3n28Zs33OsHUQcLp2vjUEV5sOBLO2ScyescGu0N58y1q1NSNJuXCzI4fu4RWJtSIn3P3+9eAsMo/2NupFeaf70/usLGd2Z0F27EjLoIj+nmJ4/Q5edPFhVNpPURQrUzPALNNzEvx3e82rDtPpbZjugv7Abm2q2vMGwz5W+hGH0hkCzXdZhPFbLk0sR5vVhScLgAPdZIVZIjTuzwIKVuWmvpMr7Gwxgiglpy8ecfOAZcCpXRzG6lNuRB64D4G9AWD9vQi/crWV4Xq5VjJnRjQc3g4bJe+MmksjEctghn27n5i5PHZvW/gM0BsXzo8Pou6yOLnp49dGXpK/oLAbOdOel9h+kDqEtZunvsXa9EFomdl0QbDvk+H58SjszCVqVOXSgDpOdZjXWfZpFL6S/fd1Lq8FQS3LklgiNhdvE5GzgSO8uq3gtj8I2o+JzucnrUSrtoxa6IejmVQLGzF3rSCy3fdhBPhZnDdgctC89dRJ+PTfW4ga5WWAyaWspzFg5251FoByB8LUbD3AxhvV6M1ARNXRJ4NhPe2j9WOlu5I2KmCMGvGP5CbHAyZk3YhiuIdtDgOvre9Cz0yOWvHH5FpZQzqzyHE5XkTTFMU2JhG1nvne9SCi9zNvPnGj9h/bQXgpue78rpogXJl8oDSfMwz9fp4ocyOxEV1JCEslSsRvodEzPbUsMUYWDERNzR6f45Ku6EmW3qdD48dcFQtc9rr2wF3o85edZ/2SY0BSkOdQX1ahwPVBP554Q1Z4lbd0d/vrRCO5k3QBWOb3iML0vI4MRkiKwqt735Q2fkq0Xl1pI3nk4ll51cSEHOrFTctkxwLOiQl6HJh2q3iqHFmtOCSo0A4YLl+mllolm7FLpe/79gMoe7A5cbFPCbX9Z3GhI43FgBbWoq8pwaIoDlklRimVauOx355pv7v26P0MLrgiqWTOxJaIGO/UhHf7GSOm0r1O5m1sPYYn1bathmEkYfrQLiEWQ2/3IjunsIxgAmi6t4JsxalYxE4YyvD59EpzvswOjZUvSgkHwPZonVtaiMTLXnV3p0dKpCSSz38Kv8QbNFzqLbwbBBRUHw/nHSxNipNm5vtjfkuf06jWRwkctgu8wZqKwS/7IcGnFtmwnbJFPhpGcyV9GVFzCCG+TOeNgAWxOUPgmtLdD8JawVVDV+e3iR8kHuaZXIknncI/3uFnblTd2P/OdWvxl+9CXbqJb1CS8osg2fg/qaA9KvM3FQoZQ79JRZC/Upm90ABPCGzksTWJ7Xy9VHpnPZCgGzAVbJhmurq8tm24BjBvnm1GOKfotvCqXyIXFE1bYTRS1WtzgZrGWgR/oOUDnNgDPXqUfTmyFPfNCD9MX22hvuBans/Kl1DustiTunl9Kravj0NG1Ds5nkTqlQSYOfhgvRIowimmWAYWma55eqvaQL9GvHmuH/hIVB/tiN6s7yOW2iahReL8dNddIbMJ6BLVguJ4n1dnquV3ZNqi6V0H/Vn00j0cE80ERsZTgsHPJ0eUjxYik+eDtaEHnyAsYeR2AjRcGw=="),function(le){return le.charCodeAt(0)}),Y=new Uint8Array([177,156,215,89,13,111,230,1]),Z=new Uint8Array($.length),re=new Uint8Array(256),ce=0;ce<256;ce++)re[ce]=ce;var ue,se=0;for(ce=0;ce<256;ce++){se=(se+re[ce]+Y[ce%Y.length])%256;var ie=[re[se],re[ce]];re[ce]=ie[0],re[se]=ie[1]}ce=0,se=0;for(var me=0;me<0+$.length;me++){se=(se+re[ce=(ce+1)%256])%256;var i=[re[se],re[ce]];re[ce]=i[0],re[se]=i[1],ue=re[(re[ce]+re[se])%256],me>=0&&(Z[me-0]=$[me-0]^ue)}return l=!0,new Promise(function(le){(function(ee,A){return WebAssembly.instantiate(ee,A)})(Z.buffer,U).then(function(ee){l=!1,E=ee.instance.exports,w.__wbindgen_wasm_module=ee.module,le()})})}().then(function(){t=N.new(),O(t)})})).then(function(O){x=O});var Q=!0;setInterval(function(){Object(s.getParameter)("UPLOAD_LOG")&&J.info("console log upload")},9e5);var J=function(){var O,w,U,$,Y,Z,re=null,ce=["DEBUG","INFO","WARNING","ERROR","NONE"],ue=0,se=function(i,le,ee){var A={};Array.isArray(i)||(i=[i]),i=i.map(function(ge){return{log_item_id:o++,log_level:ge.log_level,payload_str:ge.payload}}),A={timestamp:Date.now(),sdk_version:s.VERSION,process_id:Object(m.getProcessId)(),payload:JSON.stringify(i)},x?A.hash=x.get_digest("".concat(A.payload).concat(A.process_id).concat(A.timestamp)):ee&&ee();try{var fe=re,Ee=re||"https://".concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2");Object(y.post)(Ee,A,function(ge){ge==="OK"?le&&le(ge):ee&&ee(ge)},function(ge){ee&&ee(ge)},fe?{withCredentials:!0}:{withCredentials:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}catch(ge){ee&&ee(ge)}},ie=function(i,le){if(Object(s.getParameter)("UPLOAD_LOG"))try{le=Array.prototype.slice.call(le);var ee="";if(le.forEach(function(A){S()(A)==="object"&&(A=JSON.stringify(A)),ee=ee+A+" "}),L.push({payload:ee,log_level:i}),Q)return;h==="free"&&function A(fe){h="uploading",setTimeout(function(){se(fe,function(){G=0,L.length!==0?(M=L.length<10?L.splice(0,L.length):L.splice(0,10),A(M)):h="free"},function(){setTimeout(function(){A(M)},G++<2?200:1e4)})},3e3)}(M=L.length<10?L.splice(0,L.length):L.splice(0,10))}catch{}};w=function(){for(var i=[0],le=0;le<arguments.length;le++)i.push(arguments[le]);O.apply(this,i)},U=function(){for(var i=[1],le=0;le<arguments.length;le++)i.push(arguments[le]);O.apply(this,i)},$=function(){for(var i=[2],le=0;le<arguments.length;le++)i.push(arguments[le]);O.apply(this,i)},Y=function(){for(var i=[3],le=0;le<arguments.length;le++)i.push(arguments[le]);O.apply(this,i)};var me={};return Z=function(i){me[i]||($.apply(void 0,arguments),me[i]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,stopWaitJoin:function(){Q=!1},enableLogUpload:function(){Object(s.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(s.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(i){re=i?"https://".concat(i,"/ls/?h=").concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v2"):"https://".concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2")},setLogLevel:function(i){i>4?i=4:i<0&&(i=0),ue=i},log:O=function(){var i=arguments[0],le=arguments;if(le[0]=g()+" Agora-SDK ["+(ce[i]||"DEFAULT")+"]:",ie(i,le),!(i<ue))switch(i){case 0:case 1:console.log.apply(console,le);break;case 2:console.warn.apply(console,le);break;case 3:console.log.apply(console,le);break;default:return void console.log.apply(console,le)}},debug:w,info:U,warning:$,deprecate:Z,error:Y}}();H.default=J},function(z,H,I){I.r(H),I.d(H,"report",function(){return p}),I.d(H,"SESSION_INIT",function(){return b}),I.d(H,"JOIN_CHOOSE_SERVER",function(){return R}),I.d(H,"JOIN_GATEWAY",function(){return D}),I.d(H,"PUBLISH",function(){return _}),I.d(H,"SUBSCRIBE",function(){return j}),I.d(H,"getProcessId",function(){return k});var E=I(46),f=I.n(E),S=I(7),g=I.n(S),y=I(2),s=I(0),m=I(14),r=I(28),a=I.n(r),d=I(47);function T(n,N){var l=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);N&&(t=t.filter(function(x){return Object.getOwnPropertyDescriptor(n,x).enumerable})),l.push.apply(l,t)}return l}function C(n){for(var N=1;N<arguments.length;N++){var l=arguments[N]!=null?arguments[N]:{};N%2?T(Object(l),!0).forEach(function(t){f()(n,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):T(Object(l)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(l,t))})}return n}var v,u,b="session_init",R="join_choose_server",D="join_gateway",_="publish",j="subscribe",q=new(I.n(d)).a,B={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},W=null,k=function(){return W||(W="process-"+a()(),s.default.info("processId: "+W)),W},p=(u=0,(v={list:{},setProxyServer:function(n){q.setProxy(n),v.proxyServerURL=n},getUrl:function(){return v.proxyServerURL?"https://".concat(v.proxyServerURL,"/rs/?h=").concat(Object(y.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(y.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message")},getBackUrl:function(){return v.proxyServerURL?"https://".concat(v.proxyServerURL,"/rs/?h=").concat(Object(y.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(y.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message")},getSessionStartTime:function(n){return v.list[n]?v.list[n].startTime:(s.default.DEBUG("[getSessionStartTime]: session ".concat(n," no exit")),0)},sessionInit:function(n,N){var l=g()({},B);l.startTime=+new Date,l.sid=n,l.cname=N.cname,v.list[n]=l;var t=g()({},{willUploadConsoleLog:Object(y.getParameter)("UPLOAD_LOG"),areaVersion:"global"},N.extend),x=g()({},l);x.eventType=b,x.appid=N.appid,x.browser=navigator.userAgent,x.build=y.BUILD,x.lts=+new Date,x.elapse=x.lts-x.startTime,x.extend=JSON.stringify(t),x.mode=N.mode,x.process=k(),x.success=N.succ,x.version=y.VERSION,delete x.startTime,v.send({type:"Session",data:x}),v._flushInvokeReport(n)},joinChooseServer2:function(n,N,l){if(v.list[n]){v.list[n].uid||(N.uid&&(v.list[n].uid=parseInt(N.uid)),N.cid&&(v.list[n].cid=parseInt(N.cid)),N.vid&&(v.list[n].vid=parseInt(N.vid)));var t=g()({},v.list[n]);t.eventType=R;var x=N.lts;t.lts=Date.now(),t.eventElapse=t.lts-x,t.chooseServerAddr=N.csAddr,t.errorCode=N.ec,t.elapse=t.lts-t.startTime,t.success=N.succ,t.chooseServerIp=N.chooseServerIp||"",t.chooseServerAddrList=JSON.stringify(N.serverList),delete t.startTime,v.send({type:"JoinChooseServer",data:t})}},joinChooseServer:function(n,N,l){if(v.list[n]){l&&(N.uid&&(v.list[n].uid=parseInt(N.uid)),N.cid&&(v.list[n].cid=parseInt(N.cid)),N.vid&&(v.list[n].vid=parseInt(N.vid)));var t=g()({},v.list[n]);t.eventType=R;var x=N.lts;t.lts=Date.now(),t.eventElapse=t.lts-x,t.chooseServerAddr=N.csAddr,t.errorCode=N.ec,t.elapse=t.lts-t.startTime,t.success=N.succ,t.chooseServerIp=N.chooseServerIp||"",t.chooseServerAddrList=JSON.stringify(N.serverList),delete t.startTime,v.send({type:"JoinChooseServer",data:t})}},reqUserAccount:function(n,N){N.vid&&(v.list[n].vid=parseInt(N.vid));var l=g()({},v.list[n]),t=N.lts;l.eventType="req_user_account",l.lts=Date.now(),l.success=N.success,l.serverAddress=N.serverAddress,l.stringUid=N.stringUid,l.uid=N.uid,l.errorCode=N.errorCode,l.elapse=l.lts-l.startTime,l.eventElapse=l.lts-t,l.extend=typeof N.extend=="string"?N.extend:JSON.stringify(N.extend),delete l.startTime,v.send({type:"ReqUserAccount",data:l})},joinGateway:function(n,N){N.vid&&(v.list[n].vid=parseInt(N.vid)),N.uid&&(v.list[n].uid=parseInt(N.uid));var l=g()({},v.list[n]),t=N.lts;l.eventType=D,l.firstSuccess=N.firstSuccess,l.lts=Date.now(),l.gatewayAddr=N.addr,l.success=N.succ,l.errorCode=N.ec,l.elapse=l.lts-l.startTime,l.eventElapse=l.lts-t,delete l.startTime,v.send({type:"JoinGateway",data:l})},publish:function(n,N){var l=g()({},v.list[n]);l.eventType=_;var t=N.lts;l.lts=Date.now(),l.eventElapse=l.lts-t,l.elapse=l.lts-l.startTime,l.success=N.succ,l.errorCode=N.ec,l.audio=N.audio,l.video=N.video,l.screenshare=N.screenshare,l.publishRequestid=N.publishRequestid,l.p2pid=N.p2pid,N.videoName&&(l.videoName=N.videoName),N.audioName&&(l.audioName=N.audioName),N.screenName&&(l.screenName=N.screenName),delete l.startTime,v.send({type:"Publish",data:l}),v._flushInvokeReport(n)},subscribe:function(n,N){var l=g()({},v.list[n]);l.eventType=j;var t=N.lts;l.lts=Date.now(),l.eventElapse=l.lts-t,l.elapse=l.lts-l.startTime,l.errorCode=N.ec,l.success=N.succ,l.subscribeRequestid=N.subscribeRequestid,l.p2pid=N.p2pid,isFinite(N.peerid)?l.peer=N.peerid:l.peerSuid=""+N.peerid,typeof N.video=="boolean"&&(l.video=N.video),typeof N.audio=="boolean"&&(l.audio=N.audio),delete l.startTime,v.send({type:"Subscribe",data:l}),v._flushInvokeReport(n)},firstRemoteFrame:function(n,N){var l=g()({},v.list[n]);l.eventType="first_remote_frame";var t=N.lts;l.lts=Date.now(),l.eventElapse=l.lts-t,l.elapse=l.lts-l.startTime,l.width=N.width,l.height=N.height,l.success=N.succ,l.errorCode=N.ec,isFinite(N.peerid)?l.peer=N.peerid:l.peerSuid=""+N.peerid,delete l.startTime,v.send({type:"FirstFrame",data:l})},firstVideoReceived:function(n,N){var l=g()({},v.list[n]);l.eventType="first_video_received",l.lts=Date.now(),l.peer=N.peerid,l.uid=N.uid,l.elapse=N.elapse,l.subscribeElapse=N.subscribeElapse,l.subscribeRequestid=N.subscribeRequestid,l.p2pid=N.p2pid,v.send({type:"FirstVideoReceived",data:l})},firstAudioReceived:function(n,N){var l=g()({},v.list[n]);l.eventType="first_audio_received",l.lts=Date.now(),l.peer=N.peerid,l.uid=N.uid,l.elapse=N.elapse,l.subscribeElapse=N.subscribeElapse,l.subscribeRequestid=N.subscribeRequestid,l.p2pid=N.p2pid,v.send({type:"FirstAudioReceived",data:l})},firstVideoDecode:function(n,N){var l=g()({},v.list[n]);l.eventType="first_video_decode",l.lts=Date.now(),l.peer=N.peerid,l.uid=N.uid,l.elapse=N.elapse,l.videowidth=N.width,l.videoheight=N.height,l.subscribeElapse=N.subscribeElapse,l.subscribeRequestid=N.subscribeRequestid,l.p2pid=N.p2pid,v.send({type:"FirstVideoDecode",data:l})},firstAudioDecode:function(n,N){var l=g()({},v.list[n]);l.eventType="first_audio_decode",l.lts=Date.now(),l.uid=N.uid,l.peer=N.peerid,l.elapse=N.elapse,l.subscribeElapse=N.subscribeElapse,l.subscribeRequestid=N.subscribeRequestid,l.p2pid=N.p2pid,v.send({type:"FirstAudioDecode",data:l})},onAddAudioStream:function(n,N){var l=g()({},v.list[n]);l.eventType="on_add_audio_stream",l.lts=Date.now(),l.uid=N.uid,l.peer=N.peerid,v.send({type:"OnAddAudioStream",data:l})},onAddVideoStream:function(n,N){var l=g()({},v.list[n]);l.eventType="on_add_video_stream",l.lts=Date.now(),l.uid=N.uid,l.peer=N.peerid,v.send({type:"OnAddVideoStream",data:l})},onUpdateStream:function(n,N){var l=g()({},v.list[n]);l.eventType="on_update_stream",l.lts=Date.now(),l.uid=N.uid,l.peer=N.peerid,l.audio=N.audio,l.video=N.video,v.send({type:"OnUpdateStream",data:l})},onRemoveStream:function(n,N){var l=g()({},v.list[n]);l.eventType="on_remove_stream",l.lts=Date.now(),l.uid=N.uid,l.peer=N.peerid,v.send({type:"OnRemoveStream",data:l})},streamSwitch:function(n,N){var l=g()({},v.list[n]);l.eventType="stream_switch",l.lts=Date.now(),l.isDual=N.isdual,l.elapse=l.lts-l.startTime,l.success=l.succ,delete l.startTime,v.send({type:"StreamSwitch",data:l})},audioSendingStopped:function(n,N){var l=g()({},v.list[n]);l.eventType="audio_sending_stopped",l.lts=Date.now(),l.elapse=l.lts-l.startTime,l.reason=N.reason,l.success=N.succ,delete l.startTime,v.send({type:"AudioSendingStopped",data:l})},videoSendingStopped:function(n,N){var l=g()({},v.list[n]);l.eventType="video_sending_stopped",l.lts=Date.now(),l.elapse=l.lts-l.startTime,l.reson=N.reason,l.success=N.succ,delete l.startTime,v.send({type:"VideoSendingStopped",data:l})},requestProxyAppCenter:function(n,N){var l=g()({},v.list[n]),t=N.lts;l.eventType="request_proxy_appcenter",l.lts=Date.now(),l.eventElapse=l.lts-t,l.elapse=l.lts-l.startTime,l.extend=N.extend+"",l.APAddr=N.APAddr,l.workerManagerList=N.workerManagerList,l.response=N.response,l.errorCode=N.ec,l.success=N.succ,delete l.startTime,v.send({type:"RequestProxyAppCenter",data:l})},requestProxyWorkerManager:function(n,N){var l=g()({},v.list[n]),t=N.lts;l.eventType="request_proxy_worker_manager",l.lts=Date.now(),l.eventElapse=l.lts-t,l.elapse=l.lts-l.startTime,l.extend=N.extend,l.workerManagerAddr=N.workerManagerAddr,l.response=N.response,l.errorCode=N.ec,l.success=N.succ,delete l.startTime,v.send({type:"RequestProxyWorkerManager",data:l})},requestWorkerEvent:function(n,N){var l=g()({},v.list[n]),t=l.startTime,x=Date.now();delete(l=C({},l,{},N,{elapse:x-t,lts:x,productType:"WebRTC"})).startTime,v.send({type:"WorkerEvent",data:l})},requestApWorkerEvent:function(n,N){var l=g()({},v.list[n]),t=l.startTime,x=Date.now();l=C({},l,{},N,{elapse:x-t,lts:x}),v.send({type:"APWorkerEvent",data:l})},sendCustomReportMessage:function(n,N,l){var t={type:"UserAnalytics",data:C({sid:n},N)},x=v.getUrl(),o=!!v.proxyServerURL;Object(m.post)(x,t,function(h){l&&l()},function(h){var L=v.getBackUrl();Object(m.post)(L,t,function(M){l&&l()},function(M){l&&l("Failed")},o?{timeout:Object(y.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(y.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},o?{timeout:Object(y.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(y.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},joinChannelTimeOut:function(n){v.send({type:"JoinChannelTimeout",data:C({},n)})},peerPublishStatus:function(n){v.send({type:"PeerPublishStatus",data:C({},n)})},joinWebProxyAP:function(n){v.send({type:"JoinWebProxyAP",data:C({},n)})},webSocketQuit:function(n){v.send({type:"WebSocketQuit",data:C({},n)})}}).reportApiInvoke=function(n,N){var l=N.tag,t=N.name,x=N.getStates,o=N.options,h=N.timeout,L=h===void 0?6e4:h,M=N.callback,G=N.reportResult,Q=G===void 0||G,J=Date.now(),O=0,w=u++,U=function(){return C({tag:l,invokeId:w,sid:n,name:t,apiInvokeTime:J,options:o},x&&{states:(Z=x(),Object.keys(Z).reduce(function(re,ce){var ue=re;return Z[ce]!=null&&(ue[ce]=Z[ce]),ue},{}))});var Z},$=!!Object(y.getParameter)("SHOW_REPORT_INVOKER_LOG");$&&s.default.info("".concat(t," start"));var Y=setTimeout(function(){p._sendApiInvoke(C({},U(),{error:"API_INVOKE_TIMEOUT",success:!1}))},L);return function(Z,re){if(clearTimeout(Y),++O>1&&(Z="EXECUTOR_INVOKE_".concat(O)),Z)return p._sendApiInvoke(C({},U(),{success:!1,error:Z},x&&{states:x()})),$&&s.default.info("".concat(t," onFailure"),Z),M&&M(Z);p._sendApiInvoke(C({},U(),{success:!0},Q&&{result:re},{},x&&{states:x()})),$&&s.default.info("".concat(t," onSuccess")),M&&M(null,re)}},v._cachedItems=[],v._cacheInvokeReport=function(n){n.lts||(n.lts=Date.now()),v._cachedItems.push(n),v._cachedItems.length>50&&v._cachedItems.shift()},v._flushInvokeReport=function(n){if(v._cachedItems.length){var N=v._cachedItems;v._cachedItems=[],s.default.debug("Flush cached event reporting:",N.length),N.forEach(function(l,t){l.sid=n,setTimeout(function(){v._sendApiInvoke(l)},5e3+500*t)})}},v._sendApiInvoke=function(n){var N=n.tag,l=n.invokeId,t=n.sid,x=n.name,o=n.result,h=n.states,L=n.options,M=n.error,G=n.success,Q=n.apiInvokeTime,J=n.lts,O=Object(y.getParameter)("NOT_REPORT_EVENT");if(!(N&&O instanceof Array&&O.indexOf(N)!==-1))if(v.list[t]){var w=v.list[t],U=w.startTime,$=w.cname,Y=w.uid,Z=w.cid,re=(J=J||Date.now())-U,ce=J-Q,ue="";if(L)try{ue=JSON.stringify(L)}catch{ue=L.toString()}var se=C({invokeId:l,sid:t,cname:$,cid:Z,lts:J,uid:Y,success:G,elapse:re,apiName:x,execElapse:ce},L!==void 0&&{options:ue},{},h!==void 0&&{execStates:JSON.stringify(h)},{},M!==void 0&&{errorCode:JSON.stringify(M)},{},o!==void 0&&{execResult:JSON.stringify(o)});v.send({type:"ApiInvoke",data:se})}else v._cacheInvokeReport(arguments[0])},v.sendCache=[],v.sendTimer=null,v.send=function(n){if(n.data){var N=n.data;v._lastLts&&v._lastLts>=N.lts&&(N.lts=v._lastLts+1),v._lastLts=N.lts}if(v.sendCache.push(n),v.sendTimer===null)return function l(){v.sendTimer=setTimeout(function(){if(v.sendCache.length!==0){var t=v.sendCache.length<10?v.sendCache.splice(0,v.sendCache.length):v.sendCache.splice(0,10),x=v.list[t[0].data.sid].vid;return q.sendReportList(t,x),l()}v.sendTimer=null},Object(y.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},v)},function(z,H,I){Object.defineProperty(H,"__esModule",{value:!0}),H.BUILD="v3.6.10-0-g9f81d6e-dirty",H.VERSION="3.6.10";var E=0*Date.now()+11499+86604+5615+6547+846;H.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,100,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},H.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var f={AREA_SETTING:["NORTH_AMERICA","OVERSEA"],WEBCS_DOMAIN:["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],LOG_UPLOAD_SERVER:"logservice-oversea.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1-oversea.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"statscollector-2-oversea.agora.io",ENABLE_LIVE_SERVER_LIST:!1,LIVE_SERVER_LIST:[],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,GATEWAY_DOMAINS:["edge.agora.io"],WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,LIVESTREAMING_ALIGN:!0,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e7,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,REPORT_STATS_TIMEOUT:3e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,TICKET_RENEW_TIMEOUT:828e5,LIVE_STREAMING_TIMEOUT:12e4,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,FORCE_CHANGED_GATEWAY_FLAG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",CHROME_NEW_STATS:!1,AP_BACKOFF_MAX_TIME:8,SET_DEFAULT_TURNSERVER:!0,TURN_SERVER_PASSWORD:E.toString(),PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",NGINX:"webrtc-cloud-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CR:!0,CRL:10,CRI:6,CUSTOMER_REPORT_TIMEOUT:5e3,LIVE_STREAMING_ADDRESS:"",CHOOSE_SERVER_FRAGEMENT_LENGTH:4,PLAN:"plan-b"};f.AREA_SETTING=["CHINA","GLOBAL"],f.WEBCS_DOMAIN=["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],f.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],f.PROXY_CS=["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],f.CDS_AP=["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],f.ACCOUNT_REGISTER=["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],f.UAP_AP=["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],f.LOG_UPLOAD_SERVER="logservice.agora.io",f.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",f.EVENT_REPORT_BACKUP_DOMAIN="web-3.statscollector.sd-rtn.com",f.GATEWAY_DOMAINS=["edge.agora.io","edge.sd-rtn.com"],f.NGINX="webrtc-cloud-proxy.sd-rtn.com",f.PROXY_SERVER_TYPE3=["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],H.setParameter=function(S,g){return f[S]!==void 0&&(f[S]=g,!0)},H.getParameter=function(S){return f[S]!==void 0?f[S]:null}},function(z,H,I){I.r(H),I.d(H,"checkValidObject",function(){return s}),I.d(H,"checkValidString",function(){return m}),I.d(H,"checkValidNumber",function(){return r}),I.d(H,"checkValidArray",function(){return a}),I.d(H,"checkValidFloatNumber",function(){return d}),I.d(H,"checkValidBoolean",function(){return T}),I.d(H,"checkValidEnum",function(){return y}),I.d(H,"checkValidUID",function(){return C}),I.d(H,"isValidString",function(){return v}),I.d(H,"isValidNumber",function(){return u}),I.d(H,"isValidBoolean",function(){return R}),I.d(H,"isASCII",function(){return j}),I.d(H,"isInteger",function(){return q}),I.d(H,"isNumber",function(){return B}),I.d(H,"isString",function(){return W}),I.d(H,"isArray",function(){return k}),I.d(H,"isEmpty",function(){return p}),I.d(H,"isValidToken",function(){return D}),I.d(H,"isValidChannelName",function(){return _});var E=I(11),f=I.n(E),S=I(10),g=I(0),y=function(n,N,l){for(var t=0;t<l.length;t++)if(n===l[t])return!0;throw new Error("".concat(N," can only be set as ").concat(JSON.stringify(l)))},s=function(n,N){if(!n)throw new Error("Invalid param: ".concat(N||"param"," cannot be empty"));if(f()(n)!=="object")throw new Error("".concat(N||"This paramter"," is of the object type"));return!0},m=function(n,N,l,t,x){if(p(l)&&(l=1),t=t||255,p(x)&&(x=!0),p(n))throw new Error("".concat(N||"param"," cannot be empty"));if(!v(n,l,t,x))throw new Error("Invalid ".concat(N||"string param",": Length of the string: [").concat(l,",").concat(t,"].").concat(x?" ASCII characters only.":""))},r=function(n,N,l,t){if(p(l)&&(l=1),t=t||1e4,p(n))throw new Error("".concat(N||"param"," cannot be empty"));if(!u(n,l,t))throw new Error("Invalid ".concat(N||"number param",": The value range is [").concat(l,",").concat(t,"]. integer only"))},a=function(n,N){if(!Array.isArray(n))throw new Error("".concat(N," should be an array"))},d=function(n,N,l,t){if(n==null)throw new Error("".concat(N||"param"," cannot be null"));if(p(l)&&(l=0),t=t||1e4,p(n))throw new Error("".concat(N||"param"," cannot be empty"));if(!b(n,l,t))throw new Error("Invalid ".concat(N||"number param",": The value range is [").concat(l,",").concat(t,"]."))},T=function(n,N){if(p(n))throw new Error("".concat(N||"param"," cannot be empty"));if(!R(n))throw new Error("Invalid ".concat(N||"boolean param",": The value is of the boolean type."))},C=function(n){if(!Object(S.is32Uint)(n)&&!v(n,1,255))throw g.default.error("Invalid UID ".concat(n," ").concat(f()(n))),new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")},v=function(n,N,l,t){return N||(N=0),l||(l=Number.MAX_SAFE_INTEGER),p(t)&&(t=!0),W(n)&&(!t||j(n))&&n.length>=N&&n.length<=l},u=function(n,N,l){return q(n)&&n>=N&&n<=l},b=function(n,N,l){return B(n)&&n>=N&&n<=l},R=function(n){return typeof n=="boolean"},D=function(n){return v(n,1,2047)},_=function(n){return W(n)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n)},j=function(n){if(typeof n=="string"){for(var N=0;N<n.length;N++){var l=n.charCodeAt(N);if(l<0||l>255)return!1}return!0}},q=function(n){return typeof n=="number"&&n%1==0},B=function(n){return typeof n=="number"},W=function(n){return typeof n=="string"},k=function(n){return n instanceof Array},p=function(n){return n==null}},function(z,H,I){I.r(H),I.d(H,"APErrorCode",function(){return E}),I.d(H,"GatewayErrorCode",function(){return f}),I.d(H,"StringUidErrorCode",function(){return S}),I.d(H,"JOIN_GS_TRYNEXT_LIST",function(){return g}),I.d(H,"JOIN_CS_RETRY_LIST",function(){return y}),I.d(H,"JOIN_PROXY_RETRY_LIST",function(){return s}),I.d(H,"INJECT_STREAM_STATUS",function(){return m}),I.d(H,"WEBSOCKET_CLOSE_REASON",function(){return r});var E={1010100:"NO_FLAG_SET",1010101:"FLAG_SET_BUT_EMPTY",1010102:"INVALID_FALG_SET",2010005:"INVALID_VENDOR_KEY",2010007:"INVALID_CHANNEL_NAME",2010008:"INTERNAL_ERROR",2010009:"NO_AUTHORIZED",2010010:"DYNAMIC_KEY_TIMEOUT",2010011:"NO_ACTIVE_STATUS",2010013:"DYNAMIC_KEY_EXPIRED",2010014:"STATIC_USE_DYANMIC_KEY",2010015:"DYNAMIC_USE_STATIC_KEY",2010016:"USER_OVERLOAD",2010018:"FORBIDDEN_REGION",2010019:"CANNOT_MEET_AREA_DEMAND"},f={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",2011:"ERR_NOT_JOINED",2012:"WARN_REPEAT_JOIN",2013:"ERR_INVALID_VENDOR_KEY",2014:"ERR_INVALID_CHANNEL_NAME",2015:"ERR_INVALID_STRINGUID",2016:"ERR_TOO_MANY_USERS",2017:"ERR_SET_CLIENT_ROLE_TIMEOUT",2018:"ERR_SET_CLIENT_ROLE_NO_PERMISSION",2019:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",2020:"ERR_PUBLISH_REQUEST_INVALID",2021:"ERR_SUBSCRIBE_REQUEST_INVALID",2022:"ERR_NOT_SUPPORTED_MESSAGE",2023:"ERR_ILLEAGAL_PLUGIN",2028:"ILLEGAL_AES_PASSWORD",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},S={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},g=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],y=["NO_SERVICE_AVAILABLE"],s=["NO_SERVICE_AVAILABLE","REQUEST_PROXY_SERVER_FAILED","REQUEST_PROXY_SERVER_TIME_OUT"],m={INJECT_STREAM_STATUS_START_SUCCESS:0,INJECT_STREAM_STATUS_START_ALREADY_EXISTS:1,INJECT_STREAM_STATUS_START_UNAUTHORIZED:2,INJECT_STREAM_STATUS_START_TIMEDOUT:3,INJECT_STREAM_STATUS_START_FAILED:4,INJECT_STREAM_STATUS_STOP_SUCCESS:5,INJECT_STREAM_STATUS_STOP_NOT_FOUND:6,INJECT_STREAM_STATUS_STOP_UNAUTHORIZED:7,INJECT_STREAM_STATUS_STOP_TIMEDOUT:8,INJECT_STREAM_STATUS_STOP_FAILED:9,INJECT_STREAM_STATUS_BROKEN:10},r={WS_DISCONNECT:"WS_DISCONNECT"};H.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",NO_TRACK_IN_STREAM:"NO_TRACK_IN_STREAM",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",PLAYER_NOT_FOUND:"PLAYER_NOT_FOUND",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN",BAD_ENVIRONMENT:"BAD_ENVIRONMENT",LOAD_AUDIO_FAILED:"LOAD_AUDIO_FAILED"}},function(z,H,I){I.r(H),I.d(H,"getBrowserInfo",function(){return R}),I.d(H,"getBrowserVersion",function(){return d}),I.d(H,"getBrowserOS",function(){return T}),I.d(H,"isChrome",function(){return E}),I.d(H,"isSafari",function(){return f}),I.d(H,"isFireFox",function(){return g}),I.d(H,"isOpera",function(){return y}),I.d(H,"isEdge",function(){return S}),I.d(H,"isQQBrowser",function(){return s}),I.d(H,"isWeChatBrowser",function(){return m}),I.d(H,"isLegacyChrome",function(){return v}),I.d(H,"isSupportedPC",function(){return r}),I.d(H,"isSupportedMobile",function(){return a}),I.d(H,"getChromeKernelVersion",function(){return b}),I.d(H,"isChromeKernel",function(){return C});var E=function(){var D=R();return D.name&&D.name==="Chrome"},f=function(){var D=R();return D.name&&D.name==="Safari"},S=function(){var D=R();return D.name&&D.name==="Edge"},g=function(){var D=R();return D.name&&D.name==="Firefox"},y=function(){var D=R();return D.name&&D.name==="OPR"},s=function(){var D=R();return D.name&&D.name==="QQBrowser"},m=function(){var D=R();return D.name&&D.name==="MicroMessenger"},r=function(){var D=T();return D==="Linux"||D==="Mac OS X"||D==="Mac OS"||D.indexOf("Windows")!==-1},a=function(){var D=T();return D==="Android"||D==="iOS"},d=function(){return R().version},T=function(){return R().os},C=function(){return!!navigator.userAgent.match(/chrome\/[\d]+/i)};function v(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var u,b=function(){var D=navigator.userAgent.match(/chrome\/[\d]+/i);return D&&D[0]&&D[0].split("/")[1]},R=(u=function(){var D,_=navigator.userAgent,j=_.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];j[1]==="Chrome"&&(D=_.match(/(OPR(?=\/))\/?(\d+)/i))!=null&&(j=D),j[1]==="Safari"&&(D=_.match(/version\/(\d+)/i))!=null&&(j[2]=D[1]),~_.toLowerCase().indexOf("qqbrowser")&&(D=_.match(/(qqbrowser(?=\/))\/?(\d+)/i))!=null&&(j=D),~_.toLowerCase().indexOf("micromessenger")&&(D=_.match(/(micromessenger(?=\/))\/?(\d+)/i))!=null&&(j=D),~_.toLowerCase().indexOf("edge")&&(D=_.match(/(edge(?=\/))\/?(\d+)/i))!=null&&(j=D),~_.toLowerCase().indexOf("trident")&&(D=/\brv[ :]+(\d+)/g.exec(_)||[])!=null&&(j=[null,"IE",D[1]]);var q=void 0,B=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var W in B){var k=B[W];if(k.r.test(navigator.userAgent)){q=k.s;break}}return{name:j[1],version:j[2],os:q}}(),function(){return u})},function(z,H,I){I.d(H,"b",function(){return E}),I.d(H,"a",function(){return f}),I.d(H,"c",function(){return S}),I(0);var E=function(g,y,s){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight","VideoPublishDuration","AudioPublishDuration"].indexOf(y)>-1&&(typeof s=="string"||isFinite(s)))return g[y]=""+s},f=function(g){var y={};return g.forEach(function(s){s.id&&s.type&&(s.id.indexOf("send")===-1&&s.type.toLowerCase().indexOf("outbound")===-1&&s.id.indexOf("outbound_rtp")===-1&&s.id.indexOf("OutboundRTP")===-1||(s.mediaType==="audio"?(E(y,"audioSendBytes",s.bytesSent),E(y,"audioSendPackets",s.packetsSent),E(y,"audioSendPacketsLost",s.packetsLost)):(E(y,"videoSendBytes",s.bytesSent),E(y,"videoSendPackets",s.packetsSent),E(y,"videoSendPacketsLost",s.packetsLost),E(y,"videoSendFrameRate",s.googFrameRateSent),E(y,"videoSendResolutionWidth",s.googFrameWidthSent),E(y,"videoSendResolutionHeight",s.googFrameHeightSent))))}),y},S=function(g){var y={};return g.forEach(function(s){s.id&&s.type&&(s.id.indexOf("recv")===-1&&s.type.toLowerCase().indexOf("inbound")===-1&&s.id.indexOf("inbound_rtp")===-1&&s.id.indexOf("inbound-rtp")===-1&&s.id.indexOf("InboundRTP")===-1||(s.mediaType==="audio"?(E(y,"audioReceiveBytes",s.bytesReceived),E(y,"audioReceivePackets",s.packetsReceived),E(y,"audioReceivePacketsLost",s.packetsLost)):(E(y,"videoReceiveBytes",s.bytesReceived),E(y,"videoReceivePacketsLost",s.packetsLost),E(y,"videoReceivePackets",s.packetsReceived),E(y,"videoReceiveFrameRate",s.googFrameRateReceived),E(y,"videoReceiveDecodeFrameRate",s.googFrameRateDecoded),E(y,"videoReceiveResolutionWidth",s.googFrameWidthReceived),E(y,"videoReceiveResolutionHeight",s.googFrameHeightReceived))))}),y}},function(z,H){function I(){return z.exports=I=Object.assign||function(E){for(var f=1;f<arguments.length;f++){var S=arguments[f];for(var g in S)Object.prototype.hasOwnProperty.call(S,g)&&(E[g]=S[g])}return E},I.apply(this,arguments)}z.exports=I},function(z,H,I){I.d(H,"b",function(){return f}),I.d(H,"e",function(){return g}),I.d(H,"a",function(){return y}),I.d(H,"d",function(){return s}),I.d(H,"c",function(){return m});var E=I(0),f=function(){var r={dispatcher:{}};return r.dispatcher.eventListeners={},r.addEventListener=function(a,d){r.dispatcher.eventListeners[a]===void 0&&(r.dispatcher.eventListeners[a]=[]),r.dispatcher.eventListeners[a].push(d)},r.hasListeners=function(a){return!(!r.dispatcher.eventListeners[a]||!r.dispatcher.eventListeners[a].length)},r.on=r.addEventListener,r.removeEventListener=function(a,d){var T;r.dispatcher.eventListeners[a]&&(T=r.dispatcher.eventListeners[a].indexOf(d))!==-1&&r.dispatcher.eventListeners[a].splice(T,1)},r.dispatchEvent=function(a){var d;for(d in r.dispatcher.eventListeners[a.type])if(r.dispatcher.eventListeners[a.type]&&r.dispatcher.eventListeners[a.type].hasOwnProperty(d)&&typeof r.dispatcher.eventListeners[a.type][d]=="function")try{r.dispatcher.eventListeners[a.type][d](a)}catch(T){E.default.debug("[".concat(r.clientId,"] Error in ").concat(a.type," event"),T)}},r.dispatchSocketEvent=function(a){var d;for(d in r.dispatcher.eventListeners[a.type])r.dispatcher.eventListeners[a.type]&&r.dispatcher.eventListeners[a.type].hasOwnProperty(d)&&typeof r.dispatcher.eventListeners[a.type][d]=="function"&&r.dispatcher.eventListeners[a.type][d](a.msg)},r},S=function(r){var a={};return a.type=r.type,a},g=function(r){var a=S(r);return a.stream=r.stream,a.reason=r.reason,a.msg=r.msg,a},y=function(r){var a=S(r);return a.uid=r.uid,a.attr=r.attr,a.stream=r.stream,a},s=function(r){var a=S(r);return a.msg=r.msg,a},m=function(r){var a=S(r);return a.url=r.url,a.uid=r.uid,a.status=r.status,a.reason=r.reason,a}},function(z,H,I){var E,f=this&&this.__extends||(E=function(B,W){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,p){k.__proto__=p}||function(k,p){for(var n in p)p.hasOwnProperty(n)&&(k[n]=p[n])})(B,W)},function(B,W){function k(){this.constructor=B}E(B,W),B.prototype=W===null?Object.create(W):(k.prototype=W.prototype,new k)}),S=this&&this.__awaiter||function(B,W,k,p){return new(k||(k=Promise))(function(n,N){function l(o){try{x(p.next(o))}catch(h){N(h)}}function t(o){try{x(p.throw(o))}catch(h){N(h)}}function x(o){var h;o.done?n(o.value):(h=o.value,h instanceof k?h:new k(function(L){L(h)})).then(l,t)}x((p=p.apply(B,W||[])).next())})},g=this&&this.__generator||function(B,W){var k,p,n,N,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return N={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function t(x){return function(o){return function(h){if(k)throw new TypeError("Generator is already executing.");for(;l;)try{if(k=1,p&&(n=2&h[0]?p.return:h[0]?p.throw||((n=p.return)&&n.call(p),0):p.next)&&!(n=n.call(p,h[1])).done)return n;switch(p=0,n&&(h=[2&h[0],n.value]),h[0]){case 0:case 1:n=h;break;case 4:return l.label++,{value:h[1],done:!1};case 5:l.label++,p=h[1],h=[0];continue;case 7:h=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!((n=n.length>0&&n[n.length-1])||h[0]!==6&&h[0]!==2)){l=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){l.label=h[1];break}if(h[0]===6&&l.label<n[1]){l.label=n[1],n=h;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(h);break}n[2]&&l.ops.pop(),l.trys.pop();continue}h=W.call(B,l)}catch(L){h=[6,L],p=0}finally{k=n=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([x,o])}}},y=this&&this.__importDefault||function(B){return B&&B.__esModule?B:{default:B}};Object.defineProperty(H,"__esModule",{value:!0});var s=y(I(69)),m=I(2),r=y(I(0)),a=I(3),d=I(14),T=I(10),C=function(B){function W(k,p){var n=B.call(this)||this;return n._state=D.RELAY_STATE_IDLE,n._onStatus=function(N){r.default.debug("["+n.clientId+"] ChannelMediaStatus: "+JSON.stringify(N)),N&&N.command&&(N.command==="onAudioPacketReceived"&&n.emit("event",R.PACKET_RECEIVED_AUDIO_FROM_SRC),N.command==="onVideoPacketReceived"&&n.emit("event",R.PACKET_RECEIVED_VIDEO_FROM_SRC),N.command==="onSrcTokenPrivilegeDidExpire"&&(n._state=D.RELAY_STATE_FAILURE,n.emit("state",D.RELAY_STATE_FAILURE,_.SRC_TOKEN_EXPIRED)),N.command==="onDestTokenPrivilegeDidExpire"&&(n._state=D.RELAY_STATE_FAILURE,n.emit("state",D.RELAY_STATE_FAILURE,_.DEST_TOKEN_EXPIRED,N.channelName?{came:N.channelName}:null)))},n._onClose=function(){return S(n,void 0,void 0,function(){var N;return g(this,function(l){switch(l.label){case 0:if(r.default.debug("["+this.clientId+"] ChannelMediaSocket onClose"),this.emit("event",R.NETWORK_DISCONNECTED),this.state=D.RELAY_STATE_IDLE,!this._prevChannelMediaConfig)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.startChannelMediaRelay(this._prevChannelMediaConfig)];case 2:return l.sent(),[3,4];case 3:return(N=l.sent())instanceof q&&(N.message===u.WS_ABORT||N.message===u.AP_REQUEST_ABORT)?[2]:(this.emit("state",D.RELAY_STATE_FAILURE,_.SERVER_CONNECTION_LOST),[3,4]);case 4:return[2]}})})},n.token=k.appId,n.appId=k.appId,n.cname=k.cname,n.uid=k.uid,n.sid=k.sid,n.clientId=p,n}return f(W,B),Object.defineProperty(W.prototype,"state",{get:function(){return this._state},set:function(k){var p=this._state;this._state=k,p!==k&&this.emit("state",k)},enumerable:!0,configurable:!0}),W.prototype.startChannelMediaRelay=function(k){return S(this,void 0,void 0,function(){return g(this,function(p){switch(p.label){case 0:if(this.state!==D.RELAY_STATE_IDLE)throw new q(u.BAD_STATE);return this.state=D.RELAY_STATE_CONNECTING,[4,this._connect()];case 1:return p.sent(),r.default.debug("["+this.clientId+"] startChannelMediaRelay: connect success"),[4,this._sendStartRelayMessage(k)];case 2:return p.sent(),this._prevChannelMediaConfig=k,[2]}})})},W.prototype.updateChannelMediaRelay=function(k){return S(this,void 0,void 0,function(){return g(this,function(p){switch(p.label){case 0:if(this.state!==D.RELAY_STATE_RUNNING)throw new q(u.BAD_STATE);return[4,this._sendUpdateMessage(k)];case 1:return p.sent(),this._prevChannelMediaConfig=k,[2]}})})},W.prototype.stopChannelMediaRelay=function(){return S(this,void 0,void 0,function(){return g(this,function(k){switch(k.label){case 0:return[4,this._sendStopRelayMessage()];case 1:return k.sent(),r.default.debug("["+this.clientId+"] stopChannelMediaRelay: send stop message success"),this.state=D.RELAY_STATE_IDLE,this.dispose(),[2]}})})},W.prototype.dispose=function(){r.default.debug("["+this.clientId+"] disposeChannelMediaRelay"),this.state=D.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()},W.prototype._requestOneAP=function(k){var p=this;return new Promise(function(n,N){var l={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:"",ts:+new Date,version:m.VERSION,cname:p.cname,uid:p.uid+"",seq:1,requestId:1},t={service_name:"tele_channel",json_body:JSON.stringify(l)},x="https://"+k;d.post(x,t,function(o){var h=null,L=null;try{h=JSON.parse(o)}catch(M){N(new q(u.AP_JSON_PARSE_ERROR,M))}h.code!==0&&N(new q(u.AP_REQUEST_ERROR,h));try{L=JSON.parse(h.json_body)}catch(M){N(new q(u.AP_JSON_PARSE_ERROR,M))}L.code!==200&&N(new q(u.AP_REQUEST_ERROR,L)),L.servers?n(L.servers):N(new q(u.AP_JSON_PARSE_ERROR,L))},function(o){return N(o)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})})},W.prototype._requestAP=function(){var k=this,p=m.getParameter("UAP_AP");return new Promise(function(n,N){setTimeout(function(){N(new q(u.AP_REQUEST_TIMEOUT))},5e3),k.on("dispose",function(){N(new q(u.AP_REQUEST_ABORT))}),p.forEach(function(l){l+="/api/v1",k._requestOneAP(l).then(function(t){r.default.debug("["+k.clientId+"] startChannelMediaRelay request AP "+l+" success: "+JSON.stringify(t));var x=t[0],o="wss://"+x.address.replace(/\./g,"-")+".edge.agora.io:"+x.wss;n(o)}).catch(function(t){r.default.debug("["+k.clientId+"] startChannelMediaRelay request AP "+l+" failed: "+JSON.stringify(t))})})})},W.prototype._connectWebsocket=function(k){return this._signal=new j(this.appId,this.cname,this.uid,this.sid),this._signal.connect(k)},W.prototype._connect=function(){return S(this,void 0,void 0,function(){var k;return g(this,function(p){switch(p.label){case 0:return[4,this._requestAP()];case 1:return k=p.sent(),[4,this._connectWebsocket(k)];case 2:return p.sent(),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",R.NETWORK_CONNECTED),[2]}})})},W.prototype._sendStartRelayMessage=function(k){return S(this,void 0,void 0,function(){var p,n,N,l,t,x;return g(this,function(o){switch(o.label){case 0:return this._checkSignal(),p=this._genMessage(b.StopPacketTransfer),[4,this._signal.request(p)];case 1:return o.sent(),[4,this._signal.waitStatus("Normal Quit")];case 2:return o.sent(),r.default.debug("["+this.clientId+"] startChannelMediaRelay: StopPacketTransfer success"),n=this._genMessage(b.SetSdkProfile,k),[4,this._signal.request(n)];case 3:return o.sent(),r.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSdkProfile success"),N=this._genMessage(b.SetSourceChannel,k),[4,this._signal.request(N)];case 4:return o.sent(),[4,this._signal.waitStatus("SetSourceChannelStatus")];case 5:return o.sent(),this.emit("event",R.PACKET_JOINED_SRC_CHANNEL),r.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceChannel success"),l=this._genMessage(b.SetSourceUserId,k),[4,this._signal.request(l)];case 6:return o.sent(),r.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceUserId success"),t=this._genMessage(b.SetDestChannel,k),[4,this._signal.request(t)];case 7:return o.sent(),[4,this._signal.waitStatus("SetDestChannelStatus")];case 8:return o.sent(),this.emit("event",R.PACKET_JOINED_DEST_CHANNEL),r.default.debug("["+this.clientId+"] startChannelMediaRelay: SetDestChannel success"),x=this._genMessage(b.StartPacketTransfer,k),[4,this._signal.request(x)];case 9:return o.sent(),this.emit("event",R.PACKET_SENT_TO_DEST_CHANNEL),this.state=D.RELAY_STATE_RUNNING,r.default.debug("["+this.clientId+"] startChannelMediaRelay: StartPacketTransfer success"),[2]}})})},W.prototype._sendReconnectMessage=function(k){return S(this,void 0,void 0,function(){var p;return g(this,function(n){switch(n.label){case 0:return this._checkSignal(),p=this._genMessage(b.Reconnect,k),[4,this._signal.request(p)];case 1:return n.sent(),[2]}})})},W.prototype._sendUpdateMessage=function(k){return S(this,void 0,void 0,function(){var p;return g(this,function(n){switch(n.label){case 0:return this._checkSignal(),p=this._genMessage(b.UpdateDestChannel,k),[4,this._signal.request(p)];case 1:return n.sent(),this.emit("event",R.PACKET_UPDATE_DEST_CHANNEL),r.default.debug("["+this.clientId+"] sendUpdateMessage: UpdateDestChannel success"),[2]}})})},W.prototype._sendStopRelayMessage=function(){return S(this,void 0,void 0,function(){var k;return g(this,function(p){switch(p.label){case 0:return this._checkSignal(),k=this._genMessage(b.StopPacketTransfer),[4,this._signal.request(k)];case 1:return p.sent(),r.default.debug("["+this.clientId+"] sendStopRelayMessage: StopPacketTransfer success"),[2]}})})},W.prototype._genMessage=function(k,p){var n=this,N=[],l=[],t=[],x={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:m.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}},o=null;switch(k){case b.SetSdkProfile:return x.clientRequest={command:"SetSdkProfile",type:"multi_channel"},x;case b.SetSourceChannel:return o=p.getSrcChannelMediaInfo(),x.clientRequest={command:"SetSourceChannel",uid:o.uid+"",channelName:o.channelName,token:o.token||this.appId},x;case b.SetSourceUserId:return o=p.getSrcChannelMediaInfo(),x.clientRequest={command:"SetSourceUserId",uid:this.uid+""},x;case b.SetDestChannel:return p.getDestChannelMediaInfos().forEach(function(h){N.push(h.channelName),l.push(h.uid+""),t.push(h.token||n.appId)}),x.clientRequest={command:"SetDestChannel",channelName:N,uid:l,token:t},x;case b.StartPacketTransfer:return x.clientRequest={command:"StartPacketTransfer"},x;case b.Reconnect:return x.clientRequest={command:"Reconnect"},x;case b.StopPacketTransfer:return x.clientRequest={command:"StopPacketTransfer"},x;case b.UpdateDestChannel:return p.getDestChannelMediaInfos().forEach(function(h){N.push(h.channelName),l.push(h.uid+""),t.push(h.token||n.appId)}),x.clientRequest={command:"UpdateDestChannel",channelName:N,uid:l,token:t},x}},W.prototype._checkSignal=function(){if(!this._signal||!this._signal.isConnect())throw new q(u.WS_DISCONNECTED)},W}(s.default);H.default=C;var v=function(){function B(){this.destChannelMediaInfos=new Map}return B.prototype.setSrcChannelInfo=function(W){a.checkValidObject(W,"srcInfo");var k=W.uid,p=W.channelName,n=W.token;if(n&&!a.isValidToken(n))throw new Error("Invalid token in SrcChannelInfo");if(!a.isValidChannelName(p))throw new Error("Invalid channelName in SrcChannelInfo");if(!T.is32Uint(k))throw new Error("Invalid uid in SrcChannelInfo");this.srcChannelMediaInfo=W},B.prototype.setDestChannelInfo=function(W,k){if(!a.isValidChannelName(W))throw new Error("Invalid channelName in DestChannelInfo");a.checkValidObject(k,"destInfo");var p=k.uid,n=k.token,N=k.channelName;if(n&&!a.isValidToken(n))throw new Error("Invalid token in DestChannelInfo");if(!a.isValidChannelName(N))throw new Error("Invalid channelName in DestChannelInfo");if(!T.is32Uint(p))throw new Error("Invalid uid in DestChannelInfo");this.destChannelMediaInfos.set(W,k)},B.prototype.removeDestChannelInfo=function(W){if(!a.isValidChannelName(W))throw new Error("Invalid channelName when invoke removeDestChannelInfo");this.destChannelMediaInfos.delete(W)},B.prototype.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},B.prototype.getDestChannelMediaInfos=function(){return this.destChannelMediaInfos},B}();H.ChannelMediaRelayConfiguration=v;var u,b,R,D,_,j=function(B){function W(k,p,n,N){var l=B.call(this)||this;return l._onOpen=function(){l.emit("open")},l._onClose=function(t){l.emit("close"),l.dispose()},l._onMessage=function(t){var x=JSON.parse(t.data);if(!x||x.command!=="serverResponse"||!x.requestId)return x&&x.command==="serverStatus"&&x.serverStatus&&x.serverStatus.command?(l.emit("status",x.serverStatus),void l.emit(x.serverStatus.command,x.serverStatus)):void 0;l.emit("req_"+x.requestId,x)},l._requestId=1,l.appId=k,l.cname=p,l.uid=n,l.sid=N,l}return f(W,B),W.prototype.isConnect=function(){return this._ws&&this._ws.readyState===WebSocket.OPEN},W.prototype.sendMessage=function(k){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new q(u.WS_DISCONNECTED);var p=this._requestId++;return k.requestId=p,k.seq=p,this._ws.send(JSON.stringify(k)),p},W.prototype.waitStatus=function(k){var p=this;return new Promise(function(n,N){var l=window.setTimeout(function(){N(new q(u.WAIT_STATUS_TIMEOUT,k))},5e3);p.once(k,function(t){clearTimeout(l),t.state&&t.state!==0?N(new q(u.WAIT_STATUS_ERROR,k)):n()}),p.once("dispose",function(){clearTimeout(l),N(new q(u.WS_ABORT))})})},W.prototype.request=function(k){var p=this;return new Promise(function(n,N){var l=p.sendMessage(k),t=window.setTimeout(function(){p.removeAllListeners("req_"+l),N(new q(u.REQUEST_TIMEOUT))},3e3);p.once("req_"+l,function(x){clearTimeout(t),x&&x.code===200?n(x):N(new q(u.REQUEST_FAILED,x))}),p.once("dispose",function(){clearTimeout(t),N(new q(u.WS_ABORT))})})},W.prototype.connect=function(k){var p=this;return new Promise(function(n,N){p._ws=new WebSocket(k),p._ws.onopen=function(){p._onOpen(),p._prvUrl=k,p._ws.onmessage=p._onMessage,p._ws.onclose=p._onClose,p._startHeartBeatCheck(),n()},p._ws.onclose=function(l){p._ws=null,N(new q(u.CONNECT_FAILED,"websocket error code: "+l.code))},setTimeout(function(){p._ws&&p._ws.readyState!==WebSocket.OPEN&&(p._ws.onopen=null,p._ws.onclose=null,p._ws.close(),p._ws=null,N(new q(u.CONNECT_TIMEOUT)))},5e3),p.once("dispose",function(){N(new q(u.WS_ABORT))})})},W.prototype.dispose=function(){this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.close()),this._ws=null},W.prototype._sendPing=function(k){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new q(u.WS_DISCONNECTED);var p=this._requestId++;return k.requestId=p,this._ws.send(JSON.stringify(k)),p},W.prototype._startHeartBeatCheck=function(){var k=this;this._heartBeatTimer=window.setInterval(function(){k._sendPing({command:"ping",appId:k.appId,cname:k.cname,uid:k.uid+"",sid:k.sid,ts:+new Date,requestId:0})},3e3)},W.prototype._clearHeartBeatCheck=function(){window.clearInterval(this._heartBeatTimer)},W}(s.default),q=function(B,W,k){B===void 0&&(B=""),this.code=k,this.data=W,this.message=B};H.ChannelMediaError=q,function(B){B.CONNECT_FAILED="connect failed",B.CONNECT_TIMEOUT="connect timeout",B.WS_DISCONNECTED="websocket disconnected",B.REQUEST_TIMEOUT="request timeout",B.REQUEST_FAILED="request failed",B.WAIT_STATUS_TIMEOUT="wait status timeout",B.WAIT_STATUS_ERROR="wait status error",B.BAD_STATE="bad state",B.WS_ABORT="ws abort",B.AP_REQUEST_TIMEOUT="AP request timeout",B.AP_JSON_PARSE_ERROR="AP json parse error",B.AP_REQUEST_ERROR="AP request error",B.AP_REQUEST_ABORT="AP request abort"}(u=H.CHANNEL_MEDIA_ERROR||(H.CHANNEL_MEDIA_ERROR={})),function(B){B[B.SetSdkProfile=0]="SetSdkProfile",B[B.SetSourceChannel=1]="SetSourceChannel",B[B.SetSourceUserId=2]="SetSourceUserId",B[B.SetDestChannel=3]="SetDestChannel",B[B.StartPacketTransfer=4]="StartPacketTransfer",B[B.StopPacketTransfer=5]="StopPacketTransfer",B[B.UpdateDestChannel=6]="UpdateDestChannel",B[B.Reconnect=7]="Reconnect",B[B.SetVideoProfile=8]="SetVideoProfile"}(b||(b={})),function(B){B[B.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",B[B.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",B[B.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",B[B.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",B[B.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",B[B.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",B[B.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",B[B.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",B[B.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",B[B.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(R=H.CHANNEL_MEDIA_RELAY_EVENT||(H.CHANNEL_MEDIA_RELAY_EVENT={})),function(B){B[B.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",B[B.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",B[B.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",B[B.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE"}(D=H.CHANNEL_MEDIA_RELAY_STATE||(H.CHANNEL_MEDIA_RELAY_STATE={})),function(B){B[B.RELAY_OK=0]="RELAY_OK",B[B.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",B[B.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",B[B.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",B[B.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",B[B.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",B[B.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",B[B.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",B[B.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",B[B.INTERNAL_ERROR=9]="INTERNAL_ERROR",B[B.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",B[B.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",B[B.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",B[B.RELAY_NOT_START=13]="RELAY_NOT_START",B[B.OPERATION_ABORT=14]="OPERATION_ABORT"}(_=H.CHANNEL_MEDIA_RELAY_ERROR||(H.CHANNEL_MEDIA_RELAY_ERROR={}))},function(z,H,I){I.r(H),I.d(H,"isLiveTranscodingValid",function(){return _}),I.d(H,"generateSessionId",function(){return b}),I.d(H,"audioLevelHelper",function(){return C}),I.d(H,"vsResHack",function(){return R}),I.d(H,"is32Uint",function(){return D}),I.d(H,"safeCall",function(){return a}),I.d(H,"random",function(){return q}),I.d(H,"popBanTip",function(){return k}),I.d(H,"lengthInUtf8Bytes",function(){return B}),I.d(H,"audioTimerLoop",function(){return W}),I.d(H,"generateId",function(){return u}),I.d(H,"uint8ArrayToBase64",function(){return d}),I.d(H,"base64ToUint8Array",function(){return T});var E=I(11),f=I.n(E),S=I(5),g=I(0),y=I(28),s=I.n(y),m=I(25),r=I(15),a=function(){var p=arguments[0];if(typeof p=="function"){var n=Array.prototype.slice.call(arguments,1);p.apply(null,n)}},d=function(p){for(var n="",N=0;N<p.length;N+=1)n+=String.fromCharCode(p[N]);return window.btoa(n)},T=function(p){for(var n=window.atob(p),N=new Uint8Array(new ArrayBuffer(n.length)),l=0;l<n.length;l+=1)N[l]=n.charCodeAt(l);return N},C=function(p){return this.audioContext=Object(m.a)(),this.sourceNode=p.otWebkitAudioSource||this.audioContext.createMediaStreamSource(p),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var n=0,N=0;N<this.timeDomainData.length;N++)n=Math.max(n,Math.abs(this.timeDomainData[N]-128));return n/128}return g.default.warning("can't find analyser in audioLevelHelper"),0},this},v=1e4;function u(){return++v}function b(){return s()().replace(/-/g,"").toUpperCase()}var R=function(p,n,N){try{g.default.debug("start vsResHack",p);var l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(l);var t=!1;l.addEventListener("playing",function(x){S.isFireFox()?l.videoWidth&&(t=!0,g.default.debug("[vsResHack] get stream resolution: ","".concat(l.videoWidth," x ").concat(l.videoHeight),p),n(l.videoWidth,l.videoHeight),l.srcObject=null,l.remove()):(t=!0,g.default.debug("[vsResHack] get stream resolution: ","".concat(l.videoWidth," x ").concat(l.videoHeight),p),n(l.videoWidth,l.videoHeight),l.srcObject=null,l.remove())}),Object(r.setSrcObject)(l,p),l.play().catch(function(){}),setTimeout(function(){!t&&l&&(n(l.videoWidth,l.videoHeight),l.srcObject=null,l.remove())},4e3)}catch(x){N(x)}},D=function(p){return typeof p=="number"&&0<=p&&p<=4294967295},_=function(p){var n=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var N in p)if(N==="lowLatency"&&typeof p[N]!="boolean"||N==="userConfigExtraInfo"&&f()(p[N])!=="object"||N==="transcodingUsers"&&!j(p[N])||!~n.indexOf(N)&&typeof p[N]!="number")throw new Error("Param ["+N+"] is inValid");return!0},j=function(p){for(var n=0;n<p.length;n++)for(var N in p[n])if(typeof p[n][N]!="number")throw new Error("Param user["+n+"] - ["+N+"] is inValid");return!0},q=function(p){isNaN(p)&&(p=1e3);var n=+new Date,N=(n=(9301*n+49297)%233280)/233280;return Math.ceil(N*p)},B=function(p){var n=encodeURIComponent(p).match(/%[89ABab]/g);return p.length+(n?n.length:0)},W=function(p,n){var N=1/n,l=Object(m.a)(),t=l.createGain();t.gain.value=0,t.connect(l.destination);var x=!1;return function o(){var h=l.createOscillator();h.onended=o,h.connect(t),h.start(0),h.stop(l.currentTime+N),p(l.currentTime),x&&(h.onended=function(){})}(),function(){x=!0}},k=function(){if(!document.getElementById("agora-ban-tip")){var p=document.createElement("div");p.id="agora-ban-tip",p.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(p);var n=document.createElement("div");n.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",p.append(n);var N=document.createElement("div");N.style="height: 76px; display: flex; justify-content: center; align-items: center;";var l=document.createElement("span");l.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",l.innerText="!";var t=document.createElement("span");t.innerText="This browser does not support webRTC",N.append(l),N.append(t);var x=document.createElement("div");x.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",x.innerText="OK",n.append(N),n.append(x),x.onclick=function(){var o=document.getElementById("agora-ban-tip");o.parentNode.removeChild(o)}}}},function(z,H){function I(E){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?z.exports=I=function(f){return typeof f}:z.exports=I=function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},I(E)}z.exports=I},function(z,H,I){z.exports=I(64)},function(z,H,I){var E=I(12),f=I.n(E),S=I(17),g=I.n(S),y=I(11),s=I.n(y),m=I(32),r=I.n(m),a=I(7),d=I.n(a),T=I(22),C=I(8),v=function(O){O&&O.apply(this,[].slice.call(arguments,1))},u=I(0),b=I(1),R=I(10),D=I(14),_=I(2),j=function(O){var w=Object(C.b)(O);w.needReconnect=!0,w.isTimeout=!1,w.isInit=!0,w.sendbytes=0,w.recvbytes=0,w.startTime=Date.now(),w.lastMsgTime=null,w.clientId=O.clientId,w.hostIndex=0,w.requestID=0,O.host instanceof Array?w.host=O.host:w.host=[O.host],w.getSendBytes=function(){return w.sendbytes},w.getRecvBytes=function(){return w.recvbytes},w.getDuration=function(){return Math.ceil((Date.now()-w.startTime)/1e3)},w.getURL=function(){return w.connection.url},w.reconnect=function(){w.isInit=!0,w.creatConnection()},w.connectNext=function(){w.isInit=!0,++w.hostIndex,u.default.debug("["+w.clientId+"] Gateway length:"+w.host.length+" current index:"+w.hostIndex),w.hostIndex>=w.host.length?w.dispatchEvent(Object(C.d)({type:"recover"})):w.creatConnection()},w.replaceHost=function(Y){w.host=Y||w.host,w.hostIndex=0,w.creatConnection()},w.creatConnection=function(){w.needReconnect=!0,w.lts=new Date().getTime(),w.connection=new WebSocket("wss://"+w.host[w.hostIndex]),w.connection.binaryType="arraybuffer",w.turnConfig={};var Y=O.proxyServerType;if(w.connection.url&&Y!==3&&Y!==4&&Y!==5){var Z=w.connection.url.match(/wss\:\/\/([^:]+):(\d+)/),re=w.host[w.hostIndex].split(":"),ce=w.connection.url.match(/h=([^:]+)&p=(\d+)/);Z?(w.turnConfig.url=Z[1],Object(_.getParameter)("TURN_ENABLE_TCP")&&(w.turnConfig.tcpport=parseInt(Z[2])+30),Object(_.getParameter)("TURN_ENABLE_UDP")&&(w.turnConfig.udpport=parseInt(Z[2])+30)):ce?(w.turnConfig.url=ce[1],Object(_.getParameter)("TURN_ENABLE_TCP")&&(w.turnConfig.tcpport=parseInt(ce[2])+30),Object(_.getParameter)("TURN_ENABLE_UDP")&&(w.turnConfig.udpport=parseInt(ce[2])+30)):re&&(w.turnConfig.url=re[0],Object(_.getParameter)("TURN_ENABLE_TCP")&&(w.turnConfig.tcpport=parseInt(re[1])+30),Object(_.getParameter)("TURN_ENABLE_UDP")&&(w.turnConfig.udpport=parseInt(re[1])+30))}w.connection.onopen=function(ue){w.needReconnect=!0,w.isTimeout=!1,w.isInit=!1,w.sendbytes=0,w.recvbytes=0,w.startTime=Date.now(),Object(D.resetHTTPByetsCount)(),clearTimeout(w.timeoutCheck),w.dispatchEvent(Object(C.d)({type:"onopen",event:ue,socket:w}))},w.connection.onmessage=function(ue){if(ue.data instanceof ArrayBuffer)w.dispatchEvent({type:"onBinaryData",data:ue.data});else{w.recvbytes+=Object(R.lengthInUtf8Bytes)(ue.data);var se=JSON.parse(ue.data);w.lastMsgTime=Date.now(),se.hasOwnProperty("_id")?w.dispatchEvent(Object(C.d)({type:se._id,msg:se})):se.hasOwnProperty("_type")&&w.dispatchSocketEvent(Object(C.d)({type:se._type,msg:se._message}))}},w.connection.onclose=function(ue){w.needReconnect?w.isTimeout||w.isInit?(u.default.debug("["+w.clientId+"] websockect connect timeout"),b.report.joinGateway(O.sid,{lts:w.lts,succ:!1,ec:"timeout",addr:w.connection.url}),w.connectNext()):(w.dispatchEvent(Object(C.d)({type:"disconnect",event:ue})),w.requests&&w.requests instanceof Array&&(w.requests.map(function(se){se.callback("REQUEST_ABORT")}),w.requests=[])):(u.default.debug("["+w.clientId+"] websockect closeed"),v(O.onFailure,ue),clearTimeout(w.timeoutCheck),w.dispatchEvent(Object(C.d)({type:"close",event:ue})),w.connection.onopen=void 0,w.connection.onclose=void 0,w.connection.onerror=void 0,w.connection.onmessage=void 0,w.connection=void 0)},w.connection.onerror=function(ue){},setTimeout(function(){w.connection&&w.connection.readyState!=WebSocket.OPEN&&(w.isTimeout=!0,w.connection.close())},5e3)},w.creatConnection(),w.sendMessage=function(Y,Z){if(w.connection&&w.connection.readyState==WebSocket.OPEN){var re=JSON.stringify(Y);w.sendbytes+=Object(R.lengthInUtf8Bytes)(re),w.connection.send(re)}else Z({error:"Gateway not connected"})},w.disconnect=function(){w.needReconnect=!0,w.connection.close()},w.close=function(){w.needReconnect=!1,w.connection.onclose=void 0,w.connection.close(),clearInterval(w.requestTimer),w.requests&&w.requests instanceof Array&&(w.requests.map(function(Y){Y.callback("REQUEST_ABORT")}),w.requests=[])},w.sendSignalCommand=function(Y,Z){Y._id="_request_"+w.requestID,w.requestID+=1,Y._type!=="publish_stats"&&Y._type!=="subscribe_stats"&&Y._type!=="publish_stats_low"&&w.on(Y._id,function(re){re.msg&&Z&&Z(re.msg._result,re.msg.message),delete w.dispatcher.eventListeners[Y._id]}),w.sendMessage(Y,function(re){re.reason="NOT_CONNECTED",Z&&Z(re.reason,re)})},w.requests=[];var U=function(Y){var Z=w.requests.findIndex(function(ce){return ce.id===Y.type});if(Z>=0)var re=w.requests.splice(Z,1)[0];re&&w.dispatcher.eventListeners[Y.type]?(delete w.dispatcher.eventListeners[Y.type],Y.msg&&re.callback&&re.callback(Y.msg._result,Y.msg._message)):u.default.warning("Detached Response",Y.type,Y.msg)},$=function(Y){var Z=this,re=w.requests.findIndex(function(ce){return ce.id===Z.id});re>=0&&(Z=w.requests.splice(re,1)[0]),Z&&w.dispatcher.eventListeners[Y.type]?(delete w.dispatcher.eventListeners[Y.type],Y.reason="NOT_CONNECTED",Z.callback&&Z.callback(Y.reason,Y)):u.default.warning("handleSendError",Z)};return w.sendRequest=function(Y,Z){Y=d()({_id:"_request_"+w.requestID},Y),w.requestID+=1;var re={id:Y._id,timeoutCounter:0,stalledAt:Date.now(),message:Y,callback:Z};w.requests.push(re),w.addEventListener(Y._id,U),w.sendMessage(Y,$.bind(re))},w.checkRequestTimeout=function(){for(var Y=Math.ceil(Object(_.getParameter)("SIGNAL_REQUEST_TIMEOUT")/Object(_.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),Z=w.requests.length-1;Z>=0;Z--){var re=w.requests[Z];re.timeoutCounter>=Y?(w.requests.splice(Z,1),u.default.error("Request Timeout",re.timeoutCounter,re.message),re.callback&&re.callback("TIMEOUT")):re.timeoutCounter++}},clearInterval(w.requestTimer),w.requestTimer=setInterval(w.checkRequestTimeout,Object(_.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),w.sendReport=function(Y){w.sendMessage(Y,function(){})},w},q=function(O,w){var U={connect:function(){w.host=O,U.signal=j(w),U.on=U.signal.on,U.dispatchEvent=U.signal.dispatchEvent,U.signal.on("onopen",function($){U.signal.onEvent=function(Y){U.dispatchEvent(Object(C.d)({type:Y.event,msg:Y}))},U.dispatchEvent(Object(C.d)({type:"connect",msg:$}))}),U.signal.on("onError",function($){var Y=$.msg;onError(Y.code,"error")})},getLastMsgTime:function(){return U.signal&&U.signal.lastMsgTime},getSendBytes:function(){return U.signal.getSendBytes()},getRecvBytes:function(){return U.signal.getRecvBytes()},getDuration:function(){return U.signal.getDuration()},disconnect:function(){U.signal.disconnect()},close:function(){U.signal.close()},getURL:function(){return U.signal.getURL()},reconnect:function(){U.signal.reconnect()},connectNext:function(){U.signal.connectNext()},replaceHost:function($){U.signal.replaceHost($)},emitSimpleMessage:function($,Y){U.signal.sendSignalCommand($,Y)},emitRequest:function($,Y){U.signal.sendRequest($,Y)},emitReport:function($){U.signal.sendReport($)}};return U.connect(),U},B=I(23),W=I(4),k=I(20),p=I(5),n={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",K_SERVICE_NOT_READY:"tryNext",K_SERVICE_TOO_HEAVY:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},N={googActualEncBitrate:"A_aeb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googAvailableReceiveBandwidth:"A_arb",googTargetEncBitrate:"A_teb",googBucketDelay:"A_bd",googTransmitBitrate:"A_tb",googCodecName:"A_cn",bytesSent:"bytesSent",packetsLost:"packetsLost",packetsSent:"packetsSent",googAdaptationChanges:"A_ac",googAvgEncodeMs:"A_aem",googEncodeUsagePercent:"A_eup",googFirsReceived:"A_fr",googFrameHeightInput:"A_fhi",googFrameHeightSent:"A_fhs",googFrameRateInput:"A_fri",googFrameRateSent:"A_frs",googFrameWidthInput:"A_fwi",googFrameWidthSent:"A_fws",googNacksReceived:"A_nr",googPlisReceived:"A_pr",googRtt:"A_rtt",aecDivergentFilterFraction:"A_adff",audioInputLevel:"A_ail",googEchoCancellationReturnLoss:"A_ecrl",googEchoCancellationReturnLossEnhancement:"A_ecrle",googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_relrm",googTargetDelayMs:"A_tdm",bytesReceived:"bytesReceived",packetsReceived:"packetsReceived",googDecodeMs:"A_dm",googMaxDecodeMs:"A_mdm",googRenderDelayMs:"A_rdm",googFrameWidthReceived:"A_fwr",googFrameHeightReceived:"A_fhr",googFrameRateReceived:"A_frr",googFrameRateDecoded:"A_frd",googFrameRateOutput:"A_fro",googJitterBufferMs:"A_jbm",googCurrentDelayMs:"A_cdm",googMinPlayoutDelayMs:"A_mpdm",googNacksSent:"A_ns",googPlisSent:"A_ps",googFirsSent:"A_fs",audioOutputLevel:"A_aol",googAccelerateRate:"A_ar",googDecodingCNG:"A_dcng",googDecodingCTN:"A_dctn",googDecodingCTSG:"A_dctsg",googDecodingNormal:"A_dn",googDecodingPLC:"A_dplc",googDecodingPLCCNG:"A_dplccng",googExpandRate:"A_er",googJitterReceived:"A_jr",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sdr",googSpeechExpandRate:"A_ser",uplink_fraction_lost:"B_ufl",uplink_cumulative_lost:"B_ucl",uplink_available_bandwidth:"B_uab",period_fir:"B_fir",access_delay:"B_acd",uplink_network_quality:"B_unq",downlink_network_quality:"B_dnq",pub_audio_lost_ratio_400ms:"B_palr4",pub_video_lost_ratio_400ms:"B_pvlr4",e2e_delay:"B_ed",audio_delay:"B_ad",video_delay:"B_vd",stream_type:"B_st",e2e_audio_lost_ratio_400ms:"B_ealr4",e2e_video_lost_ratio_400ms:"B_evlr4",downlink_estimate_bandwidth:"B_deb",peer_publish_audio_duration:"B_ppad",peer_publish_video_duration:"B_ppvd"},l={};for(var t in N){var x=N[t];l[x]&&u.default.error("Key Conflict: ".concat(x,": ").concat(N[x],"| ").concat(t)),l[x]=t}var o=function(O){return N[O]||O},h=function(O){return l[O]||O},L=I(9),M=I.n(L),G=I(54),Q=function O(w){var U=!1,$=function(c){return{_type:"control",_message:c}},Y=function(c,P){var F={};return Object.keys(P).forEach(function(X){Object(_.getParameter)("STATS_FILTER")[X]||(F[o(X)]=P[X])}),{_type:"subscribe_related_stats",_message:{stream_type:"high",stream_id:c,stats:F}}},Z=function(c){return{_type:"publish",_message:c}},re=function(c,P){var F={};return Object.keys(P).forEach(function(X){Object(_.getParameter)("STATS_FILTER")[X]||(F[o(X)]=P[X])}),{_type:"subscribe_stats",_message:{stream_id:c,stats:F}}},ce=O.DISCONNECTED,ue=O.CONNECTING,se=O.CONNECTED,ie=O.DISCONNECTING,me=ce,i=Object(C.b)(w);Object.defineProperty(i,"state",{set:function(c){var P=me;me=c,Object(k._setClientConnectionStateRecord)(i.clientId,c),c!==O.CONNECTED&&c!==O.DISCONNECTING&&(i.hasJoined=!1),P!==c&&i.dispatchEvent({type:"connection-state-change",prevState:O.connetionStateMap[P],curState:O.connetionStateMap[c]})},get:function(){return me}}),i.socket=void 0,i.state=ce,i.mode=w.mode,i.role=w.role,i.codec=w.codec,i.config={},i.timers={},i.timer_counter={},i.localStreams={},i.remoteStreams={},i.remoteMuteState={},i.attemps=1,i.p2p_attemps=1,i.audioLevel={},i.activeSpeaker=void 0,i.reconnectMode="tryNext",i.rejoinAttempt=0,i.hasChangeBGPAddress=!1,i.traffic_stats={},i.clientId=w.clientId,i.pingpongCounter=0,i.hasInvokeLeave=!1,i.p2ps=new Map,i.liveStreams=new Map,i.injectLiveStreams=new Map,i.remoteStreamsInChannel=new Set,i.subscribeRequestId=new Map,i.publishRequestId=0,i.hasJoined=!1,i.isFirstSuccess=!0,i.peerPublishDurationMap=new Map,function(c){var P=v;c.makeRequest=function(F,X,ne){if(c.socket===void 0)return u.default.debug("[".concat(c.clientId,"] No socket available")),void P(ne,W.default.INVALID_OPERATION);try{c.socket.emitRequest(F,function(V,K){var te;V==="success"?typeof X=="function"&&X(K):typeof ne=="function"&&(te=K&&K.error_code&&W.GatewayErrorCode[K.error_code]?W.GatewayErrorCode[K.error_code]:K&&K.error_str?K.error_str:K&&K.error_code?"UNKNOW_ERROR_".concat(K.error_code):V,ne(te,K))})}catch(V){u.default.debug("[".concat(c.clientId,"] Socket emit message failed ").concat(JSON.stringify(F))),u.default.debug("[".concat(c.clientId,"] "),V),P(ne,W.default.SOCKET_ERROR)}},c.makeReport=function(F){c.socket===void 0&&u.default.debug("[".concat(c.clientId,"] No socket available"));try{c.socket.emitReport(F)}catch{u.default.debug("[".concat(c.clientId,"] Socket emit report failed ").concat(JSON.stringify(F)))}}}(i),i.inChannelInfo={joinAt:null,duration:0},i._sendMessage=function(c,P){switch(c){case"SubscribeStats":i.makeReport(re.apply(void 0,r()(P)));break;case"SubscribeRelatedStats":i.makeReport(Y.apply(void 0,r()(P)))}};var le=v;i.p2pCounter=Object(R.random)(1e5),i.generateP2PId=function(){return++i.p2pCounter},i.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},i.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},i.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},i.configPublisher=function(c){i.config=c},i.getGatewayInfo=function(c,P){i.makeRequest({_type:"gateway_info"},c,P)},i.setClientRole=function(c,P){u.default.debug("[".concat(i.clientId,"] setClientRole to ").concat(c));var F=b.report.reportApiInvoke(i.joinInfo.sid,{name:"_setClientRole",callback:P});i.makeRequest({_type:"set_client_role",_message:{role:c}},function(){i.role=c,i.dispatchEvent({type:"client-role-changed",role:c}),F&&F(null,{role:c})},function(X,ne){if(ne&&ne.code&&(X=W.GatewayErrorCode[ne.code]||"UNKNOW_ERROR_"+ne.code),X==="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE")return F&&F(null);u.default.error("set Client role error to "+c+": "+X),F&&F(X)})},i.join=function(c,P,F,X){i.hasInvokeLeave=!1,c.useProxyServer&&(i.hasChangeBGPAddress=!0);var ne=new Date().getTime(),V=c.uid;if(i.inChannelInfo.joinAt&&(i.inChannelInfo.duration+=ne-i.inChannelInfo.joinAt),i.inChannelInfo.joinAt=ne,i.state!==ue)return u.default.error("[".concat(i.clientId,"] GatewayClient.join Failed: state "),i.state),X&&X(W.default.INVALID_OPERATION),void b.report.joinGateway(c.sid,{lts:ne,succ:!1,ec:W.default.INVALID_OPERATION,addr:null});if(V!=null&&parseInt(V)!==V)return u.default.error("[".concat(i.clientId,"] Input uid is invalid")),i.state=ce,X&&X(W.default.INVALID_PARAMETER),void b.report.joinGateway(c.sid,{lts:ne,succ:!1,ec:W.default.INVALID_PARAMETER,addr:null});var K=J.register(i,{uid:V,cname:c&&c.cname});if(K)return i.state=ce,X&&X(K),void b.report.joinGateway(c.sid,{lts:ne,succ:!1,ec:K,addr:null});i.joinInfo=d()({},c),i.uid=V,i.key=P,i.pingpongCounter=0,Ee(c,function(te){if(c.useLocalAccessPoint)try{var ae=i.socket.signal.connection.url.match(/wss\:\/\/([^:]+):(\d+)/)[1];Object(_.setParameter)("EVENT_REPORT_DOMAIN",ae),Object(_.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",ae),Object(_.setParameter)("LOG_UPLOAD_SERVER","".concat(ae,":6444"))}catch(de){u.default.debug("[".concat(i.clientId,"] LocalAccessPoint error: ").concat(de))}if(i.state===ie||i.state===ce)return X&&X("LEAVE_BEFORE_JOIN_SUCCESS");i.state=se,u.default.debug("[".concat(i.clientId,"] Connected to gateway server")),clearInterval(i.pingTimer),i.pingTimer=setInterval(function(){var de=Object(_.getParameter)("PING_PONG_TIME_OUT");if(++i.pingpongCounter>=de){var oe=Date.now();i.socket&&u.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(oe-i.socket.getLastMsgTime(),"ms")),i.socket&&i.socket.getLastMsgTime()&&oe-i.socket.getLastMsgTime()>Object(_.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(i.pingpongCounter=0,i.socket.close(),i.socket.dispatchEvent(Object(C.d)({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var pe=Date.now();i.makeRequest({_type:"ping"},function(){i.pingpongCounter=0;var ve=Date.now()-pe;Object(_.getParameter)("REPORT_STATS")&&i.makeRequest({_type:"ping_back",_message:{pingpongElapse:ve}})},function(ve,Re){ve!=="TIMEOUT"&&(u.default.error("Ping Error ".concat(ve," ").concat(JSON.stringify(Re))),Re&&Re.error_code&&i.socket&&i.socket.signal&&i.socket.signal.connection&&i.socket.signal.connection.readyState===WebSocket.OPEN&&(u.default.info("Disconnecting websocket connection"),i.socket.signal.connection.close()))})},3e3),function(de,oe){var pe=de.role,ve=d()({},i.joinInfo.apResponse),Re={session_id:i.joinInfo.sid,app_id:w.appId,channel_key:i.key,channel_name:i.joinInfo.cname,sdk_version:_.VERSION,browser:navigator.userAgent,process_id:Object(b.getProcessId)(),mode:i.mode,codec:i.codec,role:pe,has_changed_gateway:Object(_.getParameter)("FORCE_CHANGED_GATEWAY_FLAG")||i.hasChangeBGPAddress,ap_response:ve,optionalInfo:i.joinInfo.optionalInfo,extend:Object(_.getParameter)("JOIN_EXTEND"),details:{}};if(i.joinInfo.hasOwnProperty("stringUid")&&(Re.string_uid=i.joinInfo.stringUid),i.socket&&i.socket.signal&&i.socket.signal&&(ve.addresses&&ve.addresses[i.socket.signal.hostIndex]&&(Re.ap_response.ticket=ve.addresses[i.socket.signal.hostIndex].ticket,delete ve.addresses),Object(_.getParameter)("SET_DEFAULT_TURNSERVER")&&i.socket.signal.turnConfig)){var Ie={username:i.joinInfo.uid.toString(),credential:i.joinInfo.token,forceturn:Object(_.getParameter)("FORCE_TURN")};Ie.url=i.socket.signal.turnConfig.url,i.socket.signal.turnConfig.tcpport&&(Ie.tcpport=""+i.socket.signal.turnConfig.tcpport),i.socket.signal.turnConfig.udpport&&(Ie.udpport=""+i.socket.signal.turnConfig.udpport),i.joinInfo.turnServers.find(function(Se){if(Se.url===Ie.url)return!0})||i.joinInfo.turnServers.push(Ie)}i.joinInfo.proxyServerType===3&&(Re.plugin="web_cloud_proxy",Re.details.cservice_map="1"),i.joinInfo.aesmode&&i.joinInfo.aespassword?(Re.aes_mode=i.joinInfo.aesmode,Re.aes_encrypt=!0,i.joinInfo.aes_salt&&(Re.aes_salt=i.joinInfo.aes_salt),Object(G.encryptRSA)(i.joinInfo.aespassword).then(function(Se){Re.aes_secret=Se,i.dispatchEvent({type:"join-message-hook",joinMessage:Re}),oe(null,{_type:"join",_message:Re})}).catch(function(Se){u.default.error("[".concat(i.clientId,"] encrypt password failed "),Se),oe("ENCRYPT_PASSWORD_FAILED")})):(i.dispatchEvent({type:"join-message-hook",joinMessage:Re}),oe(null,{_type:"join",_message:Re}))}({role:i.role},function(de,oe){if(de)return X&&X(de);i.makeRequest(oe,function(pe){if(b.report.joinGateway(c.sid,{lts:ne,succ:!0,ec:null,vid:c.vid,uid:c.uid,addr:i.socket.getURL(),firstSuccess:i.isFirstSuccess}),i.joinSuccessLts=Date.now(),i.isFirstSuccess=!1,i.rejoinAttempt=0,i.hasJoined=!0,F&&F(pe.uid),pe.return_vosip===!0||Object(_.getParameter)("ENABLE_LIVE_SERVER_LIST")===!0){var ve=null;try{ve=i.socket.signal.connection.url}catch(Re){u.default.debug("[".concat(i.clientId,"] Can not get gateway ip: ").concat(Re))}ve?Object(_.setParameter)("LIVE_SERVER_LIST",[ve]):Object(_.setParameter)("LIVE_SERVER_LIST",[])}i.dispatchEvent({type:"join"}),clearInterval(i.timers.trafficStats),i.timers.trafficStats=setInterval(function(){i.makeRequest({_type:"traffic_stats"},function(Re){var Ie={};for(var Se in Re)Ie[h(Se)]=Re[Se];if(Ie.peer_delay&&Ie.peer_delay.length){var Te=[];Ie.peer_delay.forEach(function(Ae){var Oe={};for(var Ce in Ae)Oe[h(Ce)]=Ae[Ce];Te.push(Oe)}),Ie.peer_delay=Te}i.traffic_stats=Ie,i.traffic_stats.timestamp=Date.now();var ye=i.joinInfo.stringUid,be=i.localStreams[V]||i.localStreams[ye];be&&(be.traffic_stats={access_delay:Ie.access_delay}),Ie.peer_delay&&Ie.peer_delay.forEach(function(Ae){var Oe=i.remoteStreams[Ae.peer_uid];Oe&&(Oe.traffic_stats={access_delay:Ie.access_delay,e2e_delay:Ae.e2e_delay,audio_delay:Ae.audio_delay,video_delay:Ae.video_delay})}),i.dispatchEvent({type:"after-getTrafficStats",trafficStats:Ie})})},3e3)},function(pe,ve){if(u.default.error("[".concat(i.clientId,"] User join failed [").concat(pe,"]")),pe==="ERR_JOIN_BY_MULTI_IP"){try{b.report.joinGateway(c.sid,{lts:ne,succ:!1,ec:"ERR_JOIN_BY_MULTI_IP",addr:i.socket.getURL()})}catch{}return i.dispatchEvent({type:"onMultiIP",option:ve.option})}n[pe]&&i.rejoinAttempt<4?i._doWithAction(n[pe],F,X):X&&X(pe),b.report.joinGateway(c.sid,{lts:ne,succ:!1,ec:pe,addr:i.socket&&i.socket.getURL()})})})}),this.remoteMuteState={},i.resetAudioVolumeIndication()},i.leave=function(c,P){var F=J.unregister(i);switch(F&&u.default.debug("[".concat(i.clientId,"] "),F),i.p2ps.clear(),i.state){case ce:return u.default.debug("[".concat(i.clientId,"] Client Already in DISCONNECTED status")),void le(c);case ie:return u.default.debug("[".concat(i.clientId,"] Client Already in DISCONNECTING status")),void le(P,W.default.INVALID_OPERATION);case ue:return i.socket&&i.socket.close(),i.socket=void 0,u.default.info("[".concat(i.clientId,"] Client connecting, Leave channel success")),i.state=ce,c&&c()}for(var X in i.state=ie,i.channelMediaConfig&&(i.channelMediaRelayController&&i.channelMediaRelayController.dispose(),i.channelMediaConfig,i.channelMediaRelayController=null),clearInterval(i.pingTimer),i.timers)i.timers.hasOwnProperty(X)&&clearInterval(i.timers[X]);for(var X in i.inChannelInfo.joinAt&&(i.inChannelInfo.duration+=Date.now()-i.inChannelInfo.joinAt,i.inChannelInfo.joinAt=null),i.hasJoined?i.makeRequest({_type:"leave"},function(K){i.socket.close(),i.socket=void 0,u.default.info("[".concat(i.clientId,"] Leave channel success")),i.state=ce,c&&c(K)},function(K){K!=="TIMEOUT"&&K!=="REQUEST_ABORT"&&(u.default.error("[".concat(i.clientId,"] Leave Channel Failed"),K),i.state=se,P&&P(K))}):(i.socket&&(i.socket.close(),i.socket=void 0),u.default.info("[".concat(i.clientId,"] Leave channel before joined")),i.state=ce,c&&c()),i.localStreams)if(i.localStreams.hasOwnProperty(X)){var ne=i.localStreams[X];delete i.localStreams[X],ne.pc!==void 0&&(ne.pc.close(),ne.pc=void 0)}_e()},i.publish=function(c,P,F,X){var ne=new Date().getTime(),V=!1;if(c.publishLTS=ne,s()(c)!=="object"||c===null)return u.default.error("[".concat(i.clientId,"] Invalid local stream")),X&&X(W.default.INVALID_LOCAL_STREAM),void b.report.publish(i.joinInfo.sid,{lts:ne,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:W.default.INVALID_LOCAL_STREAM});if(!c.stream&&c.url===void 0)return u.default.error("[".concat(i.clientId,"] Invalid local media stream")),X&&X(W.default.INVALID_LOCAL_STREAM),void b.report.publish(i.joinInfo.sid,{lts:ne,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:W.default.INVALID_LOCAL_STREAM});if(i.state!==se)return u.default.error("[".concat(i.clientId,"] User is not in the session")),X&&X(W.default.INVALID_OPERATION),void b.report.publish(i.joinInfo.sid,{lts:ne,succ:!1,audio:c.hasAudio(),video:c.hasVideo(),screenshare:c.hasScreen(),audioName:c.hasAudio()&&c.audioName,videoName:c.hasVideo()&&c.videoName,screenName:c.hasScreen()&&c.screenName,ec:W.default.INVALID_OPERATION});var K=c.getAttributes()||{};if(c.local&&i.localStreams[c.getId()]===void 0&&(c.hasAudio()||c.hasVideo()||c.hasScreen())){var te=i.generateP2PId();if(i.p2ps.set(te,c),c.p2pId=te,c.url!==void 0)ge(Z({state:"url",audio:c.hasAudio(),video:c.hasVideo(),attributes:c.getAttributes()},c.url),function(de,oe){de==="success"?(c.getUserId()!==oe&&c.setUserId(oe),i.localStreams[oe]=c,c.onClose=function(){i.unpublish(c)}):u.default.error("[".concat(i.clientId,"] Publish local stream failed"),de)});else{i.localStreams[c.getId()]=c,c.connectionSpec={callback:function(de){de||X&&X("CANNOT_GET_OFFER"),c.optimizationMode==="motion"&&c.pc.setRtpSenderParameters("maintain-framerate"),c.optimizationMode==="detail"&&c.pc.setRtpSenderParameters("maintain-resolution"),i.makeRequest(Z({state:"offer",stream_type:P.streamType==1?"low":"high",p2p_id:te,sdp:de,audio:c.audio||c.screenAudio,video:c.screen||c.video,screen:c.screen,attributes:c.getAttributes(),dtx:c.DTX,hq:c.highQuality,lq:c.lowQuality,stereo:c.stereo,speech:c.speech,codec:i.codec,extend:Object(_.getParameter)("PUB_EXTEND")}),function(oe){c.getUserId()!==oe.uid&&c.setUserId(oe.uid),u.default.info("[".concat(i.clientId,"] Local stream published with uid"),oe.uid),c.onClose=function(){i.unpublish(c)},c._onAudioUnmute=function(){i.makeReport($({action:"unmute_local_audio",stream_id:c.getId()}))},c._onVideoUnmute=function(){i.makeReport($({action:"unmute_local_video",stream_id:c.getId()}))},c._onAudioMute=function(){i.makeReport($({action:"mute_local_audio",stream_id:c.getId()}))},c._onVideoMute=function(){i.makeReport($({action:"mute_local_video",stream_id:c.getId()}))},c.getId()===c.getUserId()&&(c.isAudioOn()||c.hasAudio()&&(u.default.debug("[".concat(i.clientId,"] local stream audio mute")),c._onAudioMute()),c.isVideoOn()||(c.hasVideo()||c.hasScreen())&&(u.default.debug("[".concat(i.clientId,"] local stream video mute")),c._onVideoMute())),c.pc.oniceconnectionstatechange=function(pe){if(pe==="failed"){if(i.timers[c.getId()]!=null&&(clearInterval(i.timers[c.getId()]),clearInterval(i.timers[c.getId()]+"_RelatedStats")),u.default.error("[".concat(i.clientId,"] Publisher connection is lost -- streamId: ").concat(c.getId(),", p2pId: ").concat(te)),i.p2ps.delete(te),u.default.debug("[".concat(i.clientId,"] publish p2p failed: "),i.p2ps),!V)return V=!0,b.report.publish(i.joinInfo.sid,{lts:ne,succ:!1,audio:c.hasAudio(),video:c.hasVideo(),screenshare:c.hasScreen(),audioName:c.hasAudio()&&c.audioName,videoName:c.hasVideo()&&c.videoName,screenName:c.hasScreen()&&c.screenName,ec:W.default.PEERCONNECTION_FAILED,publishRequestid:i.publishRequestId||0,p2pid:te}),i.dispatchEvent(Object(C.a)({type:"pubP2PLost",stream:c})),X&&X(W.default.PEERCONNECTION_FAILED);i.dispatchEvent(Object(C.a)({type:"pubP2PLost",stream:c}))}else if(pe==="connected"&&(u.default.debug("[".concat(i.clientId,"] publish p2p connected: "),i.p2ps),c.getId()===c.getUserId()&&(c._isAudioMuted()?i.makeReport($({action:"mute_local_audio",stream_id:c.getId()})):i.makeReport($({action:"unmute_local_audio",stream_id:c.getId()})),c._isVideoMuted()?i.makeReport($({action:"mute_local_video",stream_id:c.getId()})):i.makeReport($({action:"unmute_local_video",stream_id:c.getId()}))),!V))return V=!0,b.report.publish(i.joinInfo.sid,{lts:ne,succ:!0,audio:c.hasAudio(),video:c.hasVideo(),screenshare:c.hasScreen(),audioName:c.hasAudio()&&c.audioName,videoName:c.hasVideo()&&c.videoName,screenName:c.hasScreen()&&c.screenName,ec:null,publishRequestid:i.publishRequestId||0,p2pid:te}),F&&F()},c.pc.processSignalingMessage(oe.sdp)},function(oe,pe){u.default.error("Publish Failed: ".concat(oe)),b.report.publish(i.joinInfo.sid,{lts:ne,succ:!1,audio:c.hasAudio(),video:c.hasVideo(),screenshare:c.hasScreen(),audioName:c.hasAudio()&&c.audioName,videoName:c.hasVideo()&&c.videoName,screenName:c.hasScreen()&&c.screenName,ec:oe,publishRequestid:i.publishRequestId||0,p2pid:te}),oe!="TIMEOUT"&&(i.processPublishFailure(c),X&&X(oe))})},audio:c.hasAudio(),video:c.hasVideo(),screen:c.hasScreen(),optimizationMode:c.optimizationMode,isSubscriber:!1,stunServerUrl:i.stunServerUrl,turnServers:i.joinInfo.turnServers,maxAudioBW:K.maxAudioBW,minVideoBW:K.minVideoBW,maxVideoBW:K.maxVideoBW,mode:i.mode,codec:i.codec,isVideoMute:c.userMuteVideo||c.peerMuteVideo,isAudioMute:c.userMuteAudio||c.peerMuteAudio,maxFrameRate:c.attributes.maxFrameRate,agoraStream:c,clientId:i.clientId,isCloudProxy3:i.joinInfo.proxyServerType===3,onNoIceCandidate:function(){i.dispatchEvent({type:"no_ice_candidate",stream:c})}},c.pc=Object(B.a)(c.connectionSpec),c.pc.addStream(c.stream),u.default.debug("[".concat(i.clientId,"] PeerConnection add stream :"),c.stream),c.pc.onnegotiationneeded=function(de){c.optimizationMode==="motion"&&c.pc.setRtpSenderParameters("maintain-framerate"),c.optimizationMode==="detail"&&c.pc.setRtpSenderParameters("maintain-resolution");var oe={state:"negotiation",stream_type:P.streamType===1?"low":"high",p2p_id:te,sdp:de};i.makeRequest(Z(oe),function(pe){u.default.debug("Negotating Stream ".concat(c.getId())),c.pc.processSignalingMessage(pe.sdp)},function(pe,ve){u.default.error("Negotiation failed ".concat(pe),ve,oe)})},clearInterval(i.timers[c.getId()]),i.timers[c.getId()]=setInterval(function(){if(Object(_.getParameter)("REPORT_STATS")){var de=0;c&&c.pc&&c.pc.getStats&&c.pc.getStatsRate(function(oe){oe.forEach(function(pe){if(pe&&pe.id&&!(/_recv$/.test(pe.id)||/^time$/.test(pe.id)||~pe.type.toLowerCase().indexOf("inbound"))&&c.getUserId()){if(pe.id.indexOf("outbound_rtp")===-1&&pe.id.indexOf("OutboundRTP")===-1&&pe.type.toLowerCase().indexOf("outbound")===-1||pe.mediaType!=="video"||(pe.googFrameWidthSent=c.videoWidth+"",pe.googFrameHeightSent=c.videoHeight+""),pe.mediaType==="video")try{var ve=c.stream.getVideoTracks()[0];pe.A_vstd=ve.enabled?"0":"1"}catch{}if(pe.mediaType==="audio")try{var Re=c.stream.getAudioTracks()[0];pe.A_astd=Re.enabled?"0":"1"}catch{}if(c.getId()==c.getUserId()){var Ie=200*de;de++,setTimeout(function(){var Se=i.socket&&i.socket.getLastMsgTime()&&Date.now()-i.socket.getLastMsgTime();Se>Object(_.getParameter)("REPORT_STATS_TIMEOUT")?u.default.debug("PublishStats report blocked by REPORT_STATS_TIMEOUT ".concat(Se)):i.makeReport(function(Te){var ye={};return Object.keys(Te).forEach(function(be){Object(_.getParameter)("STATS_FILTER")[be]||(ye[o(be)]=Te[be])}),{_type:"publish_stats",_message:{stream_type:"high",stats:ye}}}(pe))},Ie)}else Ie=200*de,de++,setTimeout(function(){var Se=i.socket&&i.socket.getLastMsgTime()&&Date.now()-i.socket.getLastMsgTime();Se>Object(_.getParameter)("REPORT_STATS_TIMEOUT")?u.default.debug("PublishStatsLow report blocked by REPORT_STATS_TIMEOUT ".concat(Se)):i.makeReport(function(Te){var ye={};return Object.keys(Te).forEach(function(be){Object(_.getParameter)("STATS_FILTER")[be]||(ye[o(be)]=Te[be])}),{_type:"publish_stats",_message:{stream_type:"low",stats:ye}}}(pe))},Ie)}})})}},3e3);var ae=function(){Object(_.getParameter)("REPORT_STATS")&&c&&c.pc&&c.pc.getVideoRelatedStats&&c.pc.getVideoRelatedStats(function(de){var oe,pe,ve=i.socket&&i.socket.getLastMsgTime()&&Date.now()-i.socket.getLastMsgTime();ve>Object(_.getParameter)("REPORT_STATS_TIMEOUT")?u.default.debug("PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(ve)):c.getId()===c.getUserId()?i.makeReport((oe=de,pe={},Object.keys(oe).forEach(function(Re){Object(_.getParameter)("STATS_FILTER")[Re]||(pe[o(Re)]=oe[Re])}),{_type:"publish_related_stats",_message:{stream_type:"high",stats:pe}})):i.makeReport(function(Re){var Ie={};return Object.keys(Re).forEach(function(Se){Object(_.getParameter)("STATS_FILTER")[Se]||(Ie[o(Se)]=Re[Se])}),{_type:"publish_related_stats",_message:{stream_type:"low",stats:Ie}}}(de))})};ae(),clearInterval(i.timers[c.getId()+"_RelatedStats"]),i.timers[c.getId()+"_RelatedStats"]=setInterval(ae,1e3)}}},i.unpublish=function(c,P,F,X){if(s()(c)!=="object"||c===null)return u.default.error("[".concat(i.clientId,"] Invalid local stream")),void le(X,W.default.INVALID_LOCAL_STREAM);if(i.state!==se)return u.default.error("[".concat(i.clientId,"] User not in the session")),void le(X,W.default.INVALID_OPERATION);if(i.timers[c.getId()]!=null&&(clearInterval(i.timers[c.getId()]),clearInterval(i.timers[c.getId()+"_RelatedStats"])),i.socket!==void 0)if(c.local&&i.localStreams[c.getId()]!==void 0){delete i.localStreams[c.getId()];var ne={stream_id:c.getUserId(),stream_type:P.streamType===1?"low":"high"};i.makeRequest({_type:"unpublish",_message:ne}),(c.hasAudio()||c.hasVideo()||c.hasScreen())&&c.url===void 0&&c.pc!==void 0&&(c.pc.close(),c.pc=void 0),c.onClose=void 0,c._onAudioMute=void 0,c._onAudioUnute=void 0,c._onVideoMute=void 0,c._onVideoUnmute=void 0,i.p2ps.delete(c.p2pId),F&&F()}else u.default.error("[".concat(i.clientId,"] Invalid local stream")),le(X,W.default.INVALID_LOCAL_STREAM);else u.default.error("[".concat(i.clientId,"] User not in the session")),le(X,W.default.INVALID_OPERATION)},i.subscribe=function(c,P,F){var X=new Date().getTime();c.subscribeLTS=X;var ne=!1;if(u.default.info("[".concat(i.clientId,"] Gatewayclient ").concat(i.uid," Subscribe ").concat(c.getId(),": ").concat(JSON.stringify(c.subscribeOptions))),s()(c)!=="object"||c===null)return u.default.error("[".concat(i.clientId,"] Invalid remote stream")),F&&F(W.default.INVALID_REMOTE_STREAM),void b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:W.default.INVALID_REMOTE_STREAM});if(i.state!==se&&(u.default.error("[".concat(i.clientId,"] User is not in the session")),!ne))return ne=!0,b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:W.default.INVALID_OPERATION}),F&&F(W.default.INVALID_OPERATION);if(!c.local&&i.remoteStreams.hasOwnProperty(c.getId()))if(c.hasAudio()||c.hasVideo()||c.hasScreen()){var V=i.generateP2PId();i.p2ps.set(V,c),c.p2pId=V,c.pc=Object(B.a)({callback:function(K){K||F&&F("CANNOT_GET_OFFER");var te={stream_id:c.getId(),audio:!c.subscribeOptions||c.subscribeOptions.audio,video:!c.subscribeOptions||c.subscribeOptions.video,codec:i.codec,p2p_id:V,sdp:K,tcc:Object(_.getParameter)("SUBSCRIBE_TCC"),extend:Object(_.getParameter)("SUB_EXTEND")};i.makeRequest({_type:"subscribe",_message:te},function(ae){c.pc.processSignalingMessage(ae.sdp)},function(ae,de){u.default.error("[".concat(i.clientId,"] Subscribe remote stream Failed: ").concat(ae,", closing stream "),c.getId(),de),b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:ae}),ae!="TIMEOUT"&&(i.processSubscribeFailure(c),F&&F(ae))})},nop2p:!0,audio:!0,video:!0,screen:c.hasScreen(),isSubscriber:!0,stunServerUrl:i.stunServerUrl,turnServers:i.joinInfo.turnServers,isVideoMute:c.userMuteVideo,isAudioMute:c.userMuteAudio,uid:c.getId(),agoraStream:c,clientId:i.clientId}),c.pc.onaddstream=function(K,te){if(c._onAudioUnmute=function(){i.makeReport($({action:"unmute_remote_audio",stream_id:c.getId()}),function(){},function(){})},c._onAudioMute=function(){i.makeReport($({action:"mute_remote_audio",stream_id:c.getId()}),function(){},function(){})},c._onVideoUnmute=function(){i.makeReport($({action:"unmute_remote_video",stream_id:c.getId()}),function(){},function(){})},c._onVideoMute=function(){i.makeReport($({action:"mute_remote_video",stream_id:c.getId()}),function(){},function(){})},te==="ontrack"&&K.track.kind==="video"||te==="onaddstream"){u.default.info("[".concat(i.clientId,"] Remote stream subscribed with uid "),c.getId());var ae=i.remoteStreams[c.getId()];if(i.remoteStreams[c.getId()].stream=te==="onaddstream"?K.stream:K.streams[0],i.remoteStreams[c.getId()].hasVideo()){if(Object(p.isFireFox)()||Object(p.isSafari)()){var de=i.remoteStreams[c.getId()].stream;Object(R.vsResHack)(de,function(ve,Re){c.videoWidth=ve,c.videoHeight=Re},function(ve){return u.default.warning("[".concat(i.clientId,"] vsResHack failed: ")+ve)})}}else{var oe=i.remoteStreams[c.getId()];oe.peerMuteVideo=!0,i._adjustPCMuteStatus(oe)}ae&&ae.isPlaying()&&ae.elementID&&(u.default.debug("[".concat(i.clientId,"] Reload Player ").concat(ae.elementID," StreamId ").concat(ae.getId())),c.audioOutput=ae.audioOutput,ae.stop(),c.play(ae.elementID,ae.playOptions)),delete c.audioLevelHelper;var pe=Object(C.e)({type:"stream-subscribed",stream:i.remoteStreams[c.getId()]});i.dispatchEvent(pe)}},clearInterval(i.timers[c.getId()]),i.timers[c.getId()]=setInterval(function(){if(Object(_.getParameter)("REPORT_STATS")){var K=0;c&&c.pc&&c.pc.getStats&&c.pc.getStatsRate(function(te){te.forEach(function(ae){if(ae&&ae.id){if(/_send$/.test(ae.id)||/^time$/.test(ae.id)||/^bweforvideo$/.test(ae.id))return;ae.id.indexOf("inbound_rtp")===-1&&ae.id.indexOf("inbound-rtp")===-1&&ae.type.toLowerCase().indexOf("inbound")===-1||ae.mediaType!=="video"||(ae.googFrameWidthReceived=c.videoWidth+"",ae.googFrameHeightReceived=c.videoHeight+"");var de=200*K;K++;var oe=c.getId();setTimeout(function(){var pe=i.socket&&i.socket.getLastMsgTime()&&Date.now()-i.socket.getLastMsgTime();if(pe>Object(_.getParameter)("REPORT_STATS_TIMEOUT"))u.default.debug("SubscribeStats report blocked by REPORT_STATS_TIMEOUT ".concat(pe));else{if(ae.mediaType==="video")try{var ve=c.stream.getVideoTracks()[0];ae.A_vrtd=ve.enabled?"0":"1",c.player&&c.player.freezeTimeCounterList.length>0&&(ae.A_vrft=c.player.freezeTimeCounterList.splice(0,1)[0].toString())}catch{}if(ae.mediaType==="audio")try{var Re=c.stream.getAudioTracks()[0];ae.A_artd=Re.enabled?"0":"1"}catch{}i.makeReport(re(oe,ae))}},de)}})})}},3e3),clearInterval(i.timers[c.getId()+"_RelatedStats"]),i.timers[c.getId()+"_RelatedStats"]=setInterval(function(){if(Object(_.getParameter)("REPORT_STATS")&&c&&c.pc){var K=i.socket&&i.socket.getLastMsgTime()&&Date.now()-i.socket.getLastMsgTime();if(K>Object(_.getParameter)("REPORT_STATS_TIMEOUT"))return void u.default.debug("SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(K));c.pc.getVideoRelatedStats&&c.pc.getVideoRelatedStats(function(te){c.player&&(c.hasVideo()&&!c.peerMuteVideo&&(te.isFreeze=c.player.freezeCount>c.player.lastFreezeCount),c.player.lastFreezeCount=c.player.freezeCount),i.makeReport(Y(c.getId(),te))}),c.pc.getAudioRelatedStats&&c.pc.getAudioRelatedStats(function(te){i.makeReport(Y(c.getId(),te))})}},1e3),i.audioLevel[c.getId()]=0,clearInterval(i.timers[c.getId()+"audio"]),i.timers[c.getId()+"audio"]=setInterval(function(){i.hasListeners("active-speaker")&&c&&c.pc&&c.pc.state==="established"&&c.pc.getStats&&c.pc.getStats(function(K){K.forEach(function(te){if(te.mediaType==="audio"){if(te.audioOutputLevel>5e3)for(var ae in i.audioLevel[c.getId()]<20&&(i.audioLevel[c.getId()]+=1),i.audioLevel)ae!==""+c.getId()&&i.audioLevel[ae]>0&&(i.audioLevel[ae]-=1);var de=Object.keys(i.audioLevel).sort(function(pe,ve){return i.audioLevel[ve]-i.audioLevel[pe]});if(i.activeSpeaker!==de[0]){var oe=Object(C.a)({type:"active-speaker",uid:de[0]});i.dispatchEvent(oe),i.activeSpeaker=de[0],u.default.debug("[".concat(i.clientId,"] Update active speaker: ").concat(i.activeSpeaker))}}})},50)},50),c.pc.oniceconnectionstatechange=function(K){if(K==="failed")i.timers[c.getId()]!=null&&(clearInterval(i.timers[c.getId()]),clearInterval(i.timers[c.getId()]+"audio")),u.default.error("[".concat(i.clientId,"] Subscriber connection is lost -- streamId: ").concat(c.getId(),", p2pId: ").concat(V)),u.default.debug("[".concat(i.clientId,"] subscribe p2p failed: "),i.p2ps),ne||(ne=!0,F&&F(W.default.PEERCONNECTION_FAILED),b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:W.default.PEERCONNECTION_FAILED,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V})),i.remoteStreams[c.getId()]&&i.p2ps.has(V)&&(i.p2ps.delete(V),i.dispatchEvent(Object(C.a)({type:"subP2PLost",stream:c})));else if(K==="connected"&&(u.default.debug("[".concat(i.clientId,"] subscribe p2p connected: "),i.p2ps),!ne)){ne=!0,b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!0,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:null,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V}),i._adjustPCMuteStatus(c);var te=!1,ae=!1,de=!1,oe=setInterval(function(){te&&ae||(c.pc?c.pc.getStats(function(Se){Se.forEach(function(Te){if((Te.id.indexOf("recv")!==-1||Te.type&&Te.type.toLowerCase().indexOf("inbound")!==-1||Te.id.indexOf("inbound_rtp")!==-1||Te.id.indexOf("inbound-rtp")!==-1||Te.id.indexOf("InboundRTP")!==-1)&&Te.mediaType==="audio"){if((Te.googDecodingNormal>0||Te.audioOutputLevel>0)&&!te){te=!0,i.dispatchEvent({type:"first-audio-frame-decode",stream:c}),te&&ae&&clearInterval(oe);var ye=Date.now(),be=b.report.getSessionStartTime(i.joinInfo.sid);b.report.firstAudioDecode(i.joinInfo.sid,{peerid:c.uintId,uid:i.uid,elapse:ye-be,subscribeElapse:ye-c.subscribeLTS,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V})}parseInt(Te.packetsReceived)>0&&!ae&&(ae=!0,i.dispatchEvent({type:"first-audio-packet-received",stream:c}),te&&ae&&clearInterval(oe),ye=Date.now(),be=b.report.getSessionStartTime(i.joinInfo.sid),b.report.firstAudioReceived(i.joinInfo.sid,{peerid:c.uintId,uid:i.uid,elapse:ye-be,subscribeElapse:ye-c.subscribeLTS,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V}))}})},100):clearInterval(oe))},100),pe=!1,ve=!1,Re=setInterval(function(){pe&&ve||(c.pc?c.pc.getStats(function(Se){Se.forEach(function(Te){if((Te.id.indexOf("recv")!==-1||Te.type&&Te.type.toLowerCase().indexOf("inbound")!==-1||Te.id.indexOf("inbound_rtp")!==-1||Te.id.indexOf("inbound-rtp")!==-1||Te.id.indexOf("InboundRTP")!==-1)&&Te.mediaType==="video"){if((Te.framesDecoded>0||Te.googFramesDecoded>0)&&!pe){pe=!0,i.dispatchEvent({type:"first-video-frame-decode",stream:c}),pe&&ve&&clearInterval(Re);var ye=Date.now(),be=b.report.getSessionStartTime(i.joinInfo.sid);c.firstFrameTime=new Date().getTime()-c.subscribeLTS,b.report.firstVideoDecode(i.joinInfo.sid,{peerid:c.uintId,width:parseInt(Te.googFrameWidthReceived)||0,height:parseInt(Te.googFrameHeightReceived)||0,uid:i.uid,elapse:ye-be,subscribeElapse:ye-c.subscribeLTS,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V})}Te.packetsReceived>0&&!ve&&(ve=!0,i.dispatchEvent({type:"first-video-packet-received",stream:c}),pe&&ve&&clearInterval(Re),ye=Date.now(),be=b.report.getSessionStartTime(i.joinInfo.sid),b.report.firstVideoReceived(i.joinInfo.sid,{peerid:c.uintId,uid:i.uid,elapse:ye-be,subscribeElapse:ye-c.subscribeLTS,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:V}))}})},100):clearInterval(Re))},100),Ie=setInterval(function(){if(!de){var Se=c.getId(),Te=i.traffic_stats;if(Te&&Te.peer_delay){var ye=Te.peer_delay.find(function(we){return we.peer_uid==Se});if(ye){if(de=!0,i.peerPublishDurationMap.get(c.getId()))return void clearInterval(Ie);var be=ye.peer_publish_audio_duration,Ae=ye.peer_publish_video_duration;if(be===void 0||Ae===void 0)return;i.peerPublishDurationMap.set(c.getId(),!0);var Oe=b.report.getSessionStartTime(i.joinInfo.sid),Ce=(be||Ae)+(Date.now()-Te.timestamp),Ne=Date.now();b.report.peerPublishStatus({audiotag:be?1:-1,videotag:Ae?1:-1,lts:Ne,sid:i.joinInfo.sid,cname:i.joinInfo.cname,cid:i.joinInfo.cid,uid:i.joinInfo.uid,elapse:Ne-Oe,peer:c.uintId,peerPublishDuration:Ce,joinChannelSuccessElapse:Ne-i.joinSuccessLts,subscribeElapse:Ne-c.subscribeLTS}),clearInterval(Ie)}}}},1e3);return c.sid=i.joinInfo.sid,P&&P()}}}else u.default.error("[".concat(i.clientId,"] Invalid remote stream")),ne||(ne=!0,F&&F(W.default.INVALID_REMOTE_STREAM),b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:W.default.INVALID_REMOTE_STREAM}));else u.default.error("[".concat(i.clientId,"] No such remote stream")),ne||(ne=!0,F&&F(W.default.NO_SUCH_REMOTE_STREAM),b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!1,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:W.default.NO_SUCH_REMOTE_STREAM}))},i.subscribeChange=function(c,P,F){var X=Date.now();u.default.info("[".concat(i.clientId,"] Gatewayclient ").concat(i.uid," SubscribeChange ").concat(c.getId(),": ").concat(JSON.stringify(c.subscribeOptions))),i._adjustPCMuteStatus(c);var ne={stream_id:c.getId(),audio:c.subscribeOptions.audio,video:c.subscribeOptions.video};i.makeRequest({_type:"subscribe_change",_message:ne},function(V){var K=Object(C.e)({type:"stream-subscribe-changed",stream:i.remoteStreams[c.getId()]});b.report.subscribe(i.joinInfo.sid,{lts:X,succ:!0,video:c.subscribeOptions&&c.subscribeOptions.video,audio:c.subscribeOptions&&c.subscribeOptions.audio,peerid:c.getId(),ec:null,subscribeRequestid:i.subscribeRequestId.get(c.getId())||0,p2pid:i.p2ps.get(c.getId())}),i.dispatchEvent(K),P&&P()},function(V,K){u.default.error("[".concat(i.clientId,"] Subscribe Change Failed ").concat(c.getId()),V,K),F&&F(V,K)})},i.processPublishFailure=function(c){c.publishLTS=null,c.p2pId&&i.p2ps.get(c.p2pId)===c&&i.p2ps.delete(c.p2pId),i.localStreams[c.getUserId()]===c&&delete i.localStreams[c.getUserId()],i.localStreams[c.getId()]===c&&delete i.localStreams[c.getId()],c.pc&&(c.pc.processSignalingMessage=function(){},c.pc.oniceconnectionstatechange=function(){},c.pc.close(),delete c.pc),delete c.onClose,delete c._onAudioUnmute,delete c._onVideoUnmute,delete c._onAudioMute,delete c._onVideoMute,delete c._onAudioUnmute},i.processSubscribeFailure=function(c){c.p2pId&&i.p2ps.get(c.p2pId)===c&&i.p2ps.delete(c.p2pId),c.pc&&(c.pc.onaddstream=function(){},c.pc.processSignalingMessage=function(){},c.pc.oniceconnectionstatechange=function(){},c.pc.close(),delete c.pc),delete c.onClose,delete c._onAudioUnmute,delete c._onVideoUnmute,delete c._onAudioMute,delete c._onVideoMute,delete c._onAudioUnmute},i._adjustPCMuteStatus=function(c){u.default.debug("[".concat(i.clientId,"]: use _adjustPCMuteStatus: ").concat(c.getId())),u.default.debug("[".concat(i.clientId,"]: video: ").concat(c.video,", audio: ").concat(c.audio,", suboption: ").concat(JSON.stringify(c.subscribeOptions),",userMuteVideo: ").concat(c.userMuteVideo,", peerMuteVideo: ").concat(c.peerMuteVideo,", userMuteAudio: ").concat(c.userMuteAudio,", peerMuteAudio: ").concat(c.peerMuteAudio)),!c.local&&c.pc&&c.pc.peerConnection.getReceivers&&c.pc.peerConnection.getReceivers().forEach(function(P){if(P&&P.track&&P.track.kind==="audio"){var F=!c.userMuteAudio&&!c.peerMuteAudio;c.subscribeOptions&&!c.subscribeOptions.audio&&(F=!1),u.default.debug("[".concat(i.clientId,"]: set receiver audio track: ").concat(F)),P.track.enabled=!!F}else if(P&&P.track&&P.track.kind==="video"){var X=!c.userMuteVideo&&!c.peerMuteVideo;c.subscribeOptions&&!c.subscribeOptions.video&&(X=!1),u.default.debug("[".concat(i.clientId,"]: set receiver video track: ").concat(X)),P.track.enabled=!!X}})},i.unsubscribe=function(c,P,F){if(s()(c)!=="object"||c===null)return u.default.error("[".concat(i.clientId,"] Invalid remote stream")),void le(F,W.default.INVALID_REMOTE_STREAM);if(i.state!==se)return u.default.error("[".concat(i.clientId,"] User is not in the session")),void le(F,W.default.INVALID_OPERATION);if(i.timers[c.getId()]!=null&&(clearInterval(i.timers[c.getId()]),clearInterval(i.timers[c.getId()]+"audio")),i.audioLevel[c.getId()]!=null&&delete i.audioLevel[c.getId()],i.timer_counter[c.getId()]!=null&&delete i.timer_counter[c.getId()],i.remoteStreams.hasOwnProperty(c.getId())){if(!i.socket)return u.default.error("[".concat(i.clientId,"] User is not in the session")),void le(F,W.default.INVALID_OPERATION);if(c.local)return u.default.error("[".concat(i.clientId,"] Invalid remote stream")),void le(F,W.default.INVALID_REMOTE_STREAM);c.close(),c.stop();var X={stream_id:c.getId()};i.makeRequest({_type:"unsubscribe",_message:X}),c.pc!==void 0&&(c.pc.close(),c.pc=void 0),c.onClose=void 0,c._onAudioMute=void 0,c._onAudioUnute=void 0,c._onVideoMute=void 0,c._onVideoUnmute=void 0,delete c.subscribeOptions,i.p2ps.delete(c.p2pId),u.default.info("[".concat(i.clientId,"] Unsubscribe stream success")),P&&P()}else le(F,W.default.NO_SUCH_REMOTE_STREAM)},i.setRemoteVideoStreamType=function(c,P){if(u.default.debug("[".concat(i.clientId,"] Switching remote video stream ").concat(c.getId()," to ").concat(P)),s()(c)==="object"&&c!==null)if(i.state===se){if(!c.local){switch(P){case i.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case i.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case i.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}var F={stream_id:c.getId(),stream_type:P};i.makeRequest({_type:"switch_video_stream",_message:F},function(){u.default.debug("SwitchVideoStream Success ".concat(F.stream_id," ").concat(F.stream_type))},function(X,ne){u.default.error("SwitchVideoStream Error ".concat(X," ").concat(F.stream_id," ").concat(F.stream_type),ne)})}}else u.default.error("[".concat(i.clientId,"] User is not in the session"));else u.default.error("[".concat(i.clientId,"] Invalid remote stream"))},i.renewToken=function(c,P,F){c?i.key?i.state!==se?(u.default.debug("[".concat(i.clientId,"] Client is not connected. Trying to rejoin")),i.key=c,i.rejoin(),P&&P()):(u.default.debug("[".concat(i.clientId,"] renewToken from ").concat(i.key," to ").concat(c)),i.key=c,i.makeRequest({_type:"renew_token",_message:{token:c}},P,F)):(u.default.error("[".concat(i.clientId,"] Client is previously joined without token")),F&&F(W.default.INVALID_PARAMETER)):(u.default.error("[".concat(i.clientId,"] Invalid Token ").concat(c)),F&&F(W.default.INVALID_PARAMETER))},i.setStreamFallbackOption=function(c,P){if(u.default.debug("[".concat(i.clientId,"] Set stream fallback option ").concat(c.getId()," to ").concat(P)),s()(c)==="object"&&c!==null)if(i.state===se){if(!c.local){switch(P){case i.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case i.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case i.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}var F={stream_id:c.getId(),fallback_type:P};i.makeRequest({_type:"set_fallback_option",_message:F},function(){u.default.debug("SetStreamFallbackOption success ".concat(F.stream_id," ").concat(P))},function(X,ne){u.default.error("Failed to SetStreamFallbackOption ".concat(F.stream_id," ").concat(P," ").concat(X),ne)})}}else u.default.error("[".concat(i.clientId,"] User is not in the session"));else u.default.error("[".concat(i.clientId,"] Invalid remote stream"))},i.enableAudioVolumeIndicator=function(c,P){i.audioVolumeIndication.enabled=!0,i.audioVolumeIndication.interval=c,i.audioVolumeIndication.smooth=P,i.resetAudioVolumeIndication()},i.resetAudioVolumeIndication=function(){if(clearInterval(i.timers.audioVolumeIndication),clearInterval(i.timers.audioVolumeSampling),i.audioVolumeIndication.enabled&&i.audioVolumeIndication.interval){var c=Math.floor(1e3*i.audioVolumeIndication.smooth/100);clearInterval(i.timers.audioVolumeSampling),i.timers.audioVolumeSampling=setInterval(function(){i.audioVolumeSampling||(i.audioVolumeSampling={});var P={};for(var F in i.remoteStreams){var X=i.remoteStreams[F];if(X.stream&&X.hasAudio()){var ne=X.getAudioLevel();ne>0&&ne<1&&(ne*=100);var V=i.audioVolumeSampling[F]||[];for(V.push(ne);V.length>c;)V.shift();P[F]=V}}i.audioVolumeSampling=P},100),clearInterval(i.timers.audioVolumeIndication),i.timers.audioVolumeIndication=setInterval(function(){if(i.socket&&i.socket.signal&&i.socket.signal.connection&&i.socket.signal.connection.readyState===WebSocket.OPEN){var P=[];for(var F in i.remoteStreams)if(i.audioVolumeSampling&&i.audioVolumeSampling[F]){var X=i.audioVolumeSampling[F],ne=0;X.forEach(function(ae){ne+=ae});var V={uid:F,level:Math.floor(ne/X.length)};V.level&&P.push(V)}var K=P.sort(function(ae,de){return ae.level-de.level});u.default.debug("[".concat(i.clientId,"] volume-indicator "),JSON.stringify(K)),i.audioVolumeIndication.sortedAudioVolumes=K;var te=Object(C.a)({type:"volume-indicator",attr:K});i.dispatchEvent(te)}},i.audioVolumeIndication.interval)}},i.closeGateway=function(){u.default.debug("[".concat(i.clientId,"] close gateway")),i.state=ce,i.socket.close(),A()},i.startChannelMediaRelay=function(){var c=g()(f.a.mark(function P(F){var X,ne,V,K;return f.a.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(!i.channelMediaRelayController){te.next=2;break}throw new L.ChannelMediaError("RELAY_ALREADY_START","",L.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return X=function(ae){i.dispatchEvent({type:"channel-media-relay-event",code:ae})},ne=function(ae,de,oe){ae===L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&de===L.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(i.channelMediaRelayController.dispose(),i.channelMediaRelayController=null),i.dispatchEvent({type:"channel-media-relay-state",state:ae,code:de,data:oe})},i.channelMediaRelayController=new M.a(i.joinInfo,i.clientId),i.channelMediaRelayController.on("event",X),i.channelMediaRelayController.on("state",ne),te.prev=7,te.next=10,i.channelMediaRelayController.startChannelMediaRelay(F);case 10:te.next=22;break;case 12:throw te.prev=12,te.t0=te.catch(7),u.default.debug("[".concat(i.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(te.t0))),V=L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,K="",K=te.t0 instanceof L.ChannelMediaError?te.t0.data==="SetSourceChannelStatus"||te.t0.data&&te.t0.data.serverResponse&&te.t0.data.serverResponse.command==="SetSourceChannel"?"FAILED_JOIN_SRC":te.t0.data==="SetDestChannelStatus"||te.t0.data&&te.t0.data.serverResponse&&te.t0.data.serverResponse.command==="SetDestChannel"?"FAILED_JOIN_DEST":te.t0.data&&te.t0.data.serverResponse&&te.t0.data.serverResponse.command==="StartPacketTransfer"?"FAILED_PACKET_SENT_TO_DEST":te.t0.message===L.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||te.t0.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":te.t0.message===L.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||te.t0.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":te.t0.message===L.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":te.t0.message===L.CHANNEL_MEDIA_ERROR.WS_ABORT||te.t0.message===L.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",i.dispatchEvent({type:"channel-media-relay-state",state:V,code:L.CHANNEL_MEDIA_RELAY_ERROR[K]}),i.channelMediaRelayController&&(i.channelMediaRelayController.dispose(),i.channelMediaConfig=null,i.channelMediaRelayController=null),i.dispatchEvent({type:"channel-media-relay-state",state:L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new L.ChannelMediaError(K,null,L.CHANNEL_MEDIA_RELAY_ERROR[K]);case 22:i.dispatchEvent({type:"channel-media-relay-state",state:L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:L.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),i.channelMediaConfig=F;case 24:case"end":return te.stop()}},P,null,[[7,12]])}));return function(P){return c.apply(this,arguments)}}(),i.updateChannelMediaRelay=function(){var c=g()(f.a.mark(function P(F){var X,ne;return f.a.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(i.channelMediaRelayController){V.next=2;break}throw new L.ChannelMediaError("RELAY_NOT_START",null,L.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return V.prev=2,V.next=5,i.channelMediaRelayController.updateChannelMediaRelay(F);case 5:V.next=18;break;case 7:throw V.prev=7,V.t0=V.catch(2),u.default.debug("[".concat(i.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e))),X=L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,ne="",ne=e instanceof L.ChannelMediaError?e.message===L.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===L.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.message===L.CHANNEL_MEDIA_ERROR.WS_ABORT||e.message===L.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",i.dispatchEvent({type:"channel-media-relay-event",code:L.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),i.dispatchEvent({type:"channel-media-relay-state",state:X,code:L.CHANNEL_MEDIA_RELAY_ERROR[ne]}),i.channelMediaRelayController&&(i.channelMediaRelayController.dispose(),i.channelMediaConfig=null,i.channelMediaRelayController=null),i.dispatchEvent({type:"channel-media-relay-state",state:L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new L.ChannelMediaError(ne,null,L.CHANNEL_MEDIA_RELAY_ERROR[ne]);case 18:i.channelMediaConfig=F;case 19:case"end":return V.stop()}},P,null,[[2,7]])}));return function(P){return c.apply(this,arguments)}}(),i.stopChannelMediaRelay=g()(f.a.mark(function c(){var P,F;return f.a.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(i.channelMediaRelayController){X.next=2;break}throw new L.ChannelMediaError("RELAY_NOT_START",null,L.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return X.prev=2,X.next=5,i.channelMediaRelayController.stopChannelMediaRelay();case 5:X.next=17;break;case 7:throw X.prev=7,X.t0=X.catch(2),u.default.debug("[".concat(i.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e))),P=L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,F="",F=e instanceof L.ChannelMediaError?e.message===L.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===L.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===L.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",i.dispatchEvent({type:"channel-media-relay-state",state:P,code:L.CHANNEL_MEDIA_RELAY_ERROR[F]}),i.channelMediaRelayController&&(i.channelMediaRelayController.dispose(),i.channelMediaConfig=null,i.channelMediaRelayController=null),i.dispatchEvent({type:"channel-media-relay-state",state:L.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new L.ChannelMediaError(F,null,L.CHANNEL_MEDIA_RELAY_ERROR[F]);case 17:i.channelMediaConfig=null,i.channelMediaRelayController=null;case 19:case"end":return X.stop()}},c,null,[[2,7]])})),i.sendMetadata=function(c,P){i.makeRequest(function(F){return{_type:"send_metadata",_message:{session_id:i.joinInfo.sid,metadata:window.btoa(unescape(encodeURIComponent(F)))}}}(c),function(){u.default.debug("[".concat(i.clientId,'] send metadata "').concat(c,'" success')),P&&P(null)},function(F){u.default.error("[".concat(i.clientId,'] send metadata "').concat(c,'" failed'),F),P&&P(F)})},i._reportWebsocketCloseEvent=function(c,P){try{var F=b.report.getSessionStartTime(i.joinInfo.sid),X=Date.now();b.report.webSocketQuit({lts:X,sid:i.joinInfo.sid,cname:i.joinInfo.cname,cid:i.joinInfo.cid,uid:i.joinInfo.uid,elapse:X-F,succ:c,errorCode:P,ip:null})}catch(ne){u.default.debug("[".concat(i.clientId,"]: _reportWebsocketCloseEvent exception, ").concat(ne))}};var ee=function(){u.default.debug("[".concat(i.clientId,"] Reconnect gateway")),i.state=ce,i.socket.close(),A(),i.reconnectMode="recover",i.state=ue,fe()};i.recover=ee;var A=function(){for(var c in i.dispatchEvent({type:"before-clear-connection"}),i.timers)i.timers.hasOwnProperty(c)&&clearInterval(i.timers[c]);for(var c in i.remoteStreams)if(i.remoteStreams.hasOwnProperty(c)){var P=i.remoteStreams[c],F=Object(C.a)({type:"stream-removed",uid:P.getId(),stream:P});i.dispatchEvent(F)}i.p2ps.clear(),_e(),he(),clearInterval(i.pingTimer)};i.rejoin=function(){i.socket&&(clearInterval(i.pingTimer),i.socket.close(),i.socket=void 0),i.state=ue,fe()};var fe=function(c,P){i.dispatchEvent(Object(C.a)({type:"rejoin-start"})),c=c||function(F){u.default.info("[".concat(i.clientId,"] User ").concat(F," is re-joined to ").concat(i.joinInfo.cname)),i.dispatchEvent(Object(C.a)({type:"rejoin"})),i.channelMediaConfig&&i.startChannelMediaRelay(i.channelMediaConfig).then(function(){u.default.debug("[".concat(i.clientId,"] restartChannelMediaRelay success"))}).catch(function(X){u.default.debug("[".concat(i.clientId,"] restartChannelMediaRelay failed: ").concat(JSON.stringify(X)))}),i.liveStreams&&i.liveStreams.size&&i.liveStreams.forEach(function(X,ne){X&&i.setLiveTranscoding(i.transcoding),i.startLiveStreaming(ne,X)}),i.injectLiveStreams&&i.injectLiveStreams.size&&i.injectLiveStreams.forEach(function(X,ne){i.addInjectStreamUrl(ne,X)})},P=P||function(F){u.default.error("[".concat(i.clientId,"] Re-join to channel failed "),F),i.dispatchEvent(Object(C.e)({type:"error",reason:F}))},i.key?(++i.rejoinAttempt,i.join(i.joinInfo,i.key,c,P)):u.default.error("[".concat(i.clientId,"] Connection recover failed [Invalid channel key]"))},Ee=function(c,P,F){if(i.onConnect=P,i.socket){if(i.dispatchEvent({type:"reconnect"}),i.reconnectMode==="retry")u.default.debug("[".concat(i.clientId,"] Retry current gateway")),i.socket.reconnect();else if(i.reconnectMode==="tryNext")u.default.debug("[".concat(i.clientId,"] Try next gateway")),i.socket.connectNext();else if(i.reconnectMode==="recover"){u.default.debug("[".concat(i.clientId,"] Recover gateway")),u.default.debug("[".concat(i.clientId,"] Try to reconnect choose server and get gateway list again ")),i.reconnectingCS=!0;var X=i.joinInfo&&i.joinInfo.sid;Object(k.getGatewayList)(i.joinInfo,function(V){u.default.debug("[".concat(i.clientId,"] session:  ").concat(X," get gateway list success")),i.joinInfo.apResponse=V.res,i.reconnectingCS?i.socket.replaceHost(V.gateway_addr):u.default.debug("[".concat(i.clientId,"] session:  ").concat(X," already leave"))})}}else ne=c.gatewayAddr,i.socket=q(ne,{sid:i.joinInfo.sid,clientId:i.clientId,proxyServerType:i.joinInfo.proxyServerType}),i.socket.on("start-connection",function(V){i.ticket=V&&V.msg&&V.msg.ticket}),i.socket.on("on_uplink_stats",function(V){var K={};for(var te in V)K[h(te)]=V[te];if(i.OutgoingAvailableBandwidth=K.uplink_available_bandwidth,i.localStreams[i.uid]){var ae=i.localStreams[i.uid].uplinkStats;ae&&ae.period_fir===K.period_fir||u.default.debug("[".concat(i.clientId,"]: Period fir change to: ").concat(K.period_fir)),i.localStreams[i.uid].uplinkStats=K}}),i.socket.on("connect",function(){i.dispatchEvent({type:"connected"}),i.attemps=1,i.onConnect()}),i.socket.on("recover",function(){i.state=ue,u.default.debug("[".concat(i.clientId,"] Try to reconnect choose server and get gateway list again ")),i.reconnectingCS=!0;var V=i.joinInfo&&i.joinInfo.sid;Object(k.getGatewayList)(i.joinInfo,function(K){u.default.debug("[".concat(i.clientId,"] session:  ").concat(V," get gateway list success")),i.reconnectingCS?i.socket.replaceHost(K.gateway_addr):u.default.debug("[".concat(i.clientId,"] session:  ").concat(V," already leave"))})}),i.socket.on("disconnect",function(V){if(u.default.debug("[".concat(i.clientId,"] Receive disconnect message")),i.state!==ce){i.state=ce,i._reportWebsocketCloseEvent(-1,W.WEBSOCKET_CLOSE_REASON.WS_DISCONNECT);var K=Object(C.e)({type:"error",reason:W.default.SOCKET_DISCONNECTED});if(i.dispatchEvent(K),i.p2ps.size===0?i.reconnectMode="tryNext":i.reconnectMode="retry",A(),i.channelMediaRelayController&&i.channelMediaRelayController.dispose(),i.channelMediaRelayController=null,U!=1){var te,ae=(te=i.attemps,1e3*Math.min(30,Math.pow(2,te)-1));if(u.default.error("[".concat(i.clientId,"] Disconnect from server [").concat(JSON.stringify(V),"], attempt to recover [#").concat(i.attemps,"] after ").concat(ae/1e3," seconds")),i.hasInvokeLeave)return u.default.debug("[".concat(i.clientId,"] No reconnection because Client.leave has been invoked")),void(i.hasInvokeLeave=!1);setTimeout(function(){i.attemps++,i.state=ue,i.inChannelInfo&&Date.now()-i.inChannelInfo.joinAt>Object(_.getParameter)("TICKET_RENEW_TIMEOUT")?(u.default.debug("Recovering to renew ticket"),ee()):fe()},ae)}else{var de=J.unregister(i);de&&u.default.debug("[".concat(i.clientId,"] "),de)}}}),i.socket.on("on_add_audio_stream",function(V){if(u.default.info("[".concat(i.clientId,"] Newly added audio stream with uid ").concat(V.uid)),i.joinInfo.stringUid&&typeof V.uid!="string"&&u.default.error("StringUID is Mixed with UintUID"),i.remoteStreamsInChannel.has(V.uid)||i.remoteStreamsInChannel.add(V.uid),i.remoteStreams[V.uid]===void 0){var K=Object(T.a)({streamID:V.uid,local:!1,audio:V.audio,video:V.video,uintUID:V.uint_id||V.uid});K.peerMuteVideo=!0,i.remoteStreams[V.uid]=K;var te=Object(C.e)({type:"stream-added",stream:K});i.dispatchEvent(te);var ae=i.remoteMuteState[V.uid];ae&&ae.audio&&(te=Object(C.a)({type:"mute-audio",uid:V.uid}),i.dispatchEvent(te)),ae&&ae.video&&(te=Object(C.a)({type:"mute-video",uid:V.uid}),i.dispatchEvent(te))}b.report.onAddAudioStream(i.joinInfo.sid,{peerid:V.uint_id||V.uid,uid:i.uid})}),i.socket.on("on_update_stream",function(V){u.default.info("[".concat(i.clientId,"] on_update_stream:"),V);var K=i.remoteStreams[V.uid];if(i.joinInfo.stringUid&&typeof V.uid!="string"&&u.default.error("StringUID is Mixed with UintUID"),K){K.audio=V.audio,K.video=V.video,K.screen=V.screen,K.pc&&i._adjustPCMuteStatus(K);var te=Object(C.e)({type:"stream-updated",stream:K});i.dispatchEvent(te)}else u.default.debug("[".concat(i.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(V.uid));b.report.onUpdateStream(i.joinInfo.sid,{peerid:V.uint_id||V.uid,audio:V.audio,video:V.video,uid:i.uid})}),i.socket.on("on_add_video_stream",function(V){if(u.default.info("[".concat(i.clientId,"] Newly added remote stream with uid ").concat(V.uid,".")),i.joinInfo.stringUid&&typeof V.uid!="string"&&u.default.error("StringUID is Mixed with UintUID"),i.remoteStreamsInChannel.has(V.uid)||i.remoteStreamsInChannel.add(V.uid),i.remoteStreams[V.uid]===void 0){var K=Object(T.a)({streamID:V.uid,local:!1,audio:V.audio,video:V.video,uintUID:V.uint_id||V.uid});i.remoteStreams[V.uid]=K;var te=Object(C.e)({type:"stream-added",stream:K});i.dispatchEvent(te);var ae=i.remoteMuteState[V.uid];ae&&ae.audio&&(te=Object(C.a)({type:"mute-audio",uid:V.uid}),i.dispatchEvent(te)),ae&&ae.video&&(te=Object(C.a)({type:"mute-video",uid:V.uid}),i.dispatchEvent(te))}else{var de=i.remoteStreams[V.uid];if(de.video=!0,de.peerMuteVideo=!1,de.pc&&i._adjustPCMuteStatus(de),u.default.info("[".concat(i.clientId,"] Stream changed: enable video ").concat(V.uid)),de.stream!==void 0&&de.isPlaying()){var oe=de.player.elementID;de.stop(),de.play(oe,de.playOptions)}}b.report.onAddVideoStream(i.joinInfo.sid,{peerid:V.uint_id||V.uid,uid:i.uid})}),i.socket.on("on_remove_stream",function(V){u.default.info("[".concat(i.clientId,"] on_remove_stream:"),V),i.remoteStreamsInChannel.has(V.uid)&&i.remoteStreamsInChannel.delete(V.uid);var K=i.remoteStreams[V.uid];if(K){delete i.remoteStreams[V.uid],delete i.remoteMuteState[V.uid];var te=Object(C.e)({type:"stream-removed",stream:K});i.dispatchEvent(te),K.close(),K.pc!==void 0&&(K.pc.close(),K.pc=void 0,i.p2ps.delete(K.p2pId)),b.report.onRemoveStream(i.joinInfo.sid,{peerid:V.uint_id||V.uid,uid:i.uid})}else u.default.error("ERROR stream ",V.uid," not found onRemoveStream ",V)}),i.socket.on("on_publish_stream",function(V){u.default.info("[".concat(i.clientId,"] on_publish_stream:"),V);var K=i.localStreams[V.uid];i.dispatchEvent({type:"streamPublished",stream:K,proxy:V.proxy}),b.report.reportApiInvoke(i.joinInfo.sid,{name:"on_publish_stream",options:{proxy:V.proxy}})()}),i.socket.on("mute_audio",function(V){u.default.info("[".concat(i.clientId,"] rcv peer mute audio: ").concat(V.uid)),i.remoteMuteState[V.uid]=i.remoteMuteState[V.uid]||{audio:!1,video:!1},i.remoteMuteState[V.uid].audio=!0;var K=Object(C.a)({type:"mute-audio",uid:V.uid}),te=i.remoteStreams[V.uid];te?(te.peerMuteAudio=!0,te.pc&&i._adjustPCMuteStatus(te),i.dispatchEvent(K)):u.default.debug("Ignoring event ".concat(V.type),V)}),i.socket.on("unmute_audio",function(V){u.default.info("[".concat(i.clientId,"] rcv peer unmute audio: ").concat(V.uid)),i.remoteMuteState[V.uid]=i.remoteMuteState[V.uid]||{audio:!1,video:!1},i.remoteMuteState[V.uid].audio=!1;var K=Object(C.a)({type:"unmute-audio",uid:V.uid}),te=i.remoteStreams[V.uid];te?(te.peerMuteAudio=!1,te.pc&&i._adjustPCMuteStatus(te),i.dispatchEvent(K)):u.default.debug("Ignoring event ".concat(V.type),V)}),i.socket.on("mute_video",function(V){u.default.info("[".concat(i.clientId,"] rcv peer mute video: ").concat(V.uid)),i.remoteMuteState[V.uid]=i.remoteMuteState[V.uid]||{audio:!1,video:!1},i.remoteMuteState[V.uid].video=!0;var K=Object(C.a)({type:"mute-video",uid:V.uid}),te=i.remoteStreams[V.uid];te?(te.peerMuteVideo=!0,te.player&&(te.player.peerVideoReady=!1),te.pc&&i._adjustPCMuteStatus(te),i.dispatchEvent(K)):u.default.debug("Ignoring event ".concat(V.type),V)}),i.socket.on("unmute_video",function(V){u.default.info("[".concat(i.clientId,"] rcv peer unmute video: ").concat(V.uid)),i.remoteMuteState[V.uid]=i.remoteMuteState[V.uid]||{audio:!1,video:!1},i.remoteMuteState[V.uid].video=!1;var K=Object(C.a)({type:"unmute-video",uid:V.uid}),te=i.remoteStreams[V.uid];te?(te.peerMuteVideo=!1,te.pc&&i._adjustPCMuteStatus(te),i.dispatchEvent(K)):u.default.debug("Ignoring event ".concat(V.type),V)}),i.socket.on("on_crypt_error",function(V){u.default.warning("[".concat(i.clientId,"] stream crypt error"));var K=Object(C.a)({type:"crypt-error",cryptType:V.crypt_type});i.dispatchEvent(K)}),i.socket.on("on_user_banned",function(V){u.default.info("[".concat(i.clientId,"] user banned uid: ").concat(V.uid," error: ").concat(V.error_code));var K=Object(C.a)({type:"client-banned",uid:V.uid,attr:V.error_code});i.dispatchEvent(K),U=!0}),i.socket.on("on_stream_fallback_update",function(V){u.default.info("[".concat(i.clientId,"] stream fallback peerId: ").concat(V.stream_id," type: ").concat(V.stream_type));var K=Object(C.a)({type:"stream-fallback",uid:V.stream_id,stream:V.stream_id,attr:V.stream_type});i.dispatchEvent(K)}),i.socket.on("stream_recover",function(V){u.default.info("[".concat(i.clientId,"] stream recover uid: ").concat(V.id," peerId: ").concat(V.peerid," type: ").concat(V.type));var K=Object(C.a)({type:"stream-recover",uid:V.id,stream:V.peerid,attr:V.type});i.dispatchEvent(K)}),i.socket.on("on_p2p_lost",function(V){u.default.debug("[".concat(i.clientId,"] p2plost: "),V,"p2ps:",i.p2ps);var K,te="DTLS failed";(K=i.localStreams[V.uid]||i.remoteStreams[V.uid])?(K.pc&&K.pc.offerCandidates&&K.pc.offerCandidates.length===0&&(te="NO_CANDIDATES_IN_OFFER"),V.event==="publish"&&b.report.publish(i.joinInfo.sid,{lts:K.publishLTS,succ:!1,audio:K.hasAudio(),video:K.hasVideo(),screenshare:K.hasScreen(),audioName:K.hasAudio()&&K.audioName,videoName:K.hasVideo()&&K.videoName,screenName:K.hasScreen()&&K.screenName,ec:te,publishRequestid:i.publishRequestId||0,p2pid:i.p2ps.get(K.getId())}),V.event==="subscribe"&&b.report.subscribe(i.joinInfo.sid,{lts:K.subscribeLTS,succ:!1,video:K.subscribeOptions&&K.subscribeOptions.video,audio:K.subscribeOptions&&K.subscribeOptions.audio,peerid:V.uid+"",ec:te,subscribeRequestid:i.subscribeRequestId.get(K.getId())||0,p2pid:i.p2ps.get(K.getId())})):u.default.warning("P2PLost Stream Not found",V),u.default.debug("[".concat(i.clientId,"] p2plost:"),V.p2pid),(K=i.p2ps.get(V.p2pid))&&(i.p2ps.delete(V.p2pid),K.local?i.dispatchEvent(Object(C.a)({type:"pubP2PLost",stream:K,attr:te})):i.remoteStreams[K.getId()]&&i.dispatchEvent(Object(C.a)({type:"subP2PLost",stream:K,attr:te})))}),i.socket.on("on_token_privilege_will_expire",function(V){u.default.debug("[".concat(i.clientId,"] Received Message onTokenPrivilegeWillExpire")),i.dispatchEvent(Object(C.a)({type:"onTokenPrivilegeWillExpire"}))}),i.socket.on("on_token_privilege_did_expire",function(){u.default.warning("[".concat(i.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),i.closeGateway(),i.dispatchEvent(Object(C.a)({type:"onTokenPrivilegeDidExpire"}))}),i.socket.on("enable_local_video",function(V){u.default.info("[".concat(i.clientId,"] enable_local_video:"),V),i.dispatchEvent(Object(C.a)({type:"enable-local-video",uid:V.uid}))}),i.socket.on("disable_local_video",function(V){u.default.info("[".concat(i.clientId,"] disable_local_video:"),V),i.dispatchEvent(Object(C.a)({type:"disable-local-video",uid:V.uid}))}),i._doWithAction=function(V,K,te){V==="tryNext"?function(ae,de){u.default.debug("[".concat(i.clientId,"] Connect next gateway")),i.state=ce,i.socket.close(),A(),i.reconnectMode="tryNext",i.state=ue,fe(ae,de)}(K,te):V==="retry"?function(ae,de){u.default.debug("[".concat(i.clientId,"] Reconnect gateway")),i.state=ce,i.socket.close(),A(),i.reconnectMode="retry",i.state=ue,fe(ae,de)}(K,te):V==="quit"?(u.default.debug("[".concat(i.clientId,"] quit gateway")),i.state=ce,i.socket.close(),A()):V==="recover"&&ee()},i.socket.on("on_notification",function(V){if(u.default.debug("[".concat(i.clientId,"] Receive notification: "),V),W.GatewayErrorCode[V.code]==="ERR_JOIN_BY_MULTI_IP")return i.dispatchEvent({type:"onMultiIP",option:V.option});V.detail?i._doWithAction(n[W.GatewayErrorCode[V.code]]):V.action&&i._doWithAction(V.action)}),i.socket.on("on_user_offline",function(V){u.default.info("[".concat(i.clientId,"] on_user_offline:"),V);var K=Object(C.a)({type:"peer-leave",uid:V.uid});if(i.remoteStreamsInChannel.has(V.uid)&&i.remoteStreamsInChannel.delete(V.uid),i.remoteStreams.hasOwnProperty(V.uid)&&(K.stream=i.remoteStreams[V.uid]),K.reason=V.reason,i.dispatchEvent(K),u.default.info("[".concat(i.clientId,"] remove remoteMuteState "),V.uid),delete i.remoteMuteState[V.uid],i.remoteStreams.hasOwnProperty(V.uid)){u.default.info("[".concat(i.clientId,"] closing stream on peer leave"),V.uid);var te=i.remoteStreams[V.uid];te.close(),delete i.remoteStreams[V.uid],b.report.onRemoveStream(i.joinInfo.sid,{peerid:V.uint_id||V.uid,uid:i.uid}),te.pc!==void 0&&(te.pc.close(),te.pc=void 0,i.p2ps.delete(te.p2pId))}i.timers.hasOwnProperty(V.uid)&&(clearInterval(i.timers[V.uid]),clearInterval(i.timers[V.uid]+"_RelatedStats"),delete i.timers[V.uid]),i.audioLevel[V.uid]!=null&&delete i.audioLevel[V.uid],i.timer_counter[V.uid]!=null&&delete i.timer_counter[V.uid]}),i.socket.on("onUplinkStats",function(V){}),i.socket.on("liveStreamingStarted",function(V){var K=Object(C.c)({type:"liveStreamingStarted",url:V.url});i.dispatchEvent(K)}),i.socket.on("liveStreamingFailed",function(V){var K=Object(C.c)({type:"liveStreamingFailed",url:V.url});i.dispatchEvent(K)}),i.socket.on("liveStreamingStopped",function(V){var K=Object(C.c)({type:"liveStreamingStopped",url:V.url});i.dispatchEvent(K)}),i.socket.on("liveTranscodingUpdated",function(V){var K=Object(C.c)({type:"liveTranscodingUpdated",reason:V.reason});i.dispatchEvent(K)}),i.socket.on("streamInjectedStatus",function(V){var K=Object(C.c)({type:"streamInjectedStatus",url:V.url,uid:V.uid,status:V.status});i.dispatchEvent(K)}),i.socket.on("on_user_online",function(V){i.joinInfo.stringUid&&typeof V.uid!="string"&&u.default.error("StringUID is Mixed with UintUID"),i.dispatchEvent({type:"peer-online",uid:V.uid})}),i.socket.on("receive_metadata",function(V){i.joinInfo.stringUid&&typeof V.uid!="string"&&u.default.error("StringUID is Mixed with UintUID");var K=decodeURIComponent(escape(window.atob(V.metadata)));u.default.debug("[".concat(i.clientId,"] received ").concat(V.uid," metadata: ").concat(K)),i.dispatchEvent({type:"receive-metadata",uid:V.uid,metadata:K})});var ne},ge=function(c,P){if(i.socket!==void 0)try{i.socket.emitSimpleMessage(c,function(F,X){P&&P(F,X)})}catch(F){u.default.error("[".concat(i.clientId,"] Error in sendSimpleSdp [").concat(F,"]"))}else u.default.error("[".concat(i.clientId,"] Error in sendSimpleSdp [socket not ready]"))},he=function(){for(var c in i.localStreams)if(i.localStreams[c]!==void 0){var P=i.localStreams[c];delete i.localStreams[c],P.pc!==void 0&&(P.pc.close(),P.pc=void 0)}},_e=function(){for(var c in i.remoteStreamsInChannel.clear(),i.remoteStreams)if(i.remoteStreams.hasOwnProperty(c)){var P=i.remoteStreams[c];P.isPlaying()&&P.stop(),P.close(),delete i.remoteStreams[c],P.pc!==void 0&&(P.pc.close(),P.pc=void 0)}};return i},J={_gatewayClients:{},register:function(O,w){if(!w.uid){var U="NO_UID_PROVIDED";return u.default.error("[".concat(O.clientId,"] "),U,w),U}if(w.cname)return this._gatewayClients[w.cname]&&this._gatewayClients[w.cname][w.uid]&&this._gatewayClients[w.cname][w.uid]!==O?(U="UID_CONFLICT",u.default.error("[".concat(O.clientId,"] "),U,w),U):(u.default.debug("[".concat(O.clientId,"] register client Channel"),w.cname,"Uid",w.uid),this._gatewayClients[w.cname]||(this._gatewayClients[w.cname]={}),this._gatewayClients[w.cname][w.uid]=O,null);var U="NO_CHANNEL_PROVIDED";return u.default.error("[".concat(O.clientId,"] "),U,w),U},unregister:function(O){var w=O&&O.uid,U=O.joinInfo&&O.joinInfo.cname;if(!w||!U){var $="INVALID_GATEWAYCLIENT";return u.default.error("[".concat(O.clientId,"] "),$),$}if(this._gatewayClients[U]&&this._gatewayClients[U][w])return this._gatewayClients[U][w]!==O?($="GATEWAYCLIENT_UID_CONFLICT",u.default.error("[".concat(O.clientId,"] "),$),$):(u.default.debug("[".concat(O.clientId,"] unregister client "),O.uid),delete this._gatewayClients[U][w],null);var $="GATEWEAY_CLIENT_UNREGISTERED";u.default.error("[".concat(O.clientId,"] "),$)}};Q.DISCONNECTED=0,Q.CONNECTING=1,Q.CONNECTED=2,Q.DISCONNECTING=3,Q.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"},H.a=Q},function(z,H,I){I.r(H),I.d(H,"post",function(){return a}),I.d(H,"postFormData",function(){return r}),I.d(H,"shouldUseHttps",function(){return d}),I.d(H,"getHTTPSendBytes",function(){return y}),I.d(H,"getHTTPRecvBytes",function(){return s}),I.d(H,"resetHTTPByetsCount",function(){return m});var E=I(2),f=I(10),S=0,g=0,y=function(){return S},s=function(){return g},m=function(){S=0,g=0},r=function(T,C,v,u,b){var R=new XMLHttpRequest;if(R.timeout=C.timeout||Object(E.getParameter)("HTTP_CONNECT_TIMEOUT"),R.open("POST",T,!0),b)for(var D in b)D=="withCredentials"?R.withCredentials=!0:R.setRequestHeader(D,b[D]);R.onload=function(q){g+=Object(f.lengthInUtf8Bytes)(R.responseText),R.status!==200?u&&u({httpErrorCode:"httpcode-xhr.status"},T):v&&v(R.responseText)},R.onerror=function(q){u&&u(q,T)},R.ontimeout=function(q){u&&u(q,T)};var _=JSON.stringify(C);S+=Object(f.lengthInUtf8Bytes)(_);var j=new FormData;j.append("request",_),R.send(j)},a=function(T,C,v,u,b){var R=new XMLHttpRequest;if(R.timeout=C.timeout||Object(E.getParameter)("HTTP_CONNECT_TIMEOUT"),R.open("POST",T,!0),R.setRequestHeader("Content-type","application/json; charset=utf-8"),b)for(var D in b)D=="withCredentials"?R.withCredentials=!0:R.setRequestHeader(D,b[D]);R.onload=function(j){g+=Object(f.lengthInUtf8Bytes)(R.responseText),R.status!==200?u&&u({httpErrorCode:"httpcode-xhr.status"},T):v&&v(R.responseText)},R.onerror=function(j){u&&u(j,T)},R.ontimeout=function(j){u&&u(j,T)};var _=JSON.stringify(C);S+=Object(f.lengthInUtf8Bytes)(_),R.send(_)},d=function(){return document.location.protocol=="https:"}},function(z,H,I){I.r(H),I.d(H,"RTCPeerConnection",function(){return B}),I.d(H,"getUserMedia",function(){return g}),I.d(H,"attachMediaStream",function(){return y}),I.d(H,"reattachMediaStream",function(){return s}),I.d(H,"setSrcObject",function(){return T}),I.d(H,"getSrcObject",function(){return C}),I.d(H,"webrtcDetectedBrowser",function(){return m}),I.d(H,"webrtcDetectedVersion",function(){return r}),I.d(H,"webrtcMinimumVersion",function(){return a}),I.d(H,"webrtcTesting",function(){return W}),I.d(H,"webrtcUtils",function(){return b});var E=I(11),f=I.n(E),S=I(5),g=null,y=null,s=null,m=null,r=null,a=null,d=null,T=null,C=null,v=null,u={addStream:null},b={log:function(){},extractVersion:function(k,p,n){var N=k.match(p);return N&&N.length>=n&&parseInt(N[n])}};if((typeof window=="undefined"?"undefined":f()(window))=="object"?(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)?(T=function(k,p){"mozSrcObject"in k?k.mozSrcObject=p:(k._srcObject=p,k.src=p?URL.createObjectURL(p):null)},C=function(k){return"mozSrcObject"in k?k.mozSrcObject:k._srcObject}):(T=function(k,p){k.srcObject=p},C=function(k){return k.srcObject}),g=window.navigator&&window.navigator.getUserMedia):(T=function(k,p){k.srcObject=p},C=function(k){return k.srcObject}),y=function(k,p){T(k,p)},s=function(k,p){T(k,C(p))},typeof window!="undefined"&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var R in b.log("This appears to be Firefox"),m="firefox",r=b.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),a=31,v=mozRTCPeerConnection,u)u[R]=v.prototype[R];if(d=function(k,p){if(r<38&&k&&k.iceServers){for(var n=[],N=0;N<k.iceServers.length;N++){var l=k.iceServers[N];if(l.hasOwnProperty("urls"))for(var t=0;t<l.urls.length;t++){var x={url:l.urls[t]};l.urls[t].indexOf("turn")===0&&(x.username=l.username,x.credential=l.credential),n.push(x)}else n.push(k.iceServers[N])}k.iceServers=n}var o=new v(k,p);for(var h in u)o[h]=u[h];return o},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),g=function(k,p,n){var N=function(l){if(f()(l)!=="object"||l.require)return l;var t=[];return Object.keys(l).forEach(function(x){if(x!=="require"&&x!=="advanced"&&x!=="mediaSource"){var o=l[x]=f()(l[x])==="object"?l[x]:{ideal:l[x]};if(o.min===void 0&&o.max===void 0&&o.exact===void 0||t.push(x),o.exact!==void 0&&(typeof o.exact=="number"?o.min=o.max=o.exact:l[x]=o.exact,delete o.exact),o.ideal!==void 0){l.advanced=l.advanced||[];var h={};typeof o.ideal=="number"?h[x]={min:o.ideal,max:o.ideal}:h[x]=o.ideal,l.advanced.push(h),delete o.ideal,Object.keys(o).length||delete l[x]}}}),t.length&&(l.require=t),l};return r<38&&(b.log("spec: "+JSON.stringify(k)),k.audio&&(k.audio=N(k.audio)),k.video&&(k.video=N(k.video)),b.log("ff37: "+JSON.stringify(k))),navigator.mozGetUserMedia(k,p,n)},navigator.getUserMedia=g,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:q,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(k){k([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},r<41){var D=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return D().then(void 0,function(k){if(k.name==="NotFoundError")return[];throw k})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var R in b.log("This appears to be Chrome"),m="chrome",r=b.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),a=38,v=webkitRTCPeerConnection,u)u[R]=v.prototype[R];d=function(k,p){k&&k.iceTransportPolicy&&(k.iceTransports=k.iceTransportPolicy);var n=new v(k,p);for(var N in u)n[N]=u[N];var l=n.getStats.bind(n);return n.getStats=function(t,x,o){var h=arguments;h.length>0&&typeof t=="function"&&(x?(o=x,x=t,h=[t=null,x,o]):(x=t,h=[t=null,x]));var L=function(G){var Q={};return G.result().forEach(function(J){var O={id:J.id,timestamp:J.timestamp,type:J.type};J.names().forEach(function(w){O[w]=J.stat(w)}),Q[O.id]=O}),Q};if(h.length>=2){var M=function(G){h[1](L(G))};return l.apply(this,[M,h[0]])}return l()},n},["createOffer","createAnswer"].forEach(function(k){var p=webkitRTCPeerConnection.prototype[k];webkitRTCPeerConnection.prototype[k]=function(){var n=this;if(arguments.length<1||arguments.length===1&&f()(arguments[0])==="object"){var N=arguments.length===1?arguments[0]:void 0;return new Promise(function(l,t){p.apply(n,[l,t,N])})}return p.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(k){var p=webkitRTCPeerConnection.prototype[k];webkitRTCPeerConnection.prototype[k]=function(){var n=arguments,N=this;return new Promise(function(l,t){p.apply(N,[n[0],function(){l(),n.length>=2&&n[1].apply(null,[])},function(x){t(x),n.length>=3&&n[2].apply(null,[x])}])})}});var _=function(k){if(f()(k)!=="object"||k.mandatory||k.optional)return k;var p={};return Object.keys(k).forEach(function(n){if(n!=="require"&&n!=="advanced"&&n!=="mediaSource"){var N=f()(k[n])==="object"?k[n]:{ideal:k[n]};N.exact!==void 0&&typeof N.exact=="number"&&(N.min=N.max=N.exact);var l=function(x,o){return x?x+o.charAt(0).toUpperCase()+o.slice(1):o==="deviceId"?"sourceId":o};if(N.ideal!==void 0){p.optional=p.optional||[];var t={};typeof N.ideal=="number"?(t[l("min",n)]=N.ideal,p.optional.push(t),(t={})[l("max",n)]=N.ideal,p.optional.push(t)):(t[l("",n)]=N.ideal,p.optional.push(t))}N.exact!==void 0&&typeof N.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[l("",n)]=N.exact):["min","max"].forEach(function(x){N[x]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[l(x,n)]=N[x])})}}),k.advanced&&(p.optional=(p.optional||[]).concat(k.advanced)),p};if(g=function(k,p,n){return k.audio&&(k.audio=_(k.audio)),k.video&&(k.video=_(k.video)),b.log("chrome: "+JSON.stringify(k)),navigator.webkitGetUserMedia(k,p,n)},navigator.getUserMedia=g,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:q,enumerateDevices:function(){return new Promise(function(k){var p={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){k(n.map(function(N){return{label:N.label,kind:p[N.kind],deviceId:N.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){if((Object(S.getBrowserVersion)()?Number(Object(S.getBrowserVersion)().split(".")[0]):void 0)<46){var j=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(k){return b.log("spec:   "+JSON.stringify(k)),k.audio=_(k.audio),k.video=_(k.video),b.log("chrome: "+JSON.stringify(k)),j(k)}}}else navigator.mediaDevices.getUserMedia=function(k){return q(k)};navigator.mediaDevices.addEventListener===void 0&&(navigator.mediaDevices.addEventListener=function(){b.log("Dummy mediaDevices.addEventListener called.")}),navigator.mediaDevices.removeEventListener===void 0&&(navigator.mediaDevices.removeEventListener=function(){b.log("Dummy mediaDevices.removeEventListener called.")}),y=function(k,p){r>=43?T(k,p):k.src!==void 0?k.src=p?URL.createObjectURL(p):null:b.log("Error attaching stream to element.")},s=function(k,p){r>=43?T(k,C(p)):k.src=p.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(b.log("This appears to be Edge"),m="edge",r=b.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),a=12):b.log("Browser does not appear to be WebRTC-capable");else b.log("This does not appear to be a browser"),m="not a browser";function q(k){return new Promise(function(p,n){g(k,p,n)})}var B,W={};try{Object.defineProperty(W,"version",{set:function(k){r=k}})}catch{}d?B=d:typeof window!="undefined"&&(B=window.RTCPeerConnection)},function(z,H,I){var E=I(12),f=I.n(E),S=I(17),g=I.n(S),y=I(51),s=I.n(y),m=I(5),r=I(1),a=I(3),d=I(0),T=(I(25),I(2),I(4),I(52)),C=I.n(T),v=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function u(t){for(var x=new Uint8Array([99,114,121,112,116,105,105]),o=x.length,h=t,L=h.length,M=new Uint8Array(L),G=new Uint8Array(256),Q=0;Q<256;Q++)G[Q]=Q;for(var J=0,O=0;O<256;O++){var w=[G[J=(J+G[O]+x[O%o])%256],G[O]];G[O]=w[0],G[J]=w[1]}var U,$=0;J=0;for(var Y=0;Y<0+L;Y++){var Z=[G[J=(J+G[$=($+1)%256])%256],G[$]];G[$]=Z[0],G[J]=Z[1],U=G[(G[$]+G[J])%256],Y>=0&&(M[Y-0]=h[Y-0]^U)}var re=String.fromCharCode.apply(null,M);return Function("var winSize = 5; return `"+re+"`")()}function b(t,x){var o=u(x),h=C.a.createProgramFromSources(t,[u(v),o]),L=t.getAttribLocation(h,"a_position"),M=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,M),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(L);var G=2,Q=t.FLOAT,J=!1,O=0,w=0;t.vertexAttribPointer(L,G,Q,J,O,w);var U=t.getAttribLocation(h,"a_texCoord"),$=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,$),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(U),G=2,Q=t.FLOAT,J=!1,O=0,w=0,t.vertexAttribPointer(U,G,Q,J,O,w),h}var R=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];function D(t,x,o){var h=t.gl;this.program=b(h,R),this.setUniforms=function(){h.getUniformLocation(this.program,"u_image");var L=h.getUniformLocation(this.program,"u_flipY");h.uniform1f(L,1)}}var _=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];function j(t,x,o){var h=t.gl,L=1/x,M=1/o,G=5;this.program=b(h,_),this.setUniforms=function(){h.getUniformLocation(this.program,"u_image");var Q=h.getUniformLocation(this.program,"u_flipY"),J=h.getUniformLocation(this.program,"u_singleStepOffset"),O=h.getUniformLocation(this.program,"u_denoiseLevel");h.uniform2f(J,L,M),h.uniform1f(O,G),h.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(G=Q.denoiseLevel)},this.setSize=function(Q,J){L=1/Q,M=1/J}}var q=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];function B(t,x,o){var h=t.gl,L=1/x,M=1/o,G=5;this.program=b(h,q),this.setUniforms=function(){h.getUniformLocation(this.program,"u_image");var Q=h.getUniformLocation(this.program,"u_flipY"),J=h.getUniformLocation(this.program,"u_singleStepOffset"),O=h.getUniformLocation(this.program,"u_denoiseLevel");h.uniform2f(J,L,M),h.uniform1f(O,G),h.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(G=Q.denoiseLevel)},this.setSize=function(Q,J){L=1/Q,M=1/J}}var W=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];function k(t,x,o){var h=t.gl,L=1/x,M=1/o,G=5;this.program=b(h,W),this.setUniforms=function(){h.getUniformLocation(this.program,"u_image");var Q=h.getUniformLocation(this.program,"u_flipY"),J=h.getUniformLocation(this.program,"u_singleStepOffset"),O=h.getUniformLocation(this.program,"u_denoiseLevel");h.uniform2f(J,L,M),h.uniform1f(O,G),h.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(G=Q.denoiseLevel)},this.setSize=function(Q,J){L=1/Q,M=1/J}}var p=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144];function n(t,x,o){var h=t.gl,L=5,M=.1,G=.5,Q=175/180*3.141593,J=115/180*3.141593,O=173/180*3.141593,w=116/180*3.141593,U=2.04203545,$=0,Y=0,Z=0,re=[],ce=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],ue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],se=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];this.program=b(h,p),this.setUniforms=function(){var ie=h.getUniformLocation(this.program,"u_flipY"),me=h.getUniformLocation(this.program,"u_denoiseLevel");h.uniform1f(me,L),h.uniform1f(ie,1);var i=h.getUniformLocation(this.program,"light");h.uniform1f(i,M);var le=h.getUniformLocation(this.program,"redness");h.uniform1f(le,G);var ee=h.getUniformLocation(this.program,"skin_he_max"),A=h.getUniformLocation(this.program,"skin_he_min"),fe=h.getUniformLocation(this.program,"skin_hc_max"),Ee=h.getUniformLocation(this.program,"skin_hc_min"),ge=h.getUniformLocation(this.program,"skin_hc_axis"),he=h.getUniformLocation(this.program,"facts_rotate_c"),_e=h.getUniformLocation(this.program,"facts_rotate_le"),c=h.getUniformLocation(this.program,"facts_rotate_ge");h.uniform1f(ee,Q),h.uniform1f(A,J),h.uniform1f(fe,O),h.uniform1f(Ee,w),h.uniform1f(ge,U),h.uniform1f(he,$),h.uniform1f(_e,Y),h.uniform1f(c,Z);var P=h.getUniformLocation(this.program,"u_originImage");h.activeTexture(h.TEXTURE2),h.bindTexture(h.TEXTURE_2D,t.inputTexture),h.uniform1i(P,2);for(var F=["lighten_lut"],X=[h.TEXTURE3],ne=0;ne<F.length;ne++){var V=h.getUniformLocation(this.program,F[ne]);h.activeTexture(X[ne]),h.bindTexture(h.TEXTURE_2D,re[ne]),h.uniform1i(V,ne+3)}},this.setParameters=function(ie){ie.denoiseLevel!==void 0&&(L=ie.denoiseLevel),ie.lightLevel!==void 0&&(M=ie.lightLevel),ie.rednessLevel!==void 0&&(G=ie.rednessLevel,this._updateRedness(G)),ie.lighteningContrastLevel!==void 0&&this._updateLut(ie.lighteningContrastLevel)},this._updateRedness=function(ie){var me,i,le=3.141593,ee=ie,A=ee;ee>1&&(ee=1),ee<0&&(ee=0),A>1&&(A=1),A<0&&(A=0),$=.8*ee,A<.8&&(A=0),(U=(117-4*A)/180*le)<(w=(116-4*A)/180*le)&&(U=w),w<le/2&&(w=le/2),U<le/2&&(U=le/2),(J=(115-4*A)/180*le)<le/2&&(J=le/2),(O=173/180*le)>le&&(O=le),U>le&&(U=le),(Q=175/180*le)>le&&(Q=le),i=O-U,Z=(me=Q-O)>.01?$*i/me:$,i=U-w,Y=(me=w-J)>.01?$*i/me:$},this._updateLut=function(ie){var me=null;ie==0&&(me=ue),ie==1&&(me=se),ie==2&&(me=ce);for(var i=[new Uint8Array(me)],le=[256],ee=[1],A=0;A<i.length;A++)h.bindTexture(h.TEXTURE_2D,re[A]),h.texImage2D(h.TEXTURE_2D,0,h.LUMINANCE,le[A],ee[A],0,h.LUMINANCE,h.UNSIGNED_BYTE,i[A])},this._init=function(){var ie=null;ie=ue;for(var me=[new Uint8Array(ie)],i=[256],le=[1],ee=0;ee<me.length;ee++){var A=h.createTexture();h.bindTexture(h.TEXTURE_2D,A),h.texImage2D(h.TEXTURE_2D,0,h.LUMINANCE,i[ee],le[ee],0,h.LUMINANCE,h.UNSIGNED_BYTE,me[ee]),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),re.push(A)}},this._init()}var N=!1;function l(){this.programs=[];var t=this,x=null,o=null;t.gl=null,t.inputTexture=null;var h=[],L=[],M=0,G=0;t._initGl=function(Q,J){t.inputTexture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,t.inputTexture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);for(var O=0;O<4;O++){var w=x.createTexture();x.bindTexture(x.TEXTURE_2D,w),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),O<2?x.texImage2D(x.TEXTURE_2D,0,x.RGBA,Q,J,0,x.RGBA,x.UNSIGNED_BYTE,null):x.texImage2D(x.TEXTURE_2D,0,x.RGBA,J,Q,0,x.RGBA,x.UNSIGNED_BYTE,null);var U=x.createFramebuffer();x.bindFramebuffer(x.FRAMEBUFFER,U),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,w,0),h.push(w),L.push(U)}x.viewport(0,0,Q,J),M=Q,G=J},t.render=function(Q){if(x){var J=0;G==Q.videoWidth&&M===Q.videoHeight&&(J=2),x.viewport(0,0,Q.videoWidth,Q.videoHeight),x.bindTexture(x.TEXTURE_2D,t.inputTexture),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,Q);for(var O=N?t.programs.length-1:0,w=0;w<=O;w++){var U=t.programs[w].program;x.useProgram(U);var $=x.getUniformLocation(U,"u_image");t.programs[w].setUniforms(),x.bindFramebuffer(x.FRAMEBUFFER,L[J+w%2]),x.clearColor(0,0,0,1),x.clear(x.COLOR_BUFFER_BIT),x.drawArrays(x.TRIANGLES,0,6),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,h[J+w%2]),x.uniform1i($,0)}x.useProgram(o);var Y=x.getUniformLocation(o,"u_flipY");x.uniform1f(Y,-1),x.bindFramebuffer(x.FRAMEBUFFER,null),x.clearColor(0,0,0,1),x.clear(x.COLOR_BUFFER_BIT),x.drawArrays(x.TRIANGLES,0,6)}},t.setEnableBeauty=function(Q){N=Q},t.init=function(Q,J,O){if(typeof WebGLRenderingContext=="undefined")throw new Error("NOT_SUPPORT");x=O.getContext("webgl"),t.gl=x,t._initGl(Q,J),t.programs.push(new D(this)),t.programs.push(new j(this,Q,J)),t.programs.push(new B(this,Q,J)),t.programs.push(new k(this,Q,J)),t.programs.push(new n(this)),o=t.programs[0].program},t.release=function(){t.gl=null,x=null,o=null,t.inputTexture=null,t.programs=[],h=[],L=[]},t.setDenoiseLevel=function(Q){t.programs.forEach(function(J){J.setParameters&&J.setParameters({denoiseLevel:Q})})},t.setLightLevel=function(Q){t.programs.forEach(function(J){J.setParameters&&J.setParameters({lightLevel:Q})})},t.setRednessLevel=function(Q){t.programs.forEach(function(J){J.setParameters&&J.setParameters({rednessLevel:Q})})},t.setContrastLevel=function(Q){t.programs.forEach(function(J){J.setParameters&&J.setParameters({lighteningContrastLevel:Q})})},t.setSize=function(Q,J){t.programs.forEach(function(O){O.setSize&&O.setSize(Q,J)})}}l._instance=null,l.getInstance=function(){return l._instance||(l._instance=new l),l._instance},H.a={addVideoEffectCapability:function(t){t.videoEffect={canvas:null,video:null,fps:30,stopChromeBackgroundLoop:null,enableBeauty:!1,denoiseLevel:5,lightLevel:.35,rednessLevel:.5,lighteningContrastLevel:1,videoContextInited:!1,originVideoTrack:null,canvasVideoTrack:null,ctx:null},t._initVideoContext=function(){if(t.videoEffect.videoContextInited)throw new Error("Failed to init video context. Already inited");if(!t.stream)throw new Error("Failed to init video context. Local Stream not initialized");t.videoEffect.originVideoTrack=t.stream.getVideoTracks()[0],t.attributes&&t.attributes.maxFrameRate&&(t.videoEffect.fps=t.attributes.maxFrameRate),t.videoEffect.videoContextInited=!0},t._renderWithWebGL=function(x){return new Promise(function(o){t.videoEffect.canvas||(t.videoEffect.canvas=document.createElement("canvas")),t.videoEffect.video||(t.videoEffect.video=document.createElement("video")),t.videoEffect.video.setAttribute("autoplay",""),t.videoEffect.video.setAttribute("muted",""),t.videoEffect.video.muted=!0,t.videoEffect.video.setAttribute("playsinline",""),t.videoEffect.video.setAttribute("style","display:none"),t.videoEffect.video.srcObject=x;var h=x.getVideoTracks()[0].getSettings(),L=h.width,M=h.height;t.videoEffect.canvas.setAttribute("width",L),t.videoEffect.canvas.setAttribute("height",M),t.videoEffect.video.setAttribute("width",L),t.videoEffect.video.setAttribute("height",M);var G=l.getInstance();G.init(t.videoEffect.video.width,t.videoEffect.video.height,t.videoEffect.canvas),G.setDenoiseLevel(t.videoEffect.denoiseLevel),G.setLightLevel(t.videoEffect.lightLevel),G.setRednessLevel(t.videoEffect.rednessLevel),G.setContrastLevel(t.videoEffect.lighteningContrastLevel),t.videoEffect.video.addEventListener("playing",function Q(){var J=t.videoEffect.canvas.captureStream(t.videoEffect.fps);t.videoEffect.video.removeEventListener("playing",Q,!0),o([J.getVideoTracks()[0],t.videoEffect.video])},!0),t.videoEffect.video.play()})},t._disableEffect=function(){t.videoEffect.videoContextInited||t._initVideoContext();var x=t.videoEffect.originVideoTrack;if(!x)return d.default.warning("Video track is null, fail to disable video effect!"),Promise.resolve();if(t.pc&&t.pc.peerConnection&&t.pc.peerConnection){var o=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(h){return h&&h.track&&h.track.kind=="video"});if(o&&o.replaceTrack&&x)return o.replaceTrack(x)}return Promise.resolve()},t._releaseEffect=function(){var x;return x=t.videoEffect.enableBeauty?t._disableEffect():Promise.resolve(),l.getInstance().release(),t.videoEffect.videoContextInited=!1,t.videoEffect.canvasVideoTrack=null,x},t._enableEffect=function(){return t.videoEffect.videoContextInited||t._initVideoContext(),t.videoEffect.originVideoTrack?t.videoEffect.canvasVideoTrack?(t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()):t._renderWithWebGL(t.stream).then(function(x){var o=s()(x,2),h=o[0],L=o[1];t.videoEffect.canvasVideoTrack=h;var M=l.getInstance();return requestAnimationFrame(function G(){t.videoEffect.enableBeauty&&M.render(L),t.videoEffect.videoContextInited&&requestAnimationFrame(G)}),m.isChrome()&&document.addEventListener("visibilitychange",function(){document.hidden?t.videoEffect.stopChromeBackgroundLoop=function(G,Q){var J=1/Q,O=new AudioContext,w=O.createGain();w.gain.value=0,w.connect(O.destination),function $(){var Y=O.createOscillator();Y.onended=$,Y.connect(w),Y.start(0),Y.stop(O.currentTime+J),G(O.currentTime),U&&(Y.onended=function(){O.close()})}();var U=!1;return function(){U=!0}}(function(){t.videoEffect.enableBeauty&&M.render(L)},t.videoEffect.fps):t.videoEffect.stopChromeBackgroundLoop&&(t.videoEffect.stopChromeBackgroundLoop(),t.videoEffect.stopChromeBackgroundLoop=null)},!1),t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()}):(d.default.warning("Video track is null, fail to enable video effect!"),Promise.resolve())},t._showEffectInLocalPlayer=function(){if(t.player){var x=t.player.div.children[0];if(x.style.display!=="none"&&(t.player.div.appendChild(t.videoEffect.canvas),x.tagName.toLowerCase()==="video")){var o=x.getAttribute("style");t.videoEffect.canvas.setAttribute("style",o),x.style.display!=="none"&&(x.style.display="none")}}},t._removeEffectFromLocalPlayer=function(){if(t.player&&t.player.div&&t.videoEffect.enableBeauty&&t.videoEffect.canvas){t.player.div.removeChild(t.videoEffect.canvas);var x=t.player.div.children[0];x.tagName.toLowerCase()==="video"&&(t.videoEffect.canvas.style.display="none",x.style.display="block")}},t._replaceWithCanvasTrack=function(){var x=null;return t.pc&&t.pc.peerConnection&&t.pc.peerConnection&&(x=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(o){return o&&o.track&&o.track.kind=="video"})),x&&x.replaceTrack&&t.videoEffect.canvasVideoTrack?x.replaceTrack(t.videoEffect.canvasVideoTrack):Promise.resolve()},t.setBeautyEffectOptions=function(){var x=g()(f.a.mark(function o(h,L){var M,G=arguments;return f.a.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Object(a.checkValidBoolean)(h,"enabled"),M=l.getInstance(),t.videoEffect.enableBeauty==h){Q.next=14;break}if(M.setEnableBeauty(h),!h){Q.next=9;break}return Q.next=7,t._enableEffect();case 7:Q.next=12;break;case 9:return t._removeEffectFromLocalPlayer(),Q.next=12,t._releaseEffect();case 12:t.videoEffect.enableBeauty=h,r.report.reportApiInvoke(t.sid,{callback:null,options:G,name:"Stream.setBeautyEffectOptions",tag:"tracer"});case 14:if(h){Q.next=16;break}return Q.abrupt("return");case 16:if(!L){Q.next=20;break}Object(a.checkValidObject)(L,"options"),Q.next=21;break;case 20:return Q.abrupt("return");case 21:if(L.smoothnessLevel!==void 0&&(Object(a.checkValidFloatNumber)(L.smoothnessLevel,"smoothnessLevel",0,1),t.videoEffect.denoiseLevel=10*L.smoothnessLevel,t.videoEffect.denoiseLevel<.1&&(t.videoEffect.denoiseLevel=.1),M.setDenoiseLevel(t.videoEffect.denoiseLevel)),L.lighteningLevel!==void 0&&(Object(a.checkValidFloatNumber)(L.lighteningLevel,"lighteningLevel",0,1),t.videoEffect.lightLevel=L.lighteningLevel/2,t.videoEffect.lightLevel<.01&&(t.videoEffect.lightLevel=.01),M.setLightLevel(t.videoEffect.lightLevel)),L.rednessLevel!==void 0&&(Object(a.checkValidFloatNumber)(L.rednessLevel,"rednessLevel",0,1),t.videoEffect.rednessLevel=L.rednessLevel,t.videoEffect.rednessLevel<.01&&(t.videoEffect.rednessLevel=.01),M.setRednessLevel(t.videoEffect.rednessLevel)),L.lighteningContrastLevel===void 0){Q.next=29;break}if(L.lighteningContrastLevel===0||L.lighteningContrastLevel===1||L.lighteningContrastLevel===2){Q.next=27;break}throw new Error("Invalid lighteningContrastLevel: The value should be 0, 1 or 2.");case 27:t.videoEffect.lighteningContrastLevel=parseFloat(L.lighteningContrastLevel),M.setContrastLevel(t.videoEffect.lighteningContrastLevel);case 29:case"end":return Q.stop()}},o)}));return function(o,h){return x.apply(this,arguments)}}()},restoreVideoEffect:function(t){return t.videoEffect.enableBeauty?t._enableEffect():Promise.resolve()},disableVideoEffect:function(t){return t._releaseEffect?t._releaseEffect():Promise.resolve()},applyEffectInPlayer:function(t){t.videoEffect.enableBeauty&&t.videoEffect.canvas&&t._showEffectInLocalPlayer()},removeEffectFromLocalPlayer:function(t){t._removeEffectFromLocalPlayer()},replaceWithCanvasTrack:function(t){return t.videoEffect.enableBeauty?t._replaceWithCanvasTrack():Promise.resolve()},checkVideoEffectEnabled:function(t){return t.videoEffect.enableBeauty&&t.videoEffect&&t.videoEffect.videoContextInited?(d.default.error("Operation not permitted: ".concat("VIDEO_EFFECT_ENABLED")),"VIDEO_EFFECT_ENABLED"):!1}}},function(z,H){function I(E,f,S,g,y,s,m){try{var r=E[s](m),a=r.value}catch(d){return void S(d)}r.done?f(a):Promise.resolve(a).then(g,y)}z.exports=function(E){return function(){var f=this,S=arguments;return new Promise(function(g,y){var s=E.apply(f,S);function m(a){I(s,g,y,m,r,"next",a)}function r(a){I(s,g,y,m,r,"throw",a)}m(void 0)})}}},function(z,H,I){var E=I(38),f=Object.prototype.toString;function S(r){return f.call(r)==="[object Array]"}function g(r){return r===void 0}function y(r){return r!==null&&typeof r=="object"}function s(r){return f.call(r)==="[object Function]"}function m(r,a){if(r!=null)if(typeof r!="object"&&(r=[r]),S(r))for(var d=0,T=r.length;d<T;d++)a.call(null,r[d],d,r);else for(var C in r)Object.prototype.hasOwnProperty.call(r,C)&&a.call(null,r[C],C,r)}z.exports={isArray:S,isArrayBuffer:function(r){return f.call(r)==="[object ArrayBuffer]"},isBuffer:function(r){return r!==null&&!g(r)&&r.constructor!==null&&!g(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){return typeof FormData!="undefined"&&r instanceof FormData},isArrayBufferView:function(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&r.buffer instanceof ArrayBuffer},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:y,isUndefined:g,isDate:function(r){return f.call(r)==="[object Date]"},isFile:function(r){return f.call(r)==="[object File]"},isBlob:function(r){return f.call(r)==="[object Blob]"},isFunction:s,isStream:function(r){return y(r)&&s(r.pipe)},isURLSearchParams:function(r){return typeof URLSearchParams!="undefined"&&r instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:m,merge:function r(){var a={};function d(v,u){typeof a[u]=="object"&&typeof v=="object"?a[u]=r(a[u],v):a[u]=v}for(var T=0,C=arguments.length;T<C;T++)m(arguments[T],d);return a},deepMerge:function r(){var a={};function d(v,u){typeof a[u]=="object"&&typeof v=="object"?a[u]=r(a[u],v):a[u]=typeof v=="object"?r({},v):v}for(var T=0,C=arguments.length;T<C;T++)m(arguments[T],d);return a},extend:function(r,a,d){return m(a,function(T,C){r[C]=d&&typeof T=="function"?E(T,d):T}),r},trim:function(r){return r.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(z,H,I){I.d(H,"a",function(){return r});var E=I(7),f=I.n(E),S=I(8),g=I(0),y=I(4);function s(a){if(typeof Symbol=="undefined"||a[Symbol.iterator]==null){if(Array.isArray(a)||(a=function(R,D){if(!!R){if(typeof R=="string")return m(R,D);var _=Object.prototype.toString.call(R).slice(8,-1);if(_==="Object"&&R.constructor&&(_=R.constructor.name),_==="Map"||_==="Set")return Array.from(_);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return m(R,D)}}(a))){var d=0,T=function(){};return{s:T,n:function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(R){throw R},f:T}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,v,u=!0,b=!1;return{s:function(){C=a[Symbol.iterator]()},n:function(){var R=C.next();return u=R.done,R},e:function(R){b=!0,v=R},f:function(){try{u||C.return==null||C.return()}finally{if(b)throw v}}}}function m(a,d){(d==null||d>a.length)&&(d=a.length);for(var T=0,C=new Array(d);T<d;T++)C[T]=a[T];return C}var r=new function(){var a=Object(S.b)();return a.devicesHistory={},a.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},a.state=a.states.UNINIT,a.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},a.deviceReloadTimer=null,a._init=function(d,T){a.state=a.states.INITING,a.devicesHistory={},a._reloadDevicesInfo(function(){a.state=a.states.INITED,a.dispatchEvent({type:"inited"}),d&&d()},function(C){g.default.warning("Device Detection functionality cannot start properly."),a.state=a.states.UNINIT,T&&T(C)})},a._enumerateDevices=function(d,T){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return g.default.warning("enumerateDevices() not supported."),T&&T("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then(function(C){d&&setTimeout(function(){d(C)},0)}).catch(function(C){T&&T(C)})},a._reloadDevicesInfo=function(d,T){var C=[];a._enumerateDevices(function(v){var u=Date.now();for(var b in v.forEach(function(D){var _=a.devicesHistory[D.deviceId];if((_?_.state:a.deviceStates.INACTIVE)!=a.deviceStates.ACTIVE){var j=_||{initAt:u};j.device=D,j.state=a.deviceStates.ACTIVE,C.push(j),a.devicesHistory[D.deviceId]=j}a.devicesHistory[D.deviceId].lastReloadAt=u}),a.devicesHistory){var R=a.devicesHistory[b];R&&R.state==a.deviceStates.ACTIVE&&R.lastReloadAt!==u&&(R.state=a.deviceStates.INACTIVE,C.push(R)),R.lastReloadAt=u}a.state==a.states.INITED&&C.forEach(function(D){var _=f()({},D);switch(D.device.kind){case"audioinput":_.type="recordingDeviceChanged";break;case"audiooutput":_.type="playoutDeviceChanged";break;case"videoinput":_.type="cameraChanged";break;default:g.default.warning("Unknown device change",_),_.type="unknownDeviceChanged"}a.dispatchEvent(_)}),d&&d()},T)},a.getDeviceById=function(d,T,C){a.getDevices(function(v){for(var u=0;u<v.length;u++){var b=v[u];if(b&&b.deviceId===d)return T&&T(b)}return C&&C()})},a.searchDeviceNameById=function(d){var T=a.devicesHistory[d];return T?T.device.label||T.device.deviceId:null},a.getDevices=function(d,T){a._enumerateDevices(d,function(C){T&&T(C.name+": "+C.message)})},a.getVideoCameraIdByLabel=function(d,T,C){a.getCameras(function(v){var u,b=s(v);try{for(b.s();!(u=b.n()).done;){var R=u.value;if(R.label===d)return T&&T(R.deviceId)}}catch(D){b.e(D)}finally{b.f()}return C&&C(y.default.NOT_FIND_DEVICE_BY_LABEL)},C)},a.getRecordingDevices=function(d,T){return a._enumerateDevices(function(C){var v=C.filter(function(u){return u.kind=="audioinput"});d&&d(v)},function(C){T&&T(C)})},a.getPlayoutDevices=function(d,T){return a._enumerateDevices(function(C){var v=C.filter(function(u){return u.kind=="audiooutput"});d&&d(v)},function(C){T&&T(C)})},a.getCameras=function(d,T){return a._enumerateDevices(function(C){var v=C.filter(function(u){return u.kind=="videoinput"});d&&d(v)},function(C){T&&T(C)})},a._init(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(){a._reloadDevicesInfo()}),a.deviceReloadTimer=setInterval(a._reloadDevicesInfo,5e3)}),a}},function(z,H,I){I.r(H),I.d(H,"_getReconnectCSTimer",function(){return p}),I.d(H,"_setClientConnectionStateRecord",function(){return n}),I.d(H,"getGatewayList",function(){return l}),I.d(H,"getUserAccount",function(){return x});var E=I(11),f=I.n(E),S=I(12),g=I.n(S),y=I(17),s=I.n(y),m=I(2),r=(I(5),I(0)),a=I(14),d=I(1),T=I(4),C=function(o,h){var L=!1,M=0,G=Object(m.getParameter)("PROXY_CS"),Q=Object(m.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),J=0,O={command:"convergeAllocateEdge",sid:o.sid,appId:o.appId,token:o.token,uid:o.uid,cname:o.cname,ts:Math.floor(Date.now()/1e3),version:m.VERSION,seq:0,requestId:1},w=function($){var Y=new Date().getTime();v("https://"+$+"/api/v1",O,function(Z,re){if(Z)return r.default.debug("["+o.clientId+"] Request proxy server failed: ",Z),M++,d.report.requestProxyAppCenter(o.sid,{lts:Y,succ:!1,APAddr:$,workerManagerList:null,ec:JSON.stringify(Z),response:JSON.stringify({err:Z,res:re})}),M>=G.length&&h&&h("Get proxy server failed: request all failed"),void(!(M%Q)&&M<G.length&&(J++,U()));if(!L)if((re=JSON.parse(re)).json_body){var ce=JSON.parse(re.json_body);if(r.default.debug("["+o.clientId+"] App return:",ce.servers),ce.code!==200)Z="Get proxy server failed: response code ["+ce.code+"], reason [ "+ce.reason+"]",M++,r.default.debug("["+o.clientId+"] "+Z),d.report.requestProxyAppCenter(o.sid,{lts:Y,succ:!1,APAddr:$,workerManagerList:null,ec:Z,response:JSON.stringify({err:Z,res:re})}),M>=G.length&&h&&h(Z),!(M%Q)&&M<G.length&&(J++,U());else{L=!0;var ue=b(ce.servers);d.report.requestProxyAppCenter(o.sid,{lts:Y,succ:!0,APAddr:$,workerManagerList:JSON.stringify(ue),ec:null,response:JSON.stringify({res:re})}),h&&h(null,ue)}}else r.default.debug("["+o.clientId+"] Get proxy server failed: no json_body"),d.report.requestProxyAppCenter(o.sid,{lts:Y,succ:!1,APAddr:$,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:re})})})},U=function(){for(var $=J*Q,Y=$;Y<Math.min(G.length,$+Q);Y++){var Z=G[Y];w(Z)}};U()},v=function(o,h,L){var M={service_name:"webrtc_proxy",json_body:JSON.stringify(h)};Object(a.post)(o,M,function(G){L&&L(null,G)},function(G){L&&L(G)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})},u=function(o,h,L){var M=!1,G=0,Q={command:"request",gatewayType:"http",appId:o.appId,cname:o.cname,uid:o.uid+"",sdkVersion:"2.3.1",sid:o.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:o.appId,cname:o.cname,uid:o.uid+"",sid:o.sid}};h.map(function(J){var O=new Date().getTime();(function(w,U,$){Object(a.post)(w,U,function(Y){$&&$(null,Y)},function(Y){$&&$(Y)})})("https://"+J+":4000/v2/machine",Q,function(w,U){if(w)return r.default.debug("["+o.clientId+"] Request worker manager failed: ",w),G++,d.report.requestProxyWorkerManager(o.sid,{lts:O,succ:!1,workerManagerAddr:J,ec:JSON.stringify(w),response:JSON.stringify({res:U})}),void(G>=h.length&&L&&L("requeet worker manager server failed: request failed"));if(!M){if(!(U=JSON.parse(U)).serverResponse)return L&&L("requeet worker manager server failed: serverResponse is undefined");M=!0,d.report.requestProxyWorkerManager(o.sid,{lts:O,succ:!0,workerManagerAddr:J,ec:JSON.stringify(w),response:JSON.stringify({res:U})}),L&&L(null,{address:J,serverResponse:U.serverResponse})}})})},b=function(o){if(!o||!([]instanceof Array))return[];var h=[];return o.forEach(function(L){var M;L.address&&L.tcp?(L.address.match(/^[\.\:\d]+$/)?M="".concat(L.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(r.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(L.address,". Used As Host instead")),M="".concat(L.address,":").concat(L.tcp)),h.push(M)):r.default.error("["+joinInfo.clientId+"] Invalid address format ",L)}),h},R=I(21),D=function(o,h,L,M){var G=Object(m.getParameter)("WEBCS_DOMAIN").concat(Object(m.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),Q=Object(m.getParameter)("PROXY_SERVER_TYPE3");G=G.map(function(re,ce){return"".concat(Q[(ce+1)%Q.length],"/ap/?url=").concat(re)});var J,O=0,w=!0,U=Object(m.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),$=0,Y=function(re){(function(ce,ue,se,ie,me){var i=Date.now(),le=function(Ee,ge){try{d.report.joinChooseServer2(se.sid,{lts:i,succ:!Ee,csAddr:ue,serverList:ge&&ge.gateway_addr,cid:ge&&ge.cid+"",uid:ge&&ge.uid+"",ec:Ee,chooseServerIp:ge&&ge.detail&&ge.detail[502]})}catch{}},ee=function(Ee,ge){var he=Date.now();try{d.report.joinWebProxyAP({lts:he,sid:se.sid,cname:se.cname,cid:se.cid,uid:se.uid,sucess:Ee?-1:1,elapse:he-i,eventType:ce,apServerAddr:ue,turnServerAddrList:JSON.stringify(ge),errorCode:Ee||"0"})}catch{}},A=Object(m.getParameter)("AREA_SETTING").reduce(function(Ee,ge,he){var _e=Object(R.getAreaCodeByArea)(ge);return _e?he===0?_e:"".concat(Ee,",").concat(_e):Ee},""),fe={appid:se.token,client_ts:Date.now(),opid:133,sid:se.sid,request_bodies:[{uri:22,buffer:{cname:se.cname,detail:{11:A,6:se.stringUid},key:se.token,service_ids:[11,me?20:18],uid:se.uid||0}}]};ue="https://".concat(ue,"/api/v2/transpond/webrtc?v=2"),Object(a.postFormData)(ue,fe,function(Ee){var ge=function(te){return new RegExp(/10102\d{2}$/).test(te)?"NO_SERVICE_AVAILABLE":T.APErrorCode[te]||te};try{var he,_e,c=JSON.parse(Ee);if((c=c.response_body)[0].uri===30&&c[0].buffer.code!==0){var P=ge(c[0].buffer.code);return ee(P,c),ie(P)}if(c[0].buffer.flag===4096?(_e=c[0].buffer,he=c[1].buffer):(_e=c[1].buffer,he=c[0].buffer),he.code!==0)return P=ge(he.code),r.default.error("[".concat(se.clientId,"] requestProxyServer failed: ").concat(P)),ee(P,he),ie(P);if(!he.edges_services||!he.edges_services instanceof Array)return ee("UNEXPECTED_ERROR",he),ie("UNEXPECTED_ERROR");var F=Object(m.getParameter)("GATEWAY_DOMAINS"),X=0;if(ue.indexOf(F[1])>-1&&(X=1),he.edges_services.length===0)return ee("EMPTY_PROXY_LIST",he),ie("EMPTY_PROXY_LIST");var ne=he.edges_services.map(function(te){if(te.ip)return te.ip=me?"".concat(te.ip.replace(/[^\d]/g,"-"),".").concat(F[X++%F.length]):"".concat(te.ip),te});if(ee(null,ne),_e.code!==0)return P=ge(_e.code),r.default.error("[".concat(se.clientId,"] requestChooseServer failed: ").concat(P)),le(P),ie(P);var V=[];if(F=Object(m.getParameter)("GATEWAY_DOMAINS"),X=0,ue.indexOf(F[1])>-1&&(X=1),_e.edges_services.forEach(function(te){var ae;if(te.ip&&te.port){if(!te.ip.match(/^[\.\:\d]+$/))return r.default.info("["+se.clientId+"] "+"Cannot recognized as IP address ".concat(te.ip,". Used As Host instead")),void le("UNEXPECTED_IP");ae="".concat(te.ip.replace(/[^\d]/g,"-"),".").concat(F[X++%F.length]);var de=Object(m.getParameter)("PROXY_SERVER_TYPE3");ae=/sd-rtn/.test(ue)?"".concat(de[0],"/ws/?h=").concat(ae,"&p=").concat(te.port):"".concat(de[1],"/ws/?h=").concat(ae,"&p=").concat(te.port),V.push(ae)}else r.default.error("["+se.clientId+"] Invalid address format ",te)}),!V.length)return r.default.error("["+se.clientId+"] Empty Address response",c),le("EMPTY_ADDRESS_RESPONSE"),ie("EMPTY_ADDRESS_RESPONSE");_e.ticket=_e.cert;var K={gateway_addr:V,uid:_e.uid,cid:_e.cid,vid:_e.detail&&_e.detail[8],res:_e,detail:c.detail};le(null,K),ie(null,{gatewayServers:K,turnServers:ne})}catch(te){return r.default.error("[".concat(se.clientId,"] requestProxyServer failed with unexpected body "),te),ee("UNEXPECTED_ERROR"),ie("UNEXPECTED_ERROR")}},function(Ee,ge){Ee.type==="timeout"?(ee("REQUEST_PROXY_SERVER_TIME_OUT"),ie("REQUEST_PROXY_SERVER_TIME_OUT")):(ee("REQUEST_PROXY_SERVER_FAILED"),ie("REQUEST_PROXY_SERVER_FAILED"))})})(o,re,h,function(ce,ue){ce?(O++,r.default.error("[".concat(h.clientId,"] request ").concat(re," failed: ").concat(ce)),ce&&T.JOIN_PROXY_RETRY_LIST.indexOf(ce)===-1&&(J=ce),O===G.length&&(J||(J="RETRYABLE_ERROR"),L(J)),!(O%U)&&O<G.length&&($++,Z())):w&&(/sd-rtn/.test(ue.gatewayServers.gateway_addr[0])?Object(m.setParameter)("NGINX",Q[0]):Object(m.setParameter)("NGINX",Q[1]),w=!1,L(null,ue))},M)},Z=function(){for(var re=$*U,ce=re;ce<Math.min(G.length,re+U);ce++){var ue=G[ce];Y(ue)}};Z()},_=I(13),j=I(29),q=I.n(j),B=I(30),W={},k={},p=function(o){return W[o]},n=function(o,h){k[o]=h},N=function(o,h,L,M,G,Q){var J=new Date().getTime(),O=h,w="";h.multiIP&&h.multiIP.gateway_ip&&(w={vocs_ip:[h.multiIP.uni_lbs_ip],vos_ip:[h.multiIP.gateway_ip]});var U=Object(m.getParameter)("AREA_SETTING").reduce(function(Y,Z,re){var ce=Object(R.getAreaCodeByArea)(Z);return ce?re===0?ce:"".concat(Y,",").concat(ce):Y},""),$={appid:h.token,opid:133,client_ts:+new Date,sid:h.sid,request_bodies:[{uri:22,buffer:{cname:h.cname,detail:{5:w?JSON.stringify(w):void 0,6:h.stringUid,11:U},key:h.token,service_ids:[11],uid:h.uid||0}}]};Object(a.postFormData)(o,$,function(Y){try{var Z=JSON.parse(Y),re=(Z=Z.response_body[0].buffer).code}catch{var ce="requestChooseServer failed with unexpected body "+Y;return r.default.error("["+O.clientId+"]",ce),M(ce,void 0,void 0,Q)}if(re)return me=new RegExp(/10102\d{2}$/).test(re)?"NO_SERVICE_AVAILABLE":T.APErrorCode[Z.code]||re,d.report.joinChooseServer(h.sid,{lts:J,succ:!1,csAddr:o,serverList:null,ec:me,chooseServerIp:Z&&Z.detail&&Z.detail[502]}),M("Get server node failed ["+me+"]",o,me,Q);var ue=[],se=Object(m.getParameter)("GATEWAY_DOMAINS"),ie=0;if(o.indexOf(se[1])>-1&&(ie=1),Z.edges_services.forEach(function(le){var ee;le.ip&&le.port?(le.ip.match(/^[\.\:\d]+$/)?ee="".concat(le.ip.replace(/[^\d]/g,"-"),".").concat(se[ie++%se.length],":").concat(le.port):(r.default.info("["+O.clientId+"] "+"Cannot recognized as IP address ".concat(le.ip,". Used As Host instead")),ee="".concat(le.ip,":").concat(le.port)),ue.push(ee)):r.default.error("["+O.clientId+"] Invalid address format ",le)}),!ue.length){r.default.error("["+O.clientId+"] Empty Address response",Z);var me="EMPTY_ADDRESS_RESPONSE";return d.report.joinChooseServer(h.sid,{lts:J,succ:!1,csAddr:o,serverList:null,ec:me,chooseServerIp:Z&&Z.detail&&Z.detail[502]}),M("Get server node failed ["+me+"]",o,me,Q)}Z.ticket=Z.cert;var i={gateway_addr:ue,uid:Z.uid,cid:Z.cid,vid:Z.detail&&Z.detail[8],res:Z,uni_lbs_ip:Z.detail};return L(i,o)},function(Y,Z){Y.type==="timeout"?(d.report.joinChooseServer(h.sid,{lts:J,succ:!1,csAddr:Z,serverList:null,ec:"timeout"}),M("Connect choose server timeout",Z,void 0,Q)):(d.report.joinChooseServer(h.sid,{lts:J,succ:!1,csAddr:Z,serverList:null,ec:Y.httpErrorCode||"server_wrong"}),M("Connect choose server error",Z,void 0,Q))})},l=function(o,h,L){var M=!1,G=null,Q=1,J=1,O=o.clientId,w=function $(Y,Z){if(!M){var re=[];(function(ce,ue,se){var ie,me=new Date().getTime(),i=!1,le=0,ee=0,A=Object(m.getParameter)("WEBCS_DOMAIN"),fe=A.length,Ee=Object(m.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),ge=Ee.length,he=Object(m.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),_e=0,c=0,P=function(K,te){var ae;try{ae=K.res.detail[8]}catch(ve){r.default.debug("["+ce.clientId+"] get vid failed",ve)}if(i)d.report.joinChooseServer(ce.sid,{lts:me,succ:!0,csAddr:te,serverList:K.gateway_addr,cid:K.cid+"",uid:K.uid+"",ec:null,vid:ae,chooseServerIp:K.res&&K.res.detail&&K.res.detail[502]},!1);else{if(clearTimeout(V),i=!0,ce.proxyServer)for(var de=K.gateway_addr,oe=0;oe<de.length;oe++){var pe=de[oe].split(":");K.gateway_addr[oe]=ce.proxyServer+"/ws/?h="+pe[0]+"&p="+pe[1]}ue(K),d.report.joinChooseServer(ce.sid,{lts:me,succ:!0,csAddr:te,serverList:K.gateway_addr,cid:K.cid+"",uid:K.uid+"",ec:null,vid:ae,chooseServerIp:K.res&&K.res.detail&&K.res.detail[502]},!0)}},F=function(K,te,ae,de){de==="domain"&&le++,de==="backup"&&ee++,r.default.error("["+ce.clientId+"]",K,te,ae),ae&&T.JOIN_CS_RETRY_LIST.indexOf(ae)===-1&&(ie=ae),le===fe&&ee===ge&&se(ie),de==="domain"&&!(le%he)&&le<fe&&(_e++,X()),de==="backup"&&!(ee%he)&&ee<ge&&(c++,ne())},X=function K(){for(var te=_e*he,ae=te;ae<Math.min(fe,te+he);++ae){var de;if(typeof A[ae]=="string"){var oe=A[ae];de=ce.proxyServer?"https://".concat(ce.proxyServer,"/ap/?url=").concat(oe+"/api/v2/transpond/webrtc?v=2"):"https://".concat(oe,"/api/v2/transpond/webrtc?v=2");var pe=Object(R.getAreaCodeByWebCS)(oe);r.default.debug("["+ce.clientId+"] "+"Connect to choose_server: ".concat(de,", ").concat(pe)),N(de,ce,P,F,0,"domain")}else le++,r.default.error("["+ce.clientId+"] Invalid Host",A[ae]),ae===te+he-1&&ae<fe-1-1&&(_e++,K())}};X();var ne=function K(){if(!i)for(var te=c*he,ae=te;ae<Math.min(ge,te+he);ae++){var de;if(typeof Ee[ae]=="string"){var oe=Ee[ae];de=ce.proxyServer?"https://".concat(ce.proxyServer,"/ap/?url=").concat(oe+"/api/v2/transpond/webrtc?v=2"):"https://".concat(oe,"/api/v2/transpond/webrtc?v=2");var pe=Object(R.getAreaCodeByWebCS)(oe);r.default.debug("["+ce.clientId+"] "+"Connect to backup_choose_server: ".concat(de,", ").concat(pe)),N(de,ce,P,F,0,"backup")}else ee++,r.default.error("["+ce.clientId+"] Invalid Host",Ee[ae]),ae===te+he-1&&ae<Ee-1-1&&(_e++,K())}},V=setTimeout(ne,1e3)})(o,function(ce){M=!0,re=ce,clearTimeout(G),k[O]!==_.a.DISCONNECTED&&k[O]!==_.a.DISCONNECTING?Z&&Z(re,null):r.default.debug("[".concat(o.clientId,"] Request gateway list success when connection state is ").concat(k[O]))},function(ce){if(ce)return r.default.info("["+o.clientId+"] Join failed: "+ce),void(L&&L(ce));if(k[O]===_.a.DISCONNECTED||k[O]===_.a.DISCONNECTING)return r.default.debug("[".concat(o.clientId,"] Request gateway list falied when connection state is ").concat(k[O])),void(L&&L("OPERATION_ABORT"));r.default.debug("["+o.clientId+"] Request gateway list will be restart in "+Q+"s"),G=setTimeout(function(){$(Y,Z)},1e3*Q),W[O]=G;var ue=Object(m.getParameter)("AP_BACKOFF_MAX_TIME");Q=Q>=ue?ue:2*Q})}},U=function $(){(function(Y,Z){C(Y,function(re,ce){if(re)return Z&&Z(re);r.default.debug("["+Y.clientId+"] getProxyServerList: ",ce),u(Y,ce,Z)})})(o,function(Y,Z){if(Y){r.default.debug("["+o.clientId+"]",Y),r.default.debug("["+o.clientId+"] Request proxy will be restart in "+J+"s"),G=setTimeout(function(){$()},1e3*J),W[O]=G;var re=Object(m.getParameter)("AP_BACKOFF_MAX_TIME");J=J>=re?re:2*J}else{clearTimeout(G);var ce=Z.address;o.proxyServer=ce;var ue={mode:"manual",url:Z.address,tcpport:Z.serverResponse.tcpport||"3433",udpport:Z.serverResponse.udpport||"3478",username:Z.serverResponse.username||"test",credential:Z.serverResponse.password||Object(m.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};ue.tcpport+="",ue.udpport+="",o.turnServers=[],o.turnServers.push(ue),d.report.setProxyServer(ce),r.default.setProxyServer(ce),w(ce,h)}})};o.useProxyServer?o.proxyServerType==1?U():o.proxyServerType==2?function $(){(function(Y,Z){C(Y,function(re,ce){return re?Z&&Z(re):(r.default.debug("["+Y.clientId+"] getProxyServerList: ",ce),Z&&Z(null,{address:ce[0],serverResponse:{tcpport:"443",udpport:"3478",username:"test",password:"111111"}}))})})(o,function(Y,Z){if(Y)return r.default.debug("["+o.clientId+"]",Y),r.default.debug("["+o.clientId+"] Request proxy will be restart in "+J+"s"),G=setTimeout(function(){$()},1e3*J),W[O]=G,void(J=J>=3600?3600:2*J);clearTimeout(G);var re=Object(m.getParameter)("PROXY_SERVER_TYPE2");o.proxyServer=re;var ce={mode:"manual",url:Z.address,tcpport:Z.serverResponse.tcpport||"3433",udpport:Z.serverResponse.udpport||"3478",username:Z.serverResponse.username||"test",credential:Z.serverResponse.password||"111111",forceturn:!0};ce.tcpport+="",ce.udpport+="",o.turnServers=[],o.turnServers.push(ce),d.report.setProxyServer(re),r.default.setProxyServer(re),w(re,h)})}():o.proxyServerType==3?function $(){D("proxy3",o,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?L&&L(Y):(r.default.debug("["+o.clientId+"]",Y),r.default.debug("["+o.clientId+"] Request proxy will be restart in "+J+"s"),G=setTimeout(function(){$()},1e3*J),W[O]=G,void(J=J>=3600?3600:2*J));var re=Z.gatewayServers,ce=Z.turnServers;clearTimeout(G);var ue=Object(m.getParameter)("NGINX");o.proxyServer=ue,o.turnServers=[];var se=Object(B.randomString)();ce.map(function(ie){var me={mode:"manual",url:ie.ip,tcpport:"",udpport:ie.port||"3478",username:ie.username||se,credential:ie.password||q()(se).toString(),forceturn:!0};me.tcpport+="",me.udpport+="",o.turnServers.push(me)}),d.report.setProxyServer(ue),r.default.setProxyServer(ue),h(re)})}():o.proxyServerType==4?function $(){D("proxy4",o,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?L&&L(Y):(r.default.debug("["+o.clientId+"]",Y),r.default.debug("["+o.clientId+"] Request proxy will be restart in "+J+"s"),G=setTimeout(function(){$()},1e3*J),W[O]=G,void(J=J>=3600?3600:2*J));var re=Z.gatewayServers,ce=Z.turnServers;clearTimeout(G);var ue=Object(m.getParameter)("NGINX");o.proxyServer=ue,o.turnServers=[];var se=Object(B.randomString)();ce.map(function(ie){var me={mode:"manual",url:ie.ip,tcpport:ie.port||"443",udpport:"",username:ie.username||se,credential:ie.password||q()(se).toString(),forceturn:!1};me.tcpport+="",me.udpport+="",o.turnServers.push(me)}),d.report.setProxyServer(ue),r.default.setProxyServer(ue),h(re)})}():o.proxyServerType==5?function $(){D("proxy5",o,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?L&&L(Y):(r.default.debug("["+o.clientId+"]",Y),r.default.debug("["+o.clientId+"] Request proxy will be restart in "+J+"s"),G=setTimeout(function(){$()},1e3*J),W[O]=G,void(J=J>=3600?3600:2*J));var re=Z.gatewayServers,ce=Z.turnServers;clearTimeout(G);var ue=Object(m.getParameter)("NGINX");o.proxyServer=ue,o.turnServers=[];var se=Object(B.randomString)();ce.map(function(ie){var me={mode:"manual",url:ie.ip,tcpport:ie.port||"443",udpport:"",username:ie.username||se,credential:ie.password||q()(se).toString(),forceturn:!1,useTurns:!0};me.tcpport+="",me.udpport+="",o.turnServers.push(me)}),d.report.setProxyServer(ue),r.default.setProxyServer(ue),h(re)},!0)}():U():w(null,h)},t=function(o,h,L,M,G){var Q=Date.now();M=M||h.stringUid;var J={sid:h.sid,opid:10,appid:h.appId,string_uid:M};return new Promise(function(O,w){Object(a.post)(o+"".concat(o.indexOf("?")===-1?"?":"&","action=stringuid"),J,function(U){try{var $=JSON.parse(U),Y=$.code}catch{var Z="requestUserAccount failed with unexpected body "+U;return r.default.error("["+h.clientId+"]",Z),w({retryable:!0,info:Z,url:o,error:"UNEXPECTED_ERROR"}),L&&L.dispatchEvent({type:"error",reason:"USER_ACCOUNT_BODY_NOT_JSON"}),void d.report.reqUserAccount(J.sid,{lts:Q,success:!1,serverAddress:o,stringUid:M,uid:null,extend:U,errorCode:"USER_ACCOUNT_BODY_NOT_JSON"})}if(Y){var re=!1;return(ue=T.StringUidErrorCode[$.code%1e4]||"REQ_ACCOUNT_ERR_".concat(Y))==="INTERNAL_SERVER_ERROR"&&(re=!0),L&&L.dispatchEvent({type:"error",reason:ue}),d.report.reqUserAccount(J.sid,{lts:Q,success:!1,serverAddress:o,stringUid:M,uid:null,errorCode:ue,extend:J}),w({retryable:re,info:Z="Get String Uid Failed ["+ue+"]",url:o,error:ue})}var ce=$.uid;if(!(ce>0&&ce<Math.pow(2,32))){r.default.error("["+h.clientId+"] "+"Invalid Uint Uid ".concat(M," => ").concat(ce),$);var ue="INVALID_UINT_UID_".concat(ce);return L&&L.dispatchEvent({type:"error",reason:ue}),d.report.reqUserAccount(J.sid,{lts:Q,success:!1,serverAddress:o,stringUid:M,uid:null,errorCode:ue,extend:J}),w({retryable:!0,error:ue,info:"Get String Uid failed ["+ue+"]",url:o})}O({uid:ce,url:o}),d.report.reqUserAccount(J.sid,{lts:Q,success:!0,serverAddress:o,stringUid:M,uid:ce,errorCode:null,extend:J})},function(U,$){if(U.type==="timeout"){var Y="USER_ACCOUNT_TIMEOUT";L&&L.dispatchEvent({type:"error",reason:Y}),d.report.reqUserAccount(J.sid,{lts:Q,success:!1,serverAddress:$,stringUid:M,uid:null,errorCode:Y,extend:J}),w({retryable:!0,info:Y,url:$,error:Y})}else{var Z="USER_ACCOUNT_SERVER_WRONG_".concat(U.type);L&&L.dispatchEvent({type:"error",reason:Z}),d.report.reqUserAccount(J.sid,{lts:Q,success:!1,serverAddress:$,stringUid:M,uid:null,errorCode:Z,extend:J}),w({retryable:!0,info:Z,url:$,error:Z})}},{"X-Packet-Service-Type":0,"X-Packet-URI":72})})},x=function(o,h,L){var M,G=Object(m.getParameter)("ACCOUNT_REGISTER"),Q=!1,J=Object(m.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),O=null,w=null,U=new Promise(function(){var $=s()(g.a.mark(function Y(Z,re){var ce,ue,se;return g.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:O=Z,w=re,M=0;case 3:if(!(M<Object(m.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){ie.next=33;break}if(!Q){ie.next=6;break}return ie.abrupt("return");case 6:return ce=G[M%G.length],ue=o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(ce+"/api/v1"):"https://".concat(ce,"/api/v1"),ie.prev=8,ie.delegateYield(g.a.mark(function me(){var i;return g.a.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return o.proxyServer,le.next=3,t(ue,o,h,L);case 3:if(i=le.sent,!Q){le.next=6;break}return le.abrupt("return",{v:void 0});case 6:Q=!0,setTimeout(function(){r.default.debug("Get UserAccount Successfully",i),O(i)},0);case 8:case"end":return le.stop()}},me)})(),"t0",10);case 10:if(se=ie.t0,f()(se)!=="object"){ie.next=13;break}return ie.abrupt("return",se.v);case 13:ie.next=30;break;case 15:if(ie.prev=15,ie.t1=ie.catch(8),!Q){ie.next=19;break}return ie.abrupt("return");case 19:if(!ie.t1.retryable){ie.next=27;break}return(J=Math.ceil(J*Object(m.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(m.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(J=Object(m.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),r.default.error("".concat(ie.t1.info," ").concat(ie.t1.url," Will Fetch User Account in ").concat(J/1e3," seconds")),ie.next=25,new Promise(function(me){setTimeout(me,J)});case 25:ie.next=30;break;case 27:r.default.error("Get UserAccount Error: ".concat(ie.t1.info," ").concat(ie.t1.url),ie.t1.error),Q=!0,w(ie.t1.error);case 30:M++,ie.next=3;break;case 33:case"end":return ie.stop()}},Y,null,[[8,15]])}));return function(Y,Z){return $.apply(this,arguments)}}());return U.cancel=function(){Q||(Q=!0,w({info:"Request Cancelled",retryable:!1}))},U.isFinished=function(){return Q},U}},function(z,H,I){var E=this&&this.__spreadArrays||function(){for(var T=0,C=0,v=arguments.length;C<v;C++)T+=arguments[C].length;var u=Array(T),b=0;for(C=0;C<v;C++)for(var R=arguments[C],D=0,_=R.length;D<_;D++,b++)u[b]=R[D];return u},f=this&&this.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(H,"__esModule",{value:!0});var S,g,y=f(I(0));(function(T){T.CHINA="CHINA",T.ASIA="ASIA",T.NORTH_AMERICA="NORTH_AMERICA",T.EUROPE="EUROPE",T.JAPAN="JAPAN",T.INDIA="INDIA",T.OCEANIA="OCEANIA",T.SOUTH_AMERICA="SOUTH_AMERICA",T.AFRICA="AFRICA",T.OVERSEA="OVERSEA",T.GLOBAL="GLOBAL"})(S||(S={})),H.AREAS=S,function(T){T.CHINA="CN",T.ASIA="AS",T.NORTH_AMERICA="NA",T.EUROPE="EU",T.JAPAN="JP",T.INDIA="IN",T.OCEANIA="OC",T.SOUTH_AMERICA="SA",T.AFRICA="AF",T.OVERSEA="OVERSEA",T.GLOBAL="GLOBAL"}(g||(g={}));var s={ASIA:{CODE:g.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:g.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:g.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:g.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:g.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:g.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],NGINX:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:g.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],NGINX:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:g.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:g.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:g.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};H.AREA_DOMAIN_MAP=s;var m={GLOBAL:{ASIA:[S.CHINA,S.JAPAN,S.INDIA],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},r=Object.keys(m[S.GLOBAL]),a=[S.CHINA,S.NORTH_AMERICA,S.EUROPE,S.ASIA,S.JAPAN,S.INDIA,S.OCEANIA,S.SOUTH_AMERICA,S.AFRICA],d=function(T,C){var v,u=[];if(typeof T=="string"&&(T=[T]),C&&!T.includes(S.GLOBAL)&&(u=T),C||(u=T),C&&T.includes(S.GLOBAL)){var b=[S.GLOBAL,S.OVERSEA],R=Object.keys(s);if(C===S.GLOBAL)throw new Error("Can not set excludedArea to 'GLOBAL'");if(C===S.CHINA)u=[S.OVERSEA];else if(v=C,r.includes(v)){var D=function(B){return B===void 0&&(B=""),m[S.GLOBAL][B]||[]}(C),_=E(b,[C],D);u=R.filter(function(B){return!_.includes(B)})}else if(function(B){var W=!1;return r.forEach(function(k){m.GLOBAL[k].includes(B)&&(W=!0)}),W}(C)){var j=function(B){B===void 0&&(B="");var W="";return r.forEach(function(k){m.GLOBAL[k].includes(B)&&(W=k)}),W}(C),q=E(b,[j,C]);u=R.filter(function(B){return!q.includes(B)})}else u=T;u=function(B){var W=[];return a.forEach(function(k){B.includes(k)&&W.push(k)}),W.concat(B.filter(function(k){return!a.includes(k)}))}(u)}return u};H.getAreaCodeByConfig=function(T){var C=T.areaCode,v=T.excludedArea;return v?d(C,v):C},s.CHINA={CODE:g.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]},H.getAreaCodeByWebCS=function(T){for(var C=Object.keys(s),v=0;v<C.length;v++){var u=C[v],b=s[u];if(b.WEBCS_DOMAIN.includes(T)||b.WEBCS_DOMAIN_BACKUP_LIST.includes(T))return b.CODE===g.OVERSEA?g.ASIA+","+g.EUROPE+","+g.AFRICA+","+g.NORTH_AMERICA+","+g.SOUTH_AMERICA+","+g.OCEANIA:b.CODE}},H.getAreaCodeByArea=function(T){return T===S.OVERSEA?g.ASIA+","+g.EUROPE+","+g.AFRICA+","+g.NORTH_AMERICA+","+g.SOUTH_AMERICA+","+g.OCEANIA:g[T]},H.getAreaDomainConfig=function(T){var C={WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],NGINX:[]};return T.map(function(v){var u=s[v];if(u){var b=Object.keys(u);b?b.map(function(R){R!=="CODE"&&(C[R]=C[R].concat(u[R]))}):y.default.info(v+" is not exist")}else y.default.info(v+" is not exist")}),C}},function(z,H,I){I.d(H,"a",function(){return n}),I.d(H,"b",function(){return N});var E=I(7),f=I.n(E),S=I(5),g=I(8),y=function(l){var t=Object(g.b)(l);return t.url=".",t},s=I(0),m=I(15),r=I(4),a=I(2),d=I(1),T=0,C=function(l){var t=y({});t.id=l.id,t.playerId=T++,t.destroyed=!1,t.fit=l.options&&l.options.fit,t.fit!=="contain"&&t.fit!=="cover"&&(t.fit=null),t.url=l.url,t.stream=l.stream.stream,t.peerVideoReady=!1,t.isFreeze=!1,t.freezeTimeCounterList=[],t.freezeCount=0,t.lastFreezeCount=0,t.lastTimeupdateTime=0,t.elementID=l.elementID,t.setAudioOutput=function(ue,se,ie){var me=t.video||t.audio;return me?me.setSinkId?void me.setSinkId(ue).then(function(){return s.default.debug("["+t.id+"] "+"video ".concat(t.id," setAudioOutput ").concat(ue," SUCCESS")),me==t.video&&t.audio?t.audio.setSinkId(ue):Promise.resolve()}).then(function(){return s.default.debug("["+t.id+"] "+"audio ".concat(t.id," setAudioOutput ").concat(ue," SUCCESS")),se&&se()}).catch(function(i){return s.default.error("["+t.id+"] VideoPlayer.setAudioOutput",i),ie&&ie(i)}):(s.default.error("["+t.id+"] ",r.default.WEB_API_NOT_SUPPORTED),ie&&ie(r.default.WEB_API_NOT_SUPPORTED)):(s.default.error("["+t.id+"] ",r.default.PLAYER_NOT_FOUND),ie&&ie(r.default.PLAYER_NOT_FOUND))},t.destroy=function(){s.default.debug("[".concat(t.id,"] destroy ").concat(l.stream.local?"local":"remote"," Player ").concat(t.id)),Object(m.setSrcObject)(t.video,null),Object(m.setSrcObject)(t.audio,null),t.video.load(),t.audio.load(),t.video.pause(),t.video.remove(),t.audio.remove(),t.freezeCheckInterval&&clearInterval(t.freezeCheckInterval),t.destroyed=!0,delete t.resizer,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.div.remove()&&t.parentNode.removeChild(t.div),["video","audio"].forEach(function(ue){t[ue];var se=h[ue];clearTimeout(se.playDeferTimeout),se.formerMediaState=null;var ie={playerId:t.playerId,stateId:se.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};h[ue]=ie;var me={type:"player-status-change",playerId:t.playerId,mediaType:ue,status:ie.status,reason:ie.reason,isErrorState:!1,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change Triggered by destroy()"),me),l.stream.dispatchEvent(me),d.report.reportApiInvoke(l.stream.sid,{name:"Stream.playerStatusChange",options:me,tag:"tracer"})()})},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),l.stream.video?t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),l.stream.local&&!l.stream.screen?l.stream.mirror?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(t.fit||"cover",";")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):l.stream.video?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):l.stream.screen?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"contain")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(t.fit||"cover"));var x={autoplay:!0,muted:!!l.stream.local||!(!S.isSafari()&&S.getBrowserOS()!=="iOS")&&"video_element_muted",playsinline:!0,controls:!1,volume:null},o=f()({},x,l.options);o.muted!==!0||o.volume||(o.volume=0),t.video.setAttribute("autoplay",""),t.video.setAttribute("muted",""),t.video.muted=!0,t.video.autoplay=!0,o.playsinline&&t.video.setAttribute("playsinline",""),o.controls&&t.video.setAttribute("controls",""),o.contains&&(t.video.controls=!0),Number.isFinite(o.volume)&&(t.video.volume=o.volume),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),o.muted===!0&&t.audio.setAttribute("muted",""),o.muted===!0&&(t.audio.muted=!0),o.playsinline&&t.audio.setAttribute("playsinline",""),Number.isFinite(o.volume)&&(t.audio.volume=o.volume),t.elementID!==void 0?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode;var h={video:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};t.mediaElemExists=function(ue){for(var se=ue,ie=0;ie<Object(a.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&se;ie++)se=se.parentNode;return!!se};var L=function(ue){return t.mediaElemExists(ue)?ue.paused?"paused":"play":"aborted"},M=function(ue,se,ie){var me=L(ue),i=!0;return me==="paused"?(se==="audio"&&ie.muted===!0&&(i=!1),ie.autoplay||(i=!1)):me==="play"?se==="video"?i=!1:ie.muted===!0?ue.muted&&(i=!1):ue.muted||(i=!1):me==="aborted"&&(i=!1),i},G=function(ue){var se,ie=this;if(ie===t.video?se="video":ie===t.audio&&(se="audio"),se){if(ue.type||s.default.error("[".concat(t.id,"] Unexpected evt"),ue),se==="video"&&ie.muted&&ie.paused)return s.default.debug("[".concat(t.id,"] auto resume video element")),void ie.play();var me=L(ie);clearTimeout(h[se].playDeferTimeout),h[se].playDeferTimeout=setTimeout(function(){h[se].playDeferTimeout=null;var i=h[se],le=L(ie);if(me===le){var ee={playerId:t.playerId,stateId:i.stateId+1,playDeferTimeout:null,error:M(ie,se,o),status:L(ie),reason:ue.type,updatedAt:Date.now()};if(i.status!==ee.status){h[se]=ee;var A={type:"player-status-change",playerId:t.playerId,mediaType:se,status:ee.status,reason:ee.reason,isErrorState:ee.error,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change"),A),l.stream.dispatchEvent(A),d.report.reportApiInvoke(l.stream.sid,{name:"Stream.playerStatusChange",options:A,tag:"tracer"})()}}else s.default.debug("[".concat(t.id,"] Status Change after event Triggered.")+"Stream ".concat(t.id," PlayerId ").concat(t.playerId," mediaType ").concat(se," Status ").concat(me,"=>").concat(le))},Object(a.getParameter)("PLAYER_STATE_DEFER"))}else s.default.error("[".concat(t.id,"] Unknown media element"),ie)};t.video.addEventListener("playing",function(ue){(function se(){t.video.videoWidth*t.video.videoHeight>4?s.default.debug("["+t.id+"] video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(se,50)})()});var Q=0,J=0,O=0;t.freezeCheckInterval=setInterval(function(){Date.now()-t.lastTimeupdateTime>500&&t.peerVideoReady?(t.isFreeze=!0,t.freezeCount+=1):t.isFreeze=!1},500),t.video.addEventListener("playing",G),t.video.addEventListener("canplay",G),t.video.addEventListener("abort",G),t.video.addEventListener("onerror",G),t.video.addEventListener("suspend",G),t.video.addEventListener("stalled",G),t.video.addEventListener("pause",G),t.audio.addEventListener("playing",G),t.audio.addEventListener("canplay",G),t.audio.addEventListener("abort",G),t.audio.addEventListener("onerror",G),t.audio.addEventListener("suspend",G),t.audio.addEventListener("stalled",G),t.audio.addEventListener("pause",G);var w=t.audio,U="audio";if(l.stream.hasVideo()||l.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),S.isEdge()?t.video.srcObject=l.stream.stream:(Object(m.attachMediaStream)(t.video,l.stream.stream),Object(m.attachMediaStream)(t.audio,l.stream.stream)),t.video.addEventListener("timeupdate",function(){var ue=Date.now();if((Q+=1)<10)t.lastTimeupdateTime=ue;else for(ue-t.lastTimeupdateTime>500&&(t.peerVideoReady?J+=ue-t.lastTimeupdateTime:t.peerVideoReady=!0),O+=ue-t.lastTimeupdateTime,t.lastTimeupdateTime=ue;O>=6e3;)O-=6e3,t.freezeTimeCounterList.push(Math.min(6e3,J)),J-=6e3,J=Math.max(J,0)});else{o.muted!==!1&&o.muted!=="video_element_muted"||(t.video.removeAttribute("muted"),t.video.muted=!1),t.video.removeAttribute("autoplay"),t.video.autoplay=!1,t.div.appendChild(t.video),w=t.video,U="video";var $=h.audio,Y={playerId:t.playerId,stateId:$.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"audioonly",updatedAt:Date.now()};h.audio=Y;var Z={type:"player-status-change",playerId:t.playerId,mediaType:"audio",status:Y.status,reason:Y.reason,isErrorState:Y.error,streamId:t.id};if(s.default.debug("[".concat(t.id,"] Media Player Status Change"),Z),Promise.resolve().then(function(){return l.stream.dispatchEvent(Z)}),d.report.reportApiInvoke(l.stream.sid,{name:"Stream.playerStatusChange",options:Z,tag:"tracer"})(),window.MediaStream&&(S.isSafari()||S.getBrowserOS()==="iOS")){var re=new MediaStream(l.stream.stream.getAudioTracks());Object(m.setSrcObject)(t.video,re)}else Object(m.setSrcObject)(t.video,l.stream.stream)}if(o.autoplay&&w){var ce=w.play();ce&&ce.catch&&ce.catch(function(ue){if(!t.destroyed&&w){var se=h[U],ie={playerId:t.playerId,stateId:se.stateId+1,playDeferTimeout:null,error:M(w,U,o),status:L(w),reason:"error",updatedAt:Date.now()};if(se.status!==ie.status){s.default.debug("[".concat(t.id,"] Player ").concat(t.playerId," Status Changed Detected by promise error: ").concat(se.status,"=>").concat(ie.status),ue),h[U]=ie;var me={type:"player-status-change",playerId:t.playerId,mediaType:U,status:ie.status,reason:ie.reason,isErrorState:ie.error,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change"),me),l.stream.dispatchEvent(me),d.report.reportApiInvoke(l.stream.sid,{name:"Stream.playerStatusChange",options:me,tag:"tracer"})()}}})}return t.setAudioVolume=function(ue){var se=parseInt(ue)/100;isFinite(se)&&(se<0?se=0:se>1&&(se=1),t.video&&(t.video.volume=se),t.audio&&(t.audio.volume=se))},t},v=I(23),u=I(10),b=I(6),R=I(19),D=I(3),_=I(25),j=I(16),q=I(11),B=I.n(q),W=function(l){Object(D.checkValidString)(l,"profileName"),(l=l.toLowerCase()).indexOf("_")===-1&&(l+="_1"),Object(D.checkValidEnum)(l,"profileName",Object.keys(a.SUPPORT_RESOLUTION_LIST));var t=a.SUPPORT_RESOLUTION_LIST[l];t||(l=Object(a.getParameter)("DEFAULT_PROFILE"),t=a.SUPPORT_RESOLUTION_LIST[l]);var x={profileName:l,video:{width:t[0],height:t[1]},attributes:{resolution:"".concat(t[0],"x").concat(t[1]),minFrameRate:t[2],maxFrameRate:t[3],minVideoBW:t[4],maxVideoBW:t[5]}};return t[2]&&(x.video.frameRate=t[2]),t[6]&&t[7]&&(x.screen={width:t[0],height:t[1],frameRate:{min:t[6],max:t[7]}}),x},k=function(l){return Object.keys(a.SUPPORT_RESOLUTION_LIST).filter(function(t){var x=a.SUPPORT_RESOLUTION_LIST[t],o=["width","height","frameRate"];for(var h in o){var L=o[h];if(l[L]&&x[h]&&(typeof l[L].max=="number"&&l[L].max<x[h]||typeof l[L].min=="number"&&l[L].min>x[h]))return!1}return!0}).reverse()},p=function(l){var t=a.AUDIO_PROFILE_SETTINGS[l]||a.AUDIO_PROFILE_SETTINGS.default;return{highQuality:t[0],stereo:t[1],speech:t[2],lowQuality:t[3]}},n=function(l){var t=Object(g.b)();if(t.params=f()({},l),t.stream=l.stream,t.url=l.url,t.onClose=void 0,t.local=!1,t.videoSource=l.videoSource,t.audioSource=l.audioSource,l.video=!(!l.videoSource&&!l.video),t.video=l.video,l.audio=!(!l.audioSource&&!l.audio),t.audio=l.audio,t.screen=!!l.screen,t.screenAudio=!!l.screenAudio,t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=l.videoSize,t.player=void 0,t.audioLevelHelper=null,l.attributes=l.attributes||{},t.attributes=l.attributes,t.microphoneId=l.microphoneId,t.cameraId=l.cameraId,t.facingMode=l.facingMode,t.inSwitchDevice=!1,t.userMuteVideo=!1,t.userMuteAudio=!1,t.peerMuteVideo=!1,t.peerMuteAudio=!1,t.lowStream=null,t.videoWidth=0,t.videoHeight=0,t.streamId=l.streamID,t.userId=null,t.uintId=l.uintUID||null,t.mirror=l.mirror!==!1,t.DTX=l.audioProcessing&&l.audioProcessing.DTX,t.audioProcessing=l.audioProcessing,t.optimizationMode=l.optimizationMode,t.highQuality=!1,t.stereo=!1,t.speech=!1,t.screen||delete t.screen,!(t.videoSize===void 0||t.videoSize instanceof Array&&t.videoSize.length===4))throw Error("Invalid Video Size");function x(){var o={};t.getVideoTrack()===this?(s.default.debug("Video Track Ended"),o.type="videoTrackEnded",o.track=this):t.getAudioTrack()===this?(s.default.debug("Audio Track Ended"),o.type="audioTrackEnded",o.track=this):s.default.debug("Detached Track ended",this.kind,this.label,this),o.type&&t.dispatchEvent(o)}return t.videoSize=[640,480,640,480],l.local!==void 0&&l.local!==!0||(t.local=!0),t.initialized=!t.local,t._streamInitID=null,function(o){o.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},o._initSoundIfNotExists=function(h,L){o.audioMixing.sounds[h]||(o.audioMixing.sounds[h]={soundId:h,state:"IDLE",muted:o.userMuteAudio,filePath:L,volume:o.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},o._initSoundIfNotExists(-1),o.loadAudioBuffer=function(h,L,M){var G=d.report.reportApiInvoke(o.sid,{callback:M,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Object(D.checkValidString)(L,"url",1,1024,!1),Object(D.checkValidString)(h,"id",1,1024,!1);var Q=function(O){s.default.error("[".concat(o.streamId,"] loadAudioBuffer Failed: ")+O),G(r.default.LOAD_AUDIO_FAILED)},J=new XMLHttpRequest;J.open("GET",L,!0),J.responseType="arraybuffer",J.onload=function(){if(J.status>400)Q("".concat(J.status," ").concat(J.statusText));else{var O=J.response;o.audioMixing.audioContextInited||o._initAudioContext(),o.audioMixing.ctx.decodeAudioData(O,function(w){o.audioMixing.buffer[h]=w,G(null)},function(w){s.default.error("[".concat(o.streamId,"] decodeAudioData Failed: "),w),G(w)})}},J.onerror=function(){return Q("load error")},J.ontimeout=function(){return Q("timeout")},J.send()},o.createAudioBufferSource=function(h){var L=d.report.reportApiInvoke(o.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(o.audioMixing.buffer[h.id]){var M=o.audioMixing.buffer[h.id],G=o.audioMixing.ctx.createBufferSource();G.buffer=M;var Q=o.audioMixing.ctx.createGain();if(G.connect(Q),Q.connect(o.audioMixing.mediaStreamDest),G.gainNode=Q,h.loop)G.loop=!0,G.start(0,h.playTime/1e3);else if(h.cycle>1)if(Object(S.isChrome)()){G.loop=!0;var J=h.cycle*M.duration*1e3-(h.playTime||0);G.start(0,h.playTime/1e3,J/1e3)}else s.default.warning("[".concat(o.streamId,"] Cycle Param is ignored by current browser")),G.start(0,h.playTime/1e3);else G.start(0,h.playTime/1e3);var O=o.audioMixing.sounds[h.soundId];return O.source=G,o._flushAudioMixingMuteStatus(),G.addEventListener("ended",function(){G===O.source&&o.dispatchEvent({type:"audioSourceEnded",soundId:h.soundId,source:G,sound:O})}),L(),G}var w="AUDIOBUFFER_NOT_FOUND";return s.default.error("[".concat(o.streamId,"] "),w,h.id),L(!1),!1},o.on("audioSourceEnded",function(h){var L=h.source,M=h.sound;M&&M.state===o.audioMixing.states.BUSY&&!M.pauseAt&&(M.state=o.audioMixing.states.IDLE,M.startAt=null,M.startOffset=null,M.resumeAt=null,M.resumeOffset=null,L.gainNode&&L.gainNode.disconnect&&L.gainNode.disconnect(),L.buffer=null,o.audioMixing.mediaStreamSource.connect(o.audioMixing.mediaStreamDest))}),o.clearAudioBufferSource=function(){o.audioBufferSource.forEach(function(h){h.stop()})},o._isSoundExists=function(h){return!!o.audioMixing.sounds[h.soundId]||(s.default.error("SoundId not exists. #".concat(h.soundId)),!1)},o._initAudioContext=function(){if(o.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!o.stream)throw new Error("Failed to init audio context. Local Stream not initialized");o.audioMixing.ctx=Object(_.a)(),o.audioMixing.mediaStreamSource=o.audioMixing.ctx.createMediaStreamSource(o.stream),o.audioMixing.mediaStreamDest=o.audioMixing.ctx.createMediaStreamDestination(),o.audioMixing.mediaStreamSource.connect(o.audioMixing.mediaStreamDest);var h=o.stream.getVideoTracks()[0];if(h&&o.audioMixing.mediaStreamDest.stream.addTrack(h),o._originStream=o.stream,o._isAudioMuted()?(o._unmuteAudio(),o.stream=o.audioMixing.mediaStreamDest.stream,o._muteAudio()):o.stream=o.audioMixing.mediaStreamDest.stream,o.audioLevelHelper=null,o.pc&&o.pc.peerConnection&&o.pc.peerConnection){var L=(o.pc.peerConnection&&o.pc.peerConnection.getSenders()).find(function(G){return G&&G.track&&G.track.kind=="audio"}),M=o.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];L&&L.replaceTrack&&M&&L.replaceTrack(M)}o.audioMixing.audioContextInited=!0},o._cleanupAudioMixing=function(){if(o.audioMixing.audioContextInited){for(var h in o.audioMixing.sounds){var L=o.audioMixing.sounds[h];L.state!==o.audioMixing.states.BUSY&&L.state!==o.audioMixing.states.PAUSED||o._stopOneEffect({soundId:h})}o.audioLevelHelper=null,o.audioMixing.audioContextInited=!1}},o._reloadInEarMonitoringMode=function(h){if(h){if(!o.audioMixing.inEarMonitoringModes[h])return s.default.error("[".concat(o.streamId,"] Invalid InEarMonitoringMode ").concat(h));o.audioMixing.inEarMonitoring=h}switch(o.audioMixing.audioContextInited||o._initAudioContext(),o.audioMixing.inEarMonitoring){case o.audioMixing.inEarMonitoringModes.FILE:o.audioMixing.mediaStreamSource.connectedToDestination&&(o.audioMixing.mediaStreamSource.disconnect(o.audioMixing.ctx.destination),o.audioMixing.mediaStreamSource.connectedToDestination=!1);case o.audioMixing.inEarMonitoringModes.ALL:for(var L in o.audioMixing.sounds){var M=o.audioMixing.sounds[L];M&&M.source&&!M.source.connectedToDestination&&(M.source.gainNode.connect(o.audioMixing.ctx.destination),M.source.connectedToDestination=!0)}}switch(o.audioMixing.inEarMonitoring){case o.audioMixing.inEarMonitoringModes.MICROPHONE:o.audioMixing.source.forEach(function(G){G.connectedToDestination&&(G.gainNode.disconnect(o.audioMixing.ctx.destination),G.connectedToDestination=!1)});case o.audioMixing.inEarMonitoringModes.ALL:o.audioMixing.mediaStreamSource.connectedToDestination||(o.audioMixing.mediaStreamSource.connect(o.audioMixing.ctx.destination),o.audioMixing.mediaStreamSource.connectedToDestination=!0)}},o._startAudioMixingBufferSource=function(h){o.audioMixing.audioContextInited||o._initAudioContext();var L={soundId:h.soundId,id:h.filePath,loop:h.loop,cycle:h.cycle,playTime:h.playTime||0},M=h.replace,G=o.createAudioBufferSource(L);return G.sound=o.audioMixing.sounds[h.soundId],G?(G.addEventListener("ended",o._audioMixingFinishedListener,{once:!0}),o._reloadInEarMonitoringMode(),M&&o.audioMixing.mediaStreamSource.disconnect(o.audioMixing.mediaStreamDest),G):null},o._stopAudioMixingBufferSource=function(h){var L=o.audioMixing.sounds[h.soundId].source;return L?(L.removeEventListener("ended",o._audioMixingFinishedListener),o.audioMixing.mediaStreamSource.connect(o.audioMixing.mediaStreamDest),L.stop(),L.gainNode&&L.gainNode.disconnect&&L.gainNode.disconnect(),L.buffer=null,L):null},o._flushAudioMixingMuteStatus=function(h){for(var L in o.audioMixing.sounds){var M=o.audioMixing.sounds[L];M&&(h!==void 0&&(M.muted=!!h),M.source&&(M.muted?M.source.gainNode.gain.value=0:M.source.gainNode.gain.value=M.volume/100))}},o._handleAudioMixingInvalidStateError=function(h,L,M){var G=o.audioMixing.sounds[L.soundId],Q=L.soundId===-1?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";s.default.error("[".concat(o.streamId,"] Cannot ").concat(h,": ").concat(Q,", state is ").concat(G.state)),M&&M(Q)},o._handleAudioMixingNoSourceError=function(h,L,M){o.audioMixing.sounds[L.soundId].state=o.audioMixing.states.IDLE;var G=L.soundId===-1?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";s.default.error("[".concat(o.streamId,"] Cannot ").concat(h,": ").concat(G)),M&&M(G)},o._getOneEffectStates=function(h){var L=o.audioMixing.sounds[h.soundId];return function(){return L?{state:L.state,startAt:L.startAt,resumeAt:L.resumeAt,pauseOffset:L.pauseOffset,pauseAt:L.pauseAt,resumeOffset:L.resumeOffset,stopAt:L.stopAt,duration:o._getOneEffectDuration(h),position:o._getOneEffectCurrentPosition(h)}:{}}},o._audioMixingFinishedListener=function(){var h=this.sound;h.state===o.audioMixing.states.IDLE&&o.audioMixing.buffer[h.options.filePath]&&!h.options.cacheResource&&(s.default.debug("Recycled buffer ".concat(h.options.filePath)),delete o.audioMixing.buffer[h.options.filePath]),h.soundId===-1&&o.dispatchEvent({type:"audioMixingFinished"})},o._playOneEffect=function(h,L){Object(D.checkValidObject)(h,"options");var M=h.soundId,G=(h.filePath,h.cacheResource);if(h.cycle,h.loop,h.playTime,h.replace,Object(S.isSafari)()&&Object(S.getBrowserVersion)()<12){var Q="BROWSER_NOT_SUPPORT";return s.default.error("[".concat(o.streamId,"] Cannot _playOneEffect: "),Q),L(Q)}o.audioMixing.audioContextInited||o._initAudioContext(),o._initSoundIfNotExists(M);var J=o.audioMixing.sounds[M];if(J.state===o.audioMixing.states.IDLE){if(h.cycle!==void 0&&!h.cycle>0)return Q="Invalid Parmeter cycle: "+h.cycle,s.default.error("[".concat(o.streamId,"] ").concat(M),Q),L(Q);if(Object(D.isEmpty)(G)&&(h.cacheResource=!0),J.state=o.audioMixing.states.STARTING,J.options=h,o.audioMixing.buffer[h.filePath]){var O=o._startAudioMixingBufferSource(h);if(O)return J.source=O,J.startAt=Date.now(),J.resumeAt=null,J.pauseOffset=null,J.pauseAt=null,J.resumeOffset=null,J.stopAt=null,J.startOffset=h.playTime||0,J.state=o.audioMixing.states.BUSY,o._flushAudioMixingMuteStatus(),L(null);J.state=o.audioMixing.states.IDLE;var w="CREATE_BUFFERSOURCE_FAILED";if(L)return L(w);s.default.error("[".concat(o.streamId,"] "),w)}else o.loadAudioBuffer(h.filePath,h.filePath,function(U){if(U)J.state=o.audioMixing.states.IDLE,L?L(U):s.default.error("[".concat(o.streamId,"] "),U);else{var $=o._startAudioMixingBufferSource(h);if($)return J.source=$,J.startAt=Date.now(),J.resumeAt=null,J.pauseOffset=null,J.pauseAt=null,J.resumeOffset=null,J.stopAt=null,J.startOffset=h.playTime||0,J.state=o.audioMixing.states.BUSY,o._flushAudioMixingMuteStatus(),L(null);if(J.state=o.audioMixing.states.IDLE,U="CREATE_BUFFERSOURCE_FAILED",L)return L(U);s.default.error("[".concat(o.streamId,"] "),U)}})}else o._handleAudioMixingInvalidStateError("_playEffect",h,L)},o._stopOneEffect=function(h,L){var M=o.audioMixing.sounds[h.soundId];return o._isSoundExists(h)?M.state===o.audioMixing.states.BUSY||M.state===o.audioMixing.states.PAUSED?(o._stopAudioMixingBufferSource(h),M.stopAt=Date.now(),M.state=o.audioMixing.states.IDLE,o.audioMixing.buffer[M.options.filePath]&&!M.options.cacheResource&&(s.default.debug("Recycled buffer ".concat(M.options.filePath)),delete o.audioMixing.buffer[M.options.filePath]),void(L&&L(null))):void o._handleAudioMixingInvalidStateError("_stopOneEffect",h,L):L("SOUND_NOT_EXISTS")},o._pauseOneEffect=function(h,L){var M=o.audioMixing.sounds[h.soundId];if(M.state===o.audioMixing.states.BUSY)return o._stopAudioMixingBufferSource(h)?(M.pauseAt=Date.now(),M.state=o.audioMixing.states.PAUSED,M.resumeAt?M.pauseOffset=M.pauseAt-M.resumeAt+M.resumeOffset:M.pauseOffset=M.pauseAt-M.startAt+M.startOffset,L&&L(null)):void o._handleAudioMixingNoSourceError("_pauseOneEffect",h,L);o._handleAudioMixingInvalidStateError("_pauseOneEffect",h,L)},o._resumeOneEffect=function(h,L){var M=o.audioMixing.sounds[h.soundId];if(M.state===o.audioMixing.states.PAUSED){var G={soundId:h.soundId,filePath:M.options.filePath,cycle:M.options.cycle,loop:M.options.loop,playTime:M.pauseOffset,replace:M.options.replace},Q=o._startAudioMixingBufferSource(G);if(!Q){var J="CREATE_BUFFERSOURCE_FAILED";return L(J),void s.default.error("[".concat(o.streamId,"] "),J)}M.source=Q,M.resumeAt=Date.now(),M.resumeOffset=M.pauseOffset,M.state=o.audioMixing.states.BUSY,M.pauseAt=null,M.pauseOffset=null,L(null)}else o._handleAudioMixingInvalidStateError("_resumeOneEffect",h,L)},o._getOneEffectDuration=function(h){var L=o.audioMixing.sounds[h.soundId];return L.options&&L.options.filePath&&o.audioMixing.buffer[L.options.filePath]?1e3*o.audioMixing.buffer[L.options.filePath].duration:null},o._getOneEffectCurrentPosition=function(h,L){var M=o.audioMixing.sounds[h.soundId];return M.state===o.audioMixing.states.PAUSED?M.pauseOffset%o._getOneEffectDuration(h):M.state===o.audioMixing.states.BUSY?M.resumeAt?(Date.now()-M.resumeAt+M.resumeOffset)%o._getOneEffectDuration(h):(Date.now()-M.startAt+M.startOffset)%o._getOneEffectDuration(h):void(L&&o._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",h))},o._setOneEffectPosition=function(h,L,M){var G=o.audioMixing.sounds[h.soundId];if(G.state===o.audioMixing.states.BUSY){if(!o._stopAudioMixingBufferSource(h))return void o._handleAudioMixingNoSourceError("_setOneEffectPosition",h,M);var Q={soundId:h.soundId,filePath:G.options.filePath,loop:G.options.loop,cycle:G.options.cycle,playTime:L},J=o._startAudioMixingBufferSource(Q);if(!J){var O="CREATE_BUFFERSOURCE_FAILED";return M&&M(O),void s.default.error("[".concat(o.streamId,"] "),O)}G.source=J,G.startAt=Date.now(),G.startOffset=L,G.resumeAt=null,G.resumeOffset=null,G.pauseOffset=null,G.pauseAt=null}else{if(G.state!==o.audioMixing.states.PAUSED)return void o._handleAudioMixingInvalidStateError("_setOneEffectPosition",h,M);G.pauseOffset=L}M&&M(null)},o.startAudioMixing=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:function(Y){if(Y)return L&&L(Y);o.dispatchEvent({type:"audioMixingPlayed"}),L&&L(null)},getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:h});Object(D.checkValidObject)(h,"options");var G=h.filePath,Q=h.cacheResource,J=h.cycle,O=h.loop,w=h.playTime,U=h.replace;Object(D.checkValidString)(G,"filePath",1,Object(a.getParameter)("FILEPATH_LENMAX"),!1),Object(D.checkValidNumber)(w,"playTime",0,1e8),!Object(D.isEmpty)(J)&&Object(D.checkValidNumber)(J,"cycle"),!Object(D.isEmpty)(O)&&Object(D.checkValidBoolean)(O,"loop"),!Object(D.isEmpty)(U)&&Object(D.checkValidBoolean)(U,"replace"),!Object(D.isEmpty)(Q)&&Object(D.checkValidBoolean)(Q,"cacheResource");var $=f()({soundId:-1},h);o._playOneEffect($,M)},o.stopAudioMixing=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:h,getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});o._stopOneEffect({soundId:-1},L)},o.pauseAudioMixing=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:h,getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return o._pauseOneEffect({soundId:-1},L)},o.resumeAudioMixing=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:function(M,G){if(M)return h&&h(M);o.dispatchEvent({type:"audioMixingPlayed"}),h&&h(null)},getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});o._resumeOneEffect({soundId:-1},L)},o.adjustAudioMixingVolume=function(h){var L=d.report.reportApiInvoke(o.sid,{getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});Object(D.checkValidNumber)(h,"volume",0,100),o.audioMixing.sounds[-1].volume=h,o._flushAudioMixingMuteStatus(),L()},o.getAudioMixingDuration=function(){var h=d.report.reportApiInvoke(o.sid,{getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),L=o._getOneEffectDuration({soundId:-1});return h(null,L),L},o.getAudioMixingCurrentPosition=function(){var h=d.report.reportApiInvoke(o.sid,{getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),L=o._getOneEffectCurrentPosition({soundId:-1},!0);return h(null,L),L},o.setAudioMixingPosition=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:L,options:arguments,tag:"tracer",getStates:o._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});Object(D.checkValidNumber)(h,"position",0,1e8),o._setOneEffectPosition({soundId:-1},h,M)},o.playEffect=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:function(O){if(O)return L&&L(O);o.dispatchEvent({type:"effectPlayed"}),L&&L(null)},name:"Stream.playEffect",options:h});Object(D.checkValidObject)(h,"options");var G=h.soundId,Q=h.filePath,J=h.cycle;Object(D.checkValidNumber)(G,"soundId",1,1e4),Object(D.checkValidString)(Q,"filePath",0,Object(a.getParameter)("FILEPATH_LENMAX"),!1),!Object(D.isEmpty)(J)&&Object(D.checkValidNumber)(J,"cycle"),o._playOneEffect(h,M)},o.stopEffect=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:L,getStates:o._getOneEffectStates({soundId:h}),name:"Stream.stopEffect"});Object(D.checkValidNumber)(h,"soundId",1,1e4),o._stopOneEffect({soundId:h},M)},o.stopAllEffects=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:h,name:"Stream.stopAllEffect"}),M=!1,G=0,Q=0,J=function(U){M||(U?(L(U),M=!0):G+=1,G===Q&&(L(null),M=!0))};for(var O in o.audioMixing.sounds){var w=o.audioMixing.sounds[O];w.soundId!==-1&&(w.state!==o.audioMixing.states.BUSY&&w.state!==o.audioMixing.states.PAUSED||(Q++,o._stopOneEffect({soundId:O},J)))}Q||L(null)},o.preloadEffect=function(h,L,M){var G=d.report.reportApiInvoke(o.sid,{callback:M,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});Object(D.checkValidNumber)(h,"soundId",1,1e4),Object(D.checkValidString)(L,"filePath",1,Object(a.getParameter)("FILEPATH_LENMAX"),!1),o._initSoundIfNotExists(h,L),o.audioMixing.buffer[L]?G(null):o.loadAudioBuffer(L,L,G)},o.unloadEffect=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:L,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});Object(D.checkValidNumber)(h,"soundId",1,1e4);var G=o.audioMixing.sounds[h];if(!G){var Q="SOUND_NOT_EXISTS";return s.default.error(Q,h),void M(Q)}var J=G.options?G.options.filePath:G.filePath;if(J)delete o.audioMixing.buffer[J],delete o.audioMixing.sounds[h],M(null);else{var O="SOUND_BUFFER_NOT_FOUND";s.default.error(O,h),M(O)}},o.pauseEffect=function(h,L){var M=d.report.reportApiInvoke(o.sid,{callback:L,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return o._pauseOneEffect({soundId:h},M)},o.pauseAllEffects=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:h,name:"Stream.pauseAllEffects"}),M=!1,G=0,Q=0,J=function(w){M||(w?(L(w),M=!0):G+=1,G===Q&&(L(null),M=!0))};for(var O in o.audioMixing.sounds)O!=="-1"&&o.audioMixing.sounds[O].state===o.audioMixing.states.BUSY&&(Q++,o._pauseOneEffect({soundId:O},J));Q||L(null)},o.resumeEffect=function(h,L){Object(D.checkValidNumber)(h,"soundId",1,1e4);var M=d.report.reportApiInvoke(o.sid,{callback:L,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return o._resumeOneEffect({soundId:h},M)},o.resumeAllEffects=function(h){var L=d.report.reportApiInvoke(o.sid,{callback:h,name:"Stream.resumeAllEffects"}),M=!1,G=0,Q=0,J=function(w){M||(w?(L(w),M=!0):G+=1,G===Q&&(L(null),M=!0))};for(var O in o.audioMixing.sounds)O!=="-1"&&o.audioMixing.sounds[O].state===o.audioMixing.states.PAUSED&&(Q++,o._resumeOneEffect({soundId:O},J));Q||L(null)},o.getEffectsVolume=function(){var h=[];for(var L in o.audioMixing.sounds){var M=o.audioMixing.sounds[L];M&&L!=="-1"&&h.push({soundId:parseInt(L),volume:M.volume})}return h},o.setEffectsVolume=function(h,L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:L});for(var G in Object(D.checkValidNumber)(h,"volume",0,100),o.audioMixing.defaultVolume=h,o.audioMixing.sounds){var Q=o.audioMixing.sounds[G];G!=="-1"&&(Q.volume=h)}o._flushAudioMixingMuteStatus(),M(null)},o.setVolumeOfEffect=function(h,L,M){var G=d.report.reportApiInvoke(o.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:M});Object(D.checkValidNumber)(h,"soundId",0,1e4),Object(D.checkValidNumber)(L,"volume",0,100),o._initSoundIfNotExists(h);var Q=o.audioMixing.sounds[h];Q.volume=L,o._flushAudioMixingMuteStatus(),G(null)}}(t),j.a.addVideoEffectCapability(t),function(o,h){o.videoConstraint={},h.cameraId&&(o.videoConstraint.deviceId={exact:h.cameraId}),h.facingMode&&(o.videoConstraint.facingMode=h.facingMode),o.videoSize&&(o.videoConstraint.width=o.videoSize[0],o.videoConstraint.height=o.videoSize[1]),Object(S.isLegacyChrome)()||(o.videoConstraint.frameRate=30),o.audioConstraint={},h.microphoneId&&(o.audioConstraint.deviceId={exact:h.microphoneId}),Object(S.isLegacyChrome)()||o.audioProcessing&&(o.audioProcessing.AGC!==void 0&&(Object(S.isFireFox)()?o.audioConstraint.autoGainControl=o.audioProcessing.AGC:Object(S.isChrome)()&&(o.audioConstraint.googAutoGainControl=o.audioProcessing.AGC,o.audioConstraint.googAutoGainControl2=o.audioProcessing.AGC)),o.audioProcessing.AEC!==void 0&&(o.audioConstraint.echoCancellation=o.audioProcessing.AEC),o.audioProcessing.ANS!==void 0&&(Object(S.isFireFox)()?o.audioConstraint.noiseSuppression=o.audioProcessing.ANS:Object(S.isChrome)()&&(o.audioConstraint.googNoiseSuppression=o.audioProcessing.ANS))),o.screenConstraint={},h.sourceId&&(o.screenConstraint.sourceId=h.sourceId),h.extensionId&&Object(S.isChrome)()?(o.screenConstraint.extensionId=h.extensionId,o.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:o.screenAttributes.width,maxHeight:o.screenAttributes.height,maxFrameRate:o.screenAttributes.maxFr,minFrameRate:o.screenAttributes.minFr}):(o.screenConstraint.mediaSource="screen",o.screenConstraint.width=o.screenAttributes.width,o.screenConstraint.height=o.screenAttributes.height,o.screenConstraint.frameRate={ideal:o.screenAttributes.maxFr,max:o.screenAttributes.maxFr}),h.mediaSource&&(o.screenConstraint.mediaSource=h.mediaSource),o.setVideoResolution=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(L instanceof Array)){var G=W(L+="");return G&&G.video?(o.videoConstraint=f()(o.videoConstraint,{width:{ideal:G.video.width},height:{ideal:G.video.height}}),h.attributes.resolution=G.attributes.resolution,(Q=o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks()[0])&&Q.applyConstraints?(s.default.debug("setVideoResolution applyConstraints",o.videoConstraint),Q.applyConstraints(o.videoConstraint).then(M).catch(M)):M(),!0):(M("NO_PROFILE_".concat(L)),!1)}var Q,J=L[0],O=L[1];o.videoConstraint=f()(o.videoConstraint,{width:{ideal:J},height:{ideal:O}}),h.attributes.resolution="".concat(J,"x").concat(O),(Q=o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks()[0])&&Q.applyConstraints?(s.default.debug("setVideoResolution applyConstraints",o.videoConstraint),j.a.disableVideoEffect(o).then(function(){return Q.applyConstraints(o.videoConstraint).then(M).catch(M)}).then(function(){return j.a.restoreVideoEffect(o)})):M()},o.setVideoFrameRate=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(S.isFireFox)())return M("FIREFOX_NOT_SUPPORTED"),!1;if(B()(L)==="object"&&L instanceof Array&&L.length>1){o.videoConstraint=f()(o.videoConstraint,{frameRate:L[0]}),o.attributes.minFrameRate=L[0],o.attributes.maxFrameRate=L[1];var G=o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks()[0];return G&&G.applyConstraints?(s.default.debug("setVideoFrameRate applyConstraints",o.videoConstraint),G.applyConstraints(o.videoConstraint).then(M).catch(M)):M(),!0}return M("INVALID_PARAM_".concat(JSON.stringify(L))),!1},o.setVideoBitRate=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return B()(L)==="object"&&L instanceof Array&&L.length>1?(h.attributes.minVideoBW=L[0],h.attributes.maxVideoBW=L[1],o.connectionSpec&&(o.connectionSpec.minVideoBW=L[0],o.connectionSpec.maxVideoBW=L[1]),o.pc&&o.pc.renegotiate&&o.pc.renegotiate(),M(),!0):(M("INVALID_PARAM_".concat(JSON.stringify(L))),!1)},o.setScreenBitRate=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return B()(L)==="object"&&L instanceof Array&&L.length>1?(o.screenAttributes.minVideoBW=L[0],o.screenAttributes.maxVideoBW=L[1],M(),!0):(M("INVALID_PARAM_".concat(JSON.stringify(L))),!1)},o.setScreenProfile=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Object(D.checkValidEnum)(L,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var G=W(L);return G&&G.screen?(o.screenConstraint.mandatory?(o.screenConstraint.mandatory.maxWidth=G.screen.width,o.screenConstraint.mandatory.maxHeight=G.screen.height,G.screen.frameRate&&G.screen.frameRate.min&&G.screen.frameRate.max&&(o.screenConstraint.mandatory.minFrameRate=G.screen.frameRate.min,o.screenConstraint.mandatory.maxFrameRate=G.screen.frameRate.max)):o.screenConstraint=f()(o.screenConstraint,G.screen),o.screenAttributes.width=G.screen.width,o.screenAttributes.height=G.screen.height,o.screenAttributes.minFr=G.screen.frameRate.min,o.screenAttributes.maxFr=G.screen.frameRate.max,M(),!0):(M("NO_SCREEN_PROFILE_".concat(JSON.stringify(L))),!1)},o.setVideoProfileCustom=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});o.setVideoResolution(L[0]),o.setVideoFrameRate([L[1],L[1]]),o.setVideoBitRate([L[2],L[2]]),M()},o.setVideoProfileCustomPlus=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});o.setVideoResolution([L.width,L.height]),h.attributes.resolution="".concat(L.width,"x").concat(L.height),o.setVideoFrameRate([L.framerate,L.framerate]),o.setVideoBitRate([L.bitrate,L.bitrate]),M()},o.setVideoProfile=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),G=W(L);if(!G){var Q="Invalid Profile ".concat(L);throw new Error(Q)}if(o.profile=L,G&&G.video){o.profile=G.profileName,o.videoConstraint=f()(o.videoConstraint,G.video),o.connectionSpec&&G.attributes.maxVideoBW&&(o.connectionSpec.minVideoBW=G.attributes.minVideoBW,o.connectionSpec.maxVideoBW=G.attributes.maxVideoBW),Object(S.isEdge)()&&(o.videoConstraint.frameRate.max=60),Object(S.isFireFox)()&&(o.videoConstraint.frameRate=30),h.attributes=f()(h.attributes,G.attributes),o.pc&&o.pc.renegotiate&&o.pc.renegotiate();var J=o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks()[0];return J&&J.applyConstraints?(s.default.debug("setVideoProfile applyConstraints",o.videoConstraint),j.a.disableVideoEffect(o).then(function(){return J.applyConstraints(o.videoConstraint)}).then(function(){return j.a.restoreVideoEffect(o)}).then(function(O){return new Promise(function(w,U){M(O),setTimeout(function(){Object(u.vsResHack)(o.stream,function($,Y){o.videoWidth=$,o.videoHeight=Y,w()},function($){s.default.warning("[".concat(o.streamId,"] vsResHack failed: "),$),U()})},2500)})}).catch(M)):M(),!0}return M("INVALID_VIDEO_PROFILE_".concat(L)),!1},o.setAudioProfile=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Object(D.checkValidEnum)(L,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),o.audioProfile=L;var G=p(L);return o.highQuality=G.highQuality,o.stereo=G.stereo,o.speech=G.speech,o.lowQuality=G.lowQuality,o.stereo&&Object(S.isChrome)()&&(o.audioConstraint.googAutoGainControl=!1,o.audioConstraint.googAutoGainControl2=!1,o.audioConstraint.echoCancellation=!1,o.audioConstraint.googNoiseSuppression=!1),M(),!0},o.setVideoEncoderConfiguration=function(L){Object(D.checkValidObject)(L,"config");var M=d.report.reportApiInvoke(o.sid,{name:"Stream.setVideoEncoderConfiguration",options:L,tag:"tracer"});L.resolution&&(Object(D.checkValidNumber)(L.resolution.width,"config.resolution.width"),Object(D.checkValidNumber)(L.resolution.height,"config.resolution.height"),o.setVideoResolution([L.resolution.width,L.resolution.height])),L.frameRate&&(Object(D.checkValidNumber)(L.frameRate.min,"config.frameRate.min"),Object(D.checkValidNumber)(L.frameRate.max,"config.frameRate.max"),o.setVideoFrameRate([L.frameRate.min,L.frameRate.max])),L.bitrate&&(Object(D.checkValidNumber)(L.bitrate.min,"config.bitrate.min",1,1e7),Object(D.checkValidNumber)(L.bitrate.max,"config.bitrate.max",1,1e7),o.setVideoBitRate([L.bitrate.min,L.bitrate.max])),M()},o.getSupportedProfile=function(L){var M=d.report.reportApiInvoke(o.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:L});if(!o.local){var G="ONLY_LOCAL_STREAM_SUPPORTED";return s.default.error(G),M(G)}if(!o.stream)return G="STREAM_NOT_INIT",s.default.error(G),M(G);if(!o.stream.getVideoTracks)return G="TRACK_NOT_SUPPORT",s.default.error(G),M(G);var Q=o.stream.getVideoTracks()[0];if(!Q)return G="NO_VIDEO_TRACK_FOUND",s.default.error(G),M(G);if(!Q.getCapabilities)return G="GETCAPABILITY_NOT_SUPPORT",s.default.error(G),M(G);var J=Q.getCapabilities(),O=k(J);return M(null,O)}}(t,l),t.getId=function(){return t.streamId},t.getUserId=function(){return t.userId},t.checkDualStreamEnabled=function(){return Object(a.getParameter)("DUALSTREAM_OPERATION_CHECK")&&t.isDualStream?(s.default.error("Operation not permitted: ".concat("DUAL_STREAM_ENABLED")),"DUAL_STREAM_ENABLED"):!1},t.setUserId=function(o){var h=d.report.reportApiInvoke(t.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});t.userId&&s.default.warning("[".concat(t.streamId,"] Stream.userId ").concat(t.userId," => ").concat(o)),t.userId=o,h()},t.getAttributes=function(){return l.screen?t.screenAttributes:l.attributes},t.hasAudio=function(){return!!t.audio},t.hasVideo=function(){return!!t.video},t.hasScreen=function(){return!!t.screen},t.hasScreenAudio=function(){return!!t.screenAudio},t.isVideoOn=function(){return(t.hasVideo()||t.hasScreen())&&!t.userMuteVideo},t.isAudioOn=function(){return t.hasAudio()&&!t.userMuteAudio},t.init=function(o,h){var L=d.report.reportApiInvoke(t.sid,{callback:function(J,O){if(J)return h&&h(J);o&&o(O)},name:"Stream.init",options:arguments,tag:"tracer"}),M=(new Date().getTime(),arguments[2]);if(M===void 0&&(M=2),t.initialized===!0)return L({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(t.local!==!0)return L({type:"warning",msg:"STREAM_NOT_LOCAL"});var G=Math.random().toString().slice(3);t._streamInitID=G,t.videoSource?t.videoName="videoSource":t.video&&(t.videoName=R.a.searchDeviceNameById(l.cameraId)||"default"),t.audioSource?t.audioName="audioSource":t.audio&&(t.audioName=R.a.searchDeviceNameById(l.microphoneId)||"default"),t.screen&&(t.screenName=l.extensionId||"default");try{if(l.audio||l.video||l.screen||l.screenAudio||l.videoSource||l.audioSource){s.default.debug("[".concat(t.streamId,"] Requested access to local media"));var Q={streamId:t.streamId};l.videoSource?Q.videoSource=l.videoSource:l.screen?Q.screen=t.screenConstraint:l.video&&(Q.video=t.videoConstraint),l.audioSource?Q.audioSource=l.audioSource:l.screenAudio?Q.screenAudio=l.screenAudio:l.audio&&(Q.audio=t.audioConstraint),Object(v.b)(Q,function(J){if(Q.screenAudio&&!J.getAudioTracks()[0]&&s.default.warning("[".concat(t.streamId,"] Audio sharing is not selected")),Q.screen&&s.default.debug("[".concat(t.streamId,"] User has granted access to screen sharing")),(Q.video||Q.audio)&&s.default.debug("[".concat(t.streamId,"] User has granted access to local media")),t._streamInitID===null){J.getTracks().forEach(function(w){w.stop()});var O={type:"error",msg:"STREAM_IS_CLOSED",info:"stream is closed and cannot be initialized"};return s.default.error(t.streamId,O.info),void L(O)}if(t._streamInitID!==G)return J.getTracks().forEach(function(w){w.stop()}),O={type:"error",msg:"ABORT_OTHER_INIT",info:"stream initialization is aborted because of another stream.init"},s.default.error(t.streamId,O.info),void L(O);t.dispatchEvent({type:"accessAllowed"}),t.stream=J,t.initialized=!0,t.reloadDeviceName(),t.hasVideo()&&Object(u.vsResHack)(J,function(w,U){t.videoWidth=w,t.videoHeight=U},function(w){s.default.warning("[".concat(t.streamId,"] vsResHack failed: "),w)}),l.screen&&t.stream&&t.stream.getVideoTracks()[0]&&(t.stream.getVideoTracks()[0].onended=function(){t.dispatchEvent({type:"stopScreenSharing"})}),t.stream&&t.stream.getTracks&&t.stream.getTracks().forEach(function(w){w&&!w.onended&&(w.onended=x),w.kind==="video"&&l.optimizationMode&&(w.contentHint=l.optimizationMode,w.contentHint===l.optimizationMode&&s.default.debug("[".concat(t.streamId,"] set content hint to"),l.optimizationMode))}),L()},function(J){var O={type:"error",info:null};switch(J&&(O.msg=J.name||J.code||J,J.message&&(O.info=J.message),J.code&&(O.info?O.info+=". "+J.code:O.info=" "+J.code),J.constraint&&(O.info?O.info+=". Constraint: "+J.constraint:O.info="constraint: "+J.constraint)),O.msg){case"Starting video failed":case"TrackStartError":if(t.videoConstraint&&(delete t.videoConstraint.width,delete t.videoConstraint.height),M>0)return void setTimeout(function(){t.init(function(U){return L(U)},L,M-1)},1);O.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":O.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":O.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":O.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":O.msg="CONSTRAINT_NOT_SATISFIED";break;default:O.msg||(O.msg="UNDEFINED")}var w="Media access ".concat(O.msg).concat(O.info?": "+O.info:"");s.default.error("[".concat(t.streamId,"] "),w),L(O)})}else L({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(J){s.default.error("[".concat(t.streamId,"] Stream init: "),J),L({type:"error",msg:J.message||J})}},t.reloadDeviceName=function(){if(t.stream){if(t.stream.getVideoTracks){var o=t.stream.getVideoTracks()[0];o&&o.label&&(t.videoName=o.label)}if(t.stream.getAudioTracks){var h=t.stream.getAudioTracks()[0];h&&h.label&&(t.audioName=h.label)}}},t.close=function(){var o=d.report.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(s.default.debug("[".concat(t.streamId,"] Close stream with id"),t.streamId),t._originStream)try{t._originStream.getTracks().map(function(G){return G.stop()})}catch{}if(t.stream!==void 0){var h=t.stream.getTracks();for(var L in h)h.hasOwnProperty(L)&&(h[L].stop(),h[L].onended=null);!t.isLowStream&&t.local?j.a.disableVideoEffect(t).then(function(){t.stream=void 0}):(t.stream&&t.stream.clean&&t.stream.clean(),t.stream=void 0)}if(t._originStream){h=t._originStream.getTracks();for(var L in h)h.hasOwnProperty(L)&&(h[L].stop(),h[L].onended=null);!t.isLowStream&&t.local?j.a.disableVideoEffect(t).then(function(){t._originStream=void 0}):(t._originStream&&t._originStream.clean&&t._originStream.clean(),t._originStream=void 0)}if(Object(S.isSafari)()&&t.pc&&t.pc.peerConnection&&t.pc.peerConnection.removeTrack&&t.pc.peerConnection.getSenders){var M=t.pc.peerConnection.getSenders();M.forEach(function(G){G&&(s.default.debug("[".concat(t.streamId,"] Remove Track"),G),t.pc.peerConnection.removeTrack(G))})}t.local&&(t.initialized=!1),t._streamInitID=null,t._onAudioMute=void 0,t._onAudioUnmute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,t.lowStream&&t.lowStream.close(),t.player&&t.player.video&&t.player.video.srcObject&&(t.player.video.srcObject=null),t.player&&t.player.audio&&t.player.audio.srcObject&&(t.player.audio.srcObject=null),o()},t.enableAudio=function(){var o,h=d.report.reportApiInvoke(t.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return s.default.deprecate("[".concat(t.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),t.userMuteAudio||s.default.warning("[".concat(t.streamId,"] User already enableAudio")),t.userMuteAudio=!1,h(null,o=!t.peerMuteAudio&&t._unmuteAudio()),o},t.disableAudio=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});s.default.deprecate("[".concat(t.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),t.userMuteAudio&&s.default.warning("[".concat(t.streamId,"] User already disableAudio")),t.userMuteAudio=!0;var h=t._muteAudio();return o(null,h),h},t.enableVideo=function(){var o,h=d.report.reportApiInvoke(t.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return s.default.deprecate("[".concat(t.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),t.userMuteVideo||s.default.warning("[".concat(t.streamId,"] User already enableVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),h(null,o=!t.peerMuteVideo&&t._unmuteVideo()),o},t.disableVideo=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});s.default.deprecate("[".concat(t.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),t.userMuteVideo&&s.default.warning("[".concat(t.streamId,"] User already disableVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var h=t._muteVideo();return o(null,h),h},t.unmuteAudio=function(){var o,h=d.report.reportApiInvoke(t.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return t.userMuteAudio||s.default.warning("[".concat(t.streamId,"] User already unmuteAudio")),t.userMuteAudio=!1,h(null,o=!t.peerMuteAudio&&t._unmuteAudio()),o},t.muteAudio=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});t.userMuteAudio&&s.default.warning("[".concat(t.streamId,"] User already muteAudio")),t.userMuteAudio=!0;var h=t._muteAudio();return o(null,h),h},t.unmuteVideo=function(){var o,h=d.report.reportApiInvoke(t.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return t.userMuteVideo||s.default.warning("[".concat(t.streamId,"] User already unmuteVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),h(null,o=!t.peerMuteVideo&&t._unmuteVideo()),o},t.muteVideo=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});t.userMuteVideo&&s.default.warning("[".concat(t.streamId,"] User already muteVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var h=t._muteVideo();return o(null,h),h},t._unmuteAudio=function(){return s.default.debug("[".concat(t.streamId,"] Unmuted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!1),!(!t.hasAudio()||!t.initialized||t.stream===void 0||t.stream.getAudioTracks()[0].enabled===!0)&&(t._onAudioUnmute&&t._onAudioUnmute(),t.pc&&(t.pc.isAudioMute=!1),t.stream.getAudioTracks()[0].enabled=!0,!0)},t._isAudioMuted=function(){if(t.stream&&t.hasAudio()){var o=t.stream.getAudioTracks();return o.length>0&&!o[0].enabled}return!1},t._isVideoMuted=function(){if(t.stream&&t.hasVideo()){var o=t.stream.getVideoTracks();return o.length>0&&!o[0].enabled}return!1},t._muteAudio=function(){return s.default.debug("[".concat(t.streamId,"] Muted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!0),!!(t.hasAudio()&&t.initialized&&t.stream!==void 0&&t.stream.getAudioTracks()[0].enabled)&&(t._onAudioMute&&t._onAudioMute(),t.pc&&(t.pc.isAudioMute=!0),t.stream.getAudioTracks()[0].enabled=!1,t.sid&&d.report.audioSendingStopped(t.sid,{succ:!0,reason:"muteAudio"}),!0)},t._unmuteVideo=function(){return s.default.debug("[".concat(t.streamId,"] Unmuted video stream with id"),t.streamId),!(!t.initialized||t.stream===void 0||!t.stream.getVideoTracks().length||t.stream.getVideoTracks()[0].enabled===!0)&&(t._onVideoUnmute&&t._onVideoUnmute(),t.pc&&(t.pc.isVideoMute=!1),t.stream.getVideoTracks()[0].enabled=!0,t.lowStream&&t.lowStream._unmuteVideo(),!0)},t._muteVideo=function(){return s.default.debug("[".concat(t.streamId,"] Muted video stream with id"),t.streamId),!!(t.initialized&&t.stream!==void 0&&t.stream.getVideoTracks().length&&t.stream.getVideoTracks()[0].enabled)&&(t._onVideoMute&&t._onVideoMute(),t.pc&&(t.pc.isVideoMute=!0),t.stream.getVideoTracks()[0].enabled=!1,t.lowStream&&t.lowStream._muteVideo(),t.sid&&d.report.videoSendingStopped(t.sid,{succ:!0,reason:"muteVideo"}),!0)},t.addTrack=function(o){if(t.audio&&o.kind==="audio")s.default.warning("already added audio track");else if(t.video&&o.kind==="video")s.default.warning("already added video track");else{var h=d.report.reportApiInvoke(t.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(t.pc&&t.pc.addTrack(o,t.stream),o.kind=="audio"){t._cleanupAudioMixing();var L=new MediaStream;t.userMuteAudio&&(o.enabled=!1),L.addTrack(o);var M=t.stream.getVideoTracks()[0];M&&L.addTrack(M),t.audio=!0,l.audio=!0,t.stream=L,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream)}else t.userMuteVideo&&(o.enabled=!1),t.stream.addTrack(o),t.video=!0,l.video=!0;o.onended||(o.onended=x),h()}},t.removeTrack=function(o){if(o)if(t.audio||o.kind!=="audio")if(t.video||o.kind!=="video"){var h=d.report.reportApiInvoke(t.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});t.pc&&t.pc.removeTrack(o,t.stream),t.stream.removeTrack(o),t._cleanupAudioMixing(),o.kind==="audio"?(t.audio=!1,l.audio=!1):(t.video=!1,l.video=!1),t.audioLevelHelper=null,o.readyState=="live"&&(o.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(o.kind," Stopped"))),h()}else s.default.warning("already removed video track");else s.default.warning("already removed audio track");else s.default.warning("track doesn't exist.")},t.setAudioOutput=function(o,h,L){var M=d.report.reportApiInvoke(t.sid,{callback:function(G,Q){if(G)return L&&L(G);h&&h(Q)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Object(D.isValidString)(o,1,255)?(t.audioOutput=o,t.player?void t.player.setAudioOutput(o,function(){return M()},M):M()):(s.default.error("[".concat(t.streamId,"] setAudioOutput Invalid Parameter"),o),M(r.default.INVALID_PARAMETER))},t.play=function(o,h,L){typeof h=="function"&&(L=h,h=null),s.default.debug("[".concat(t.streamId,"] play()."),o,h);var M=d.report.reportApiInvoke(t.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:L});if(Object(D.checkValidString)(o,"elementID"),Object(D.isEmpty)(h)||(Object(D.isEmpty)(h.fit)||Object(D.checkValidEnum)(h.fit,"fit",["cover","contain"]),Object(D.isEmpty)(h.muted)||Object(D.checkValidBoolean)(h.muted,"muted")),t.player)s.default.warning("[".concat(t.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),t.resume().then(function(){M(null)}).catch(M);else{t.elementID=o,t.playOptions=h,!t.local||t.video||t.screen?(t.player=new C({id:t.getId(),stream:t,elementID:o,options:h}),t.local&&j.a.applyEffectInPlayer(t)):t.hasAudio()&&(t.player=new C({id:t.getId(),stream:t,elementID:o,options:h}));var G={video:null,audio:null},Q=function J(O){if(G[O.mediaType]=O,G.video&&G.audio)if(t.removeEventListener("player-status-change",J),G.video.isErrorState||G.audio.isErrorState){var w=G.video.isErrorState?G.video:G.audio;M({isErrorState:!0,status:w.status,reason:w.reason,video:G.video,audio:G.audio})}else G.video.status==="aborted"&&G.audio.status==="aborted"?M({status:"aborted",reason:"stop",video:G.video,audio:G.audio}):M(null)};t.on("player-status-change",Q),t.audioOutput&&t.player.setAudioOutput(t.audioOutput),t.audioLevel!==void 0&&t.player.setAudioVolume(t.audioLevel),t._flushAudioMixingMuteStatus(!1)}},t.stop=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});s.default.debug("[".concat(t.streamId,"] Stop stream player with id "),t.streamId),t.player?(j.a.removeEffectFromLocalPlayer(t),t.player.destroy(),delete t.player):s.default.error("[".concat(t.streamId,"] Stream.stop(): Stream is not playing")),t._flushAudioMixingMuteStatus(!0),o()},t.isPlaying=function(){return!!t.player},t.isPaused=function(){return!!t.player&&(!!(t.player.video&&t.player.video.paused&&t.player.mediaElemExists(t.player.video))||!!(t.player.audio&&t.player.audio.paused&&t.player.mediaElemExists(t.player.audio)))},t.resume=function(){var o,h;return t.player?(t.player.video&&t.player.video.play&&(o=t.player.video.play()),o=o||Promise.resolve(),t.player.audio&&t.player.audio.play&&(h=t.player.audio.play()),h=h||Promise.resolve(),Promise.all([o,h])):Promise.reject("NO_PLAYER_FOUND")},t.getVideoTrack=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getVideoTracks){var h=t.stream.getVideoTracks()[0];if(h)return s.default.info("[".concat(t.streamId,"] getVideoTrack"),h),o(),h}s.default.info("[".concat(t.streamId,"] getVideoTrack None")),o(null,"getVideoTrack None")},t.getAudioTrack=function(){var o=d.report.reportApiInvoke(t.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getAudioTracks){var h=t.stream.getAudioTracks()[0];if(h)return s.default.info("[".concat(t.streamId,"] getAudioTracks"),h),o(),h}s.default.info("[".concat(t.streamId,"] getAudioTracks None")),o(null,"getAudioTracks None")},t._hasVideoTracks=function(){return!!(t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0])},t._hasAudioTracks=function(){return!!(t.stream&&t.stream.getAudioTracks&&t.stream.getAudioTracks()[0])},t._replaceMediaStreamTrack=function(o,h,L){if(t.stream){if(o.kind=="video"){if(G=t.stream.getVideoTracks()[0])return t.userMuteVideo&&(o.enabled=!1),t.stream.removeTrack(G),t.stream.addTrack(o),s.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(o.kind," SUCCESS")),G.readyState=="live"&&(G.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(G.kind," Stopped"))),h&&h();var M="MEDIASTREAM_TRACK_NOT_FOUND";return s.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(o.kind)),L(M)}if(o.kind=="audio"){var G;if(G=t.stream.getAudioTracks()[0]){t.userMuteAudio&&(o.enabled=!1);var Q=new MediaStream;Q.addTrack(o);var J=t.stream&&t.stream.getVideoTracks()[0];return J&&Q.addTrack(J),t.stream=Q,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream),s.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack SUCCESS")),G.readyState=="live"&&(G.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(G.kind," Stopped"))),h&&h()}return M="MEDIASTREAM_TRACK_NOT_FOUND",s.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(o.kind)),L(M)}return M="INVALID_TRACK_TYPE",s.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(M," ").concat(o.kind)),L&&L(M)}return M="NO_STREAM_FOUND",s.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(M)),L&&L(M)},t.replaceTrack=function(o,h,L){var M=d.report.reportApiInvoke(t.sid,{callback:function(G,Q){if(G)return L&&L(G);h&&h(Q)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return o&&o.kind?(t._cleanupAudioMixing(),o.onended||(o.onended=x),t.pc&&t.pc.hasSender&&t.pc.hasSender(o.kind)?void t.pc.replaceTrack(o,function(){return s.default.debug("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(o.kind," SUCCESS")),t._replaceMediaStreamTrack(o,function(G){return M(null,G)},M)},function(G){return s.default.error("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(o.kind," Failed ").concat(G)),M(G)}):t._replaceMediaStreamTrack(o,function(G){return M(null,G)},M)):M("INVALID_TRACK")},t.setAudioVolume=function(o){var h=d.report.reportApiInvoke(t.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});Object(D.checkValidNumber)(o,"level",0,100),t.audioLevel=o,t.player&&t.player.setAudioVolume(o),h()},t.getStats=function(o,h,L){var M=[];M.push(t._getPCStats(L)),M.push(new Promise(function(G){var Q={};t.pc&&t.pc.isSubscriber?window.navigator.userAgent.match("Firefox")!==null&&(Object(b.b)(Q,"videoReceiveResolutionHeight",t.videoHeight),Object(b.b)(Q,"videoReceiveResolutionWidth",t.videoWidth)):t.pc&&!t.pc.isSubscriber&&((Object(S.isSafari)()||Object(S.isFireFox)())&&(Object(b.b)(Q,"videoSendResolutionHeight",t.videoHeight),Object(b.b)(Q,"videoSendResolutionWidth",t.videoWidth)),(Object(S.isSafari)()||Object(S.isFireFox)())&&t.uplinkStats&&Object(b.b)(Q,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),G(Q)})),M.push(new Promise(function(G){var Q={};return t.traffic_stats&&t.pc&&t.pc.isSubscriber?(Object(b.b)(Q,"accessDelay",t.traffic_stats.access_delay),Object(b.b)(Q,"endToEndDelay",t.traffic_stats.e2e_delay),Object(b.b)(Q,"videoReceiveDelay",t.traffic_stats.video_delay),Object(b.b)(Q,"audioReceiveDelay",t.traffic_stats.audio_delay)):t.traffic_stats&&t.pc&&!t.pc.isSubscriber&&Object(b.b)(Q,"accessDelay",t.traffic_stats.access_delay),G(Q)})),Promise.all(M).then(function(G){for(var Q={},J=G.length-1;J>=0;J--){var O=G[J];f()(Q,O)}o&&setTimeout(o.bind(t,Q),0)}).catch(function(G){h&&setTimeout(h.bind(t,G),0)})},t._getPCStats=function(o){return new Promise(function(h,L){if(!t.pc||t.pc.state!=="established"||!t.pc.getStats)return L("PEER_CONNECTION_NOT_ESTABLISHED");t.pc.getStats(function(M){if(!t.pc||t.pc.state!=="established"||!t.pc.getStats)return L("PEER_CONNECTION_STATE_CHANGE");var G=t.pc.isSubscriber?Object(b.c)(M):Object(b.a)(M);return h(G)},o)}).then(function(h){return t.pc.isSubscriber?(Object(S.isFireFox)()||Object(S.isSafari)())&&(h.videoReceiveResolutionHeight&&h.videoReceiveResolutionHeight!=="0"||h.videoReceiveResolutionWidth&&h.videoReceiveResolutionWidth!=="0"||(Object(b.b)(h,"videoReceiveResolutionHeight",t.videoHeight),Object(b.b)(h,"videoReceiveResolutionWidth",t.videoWidth))):((Object(S.isSafari)()||Object(S.isFireFox)())&&(h.videoSendResolutionHeight&&h.videoSendResolutionHeight!=="0"||h.videoSendResolutionWidth&&h.videoSendResolutionWidth!=="0"||(Object(b.b)(h,"videoSendResolutionHeight",t.videoHeight),Object(b.b)(h,"videoSendResolutionWidth",t.videoWidth))),(Object(S.isSafari)()||Object(S.isFireFox)())&&t.uplinkStats&&Object(b.b)(h,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),Promise.resolve(h)})},t.getAudioLevel=function(){if(t.audioLevelHelper)return t.audioLevelHelper.getAudioLevel();if(t.stream){if(t.stream.getAudioTracks().length!==0)return t.audioLevelHelper=new u.audioLevelHelper(t.stream),t.audioLevelHelper.getAudioLevel();s.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else s.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no stream exist"))},t.setVideoProfile("480p_1"),t._switchVideoDevice=function(o,h,L){if(o===t.cameraId)return h&&h();var M={video:f()({},t.videoConstraint,{deviceId:{exact:o}}),audio:!1};s.default.debug("[".concat(t.streamId,"] ").concat(M)),Object(v.b)(M,function(G){try{var Q=function(){t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.cameraId=o,t.videoConstraint.deviceId={exact:o},t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),j.a.restoreVideoEffect(t).then(function(){h&&h()})};j.a.disableVideoEffect(t).then(function(){var J=!1;window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function"&&(J=!0),J?t.replaceTrack(G.getVideoTracks()[0],Q,L):(t.removeTrack(t.stream.getVideoTracks()[0]),t.addTrack(G.getVideoTracks()[0]),Q())})}catch(J){return L&&L(J)}},function(G){return L&&L(G)})},t._switchAudioDevice=function(o,h,L){if(o===t.microphoneId)return h&&h();var M={video:!1,audio:f()({},t.audioConstraint,{deviceId:{exact:o}})};s.default.debug("[".concat(t.streamId,"] "),M);var G=t.stream.getAudioTracks()[0];G&&G.stop(),Object(v.b)(M,function(Q){var J=function(){t._cleanupAudioMixing(),t.userMuteAudio&&(t.stream.getAudioTracks()[0].enabled=!1),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.microphoneId=o,t.audioConstraint.deviceId={exact:o},h&&h()};try{var O=!1;window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function"&&(O=!0),O?t.replaceTrack(Q.getAudioTracks()[0],J,L):(t.removeTrack(t.stream.getAudioTracks()[0]),t.addTrack(Q.getAudioTracks()[0]),J())}catch(w){return L&&L(w)}},function(Q){return L&&L(Q)})},t.switchDevice=function(o,h,L,M){var G=d.report.reportApiInvoke(t.sid,{callback:function(Y,Z){if(Y)return M&&M(Y);L&&L(Z)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Object(D.checkValidString)(h,"deviceId");var Q=function(){return t.inSwitchDevice=!1,G()},J=function(Y){t.inSwitchDevice=!1,s.default.error("[".concat(t.streamId,"] "),Y),G(Y)};if(t.inSwitchDevice)return G("Device switch is in process.");if(t.inSwitchDevice=!0,!t.local)return J("Only the local stream can switch the device.");if(t.screen&&o==="video")return J("The device cannot be switched during screen-sharing.");if(!t.video&&o==="video")return J("Video track not exist.");if(!t.audio&&o==="audio")return J("Audio track not exist.");if(t.videoSource||t.audioSource)return J("The device cannot be switched when using videoSource or audioSource.");var O=!1;for(var w in t.audioMixing.sounds){var U=t.audioMixing.sounds[w];if(U.state!==t.audioMixing.states.IDLE){O=!0;break}}var $=t.audioMixing.audioContextInited;if($&&O)return J("The device cannot be switched when using audio Mixing.");R.a.getDeviceById(h,function(){if(o==="video")t._switchVideoDevice(h,Q,J);else{if(o!=="audio")return J("Invalid type.");t._switchAudioDevice(h,Q,J)}},function(){return J("The device does not exist.")})},t},N=function(l){var t=d.report.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer",getStates:function(){return{audioTrackEnable:l&&l.audioSource?l.audioSource.enabled:null,videoTrackEnable:l&&l.videoSource?l.videoSource.enabled:null}}});Object(D.checkValidObject)(l,"StreamSpec");var x=l.streamID,o=l.audio,h=l.video,L=l.screen,M=l.screenAudio,G=(l.audioSource,l.videoSource,l.cameraId),Q=l.facingMode,J=l.microphoneId,O=l.mirror,w=l.extensionId,U=l.mediaSource,$=l.audioProcessing,Y=l.optimizationMode;if(!Object(D.isEmpty)(x)&&!Object(u.is32Uint)(x)&&!Object(D.isValidString)(x,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Object(D.checkValidBoolean)(o,"audio"),Object(D.checkValidBoolean)(h,"video"),Object(D.isEmpty)(L)||Object(D.checkValidBoolean)(L,"screen"),Object(D.isEmpty)(M)||Object(D.checkValidBoolean)(M,"screenAudio"),Object(D.isEmpty)(G)||Object(D.checkValidString)(G,"cameraId",0,255,!1),Object(D.isEmpty)(Q)||Object(D.checkValidEnum)(Q,"facingMode",["user","environment","left","right"]),Object(D.isEmpty)(J)||Object(D.checkValidString)(J,"microphoneId",0,255,!1),Object(D.isEmpty)(w)||Object(D.checkValidString)(w,"extensionId"),Object(D.isEmpty)(U)||Object(D.checkValidEnum)(U,"mediaSource",["screen","application","window"]),Object(D.isEmpty)(O)||Object(D.checkValidBoolean)(O,"mirror"),!Object(D.isEmpty)($)){var Z=$.AGC,re=$.AEC,ce=$.ANS;Object(D.isEmpty)(Z)||Object(D.checkValidBoolean)(Z,"AGC"),Object(D.isEmpty)(re)||Object(D.checkValidBoolean)(re,"AEC"),Object(D.isEmpty)(ce)||Object(D.checkValidBoolean)(ce,"ANS")}Object(D.isEmpty)(Y)||Object(D.checkValidEnum)(Y,"optimizationMode",["detail","motion"]),s.default.debug("Create stream"),M===!0&&o===!0&&s.default.warning("Do not set both 'screenAudio' and 'audio' to true at the same time"),l.screen&&!Y&&(l.optimizationMode="detail");var ue=n(l);return t(),ue}},function(z,H,I){I.d(H,"a",function(){return W}),I.d(H,"b",function(){return k});var E=I(5),f=I(7),S=I.n(f),g=I(12),y=I.n(g),s=I(17),m=I.n(s),r=I(0),a=I(15),d=I(2);function T(p){if(typeof Symbol=="undefined"||p[Symbol.iterator]==null){if(Array.isArray(p)||(p=function(h,L){if(!!h){if(typeof h=="string")return C(h,L);var M=Object.prototype.toString.call(h).slice(8,-1);if(M==="Object"&&h.constructor&&(M=h.constructor.name),M==="Map"||M==="Set")return Array.from(M);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return C(h,L)}}(p))){var n=0,N=function(){};return{s:N,n:function(){return n>=p.length?{done:!0}:{done:!1,value:p[n++]}},e:function(h){throw h},f:N}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,t,x=!0,o=!1;return{s:function(){l=p[Symbol.iterator]()},n:function(){var h=l.next();return x=h.done,h},e:function(h){o=!0,t=h},f:function(){try{x||l.return==null||l.return()}finally{if(o)throw t}}}}function C(p,n){(n==null||n>p.length)&&(n=p.length);for(var N=0,l=new Array(n);N<n;N++)l[N]=p[N];return l}var v=function(p){var n={},N=a.RTCPeerConnection;n.uid=p.uid,n.isVideoMute=p.isVideoMute,n.isAudioMute=p.isAudioMute,n.isSubscriber=p.isSubscriber,n.clientId=p.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[]};var l={id:"outbound_audio_ssrc_send",type:"ssrc",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},t={id:"outbound_video_ssrc_send",type:"ssrc",mediaType:"",googCodecName:p.codec?p.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},x={id:"inbound_audio_ssrc_recv",type:"ssrc",mediaType:"",googCodecName:"opus",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},o={id:"inbound_video_ssrc_recv",type:"ssrc",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesReceived:"0",googFramesDecoded:"0"},h={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"};n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},p.iceServers instanceof Array?n.pc_config.iceServers=p.iceServers:(p.stunServerUrl&&(p.stunServerUrl instanceof Array?p.stunServerUrl.map(function(O){typeof O=="string"&&O!==""&&n.pc_config.iceServers.push({url:O})}):typeof p.stunServerUrl=="string"&&p.stunServerUrl!==""&&n.pc_config.iceServers.push({url:p.stunServerUrl})),p.turnServers&&(p.turnServers instanceof Array?p.turnServers.map(function(O){O.udpport&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.udpport+"?transport=udp"}),typeof O.tcpport=="string"&&O.tcpport!==""&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.tcpport+"?transport=tcp"}),O.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):r.default.error("[".concat(n.clientId,"] turnServers is not a array")))),p.audio===void 0&&(p.audio=!0),p.video===void 0&&(p.video=!0),n.mediaConstraints={mandatory:{OfferToReceiveVideo:p.video,OfferToReceiveAudio:p.audio}},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(d.getParameter)("PLAN"),n.peerConnection=new N(n.pc_config,n.con)}catch{delete n.pc_config.sdpSemantics,n.peerConnection=new N(n.pc_config,n.con);var L=n.peerConnection.getConfiguration();L.sdpSemantics&&Object(d.setParameter)("PLAN",L.sdpSemantics)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,r.default.debug("[".concat(n.clientId,"]Candidates collected: ").concat(n.iceCandidateCount)),n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(d.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(O){var w,U,$,Y;U=(w=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),$=w.match(/a=candidate:.+typ\shost.+\r\n/),Y=w.match(/a=candidate:.+typ\srelay.+\r\n/),U===null&&$===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var M=function(O){return O=O.replace(`a=x-google-flag:conference\r
`,"")},G=function(O){var w,U;if((w=O.match(/m=video.*\r\n/))&&p.minVideoBW&&p.maxVideoBW){U=w[0]+"b=AS:"+p.maxVideoBW+`\r
`;var $=0,Y=0;p.codec==="h264"?($=O.search(/a=rtpmap:(\d+) H264\/90000\r\n/),Y=O.search(/H264\/90000\r\n/)):p.codec==="vp8"?($=O.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),Y=O.search(/VP8\/90000\r\n/)):p.codec==="vp9"&&($=O.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),Y=O.search(/VP9\/90000\r\n/)),$!==-1&&Y!==-1&&Y-$>10&&(U=U+"a=fmtp:"+O.slice($+9,Y-1)+" x-google-min-bitrate="+p.minVideoBW+`\r
`),O=(O=(O=O.replace(w[0],U)).replace("a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f","a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f")).replace("a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"),r.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+p.minVideoBW+" max:"+p.maxVideoBW)}return(w=O.match(/m=audio.*\r\n/))&&p.maxAudioBW&&(U=w[0]+"b=AS:"+p.maxAudioBW+`\r
`,O=O.replace(w[0],U)),O};n.processSignalingMessage=function(O){var w,U=JSON.parse(O);n.incomingMessage=U,n.state==="new"?U.messageType==="OFFER"?(w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)).catch(function($){}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="offer-sent"?U.messageType==="ANSWER"?((w={sdp:U.sdp,type:"answer"}).sdp=M(w.sdp),w.sdp=G(w.sdp),p.screen&&p.optimizationMode==="detail"&&(r.default.debug("[".concat(n.client,"] remove screen share abs ext")),w.sdp=w.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),p.isSubscriber&&(w.sdp=w.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)).catch(function($){}),n.state="established"):U.messageType==="pr-answer"?(w={sdp:U.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)).catch(function($){})):U.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="established"&&(U.messageType==="OFFER"?(w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)).catch(function($){}),n.state="offer-received",n.markActionNeeded()):U.messageType==="ANSWER"?((w={sdp:U.sdp,type:"answer"}).sdp=M(w.sdp),w.sdp=G(w.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)).catch(function($){})):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var O=m()(y.a.mark(function w(U){var $,Y,Z;return y.a.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if($=n.peerConnection.getSenders(),Y=$.find(function(ce){return ce.track.kind==="video"})){re.next=4;break}return re.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=U,re.prev=6,r.default.debug("[".concat(n.clientId,"] setParameters"),Z),re.next=10,Y.setParameters(Z);case 10:re.next=15;break;case 12:re.prev=12,re.t0=re.catch(6),r.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return re.stop()}},w,null,[[6,12]])}));return function(w){return O.apply(this,arguments)}}();var Q=0,J=0;return n.getVideoRelatedStats=function(O){n.getStats(function(w){w.forEach(function(U){if(n.isSubscriber){if(U.mediaType==="video"&&U.id&&~U.id.indexOf("recv")){if(E.isChromeKernel()&&+E.getBrowserVersion()>=76){var $=+U.googFramesReceived-Q,Y=+U.googFramesDecoded-J;n._setStat(o,"googFrameRateReceived",$),n._setStat(o,"googFrameRateDecoded",Y),n._setStat(o,"googFrameRateOutput",Y),Q=+U.googFramesReceived,J=+U.googFramesDecoded}O&&O({mediaType:"video",peerId:n.uid,isVideoMute:n.isVideoMute,frameRateReceived:U.googFrameRateReceived,frameRateDecoded:U.googFrameRateDecoded,bytesReceived:U.bytesReceived,packetsReceived:U.packetsReceived,packetsLost:U.packetsLost})}}else U.mediaType==="video"&&U.id&&~U.id.indexOf("send")&&O&&O({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:U.googFrameRateInput,frameRateSent:U.googFrameRateSent,googRtt:U.googRtt})})})},n.getAudioRelatedStats=function(O){n.getStats(function(w){w.forEach(function(U){n.isSubscriber&&U.mediaType==="audio"&&U.id&&~U.id.indexOf("recv")&&O&&O({mediaType:"audio",peerId:n.uid,isAudioMute:n.isAudioMute,frameDropped:parseInt(U.googDecodingPLC)+parseInt(U.googDecodingPLCCNG)+"",frameReceived:U.googDecodingCTN,googJitterReceived:U.googJitterReceived,bytesReceived:U.bytesReceived,packetsReceived:U.packetsReceived,packetsLost:U.packetsLost})})})},n.getStatsRate=function(O){n.getStats(function(w){O(w)})},n.getStats=function(O,w){w=(w=w||500)>500?500:w,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<w?O&&O(n.filterStatsCache,n.originStatsCache):(n.lastTimeGetStats=Date.now(),this._getStats(function(U,$){n.filterStatsCache=U,n.originStatsCache=$,O&&O(U,$)}))},n._setStat=function(O,w,U){O.hasOwnProperty(w)&&(U!=null&&U!==1/0&&U==U||(U=0),O[w]=U+"")},n._processGetStatsAfterChrome76=function(O){var w=this;n.lastStats||(n.lastStats=new Map),n.peerConnection.getStats().then(function(U){var $,Y=[],Z=[],re=new Map,ce=new Date,ue=T(U.values());try{for(ue.s();!($=ue.n()).done;){var se=$.value;se.type!="codec"?se.type!="candidate-pair"?(se.type==="inbound-rtp"&&se.mediaType==="video"&&re.set("inbound-video",se),se.type==="inbound-rtp"&&se.mediaType==="audio"&&re.set("inbound-audio",se),se.type==="outbound-rtp"&&se.mediaType==="audio"&&re.set("outbound-audio",se),se.type==="outbound-rtp"&&se.mediaType==="video"&&re.set("outbound-video",se),se.type==="track"&&se.kind==="video"&&se.remoteSource&&re.set("remote-video-track",se),se.type==="track"&&se.kind==="audio"&&se.remoteSource&&re.set("remote-audio-track",se),se.type==="remote-inbound-rtp"&&se.mediaType==="video"&&re.set("remote-inbound-video",se),se.type==="remote-inbound-rtp"&&se.mediaType==="audio"&&re.set("remote-inbound-audio",se),se.type!=="track"||se.kind!=="video"||se.remoteSource||re.set("local-video-track",se),se.type!=="track"||se.kind!=="audio"||se.remoteSource||re.set("local-audio-track",se),se.type==="media-source"&&se.kind==="video"&&re.set("media-source-video",se),se.type==="media-source"&&se.kind==="audio"&&re.set("media-source-audio",se)):Z.push(se):Y.push(se)}}catch(_e){ue.e(_e)}finally{ue.f()}re.set("codec",Y),re.set("candidatePairs",Z),re.set("timestamp",+ce);var ie=null,me=null;if(o.timestamp=ce,x.timestamp=ce,l.timestamp=ce,l.timestamp=ce,h.timestamp=ce,w.isSubscriber)(ie=re.get("inbound-video"))&&(n._setStat(o,"id","inbound_video_ssrc_recv"),n._setStat(o,"mediaType",ie.mediaType),n._setStat(o,"packetsLost",ie.packetsLost),n._setStat(o,"googDecodeMs",null),n._setStat(o,"googMaxDecodeMs",null),n._setStat(o,"googRenderDelayMs",null),n._setStat(o,"googMinPlayoutDelayMs",null),n._setStat(o,"googNacksSent",ie.nackCount),n._setStat(o,"googPlisSent",ie.pliCount),n._setStat(o,"googFirsSent",ie.firCount),n._setStat(o,"bytesReceived",ie.bytesReceived),n._setStat(o,"packetsReceived",ie.packetsReceived)),(ie=re.get("inbound-audio"))&&(n._setStat(x,"id","inbound_audio_ssrc_recv"),n._setStat(x,"mediaType",ie.mediaType),n._setStat(x,"bytesReceived",ie.bytesReceived),n._setStat(x,"packetsLost",ie.packetsLost),n._setStat(x,"packetsReceived",ie.packetsReceived),n._setStat(x,"googAccelerateRate",ie.removedSamplesForAcceleration),n._setStat(x,"googCurrentDelayMs",ie.jitterBufferDelay),n._setStat(x,"googDecodingCNG",null),n._setStat(x,"googDecodingCTN",null),n._setStat(x,"googDecodingCTSG",null),n._setStat(x,"googDecodingNormal",null),n._setStat(x,"googDecodingPLC",null),n._setStat(x,"googDecodingPLCCNG",null),n._setStat(x,"googJitterReceived",ie.jitter),n._setStat(x,"googPreferredJitterBufferMs",null),n._setStat(x,"googSecondaryDecodedRate",null)),(ie=re.get("remote-video-track"))&&(n._setStat(o,"googTargetDelayMs",ie.jitterBufferDelay),n._setStat(o,"googFrameWidthReceived",ie.frameWidth),n._setStat(o,"googFrameHeightReceived",ie.frameHeight),n._setStat(o,"googJitterBufferMs",ie.jitterBufferDelay/ie.jitterBufferEmittedCount*1e3),n._setStat(o,"googCurrentDelayMs",ie.jitterBufferDelay),n._setStat(o,"googFramesDecoded",ie.framesDecoded),n._setStat(o,"googFramesReceived",ie.framesReceived)),(ie=re.get("remote-audio-track"))&&(n._setStat(x,"audioOutputLevel",32767*ie.audioLevel),n._setStat(x,"googJitterBufferMs",ie.jitterBufferDelay/ie.jitterBufferEmittedCount*1e3),n._setStat(x,"googExpandRate",ie.concealedSamples),n._setStat(x,"googPreemptiveExpandRate",ie.insertedSamplesForDeceleration),n._setStat(x,"googSpeechExpandRate",ie.silentConcealedSamples));else{var i=n.lastStats.get("timestamp"),le=n.lastStats.get("outbound-video");if((ie=re.get("outbound-audio"))&&(n._setStat(l,"id","outbound_audio_ssrc_send"),n._setStat(l,"mediaType",ie.mediaType),n._setStat(l,"aecDivergentFilterFraction",null),n._setStat(l,"bytesSent",ie.bytesSent),n._setStat(l,"packetsSent",ie.packetsSent),me=ie.transportId),ie=re.get("outbound-video")){if(n._setStat(t,"id","outbound_video_ssrc_send"),n._setStat(t,"mediaType",ie.mediaType),n._setStat(t,"bytesSent",ie.bytesSent),n._setStat(t,"packetsSent",ie.packetsSent),n._setStat(t,"googAdaptationChanges",ie.qualityLimitationDurations),n._setStat(t,"googAvgEncodeMs",null),n._setStat(t,"googEncodeUsagePercent",null),me=ie.transportId,ie.totalEncodedBytesTarget&&le&&le.totalEncodedBytesTarget){var ee=(ie.totalEncodedBytesTarget-le.totalEncodedBytesTarget)/(+new Date-i);n._setStat(h,"googTargetEncBitrate",Math.floor(8*ee*1e3))}if(ie.retransmittedBytesSent&&le&&le.retransmittedBytesSent){var A=(ie.retransmittedBytesSent-le.retransmittedBytesSent)/(+new Date-i);n._setStat(h,"googRetransmitBitrate",Math.floor(8*A*1e3))}if(ie.bytesSent&&le&&le.bytesSent){var fe=(ie.bytesSent-le.bytesSent)/(+new Date-i);n._setStat(h,"googTransmitBitrate",Math.floor(8*fe*1e3)),n._setStat(h,"googActualEncBitrate",Math.floor(8*fe*1e3))}if(ie.totalPacketSendDelay&&le&&le.totalPacketSendDelay){var Ee=(ie.totalPacketSendDelay-le.totalPacketSendDelay)/(+new Date-i);n._setStat(h,"googBucketDelay",Math.floor(1e3*Ee))}}if((ie=re.get("remote-inbound-video"))&&(n._setStat(t,"packetsLost",ie.packetsLost),n._setStat(t,"googRtt",ie.roundTripTime)),(ie=re.get("local-video-track"))&&(n._setStat(t,"googFrameHeightSent",ie.frameHeight),n._setStat(t,"googFrameWidthSent",ie.frameWidth),ie.framesPerSecond!==void 0&&n._setStat(t,"googFrameRateSent",ie.framesPerSecond)),(ie=re.get("local-audio-track"))&&(n._setStat(l,"googEchoCancellationReturnLoss",ie.echoReturnLoss),n._setStat(l,"googEchoCancellationReturnLossEnhancement",ie.echoReturnLossEnhancement)),(ie=re.get("media-source-video"))&&(n._setStat(t,"googFrameHeightInput",ie.height),n._setStat(t,"googFrameWidthInput",ie.width),n._setStat(t,"googFrameRateInput",ie.framesPerSecond)),(ie=re.get("media-source-audio"))&&n._setStat(l,"audioInputLevel",32767*ie.totalAudioEnergy),(ie=re.get("inbound-video"))&&(n._setStat(t,"googFirsReceived",ie.firCount),n._setStat(t,"googNacksReceived",ie.nackCount),n._setStat(t,"googPlisReceived",ie.pliCount)),me)re.get("candidatePairs").map(function(_e){me==_e.transportId&&n._setStat(h,"googAvailableSendBandwidth",_e.availableOutgoingBitrate)});else{var ge=re.get("candidatePairs")[0];ge&&n._setStat(h,"googAvailableSendBandwidth",ge.availableOutgoingBitrate)}}n.lastStats=re;var he=[S()({},t),S()({},l),S()({},o),S()({},x),S()({},h)];he.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),O(he)})},n._processGetStatsBeforeChrome76=function(O){n.peerConnection.getStats(function(w){var U=[],$=[],Y=null;Object.keys(w).forEach(function(Z){var re=w[Z];re&&($.push(re),Y=re.timestamp,re.type==="VideoBwe"?h=re:re.id.indexOf("_send")>-1&&re.mediaType==="video"?t=re:re.id.indexOf("_send")>-1&&re.mediaType==="audio"?l=re:re.id.indexOf("_recv")>-1&&re.mediaType==="video"?o=re:re.id.indexOf("_recv")>-1&&re.mediaType==="audio"&&(x=re))}),(U=[S()({},t),S()({},l),S()({},o),S()({},x),S()({},h)]).push({id:"time",startTime:n.connectedTime,timestamp:Y||new Date}),O(U,$)})},n._getStats=function(O){Object(d.getParameter)("CHROME_NEW_STATS")&&E.isChromeKernel()&&+E.getBrowserVersion()>=76?n._processGetStatsAfterChrome76(O):n._processGetStatsBeforeChrome76(O)},n.addTrack=function(O,w){if(Object(d.getParameter)("PLAN")==="unified-plan"){var U=O.kind==="audio"?n._audioSender:n._videoSender;if(U){var $=n.peerConnection.getTransceivers().find(function(Y){return Y.sender===U});U.replaceTrack(O).then(function(){$.direction="sendrecv",n.renegotiate()})}else U=n.peerConnection.addTrack(O,w),O.kind==="audio"?n._audioSender=U:n._videoSender=U}else n.peerConnection.addTrack(O,w)},n.removeTrack=function(O,w){if(Object(d.getParameter)("PLAN")==="unified-plan"){var U=n.peerConnection.getTransceivers().find(function($){return $.sender.track===O});U&&(U.direction="inactive",n.peerConnection.removeTrack(U.sender))}else n.peerConnection.removeTrack(n.peerConnection.getSenders().find(function($){return $.track==O}))},n.addStream=function(O){Object(d.getParameter)("PLAN")==="unified-plan"?O.getTracks().forEach(function(w){var U=n.peerConnection.addTrack(w,O);w.kind==="audio"?n._audioSender=U:n._videoSender=U}):(n.peerConnection.addStream(O),n.markActionNeeded())},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(O){window.setTimeout(O,1)},n.onstablestate=function(){var O;if(n.actionNeeded){if(n.state==="new"||n.state==="established")n.peerConnection.createOffer(n.mediaConstraints).then(function(w){return w?w.sdp!==n.prevOffer?(p.isSubscriber&&(w.sdp=w.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setLocalDescription(w),n.state="preparing-offer",void n.markActionNeeded()):void r.default.debug("["+n.clientId+"]Not sending a new offer"):(r.default.debug("["+n.clientId+"]sessionDescription is null"),void n.onsignalingmessage(null))}).catch(function(w){r.default.debug("["+n.clientId+"]peer connection create offer failed ",w)});else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(p.isCloudProxy3&&p.onNoIceCandidate&&p.onNoIceCandidate(),r.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),Object(d.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):r.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(w){if(n.peerConnection.setLocalDescription(w),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var U=new Date;r.default.debug("["+n.clientId+"]"+U.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(w){r.default.debug("["+n.clientId+"]peer connection create answer failed ",w)},n.mediaConstraints);else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;O=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",O),n.state="established"}else r.default.debug("[".concat(n.clientId,"] Dazed and confused in state ").concat(n.state,", stopping here'"));n.actionNeeded=!1}},n.sendMessage=function(O,w){var U={};U.messageType=O,U.sdp=w,O==="OFFER"?(U.offererSessionId=n.sessionId,U.answererSessionId=n.otherSessionId,U.seq=n.sequenceNumber+=1,U.tiebreaker=Math.floor(429496723*Math.random()+1)):(U.offererSessionId=n.incomingMessage.offererSessionId,U.answererSessionId=n.sessionId,U.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(U))},n._getSender=function(O){if(n.peerConnection&&n.peerConnection.getSenders){var w=n.peerConnection.getSenders().find(function(U){return U.track.kind==O});if(w)return w}return null},n.hasSender=function(O){return!!n._getSender(O)},n.replaceTrack=function(O,w,U){var $=n._getSender(O.kind);if(!$)return U("NO_SENDER_FOUND");try{$.replaceTrack(O)}catch(Y){return U&&U(Y)}setTimeout(function(){return w&&w()},50)},n.error=function(O){throw"Error in RoapOnJsep: "+O},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=p.callback,n.peerConnection.ontrack=function(O){n.onaddstream&&(n.onaddstream(O,"ontrack"),n.peerConnection.onaddstream=null)},n.peerConnection.onaddstream=function(O){n.onaddstream&&(n.onaddstream(O,"onaddstream"),n.peerConnection.ontrack=null)},n.peerConnection.onremovestream=function(O){n.onremovestream&&n.onremovestream(O)},n.peerConnection.oniceconnectionstatechange=function(O){r.default.debug(n.peerConnection.iceConnectionState),O.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(O.currentTarget.iceConnectionState)},n.renegotiate=function(){n.prevOffer!==void 0&&n.peerConnection.createOffer().then(function(O){return Object(d.getParameter)("PLAN")!=="unified-plan"&&(O.sdp=O.sdp.replace(/a=recvonly\r\n/g,`a=inactive\r
`)),O.sdp=M(O.sdp),O.sdp=G(O.sdp),n.peerConnection.setLocalDescription(O)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(O){r.default.error("createOffer error: ",O.message||O)})},n.peerConnection.onnegotiationneeded=n.renegotiate,n.onaddstream=null,n.onremovestream=null,n.onnegotiationneeded=null,n.state="new",n.markActionNeeded(),n},u=function(p){var n={},N=a.RTCPeerConnection;n.uid=p.uid,n.isVideoMute=p.isVideoMute,n.isAudioMute=p.isAudioMute,n.isSubscriber=p.isSubscriber,n.clientId=p.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[],bundlePolicy:"max-bundle"},n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},p.iceServers instanceof Array?n.pc_config.iceServers=p.iceServers:(p.stunServerUrl&&(p.stunServerUrl instanceof Array?p.stunServerUrl.map(function(O){typeof O=="string"&&O!==""&&n.pc_config.iceServers.push({url:O})}):typeof p.stunServerUrl=="string"&&p.stunServerUrl!==""&&n.pc_config.iceServers.push({url:p.stunServerUrl})),p.turnServers&&(p.turnServers instanceof Array?p.turnServers.map(function(O){O.udpport&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.udpport+"?transport=udp"}),typeof O.tcpport=="string"&&O.tcpport!==""&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.tcpport+"?transport=tcp"}),O.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):r.default.error("[".concat(n.clientId,"] turnServers is not a array")))),p.audio===void 0&&(p.audio=!0),p.video===void 0&&(p.video=!0),n.mediaConstraints={mandatory:{OfferToReceiveVideo:p.video,OfferToReceiveAudio:p.audio}},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(d.getParameter)("PLAN"),n.peerConnection=new N(n.pc_config,n.con)}catch{delete n.pc_config.sdpSemantics,n.peerConnection=new N(n.pc_config,n.con)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(d.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(O){var w,U,$,Y;U=(w=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),$=w.match(/a=candidate:.+typ\shost.+\r\n/),Y=w.match(/a=candidate:.+typ\srelay.+\r\n/),n.iceCandidateCount===0&&(n.timeout=setTimeout(function(){n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},1e3)),U===null&&$===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var l=function(O){return p.screen&&(O=O.replace(`a=x-google-flag:conference\r
`,"")),O},t=function(O){var w,U;return(w=O.match(/m=video.*\r\n/))&&p.minVideoBW&&p.maxVideoBW&&(U=w[0]+"b=AS:"+p.maxVideoBW+`\r
`,O=O.replace(w[0],U),r.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+p.minVideoBW+" max:"+p.maxVideoBW)),(w=O.match(/m=audio.*\r\n/))&&p.maxAudioBW&&(U=w[0]+"b=AS:"+p.maxAudioBW+`\r
`,O=O.replace(w[0],U)),O};n.processSignalingMessage=function(O){var w,U=JSON.parse(O);n.incomingMessage=U,n.state==="new"?U.messageType==="OFFER"?(w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="offer-sent"?U.messageType==="ANSWER"?((w={sdp:U.sdp,type:"answer"}).sdp=l(w.sdp),w.sdp=t(w.sdp),w.sdp=w.sdp.replace(/a=x-google-flag:conference\r\n/g,""),p.screen&&p.optimizationMode==="detail"&&(r.default.debug("[".concat(n.client,"] remove screen share abs ext")),w.sdp=w.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)),n.state="established"):U.messageType==="pr-answer"?(w={sdp:U.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w))):U.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="established"&&(U.messageType==="OFFER"?(w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(w)),n.state="offer-received",n.markActionNeeded()):U.messageType==="ANSWER"?((w={sdp:U.sdp,type:"answer"}).sdp=l(w.sdp),w.sdp=t(w.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(w))):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var O=m()(y.a.mark(function w(U){return y.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:n.degradation=U;case 1:case"end":return $.stop()}},w)}));return function(w){return O.apply(this,arguments)}}(),n._setRtpSenderParameters=function(){var O=m()(y.a.mark(function w(U){var $,Y,Z;return y.a.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if($=n.peerConnection.getSenders(),Y=$.find(function(ce){return ce&&ce.track&&ce.track.kind==="video"})){re.next=4;break}return re.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=U,re.prev=6,r.default.debug("[".concat(n.clientId,"] setParameters"),Z),re.next=10,Y.setParameters(Z);case 10:re.next=15;break;case 12:re.prev=12,re.t0=re.catch(6),r.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return re.stop()}},w,null,[[6,12]])}));return function(w){return O.apply(this,arguments)}}();var x={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},o={id:"",type:"",mediaType:"",googCodecName:p.codec?p.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},h={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},L={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},M={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},G=0,Q=0,J=0;return n.isRemoteVideoStats=function(O){return!!(O.frameHeight&&O.frameWidth&&O.remoteSource)},n.getVideoRelatedStats=function(O){n.peerConnection.getStats().then(function(w){w.forEach(function(U){if(n.isSubscriber){var $={peerId:n.uid,mediaType:"video",isVideoMute:n.isVideoMute};if(U.type==="track"&&(~U.id.indexOf("video")||~U.trackIdentifier.indexOf("v")||n.isRemoteVideoStats(U))){if(!n.lastReport)return void(n.lastReport=U);$.frameRateReceived=U.framesReceived-n.lastReport.framesReceived+"",$.frameRateDecoded=U.framesDecoded-n.lastReport.framesDecoded+"",n.lastReport=U}U.type==="inbound-rtp"&&~U.id.indexOf("Video")&&($.bytesReceived=U.bytesReceived+"",$.packetsReceived=U.packetsReceived+"",$.packetsLost=U.packetsLost+""),O&&O($)}else if(U.type==="outbound-rtp"&&~U.id.indexOf("Video")){if(!n.lastReport)return void(n.lastReport=U);O&&O({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:p.maxFrameRate+"",frameRateSent:U.framesEncoded-n.lastReport.framesEncoded+""}),n.lastReport=U}})})},n.getAudioRelatedStats=function(O){n.peerConnection.getStats().then(function(w){w.forEach(function(U){n.isSubscriber&&U.type==="inbound-rtp"&&~U.id.indexOf("Audio")&&O&&O({peerId:n.uid,mediaType:"audio",isAudioMute:n.isAudioMute,frameDropped:U.packetsLost+"",frameReceived:U.packetsReceived+"",googJitterReceived:U.jitter+"",bytesReceived:U.bytesReceived+"",packetsReceived:U.packetsReceived+"",packetsLost:U.packetsLost+""})})})},n.getStatsRate=function(O){n.getStats(function(w){w.forEach(function(U){U.type==="outbound-rtp"&&U.mediaType==="video"&&U.googFramesEncoded&&(U.googFrameRateSent=Math.ceil((U.googFramesEncoded-G)/3).toString(),G=U.googFramesEncoded),U.type==="inbound-rtp"&&U.id.indexOf("55543")!=-1&&(U.googFrameRateReceived&&(U.googFrameRateReceived=Math.ceil((U.googFrameReceived-J)/3).toString(),J=U.googFrameReceived),U.googFrameRateDecoded&&(U.googFrameRateDecoded=Math.ceil((U.googFramesDecoded-Q)/3).toString(),Q=U.googFramesDecoded))}),O(w)})},n.getStats=function(O,w){w=(w=w||500)>500?500:w,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<w?O&&O(n.filterStatsCache,n.originStatsCache):this._getStats(function(U,$){n.filterStatsCache=U,n.originStatsCache=$,n.lastTimeGetStats=Date.now(),O&&O(U,$)})},n._getStats=function(O){var w=[];n.peerConnection.getStats().then(function(U){U.forEach(function(Y){var Z;w.push(Y),Y.type==="outbound-rtp"&&Y.mediaType==="audio"&&(x.id=Y.id,x.type=Y.type,x.mediaType=Y.mediaType,x.bytesSent=Y.bytesSent?Y.bytesSent+"":"0",x.packetsSent=Y.packetsSent?Y.packetsSent+"":"0",p.agoraStream.local&&(x.audioInputLevel=Math.round(32767*p.agoraStream.getAudioLevel()).toString())),Y.type==="outbound-rtp"&&Y.mediaType==="video"&&(o.id=Y.id,o.type=Y.type,o.mediaType=Y.mediaType,o.bytesSent=Y.bytesSent?Y.bytesSent+"":"0",o.packetsSent=Y.packetsSent?Y.packetsSent+"":"0",o.googPlisReceived=Y.pliCount?Y.pliCount+"":"0",o.googNacksReceived=Y.nackCount?Y.nackCount+"":"0",o.googFirsReceived=Y.firCount?Y.firCount+"":"0",o.googFramesEncoded=Y.framesEncoded?Y.framesEncoded+"":"0",(Z=U.get(Y.trackId))&&(o.googFrameHeightSent=Z.frameHeight&&Z.frameHeight.toString(),o.googFrameWidthSent=Z.frameWidth&&Z.frameWidth.toString())),Y.type!=="inbound-rtp"||Y.id.indexOf("44444")==-1&&Y.mediaType!=="audio"||(h.id=Y.id,h.type=Y.type,h.mediaType="audio",h.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",h.bytesReceived=Y.bytesReceived?Y.bytesReceived+"":"0",h.packetsLost=Y.packetsLost?Y.packetsLost+"":"0",h.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",h.googJitterReceived=Y.jitter?Y.jitter+"":"0",(Z=U.get(Y.trackId))&&(h.audioOutputLevel=Z.audioLevel&&Math.round(32767*Z.audioLevel).toString()),p.agoraStream.local||h.audioOutputLevel||(h.audioOutputLevel=Math.round(32767*p.agoraStream.getAudioLevel()).toString())),Y.type!=="inbound-rtp"||Y.id.indexOf("55543")==-1&&Y.mediaType!=="video"||(L.id=Y.id,L.type=Y.type,L.mediaType="video",L.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",L.bytesReceived=Y.bytesReceived?Y.bytesReceived+"":"0",L.packetsLost=Y.packetsLost?Y.packetsLost+"":"0",L.googJitterBufferMs=Y.jitter?Y.jitter+"":"0",L.googNacksSent=Y.nackCount?Y.nackCount+"":"0",L.googPlisSent=Y.pliCount?Y.pliCount+"":"0",L.googFirsSent=Y.firCount?Y.firCount+"":"0",(Z=U.get(Y.trackId))&&(L.googFrameHeightReceived=Z.frameHeight&&Z.frameHeight.toString(),L.googFrameWidthReceived=Z.frameWidth&&Z.frameWidth.toString(),L.googFrameReceived=Z.framesReceived&&Z.framesReceived.toString(),L.googFramesDecoded=Z.framesDecoded&&Z.framesDecoded.toString())),Y.type==="candidate-pair"&&(Y.availableIncomingBitrate==0?M.googAvailableSendBandwidth=Y.availableOutgoingBitrate+"":M.googAvailableReceiveBandwidth=Y.availableIncomingBitrate+"")});var $=[M,x,o,h,L];$.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),O($,w)}).catch(function(U){r.default.error("["+n.clientId+"] ",U)})},n.addTrack=function(O,w){n.peerConnection.addTrack(O,w)},n.removeTrack=function(O,w){var U=n.peerConnection.getSenders().find(function($){return $.track==O});U.replaceTrack(null),n.peerConnection.removeTrack(U)},n.addStream=function(O){window.navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")===-1?O.getTracks().forEach(function(w){return n.peerConnection.addTrack(w,O)}):n.peerConnection.addStream(O),n.markActionNeeded()},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(O){window.setTimeout(O,1)},n.onstablestate=function(){var O;if(n.actionNeeded){if(n.state==="new"||n.state==="established")p.isSubscriber&&(n.peerConnection.addTransceiver("audio",{direction:"recvonly"}),n.peerConnection.addTransceiver("video",{direction:"recvonly"})),n.peerConnection.createOffer(n.mediaConstraints).then(function(w){if(w.sdp=t(w.sdp),p.isSubscriber||(w.sdp=w.sdp.replace(/a=.*video-orientation\r\n/g,"")),w.sdp!==n.prevOffer)return n.peerConnection.setLocalDescription(w),n.state="preparing-offer",void n.markActionNeeded();r.default.debug("["+n.clientId+"]Not sending a new offer")}).catch(function(w){r.default.debug("["+n.clientId+"]peer connection create offer failed ",w)});else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(r.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),p.isCloudProxy3&&p.onNoIceCandidate&&p.onNoIceCandidate(),Object(d.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):r.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(w){if(n.peerConnection.setLocalDescription(w),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var U=new Date;r.default.debug("["+n.clientId+"]"+U.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(w){r.default.debug("["+n.clientId+"]peer connection create answer failed ",w)},n.mediaConstraints);else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;O=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",O),n.state="established"}else n.debug("Dazed and confused in state "+n.state+", stopping here");n.actionNeeded=!1}},n.sendMessage=function(O,w){var U={};U.messageType=O,U.sdp=w,O==="OFFER"?(U.offererSessionId=n.sessionId,U.answererSessionId=n.otherSessionId,U.seq=n.sequenceNumber+=1,U.tiebreaker=Math.floor(429496723*Math.random()+1)):(U.offererSessionId=n.incomingMessage.offererSessionId,U.answererSessionId=n.sessionId,U.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(U))},n._getSender=function(O){if(n.peerConnection&&n.peerConnection.getSenders){var w=n.peerConnection.getSenders().find(function(U){return U.track.kind==O});if(w)return w}return null},n.hasSender=function(O){return!!n._getSender(O)},n.replaceTrack=function(O,w,U){var $=n._getSender(O.kind);if(!$)return U("NO_SENDER_FOUND");try{$.replaceTrack(O)}catch(Y){return U&&U(Y)}setTimeout(function(){return w&&w()},50)},n.error=function(O){throw"Error in RoapOnJsep: "+O},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=p.callback,n.peerConnection.ontrack=function(O){n.onaddstream&&n.onaddstream(O,"ontrack")},n.peerConnection.onremovestream=function(O){n.onremovestream&&n.onremovestream(O)},n.peerConnection.oniceconnectionstatechange=function(O){O.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date,n._setRtpSenderParameters(n.degradation)),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(O.currentTarget.iceConnectionState)},n.renegotiate=function(){n.isSubscriber||(r.default.debug("[".concat(n.uid,"]"),"renegotiating"),n.prevOffer!==void 0&&n.peerConnection.createOffer().then(function(O){return O.sdp=O.sdp.replace(/a=recvonly\r\n/g,`a=inactive\r
`),O.sdp=l(O.sdp),O.sdp=t(O.sdp),n.peerConnection.setLocalDescription(O)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(O){r.default.error("createOffer error: ",O)}))},n.isSubscriber||(n.peerConnection.onnegotiationneeded=n.renegotiate),n.onaddstream=null,n.onremovestream=null,n.state="new",n.markActionNeeded(),n};function b(p){if(typeof Symbol=="undefined"||p[Symbol.iterator]==null){if(Array.isArray(p)||(p=function(h,L){if(!!h){if(typeof h=="string")return R(h,L);var M=Object.prototype.toString.call(h).slice(8,-1);if(M==="Object"&&h.constructor&&(M=h.constructor.name),M==="Map"||M==="Set")return Array.from(M);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return R(h,L)}}(p))){var n=0,N=function(){};return{s:N,n:function(){return n>=p.length?{done:!0}:{done:!1,value:p[n++]}},e:function(h){throw h},f:N}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,t,x=!0,o=!1;return{s:function(){l=p[Symbol.iterator]()},n:function(){var h=l.next();return x=h.done,h},e:function(h){o=!0,t=h},f:function(){try{x||l.return==null||l.return()}finally{if(o)throw t}}}}function R(p,n){(n==null||n>p.length)&&(n=p.length);for(var N=0,l=new Array(n);N<n;N++)l[N]=p[N];return l}var D=function(p){var n={},N=(mozRTCPeerConnection,mozRTCSessionDescription),l=!1;n.uid=p.uid,n.isVideoMute=p.isVideoMute,n.isAudioMute=p.isAudioMute,n.isSubscriber=p.isSubscriber,n.clientId=p.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[]},p.iceServers instanceof Array?p.iceServers.map(function(O){O.url.indexOf("stun:")===0&&n.pc_config.iceServers.push({url:O.url})}):(p.stunServerUrl&&(p.stunServerUrl instanceof Array?p.stunServerUrl.map(function(O){typeof O=="string"&&O!==""&&n.pc_config.iceServers.push({url:O})}):typeof p.stunServerUrl=="string"&&p.stunServerUrl!==""&&n.pc_config.iceServers.push({url:p.stunServerUrl})),p.turnServers&&(p.turnServers instanceof Array?p.turnServers.map(function(O){O.udpport&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.udpport+"?transport=udp"}),typeof O.tcpport=="string"&&O.tcpport!==""&&n.pc_config.iceServers.push({username:O.username,credential:O.credential,credentialType:"password",urls:(O.useTurns?"turns:":"turn:")+O.url+":"+O.tcpport+"?transport=tcp"}),O.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):r.default.error("[".concat(n.clientId,"] turnServers is not a array")))),p.audio===void 0&&(p.audio=!0),p.video===void 0&&(p.video=!0),n.mediaConstraints={offerToReceiveAudio:p.audio,offerToReceiveVideo:p.video,mozDontOfferDataChannel:!0},n.roapSessionId=103,n.peerConnection=new a.RTCPeerConnection(n.pc_config),n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,r.default.debug("[".concat(n.clientId,"]Candidates collected: ").concat(n.iceCandidateCount)),n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(d.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(O){var w,U,$,Y;U=(w=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),$=w.match(/a=candidate:.+typ\shost.+\r\n/),Y=w.match(/a=candidate:.+typ\srelay.+\r\n/),U===null&&$===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1},n.checkMLineReverseInSDP=function(O){return!(!~O.indexOf("m=audio")||!~O.indexOf("m=video"))&&O.indexOf("m=audio")>O.indexOf("m=video")},n.reverseMLineInSDP=function(O){var w=O.split("m=audio"),U=w[1].split("m=video"),$="m=video"+U[1],Y="m=audio"+U[0];return O=w[0]+$+Y},n.processSignalingMessage=function(O){var w,U=JSON.parse(O);n.incomingMessage=U,n.state==="new"?U.messageType==="OFFER"?(U.sdp=Q(U.sdp),w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new N(w),function(){r.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function($){r.default.info("["+n.clientId+"]setRemoteDescription failed: "+$.name)}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="offer-sent"?U.messageType==="ANSWER"?(U.sdp=Q(U.sdp),U.sdp=U.sdp.replace(/ generation 0/g,""),U.sdp=U.sdp.replace(/ udp /g," UDP "),U.sdp.indexOf("a=group:BUNDLE")!==-1?(U.sdp=U.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),U.sdp=U.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),U.sdp=U.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(U.sdp=U.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),U.sdp=U.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),w={sdp:U.sdp,type:"answer"},p.screen&&p.optimizationMode==="detail"&&(r.default.debug("[".concat(n.client,"] remove screen share abs ext")),U.sdp=J(w.sdp)),n.peerConnection.setRemoteDescription(new N(w),function(){r.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function($){r.default.info("["+n.clientId+"]setRemoteDescription failed: "+$)}),n.state="established"):U.messageType==="pr-answer"?(w={sdp:U.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new N(w),function(){r.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function($){r.default.info("["+n.clientId+"]setRemoteDescription failed: "+$.name)})):U.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state):n.state==="established"&&(U.messageType==="OFFER"?(w={sdp:U.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new N(w),function(){r.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function($){r.default.info("["+n.clientId+"]setRemoteDescription failed: "+$.name)}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+U.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var O=m()(y.a.mark(function w(U){var $,Y,Z;return y.a.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if($=n.peerConnection.getSenders(),Y=$.find(function(ce){return ce.track.kind==="video"})){re.next=4;break}return re.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=U,re.prev=6,r.default.debug("[".concat(n.clientId,"] setParameters"),Z),re.next=10,Y.setParameters(Z);case 10:re.next=15;break;case 12:re.prev=12,re.t0=re.catch(6),r.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return re.stop()}},w,null,[[6,12]])}));return function(w){return O.apply(this,arguments)}}();var t={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},x={id:"",type:"",mediaType:"",googCodecName:p.codec?p.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},o={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},h={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},L=0,M=0,G=0;n.getVideoRelatedStats=function(O){n.peerConnection.getStats().then(function(w){var U,$=b(w.values());try{for($.s();!(U=$.n()).done;){var Y=U.value;if(n.isSubscriber){if((Y.type==="inbound-rtp"||Y.type==="inboundrtp")&&Y.mediaType==="video"){if(!n.lastReport)return void(n.lastReport=Y);O&&O({browser:"firefox",mediaType:"video",peerId:n.uid,isVideoMute:n.isVideoMute,frameRateReceived:Math.round(Y.framerateMean)+"",frameRateDecoded:Y.framesDecoded-n.lastReport.framesDecoded+"",bytesReceived:Y.bytesReceived+"",packetsReceived:Y.packetsReceived+"",packetsLost:Y.packetsLost+""}),n.lastReport=Y}}else if((Y.type==="outbound-rtp"||Y.type==="outboundrtp")&&Y.mediaType==="video"){if(!n.lastReport)return void(n.lastReport=Y);O&&O({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:Math.round(Y.framerateMean)+"",frameRateSent:Y.framesEncoded-n.lastReport.framesEncoded+""}),n.lastReport=Y}}}catch(Z){$.e(Z)}finally{$.f()}})},n.getAudioRelatedStats=function(O){n.peerConnection.getStats().then(function(w){var U,$=b(w.values());try{for($.s();!(U=$.n()).done;){var Y=U.value;n.isSubscriber&&(Y.type!=="inbound-rtp"&&Y.type!=="inboundrtp"||Y.mediaType!=="audio"||O&&O({browser:"firefox",mediaType:"audio",peerId:n.uid,isAudioMute:n.isAudioMute,frameDropped:Y.packetsLost+"",frameReceived:Y.packetsReceived+"",googJitterReceived:Y.jitter+"",bytesReceived:Y.bytesReceived+"",packetsReceived:Y.packetsReceived+"",packetsLost:Y.packetsLost+""}))}}catch(Z){$.e(Z)}finally{$.f()}})},n.getStatsRate=function(O){n.getStats(function(w){w.forEach(function(U){}),O(w)})},n.getStats=function(O,w){w=(w=w||500)>500?500:w,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<w?O&&O(n.filterStatsCache,n.originStatsCache):this._getStats(function(U,$){n.filterStatsCache=U,n.originStatsCache=$,n.lastTimeGetStats=Date.now(),O&&O(U,$)})},n._getStats=function(O){n.peerConnection.getStats().then(function(w){var U,$=[],Y=b(w.values());try{for(Y.s();!(U=Y.n()).done;){var Z=U.value;$.push(Z),Z.type!=="outbound-rtp"&&Z.type!=="outboundrtp"||Z.mediaType!=="video"||Z.id.indexOf("rtcp")!==-1||(x.id=Z.id,x.type=Z.type,x.mediaType=Z.mediaType,x.bytesSent=Z.bytesSent?Z.bytesSent+"":"0",x.packetsSent=Z.packetsSent?Z.packetsSent+"":"0",x.googPlisReceived=Z.pliCount?Z.pliCount+"":"0",x.googNacksReceived=Z.nackCount?Z.nackCount+"":"0",x.googFirsReceived=Z.firCount?Z.firCount+"":"0",x.googFrameRateSent=Z.framerateMean?Math.round(Z.framerateMean)+"":"0"),Z.type!=="outbound-rtp"&&Z.type!=="outboundrtp"||Z.mediaType!=="audio"||Z.id.indexOf("rtcp")!==-1||(t.id=Z.id,t.type=Z.type,t.mediaType=Z.mediaType,t.bytesSent=Z.bytesSent?Z.bytesSent+"":"0",t.packetsSent=Z.packetsSent?Z.packetsSent+"":"0",p.agoraStream.local&&(t.audioInputLevel=Math.round(32767*p.agoraStream.getAudioLevel()).toString())),Z.type!=="inbound-rtp"&&Z.type!=="inboundrtp"||Z.mediaType!=="audio"||Z.isRemote||Z.id.indexOf("rtcp")!==-1||(o.id=Z.id,o.type=Z.type,o.mediaType=Z.mediaType,o.bytesReceived=Z.bytesReceived?Z.bytesReceived+"":"0",o.packetsLost=Z.packetsLost?Z.packetsLost+"":"0",o.packetsReceived=Z.packetsReceived?Z.packetsReceived+"":"0",o.googJitterReceived=Z.jitter?Z.jitter+"":"0",p.agoraStream.local||(o.audioOutputLevel=Math.round(32767*p.agoraStream.getAudioLevel()).toString())),Z.type!=="inbound-rtp"&&Z.type!=="inboundrtp"||Z.mediaType!=="video"||Z.isRemote||Z.id.indexOf("rtcp")!==-1||(h.id=Z.id,h.type=Z.type,h.mediaType=Z.mediaType,h.bytesReceived=Z.bytesReceived?Z.bytesReceived+"":"0",h.googFrameRateReceived=Z.framerateMean?Math.round(Z.framerateMean)+"":"0",h.googFramesDecoded=Z.framesDecoded?Z.framesDecoded+"":"0",Date.now()-G>=1e3?(h.googFrameRateDecoded=(Z.framesDecoded-L)/((Date.now()-G)/1e3),h.googFrameRateDecoded=Math.round(Math.max(0,h.googFrameRateDecoded)),G=Date.now(),M=h.googFrameRateDecoded,L=Z.framesDecoded,h.googFrameRateDecoded=h.googFrameRateDecoded.toString()):h.googFrameRateDecoded=M.toString(),h.packetsLost=Z.packetsLost?Z.packetsLost+"":"0",h.packetsReceived=Z.packetsReceived?Z.packetsReceived+"":"0",h.googJitterBufferMs=Z.jitter?Z.jitter+"":"0",h.googNacksSent=Z.nackCount?Z.nackCount+"":"0",h.googPlisSent=Z.pliCount?Z.pliCount+"":"0",h.googFirsSent=Z.firCount?Z.firCount+"":"0"),Z.id.indexOf("outbound_rtcp_video")!==-1&&(x.packetsLost=Z.packetsLost?Z.packetsLost+"":"0")}}catch(ce){Y.e(ce)}finally{Y.f()}var re=[x,t,o,h];re.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),O(re,$)},function(w){r.default.error("["+n.clientId+"]"+w)})},n.addStream=function(O){l=!0,n.peerConnection.addStream(O),n.markActionNeeded()},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(O){window.setTimeout(O,1)},n.onstablestate=function(){if(n.actionNeeded){if(n.state==="new"||n.state==="established")l&&(n.mediaConstraints=void 0),n.peerConnection.createOffer(function(w){if(w.sdp=Q(w.sdp),w.sdp=w.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),w.sdp!==n.prevOffer)return n.peerConnection.setLocalDescription(w),n.state="preparing-offer",void n.markActionNeeded();r.default.debug("["+n.clientId+"]Not sending a new offer")},function(w){r.default.debug("["+n.clientId+"]Ups! create offer failed ",w)},n.mediaConstraints);else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(p.isCloudProxy3&&p.onNoIceCandidate&&p.onNoIceCandidate(),r.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),Object(d.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):r.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(w){if(n.peerConnection.setLocalDescription(w),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var U=new Date;r.default.debug("["+n.clientId+"]"+U.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(){r.default.debug("["+n.clientId+"]Ups! Something went wrong")});else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;var O=n.peerConnection.localDescription.sdp;n.sendMessage("ANSWER",O),n.state="established"}else n.debug("Dazed and confused in state "+n.state+", stopping here");n.actionNeeded=!1}},n.sendMessage=function(O,w){var U={};U.messageType=O,U.sdp=w,O==="OFFER"?(U.offererSessionId=n.sessionId,U.answererSessionId=n.otherSessionId,U.seq=n.sequenceNumber+=1,U.tiebreaker=Math.floor(429496723*Math.random()+1)):(U.offererSessionId=n.incomingMessage.offererSessionId,U.answererSessionId=n.sessionId,U.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(U))},n._getSender=function(O){if(n.peerConnection&&n.peerConnection.getSenders){var w=n.peerConnection.getSenders().find(function(U){return U.track.kind==O});if(w)return w}return null},n.hasSender=function(O){return!!n._getSender(O)},n.replaceTrack=function(O,w,U){var $=n._getSender(O.kind);if(!$)return U("NO_SENDER_FOUND");try{$.replaceTrack(O)}catch(Y){return U&&U(Y)}setTimeout(function(){return w&&w()},50)},n.error=function(O){throw"Error in RoapOnJsep: "+O},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=p.callback,n.peerConnection.ontrack=function(O){n.onaddstream&&n.onaddstream(O,"ontrack")},n.peerConnection.onremovestream=function(O){n.onremovestream&&n.onremovestream(O)},n.peerConnection.oniceconnectionstatechange=function(O){O.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(O.currentTarget.iceConnectionState)};var Q=function(O){var w;if(p.video&&p.maxVideoBW&&((w=O.match(/m=video.*\r\n/))==null&&(w=O.match(/m=video.*\n/)),w&&w.length>0)){var U=w[0]+"b=TIAS:"+1e3*p.maxVideoBW+`\r
`;O=O.replace(w[0],U)}return p.audio&&p.maxAudioBW&&((w=O.match(/m=audio.*\r\n/))==null&&(w=O.match(/m=audio.*\n/)),w&&w.length>0)&&(U=w[0]+"b=TIAS:"+1e3*p.maxAudioBW+`\r
`,O=O.replace(w[0],U)),O},J=function(O){return(O=O.replace(/a=.*abs-send-time\r\n/g,"")).replace(/a=.*goog-remb\r\n/g,"")};return n.onaddstream=null,n.onremovestream=null,n.state="new",n.markActionNeeded(),n},_=I(50),j=I.n(_),q=I(26),B=(I(4),103),W=function(p){var n={};if(n.clientId=p.clientId,p.session_id=B+=1,typeof window=="undefined"||!window.navigator)throw r.default.error("["+n.streamId+"]["+n.clientId+"]Publish/subscribe video/audio streams not supported yet"),new Error("NON_BROWSER_ENV_DETECTED");return window.navigator.userAgent.match("Firefox")!==null?(n.browser="mozilla",n=D(p)):E.getBrowserOS()==="iOS"||E.isSafari()?(r.default.debug("["+n.streamId+"]["+n.clientId+"]Safari"),(n=u(p)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?n=new j.a(p):(n=v(p)).browser="chrome-stable",n},k=function(p,n,N){var l={};l.config=p,l.streamId=p.streamId,delete p.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var t=0,x=1,o=!1,h=null,L=function(J){if(t++,h)if(h===J)r.default.debug("Using Video Source/ Audio Source");else{var O=h.getVideoTracks()[0],w=h.getAudioTracks()[0],U=J.getVideoTracks()[0],$=J.getAudioTracks()[0];U&&(O&&h.removeTrack(O),h.addTrack(U)),$&&(w&&h.removeTrack(w),h.addTrack($))}else h=J;t!==x||o||(o=!0,setTimeout(function(){n(h)},0))},M=function(J){r.default.error("Failed to GetUserMedia",J.name,J.code,J.message,J),t++,o||(o=!0,setTimeout(function(){N&&N(J)},0))},G=function(){var J={video:p.video,audio:p.audio};if(r.default.debug("GetUserMedia",JSON.stringify(J)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(J).then(L).catch(M);else if(typeof navigator!="undefined"&&navigator.getMedia)navigator.getMedia(p,L,M);else{var O={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};r.default.error("["+l.streamId+"]"+O.message),N&&N(O)}};if((p.videoSource||p.audioSource)&&(h=new MediaStream,p.videoSource&&h.addTrack(p.videoSource),p.audioSource&&h.addTrack(p.audioSource)),p.video||p.audio||p.screen||p.screenAudio){if(!p.screen&&p.screenAudio)return N&&N({code:"Set screen to true before sharing the audio"});if(p.screen){if(q.a.isElectron())return p.screen.sourceId?q.a.getScreenStream(p.screen.sourceId,p.screen,function(J,O){J?M(J):(p.audio&&(x++,G()),L(O))}):q.a.shareScreen(p.screen,function(J,O){J?M(J):(p.audio&&(x++,G()),L(O))});if(E.isFireFox()){if(r.default.debug("["+l.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(p.screen.mediaSource))return N&&N({code:"Invalid mediaSource, mediaSource should be one of [screen, window, application]"});navigator.getMedia({video:p.screen},function(J){p.audio&&(x++,G()),L(J)},M)}else if(E.isChromeKernel()&&p.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void N({code:"This browser does not support screen sharing"});r.default.debug("["+l.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(p.screen.extensionId,{getStream:!0},function(J){J===void 0?(r.default.error("["+l.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),M({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(p.screen.mandatory.chromeMediaSourceId=J.streamId,navigator.getMedia({video:p.screen},function(O){p.audio&&(x++,G()),L(O)},M))})}catch{return r.default.debug("["+l.streamId+"]AgoraRTC screensharing plugin is not accessible"),void N({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var Q={};return typeof p.screen.width=="number"&&typeof p.screen.height=="number"?Q.video={width:{ideal:p.screen.width},height:{ideal:p.screen.height}}:Q.video={width:p.screen.width,height:p.screen.height},p.screen.frameRate&&p.screen.frameRate.min?Q.video.frameRate={ideal:p.screen.frameRate.max,max:p.screen.frameRate.max}:Q.video.frameRate=p.screen.frameRate,p.screenAudio&&(Q.audio=p.screenAudio),r.default.debug("use getDisplayMedia, constraints:",Q),window.navigator.mediaDevices.getDisplayMedia(Q).then(function(J){!p.screenAudio&&p.audio&&(x++,G()),L(J)}).catch(M)}r.default.error("["+l.streamId+"]This browser does not support screenSharing"),N({code:"This browser does not support screen sharing"})}}else G()}else L(h)}},function(z,H,I){var E=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(H,"__esModule",{value:!0});var f=E(I(0)),S=function(){function g(y,s,m){s===void 0&&(s=""),this.name="AgoraRTCException",this.code=y,this.message="AgoraRTCError "+this.code+": "+s,this.data=m}return g.prototype.toString=function(){return this.data?this.message+" data: "+JSON.stringify(this.data):this.message},g.prototype.throw=function(){throw f.default.error(this.toString()),this},g}();H.AgoraRTCError=S,function(g){g.UNEXPECTED_ERROR="UNEXPECTED_ERROR",g.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",g.TIMEOUT="TIMEOUT",g.INVALID_PARAMS="INVALID_PARAMS",g.NOT_SUPPORT="NOT_SUPPORT",g.INVALID_OPERATION="INVALID_OPERATION",g.OPERATION_ABORT="OPERATION_ABORT",g.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",g.NETWORK_ERROR="NETWORK_ERROR",g.NETWORK_TIMEOUT="NETWORK_TIMEOUT",g.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",g.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",g.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",g.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",g.ELECTRON_IS_NULL="ELECTRON_IS_NULL",g.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",g.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",g.STREAM_IS_CLOSED="STREAM_IS_CLOSED",g.ABORT_OTHER_INIT="ABORT_OTHER_INIT",g.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",g.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",g.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",g.PERMISSION_DENIED="PERMISSION_DENIED",g.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",g.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",g.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",g.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",g.TRACK_IS_DISABLED="TRACK_IS_DISABLED",g.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",g.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",g.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",g.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",g.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",g.UID_CONFLICT="UID_CONFLICT",g.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",g.INVALID_TRACK="INVALID_TRACK",g.SENDER_NOT_FOUND="SENDER_NOT_FOUND",g.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",g.SET_ANSWER_FAILED="SET_ANSWER_FAILED",g.ICE_FAILED="ICE_FAILED",g.PC_CLOSED="PC_CLOSED",g.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",g.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",g.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",g.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",g.INVALID_REMOTE_USER="INVALID_REMOTE_USER",g.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",g.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",g.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",g.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",g.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",g.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",g.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",g.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",g.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",g.WS_ABORT="WS_ABORT",g.WS_DISCONNECT="WS_DISCONNECT",g.WS_ERR="WS_ERR",g.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",g.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",g.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",g.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",g.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",g.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",g.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",g.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",g.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",g.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",g.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",g.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",g.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",g.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",g.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",g.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",g.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",g.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",g.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(H.AgoraRTCErrorCode||(H.AgoraRTCErrorCode={}))},function(z,H,I){I.d(H,"a",function(){return s});var E=I(0),f=window.AudioContext||window.webkitAudioContext,S=I(2),g=S.getParameter,y=S.setParameter,s=function(){return g("AUDIO_CONTEXT")||y("AUDIO_CONTEXT",function(){if(f){var m=new f;return window.ctx=m,new Promise(function(r){document.body?r():window.addEventListener("load",r)}).then(function(){var r=function a(){m.state=="suspended"?(E.default.debug("AudioContext is suspended, auto resume"),m.resume().then(function(){E.default.debug("AudioContext resume success"),document.body.removeEventListener("touchend",a,!0),document.body.removeEventListener("mousedown",a,!0)})):(E.default.debug("AudioContext is running"),document.body.removeEventListener("touchend",a,!0),document.body.removeEventListener("mousedown",a,!0))};document.body.addEventListener("touchend",r,!0),document.body.addEventListener("mousedown",r,!0)}),m}throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}()),g("AUDIO_CONTEXT")};s()},function(z,H,I){var E=I(1),f=null,S=function(){try{f=window.require("electron")}catch{}return f},g=function(s){var m=E.report.reportApiInvoke(null,{callback:s,name:"getScreenSources",options:arguments,tag:"tracer"}),r=S();if(!r)return m&&m("electron is null");try{var a=r.desktopCapturer.getSources({types:["window","screen"]})}catch(d){console.log(d)}a instanceof Promise?a.then(function(d){return m&&m(null,d)}).catch(function(d){return m&&m(d)}):a=r.desktopCapturer.getSources({types:["window","screen"]},function(d,T){m&&m(null,T)})},y=function(s,m,r){var a=m.width;m={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:m.height,maxWidth:a,maxFrameRate:m.frameRate&&m.frameRate.max,minFrameRate:m.frameRate&&m.frameRate.min}}},navigator.webkitGetUserMedia(m,function(d){r&&r(null,d)},function(d){r&&r(d)})};H.a={isElectron:function(){return!!S()},getElectronInstance:S,getScreenSources:g,getScreenStream:y,shareScreen:function(s,m){g(function(r,a){if(r)return m&&m(r);(function(d,T){var C=document.createElement("div");C.innerText="share screen",C.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");var b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var R=document.createElement("div");R.setAttribute("style","text-align: right; padding: 16px 0;");var D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=function(){document.body.removeChild(_),T&&T("NotAllowedError")},R.appendChild(D),v.appendChild(u),v.appendChild(b),v.appendChild(R);var _=document.createElement("div");_.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(C),_.appendChild(v),document.body.appendChild(_),d.map(function(j){if(j.id){var q=document.createElement("div");q.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var B=j.thumbnail;B.getSize().width>1920&&(B=B.resize({width:1920})),q.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+B.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+j.name.replace(/[\u00A0-\u9999<>\&]/g,function(W){return"&#"+W.charCodeAt(0)+";"})+"</span>",q.onclick=function(){document.body.removeChild(_),T&&T(null,j.id)},b.appendChild(q)}})})(a,function(d,T){if(d)return m&&m(d);y(T,s,m)})})}}},function(z,H,I){Object.defineProperty(H,"__esModule",{value:!0});var E=I(3);(function(f){f.TRANSCODE="mix_streaming",f.RAW="raw_streaming",f.INJECT="inject_streaming"})(H.LiveStreamingServiceMode||(H.LiveStreamingServiceMode={})),H.DEFAULT_LIVE_STREAMING_TRANSCODING_USER={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},H.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},H.isLiveStreamingTranscodingConfig=function(f){return E.isEmpty(f.width)||E.checkValidNumber(f.width,"config.width",0),E.isEmpty(f.height)||E.checkValidNumber(f.height,"config.height",0),E.isEmpty(f.videoBitrate)||E.checkValidNumber(f.videoBitrate,"config.videoBitrate",1,1e6),E.isEmpty(f.videoFramerate)||E.checkValidNumber(f.videoFramerate,"config.videoFramerate"),E.isEmpty(f.lowLatency)||E.checkValidBoolean(f.lowLatency,"config.lowLatency"),E.isEmpty(f.audioSampleRate)||E.checkValidEnum(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),E.isEmpty(f.audioBitrate)||E.checkValidNumber(f.audioBitrate,"config.audioBitrate",1,128),E.isEmpty(f.audioChannels)||E.checkValidEnum(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),E.isEmpty(f.videoGop)||E.checkValidNumber(f.videoGop,"config.videoGop"),E.isEmpty(f.videoCodecProfile)||E.checkValidEnum(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),E.isEmpty(f.userCount)||E.checkValidNumber(f.userCount,"config.userCount",0,17),E.isEmpty(f.backgroundColor)||E.checkValidNumber(f.backgroundColor,"config.backgroundColor",0,16777215),f.transcodingUsers&&!E.isEmpty(f.transcodingUsers)&&(E.checkValidArray(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach(function(S,g){E.checkValidUID(S.uid),E.isEmpty(S.x)||E.checkValidNumber(S.x,"transcodingUser["+g+"].x",0,1e4),E.isEmpty(S.y)||E.checkValidNumber(S.y,"transcodingUser["+g+"].y",0,1e4),E.isEmpty(S.width)||E.checkValidNumber(S.width,"transcodingUser["+g+"].width",0,1e4),E.isEmpty(S.height)||E.checkValidNumber(S.height,"transcodingUser["+g+"].height",0,1e4),E.isEmpty(S.zOrder)||E.checkValidNumber(S.zOrder-1,"transcodingUser["+g+"].zOrder",0,100),E.isEmpty(S.alpha)||E.checkValidFloatNumber(S.alpha,"transcodingUser["+g+"].alpha",0,1)})),f.images&&!E.isEmpty(f.images)&&(E.checkValidArray(f.images,"config.images"),f.images.forEach(function(S,g){E.checkValidString(S.url,"images["+g+"].url",1,1e3,!1),E.isEmpty(S.x)||E.checkValidNumber(S.x,"images["+g+"].x",0,1e4),E.isEmpty(S.y)||E.checkValidNumber(S.y,"images["+g+"].y",0,1e4),E.isEmpty(S.width)||E.checkValidNumber(S.width,"images["+g+"].width",0,1e4),E.isEmpty(S.height)||E.checkValidNumber(S.height,"images["+g+"].height",0,1e4),E.isEmpty(S.zOrder)||E.checkValidNumber(S.zOrder,"images["+g+"].zOrder",0,255),E.isEmpty(S.alpha)||E.checkValidFloatNumber(S.alpha,"images["+g+"].alpha",0,1)})),!0},H.DEFAULT_TRANSCODING_CONFIG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFramerate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},H.isInjectStreamConfig=function(f){return E.isEmpty(f.audioVolume)||E.checkValidNumber(f.audioVolume,"config.audioVolume",0,1e3),E.isEmpty(f.audioBitrate)||E.checkValidNumber(f.audioBitrate,"config.audioBitrate",1,1e4),E.isEmpty(f.audioChannels)||E.checkValidEnum(f.audioChannels,"config.audioChannels",[1,2]),E.isEmpty(f.audioSampleRate)||E.checkValidEnum(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),E.isEmpty(f.width)||E.checkValidNumber(f.width,"config.width",0,1e4),E.isEmpty(f.height)||E.checkValidNumber(f.height,"config.height",0,1e4),E.isEmpty(f.videoBitrate)||E.checkValidNumber(f.videoBitrate,"config.videoBitrate",1,1e4),E.isEmpty(f.videoFramerate)||E.checkValidNumber(f.videoFramerate,"config.videoFramerate",1,1e4),E.isEmpty(f.videoGop)||E.checkValidNumber(f.videoGop,"config.videoGop",1,1e4),!0},H.DEFAULT_INJECT_CONFIG={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},function(f){f.WARNING="@live_uap-warning",f.ERROR="@line_uap-error",f.PUBLISH_STREAM_STATUS="@live_uap-publish-status",f.INJECT_STREAM_STATUS="@live_uap-inject-status",f.WORKER_STATUS="@live_uap-worker-status",f.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(H.LiveStreamingUapSignalEvents||(H.LiveStreamingUapSignalEvents={})),function(f){f.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(H.LiveStreamingInternalEvents||(H.LiveStreamingInternalEvents={})),function(f){f[f.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",f[f.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",f[f.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",f[f.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",f[f.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",f[f.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",f[f.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",f[f.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",f[f.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",f[f.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",f[f.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",f[f.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",f[f.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",f[f.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",f[f.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",f[f.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",f[f.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",f[f.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE=505]="LIVE_STREAM_RESPONSE_INGNORE_MESSAGE",f[f.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",f[f.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",f[f.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",f[f.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(H.LIVE_STREAM_ERROR_CODE||(H.LIVE_STREAM_ERROR_CODE={})),function(f){f.CONNECTED="websocket:connected",f.RECONNECTING="websocket:reconnecting",f.WILL_RECONNECT="websocket:will_reconnect",f.CLOSED="websocket:closed",f.FAILED="websocket:failed",f.ON_MESSAGE="websocket:on_message",f.REQUEST_NEW_URLS="websocket:request_new_urls"}(H.WebSocketManagerEvents||(H.WebSocketManagerEvents={}))},function(z,H,I){var E=I(57),f=I(58);z.exports=function(S,g,y){var s=g&&y||0;typeof S=="string"&&(g=S==="binary"?new Array(16):null,S=null);var m=(S=S||{}).random||(S.rng||E)();if(m[6]=15&m[6]|64,m[8]=63&m[8]|128,g)for(var r=0;r<16;++r)g[s+r]=m[r];return g||f(m)}},function(z,H,I){var E;z.exports=(E=I(73),function(f){var S=E,g=S.lib,y=g.WordArray,s=g.Hasher,m=S.algo,r=[],a=[];(function(){function C(R){for(var D=f.sqrt(R),_=2;_<=D;_++)if(!(R%_))return!1;return!0}function v(R){return 4294967296*(R-(0|R))|0}for(var u=2,b=0;b<64;)C(u)&&(b<8&&(r[b]=v(f.pow(u,.5))),a[b]=v(f.pow(u,1/3)),b++),u++})();var d=[],T=m.SHA256=s.extend({_doReset:function(){this._hash=new y.init(r.slice(0))},_doProcessBlock:function(C,v){for(var u=this._hash.words,b=u[0],R=u[1],D=u[2],_=u[3],j=u[4],q=u[5],B=u[6],W=u[7],k=0;k<64;k++){if(k<16)d[k]=0|C[v+k];else{var p=d[k-15],n=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,N=d[k-2],l=(N<<15|N>>>17)^(N<<13|N>>>19)^N>>>10;d[k]=n+d[k-7]+l+d[k-16]}var t=b&R^b&D^R&D,x=(b<<30|b>>>2)^(b<<19|b>>>13)^(b<<10|b>>>22),o=W+((j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25))+(j&q^~j&B)+a[k]+d[k];W=B,B=q,q=j,j=_+o|0,_=D,D=R,R=b,b=o+(x+t)|0}u[0]=u[0]+b|0,u[1]=u[1]+R|0,u[2]=u[2]+D|0,u[3]=u[3]+_|0,u[4]=u[4]+j|0,u[5]=u[5]+q|0,u[6]=u[6]+B|0,u[7]=u[7]+W|0},_doFinalize:function(){var C=this._data,v=C.words,u=8*this._nDataBytes,b=8*C.sigBytes;return v[b>>>5]|=128<<24-b%32,v[14+(b+64>>>9<<4)]=f.floor(u/4294967296),v[15+(b+64>>>9<<4)]=u,C.sigBytes=4*v.length,this._process(),this._hash},clone:function(){var C=s.clone.call(this);return C._hash=this._hash.clone(),C}});S.SHA256=s._createHelper(T),S.HmacSHA256=s._createHmacHelper(T)}(Math),E.SHA256)},function(z,H,I){Object.defineProperty(H,"__esModule",{value:!0}),H.randomString=function(E){E===void 0&&(E=8);for(var f="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",S=f.length,g="",y=0;y<E;y++)g+=f.charAt(Math.floor(Math.random()*S));return g}},function(z,H,I){var E=this&&this.__assign||function(){return(E=Object.assign||function(R){for(var D,_=1,j=arguments.length;_<j;_++)for(var q in D=arguments[_])Object.prototype.hasOwnProperty.call(D,q)&&(R[q]=D[q]);return R}).apply(this,arguments)},f=this&&this.__awaiter||function(R,D,_,j){return new(_||(_=Promise))(function(q,B){function W(n){try{p(j.next(n))}catch(N){B(N)}}function k(n){try{p(j.throw(n))}catch(N){B(N)}}function p(n){var N;n.done?q(n.value):(N=n.value,N instanceof _?N:new _(function(l){l(N)})).then(W,k)}p((j=j.apply(R,D||[])).next())})},S=this&&this.__generator||function(R,D){var _,j,q,B,W={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return B={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function k(p){return function(n){return function(N){if(_)throw new TypeError("Generator is already executing.");for(;W;)try{if(_=1,j&&(q=2&N[0]?j.return:N[0]?j.throw||((q=j.return)&&q.call(j),0):j.next)&&!(q=q.call(j,N[1])).done)return q;switch(j=0,q&&(N=[2&N[0],q.value]),N[0]){case 0:case 1:q=N;break;case 4:return W.label++,{value:N[1],done:!1};case 5:W.label++,j=N[1],N=[0];continue;case 7:N=W.ops.pop(),W.trys.pop();continue;default:if(q=W.trys,!((q=q.length>0&&q[q.length-1])||N[0]!==6&&N[0]!==2)){W=0;continue}if(N[0]===3&&(!q||N[1]>q[0]&&N[1]<q[3])){W.label=N[1];break}if(N[0]===6&&W.label<q[1]){W.label=q[1],q=N;break}if(q&&W.label<q[2]){W.label=q[2],W.ops.push(N);break}q[2]&&W.ops.pop(),W.trys.pop();continue}N=D.call(R,W)}catch(l){N=[6,l],j=0}finally{_=q=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([p,n])}}},g=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(H,"__esModule",{value:!0});var y=I(2),s=g(I(37)),m=I(24),r=g(I(0)),a=I(1);function d(R){return new Promise(function(D){window.setTimeout(D,R)})}function T(R,D){return new Promise(function(_,j){D.timeout=D.timeout||y.getParameter("HTTP_CONNECT_TIMEOUT"),D.responseType=D.responseType||"json",D.data&&(D.data=JSON.stringify(D.data)),D.headers=D.headers||{},D.headers["Content-Type"]="application/json",D.method="POST",D.url=R,s.default.request(D).then(function(q){_(q.data)}).catch(function(q){s.default.isCancel(q)?j(new m.AgoraRTCError(m.AgoraRTCErrorCode.OPERATION_ABORT,"cancel token canceled")):q.code==="ECONNABORTED"?j(new m.AgoraRTCError(m.AgoraRTCErrorCode.NETWORK_TIMEOUT,q.message)):q.response?j(new m.AgoraRTCError(m.AgoraRTCErrorCode.NETWORK_RESPONSE_ERROR,q.response.status)):j(new m.AgoraRTCError(m.AgoraRTCErrorCode.NETWORK_ERROR,q.message))})})}function C(R,D,_,j){var q=this,B=Object.assign({},H.DEFAULT_RETRY_CONFIG,j),W=B.timeout,k=function(){return f(q,void 0,void 0,function(){return S(this,function(N){switch(N.label){case 0:return[4,d(W)];case 1:return N.sent(),W*=B.timeoutFactor,W=Math.min(B.maxRetryTimeout,W),[2]}})})},p=!1,n=new Promise(function(N,l){return f(q,void 0,void 0,function(){var t,x,o;return S(this,function(h){switch(h.label){case 0:D=D||function(){return!1},_=_||function(){return!0},t=0,h.label=1;case 1:if(!(t<B.maxRetryCount))return[3,12];if(p)return[2,l(new m.AgoraRTCError(m.AgoraRTCErrorCode.OPERATION_ABORT))];h.label=2;case 2:return h.trys.push([2,7,,11]),[4,R()];case 3:return x=h.sent(),D(x,t)?t+1===B.maxRetryCount?[2,N(x)]:[4,k()]:[3,5];case 4:return h.sent(),[3,6];case 5:return[2,N(x)];case 6:return[3,11];case 7:return o=h.sent(),_(o,t)?t+1===B.maxRetryCount?[2,l(o)]:[4,k()]:[3,9];case 8:return h.sent(),[3,10];case 9:return[2,l(o)];case 10:return[3,11];case 11:return t+=1,[3,1];case 12:return[2]}})})});return n.cancel=function(){return p=!0},n}function v(R,D){return{addressList:R.servers.map(function(_,j){return"wss://"+_.address.replace(/\./g,"-")+".edge.agora.io:"+_.wss+"?serviceName="+encodeURIComponent(D)}),workerToken:R.workerToken,vid:R.vid}}H.wait=d,H.post=T,H.DEFAULT_RETRY_CONFIG={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},H.getRetryWaitTime=function(R,D){var _=D.timeout*Math.pow(D.timeoutFactor,R);return Math.min(D.maxRetryTimeout,_)},H.retryable=C,H.liveStreamingServerResponseToResult=v;var u=1;function b(R,D,_,j,q){var B=this;q===void 0&&(q=H.DEFAULT_RETRY_CONFIG),u+=1;var W,k,p={sid:_.sid,command:"convergeAllocateEdge",uid:"666",appId:_.appId,ts:Math.floor(Date.now()/1e3),seq:u,requestId:u,version:y.VERSION,cname:_.cname},n={service_name:D,json_body:JSON.stringify(p)},N=R[0];return C(function(){return f(B,void 0,void 0,function(){var l,t,x,o,h;return S(this,function(L){switch(L.label){case 0:return W=Date.now(),[4,T(N,{data:n,cancelToken:j,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}})];case 1:if(l=L.sent(),k=Date.now()-W,l.code!==0)throw x=new m.AgoraRTCError(m.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l.code,{retry:!0}),r.default.error(x.toString()),x;if((t=JSON.parse(l.json_body)).code!==200)throw x=new m.AgoraRTCError(m.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center error, code: "+t.code+", reason: "+t.reason),r.default.error(x.toString()),x;if(!t.servers||t.servers.length===0)throw x=new m.AgoraRTCError(m.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center empty server"),r.default.error(x.toString()),x;if(o=v(t,D),y.getParameter("LIVE_STREAMING_ADDRESS"))try{h=JSON.parse(y.getParameter("LIVE_STREAMING_ADDRESS")),o.addressList=h}catch{o.addressList=[y.getParameter("LIVE_STREAMING_ADDRESS")]}return[2,E(E({},o),{responseTime:k})]}})})},function(l,t){return a.report.requestApWorkerEvent(_.sid,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(l.addressList),firstSuccess:t===0,responseTime:k,serverIp:R[t%R.length]}),!1},function(l,t){return a.report.requestApWorkerEvent(_.sid,{success:!1,sc:l.data&&l.data.code||200,serviceName:D,responseTime:k,serverIp:R[t%R.length]}),!!(l.code!==m.AgoraRTCErrorCode.OPERATION_ABORT&&l.code!==m.AgoraRTCErrorCode.UNEXPECTED_RESPONSE||l.data&&l.data.retry)&&(N=R[(t+1)%R.length],!0)},q)}H.requestLiveStreamingWorkerManager=b,H.getLiveStreamingWorkerMangerResult=function(R,D,_){return f(this,void 0,void 0,function(){var j,q;return S(this,function(B){switch(B.label){case 0:j=y.getParameter("UAP_AP").map(function(W){return D.proxyServer?"https://"+D.proxyServer+"/ap/?url="+W+"/api/v1?action=uap":"https://"+W+"/api/v1?action=uap"}),B.label=1;case 1:return B.trys.push([1,3,,4]),[4,b(j,R,D,_)];case 2:return[2,B.sent()];case 3:throw q=B.sent(),a.report.requestApWorkerEvent(D.sid,{success:!1,sc:q.data&&q.data.code||200,serviceName:R,responseTime:q.data&&q.data.responseTime}),q;case 4:return[2]}})})}},function(z,H,I){var E=I(70),f=I(71),S=I(34),g=I(72);z.exports=function(y){return E(y)||f(y)||S(y)||g()}},function(z,H){var I;I=function(){return this}();try{I=I||new Function("return this")()}catch{typeof window=="object"&&(I=window)}z.exports=I},function(z,H,I){var E=I(35);z.exports=function(f,S){if(f){if(typeof f=="string")return E(f,S);var g=Object.prototype.toString.call(f).slice(8,-1);return g==="Object"&&f.constructor&&(g=f.constructor.name),g==="Map"||g==="Set"?Array.from(g):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?E(f,S):void 0}}},function(z,H){z.exports=function(I,E){(E==null||E>I.length)&&(E=I.length);for(var f=0,S=new Array(E);f<E;f++)S[f]=I[f];return S}},function(z,H,I){var E=this&&this.__spreadArrays||function(){for(var y=0,s=0,m=arguments.length;s<m;s++)y+=arguments[s].length;var r=Array(y),a=0;for(s=0;s<m;s++)for(var d=arguments[s],T=0,C=d.length;T<C;T++,a++)r[a]=d[T];return r};Object.defineProperty(H,"__esModule",{value:!0});var f=I(24),S=function(){function y(){this._events={},this.addListener=this.on}return y.prototype.getListeners=function(s){return this._events[s]?this._events[s].map(function(m){return m.listener}):[]},y.prototype.on=function(s,m){this._events[s]||(this._events[s]=[]);var r=this._events[s];this._indexOfListener(r,m)===-1&&r.push({listener:m,once:!1})},y.prototype.once=function(s,m){this._events[s]||(this._events[s]=[]);var r=this._events[s];this._indexOfListener(r,m)===-1&&r.push({listener:m,once:!0})},y.prototype.off=function(s,m){if(this._events[s]){var r=this._events[s],a=this._indexOfListener(r,m);a!==-1&&r.splice(a,1),this._events[s].length===0&&delete this._events[s]}},y.prototype.removeAllListeners=function(s){s?delete this._events[s]:this._events={}},y.prototype.emit=function(s){for(var m=[],r=1;r<arguments.length;r++)m[r-1]=arguments[r];this._events[s]||(this._events[s]=[]);for(var a=this._events[s].map(function(C){return C}),d=0;d<a.length;d+=1){var T=a[d];T.once&&this.off(s,T.listener),T.listener.apply(this,m||[])}},y.prototype._indexOfListener=function(s,m){for(var r=s.length;r--;)if(s[r].listener===m)return r;return-1},y}();function g(y,s){for(var m=[],r=2;r<arguments.length;r++)m[r-2]=arguments[r];var a=null,d=null;if(y.emit.apply(y,E([s],m,[function(T){a=T},function(T){d=T}])),d!==null)throw d;if(a===null)throw new f.AgoraRTCError(f.AgoraRTCErrorCode.UNEXPECTED_ERROR,"handler is not sync");return a}H.EventEmitter=S,H.emitAsPromise=function(y,s){for(var m=[],r=2;r<arguments.length;r++)m[r-2]=arguments[r];return y.getListeners(s).length===0?Promise.reject(new f.AgoraRTCError(f.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not emit promise")):new Promise(function(a,d){y.emit.apply(y,E([s],m,[a,d]))})},H.emitAsInvokerNoResponse=function(y,s){for(var m=[],r=2;r<arguments.length;r++)m[r-2]=arguments[r];return y.getListeners(s).length===0?null:g.apply(void 0,E([y,s],m))},H.emitAsInvoker=g},function(z,H,I){z.exports=I(78)},function(z,H,I){z.exports=function(E,f){return function(){for(var S=new Array(arguments.length),g=0;g<S.length;g++)S[g]=arguments[g];return E.apply(f,S)}}},function(z,H,I){var E=I(18);function f(S){return encodeURIComponent(S).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}z.exports=function(S,g,y){if(!g)return S;var s;if(y)s=y(g);else if(E.isURLSearchParams(g))s=g.toString();else{var m=[];E.forEach(g,function(a,d){a!=null&&(E.isArray(a)?d+="[]":a=[a],E.forEach(a,function(T){E.isDate(T)?T=T.toISOString():E.isObject(T)&&(T=JSON.stringify(T)),m.push(f(d)+"="+f(T))}))}),s=m.join("&")}if(s){var r=S.indexOf("#");r!==-1&&(S=S.slice(0,r)),S+=(S.indexOf("?")===-1?"?":"&")+s}return S}},function(z,H,I){z.exports=function(E){return!(!E||!E.__CANCEL__)}},function(z,H,I){(function(E){var f=I(18),S=I(84),g={"Content-Type":"application/x-www-form-urlencoded"};function y(r,a){!f.isUndefined(r)&&f.isUndefined(r["Content-Type"])&&(r["Content-Type"]=a)}var s,m={adapter:((typeof XMLHttpRequest!="undefined"||E!==void 0&&Object.prototype.toString.call(E)==="[object process]")&&(s=I(42)),s),transformRequest:[function(r,a){return S(a,"Accept"),S(a,"Content-Type"),f.isFormData(r)||f.isArrayBuffer(r)||f.isBuffer(r)||f.isStream(r)||f.isFile(r)||f.isBlob(r)?r:f.isArrayBufferView(r)?r.buffer:f.isURLSearchParams(r)?(y(a,"application/x-www-form-urlencoded;charset=utf-8"),r.toString()):f.isObject(r)?(y(a,"application/json;charset=utf-8"),JSON.stringify(r)):r}],transformResponse:[function(r){if(typeof r=="string")try{r=JSON.parse(r)}catch{}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(r){return r>=200&&r<300}};m.headers={common:{Accept:"application/json, text/plain, */*"}},f.forEach(["delete","get","head"],function(r){m.headers[r]={}}),f.forEach(["post","put","patch"],function(r){m.headers[r]=f.merge(g)}),z.exports=m}).call(this,I(83))},function(z,H,I){var E=I(18),f=I(85),S=I(39),g=I(87),y=I(90),s=I(91),m=I(43);z.exports=function(r){return new Promise(function(a,d){var T=r.data,C=r.headers;E.isFormData(T)&&delete C["Content-Type"];var v=new XMLHttpRequest;if(r.auth){var u=r.auth.username||"",b=r.auth.password||"";C.Authorization="Basic "+btoa(u+":"+b)}var R=g(r.baseURL,r.url);if(v.open(r.method.toUpperCase(),S(R,r.params,r.paramsSerializer),!0),v.timeout=r.timeout,v.onreadystatechange=function(){if(v&&v.readyState===4&&(v.status!==0||v.responseURL&&v.responseURL.indexOf("file:")===0)){var j="getAllResponseHeaders"in v?y(v.getAllResponseHeaders()):null,q={data:r.responseType&&r.responseType!=="text"?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:j,config:r,request:v};f(a,d,q),v=null}},v.onabort=function(){v&&(d(m("Request aborted",r,"ECONNABORTED",v)),v=null)},v.onerror=function(){d(m("Network Error",r,null,v)),v=null},v.ontimeout=function(){var j="timeout of "+r.timeout+"ms exceeded";r.timeoutErrorMessage&&(j=r.timeoutErrorMessage),d(m(j,r,"ECONNABORTED",v)),v=null},E.isStandardBrowserEnv()){var D=I(92),_=(r.withCredentials||s(R))&&r.xsrfCookieName?D.read(r.xsrfCookieName):void 0;_&&(C[r.xsrfHeaderName]=_)}if("setRequestHeader"in v&&E.forEach(C,function(j,q){T===void 0&&q.toLowerCase()==="content-type"?delete C[q]:v.setRequestHeader(q,j)}),E.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),r.responseType)try{v.responseType=r.responseType}catch(j){if(r.responseType!=="json")throw j}typeof r.onDownloadProgress=="function"&&v.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&v.upload&&v.upload.addEventListener("progress",r.onUploadProgress),r.cancelToken&&r.cancelToken.promise.then(function(j){v&&(v.abort(),d(j),v=null)}),T===void 0&&(T=null),v.send(T)})}},function(z,H,I){var E=I(86);z.exports=function(f,S,g,y,s){var m=new Error(f);return E(m,S,g,y,s)}},function(z,H,I){var E=I(18);z.exports=function(f,S){S=S||{};var g={},y=["url","method","params","data"],s=["headers","auth","proxy"],m=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];E.forEach(y,function(d){S[d]!==void 0&&(g[d]=S[d])}),E.forEach(s,function(d){E.isObject(S[d])?g[d]=E.deepMerge(f[d],S[d]):S[d]!==void 0?g[d]=S[d]:E.isObject(f[d])?g[d]=E.deepMerge(f[d]):f[d]!==void 0&&(g[d]=f[d])}),E.forEach(m,function(d){S[d]!==void 0?g[d]=S[d]:f[d]!==void 0&&(g[d]=f[d])});var r=y.concat(s).concat(m),a=Object.keys(S).filter(function(d){return r.indexOf(d)===-1});return E.forEach(a,function(d){S[d]!==void 0?g[d]=S[d]:f[d]!==void 0&&(g[d]=f[d])}),g}},function(z,H,I){function E(f){this.message=f}E.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},E.prototype.__CANCEL__=!0,z.exports=E},function(z,H){z.exports=function(I,E,f){return E in I?Object.defineProperty(I,E,{value:f,enumerable:!0,configurable:!0,writable:!0}):I[E]=f,I}},function(z,H,I){var E=this&&this.__awaiter||function(v,u,b,R){return new(b||(b=Promise))(function(D,_){function j(W){try{B(R.next(W))}catch(k){_(k)}}function q(W){try{B(R.throw(W))}catch(k){_(k)}}function B(W){var k;W.done?D(W.value):(k=W.value,k instanceof b?k:new b(function(p){p(k)})).then(j,q)}B((R=R.apply(v,u||[])).next())})},f=this&&this.__generator||function(v,u){var b,R,D,_,j={label:0,sent:function(){if(1&D[0])throw D[1];return D[1]},trys:[],ops:[]};return _={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function q(B){return function(W){return function(k){if(b)throw new TypeError("Generator is already executing.");for(;j;)try{if(b=1,R&&(D=2&k[0]?R.return:k[0]?R.throw||((D=R.return)&&D.call(R),0):R.next)&&!(D=D.call(R,k[1])).done)return D;switch(R=0,D&&(k=[2&k[0],D.value]),k[0]){case 0:case 1:D=k;break;case 4:return j.label++,{value:k[1],done:!1};case 5:j.label++,R=k[1],k=[0];continue;case 7:k=j.ops.pop(),j.trys.pop();continue;default:if(D=j.trys,!((D=D.length>0&&D[D.length-1])||k[0]!==6&&k[0]!==2)){j=0;continue}if(k[0]===3&&(!D||k[1]>D[0]&&k[1]<D[3])){j.label=k[1];break}if(k[0]===6&&j.label<D[1]){j.label=D[1],D=k;break}if(D&&j.label<D[2]){j.label=D[2],j.ops.push(k);break}D[2]&&j.ops.pop(),j.trys.pop();continue}k=u.call(v,j)}catch(p){k=[6,p],R=0}finally{b=D=0}if(5&k[0])throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}([B,W])}}},S=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}},g=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var u={};if(v!=null)for(var b in v)Object.hasOwnProperty.call(v,b)&&(u[b]=v[b]);return u.default=v,u};Object.defineProperty(H,"__esModule",{value:!0});var y=S(I(59)),s=g(I(62)),m=g(I(63)),r=S(I(0)),a=I(2),d=y.default.Root.fromJSON(m),T=function(){function v(){this.requestArray=[],this.retryBackoffCount=0,this.state=0}return v.prototype.setProxy=function(u){this.proxyServer=u},v.prototype.sendReportList=function(u,b){var R=this,D=this._dataConvert("ProtoRaws",{vid:b,sendTs:Math.round(Date.now()/1e3),payloads:u.map(function(_){return{id:s[_.type],msg:R._dataConvert(_.type,_.data)}})});this.send(D)},v.prototype._dataConvert=function(u,b){var R;try{R=d.lookupType("protobuf."+u)}catch{r.default.error("[send-proto] invalid proto name "+u)}var D=R.create(b);return R.encode(D).finish()},v.prototype.send=function(u){this.state==0?this._send(u):this.requestArray.push(u)},v.prototype._send=function(u){return E(this,void 0,void 0,function(){return f(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,4]),this.state=1,[4,this.request(u)];case 1:return b.sent(),this.retryBackoffCount=0,this.requestArray.length!==0?this._send(this.requestArray.shift()):this.state=0,[3,4];case 2:return b.sent(),[4,C(this.retryBackoffCount++<2?200:1e4)];case 3:return b.sent(),this._send(u),[3,4];case 4:return[2]}})})},v.prototype.request=function(u){return E(this,void 0,void 0,function(){var b,R;return f(this,function(D){switch(D.label){case 0:b=this._getAddress(),R=this._getBackupAddress(),D.label=1;case 1:return D.trys.push([1,3,,5]),[4,this._request(b,u)];case 2:return D.sent(),[3,5];case 3:return D.sent(),[4,this._request(R,u)];case 4:return D.sent(),[3,5];case 5:return[2]}})})},v.prototype._request=function(u,b){return this._post(u,b)},v.prototype._post=function(u,b){var R=this;return new Promise(function(D,_){var j=new XMLHttpRequest;j.timeout=a.getParameter("HTTP_CONNECT_TIMEOUT"),j.open("POST",u,!0),j.setRequestHeader("Content-type","application/octet-stream"),R.proxyServer||(j.setRequestHeader("Cache-Control","no-cache, no-store"),j.setRequestHeader("Pragma","no-cache"),j.setRequestHeader("Expires","0")),j.onload=function(q){D(j.responseText)},j.onerror=function(q){_(q)},j.ontimeout=function(q){_(q)},j.send(b)})},v.prototype._getAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+a.getParameter("EVENT_REPORT_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+a.getParameter("EVENT_REPORT_DOMAIN")+":6443/events/proto-raws"},v.prototype._getBackupAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+a.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+a.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+":6443/events/proto-raws"},v}();H.default=T;var C=function(v){return new Promise(function(u){window.setTimeout(u,v)})}},function(z,H){z.exports=function(I,E){if(!(I instanceof E))throw new TypeError("Cannot call a class as a function")}},function(z,H){function I(E,f){for(var S=0;S<f.length;S++){var g=f[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(E,g.key,g)}}z.exports=function(E,f,S){return f&&I(E.prototype,f),S&&I(E,S),E}},function(z,H,I){var E=this&&this.__awaiter||function(r,a,d,T){return new(d||(d=Promise))(function(C,v){function u(D){try{R(T.next(D))}catch(_){v(_)}}function b(D){try{R(T.throw(D))}catch(_){v(_)}}function R(D){var _;D.done?C(D.value):(_=D.value,_ instanceof d?_:new d(function(j){j(_)})).then(u,b)}R((T=T.apply(r,a||[])).next())})},f=this&&this.__generator||function(r,a){var d,T,C,v,u={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return v={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function b(R){return function(D){return function(_){if(d)throw new TypeError("Generator is already executing.");for(;u;)try{if(d=1,T&&(C=2&_[0]?T.return:_[0]?T.throw||((C=T.return)&&C.call(T),0):T.next)&&!(C=C.call(T,_[1])).done)return C;switch(T=0,C&&(_=[2&_[0],C.value]),_[0]){case 0:case 1:C=_;break;case 4:return u.label++,{value:_[1],done:!1};case 5:u.label++,T=_[1],_=[0];continue;case 7:_=u.ops.pop(),u.trys.pop();continue;default:if(C=u.trys,!((C=C.length>0&&C[C.length-1])||_[0]!==6&&_[0]!==2)){u=0;continue}if(_[0]===3&&(!C||_[1]>C[0]&&_[1]<C[3])){u.label=_[1];break}if(_[0]===6&&u.label<C[1]){u.label=C[1],C=_;break}if(C&&u.label<C[2]){u.label=C[2],u.ops.push(_);break}C[2]&&u.ops.pop(),u.trys.pop();continue}_=a.call(r,u)}catch(j){_=[6,j],T=0}finally{d=C=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([R,D])}}},S=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(H,"__esModule",{value:!0});var g,y=S(I(0)),s=I(15);(function(r){r.NEW="new",r.PREPARING_OFFER="preparing-offer",r.OFFER_SENT="offer-sent",r.ESTABLISHED="established",r.CLOSED="closed"})(g||(g={}));var m=function(){function r(a){this.candidate=null,this.state=g.NEW,this.config=a,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(a),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:this.config.codec.toUpperCase(),bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return r.prototype.addStream=function(a){this.peerConnection.addStream(a)},r.prototype.setRtpSenderParameters=function(a){return E(this,void 0,void 0,function(){return f(this,function(d){return[2]})})},r.prototype.setAnswer=function(a){var d=JSON.parse(a);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:d.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},r.prototype.close=function(){this.peerConnection.close()},r.prototype.getStats=function(a,d){if(d===void 0&&(d=500),d=d>500?500:d,Date.now()-this.lastTimeGetStats<d){var T=[];this.config.isSubscriber?(T.push(this.receiveVideoStats),T.push(this.receiveAudioStats)):(T.push(this.sendAudioStats),T.push(this.sendVideoStats)),T.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),a&&a(T)}else this._getStats(a)},r.prototype._getStats=function(a){var d=this,T=[];this.peerConnection.getStats(null).then(function(C){d.lastTimeGetStats=Date.now(),Object.keys(C).map(function(v){var u=C[v];d.config.isSubscriber?u.type&&u.type==="inboundrtp"&&u.mediaType&&u.mediaType==="audio"?(d.receiveAudioStats.id=u.id+"recv",d.receiveAudioStats.type=u.type+"",d.receiveAudioStats.mediaType=u.mediaType+"",d.receiveAudioStats.packetsReceived=u.packetsReceived+"",d.receiveAudioStats.bytesReceived=u.bytesReceived+"",d.receiveAudioStats.packetsLost=u.packetsLost+"",d.receiveAudioStats.googJitterReceived=u.jitter+""):u.type&&u.type==="inboundrtp"&&u.mediaType&&u.mediaType==="video"?(d.receiveVideoStats.id=u.id+"recv",d.receiveVideoStats.type=u.type+"",d.receiveVideoStats.mediaType=u.mediaType+"",d.receiveVideoStats.packetsReceived=u.packetsReceived+"",d.receiveVideoStats.bytesReceived=u.bytesReceived+"",d.receiveVideoStats.packetsLost=u.packetsLost+"",d.receiveVideoStats.googJitterBufferMs=u.jitter+"",d.receiveVideoStats.googPlisSent=u.pliCount+"",d.receiveVideoStats.googFirsSent=u.firCount+"",d.receiveVideoStats.googNacksSent=u.nackCount+""):u.remoteSource&&u.type&&u.type==="track"&&u.trackIdentifier&&u.trackIdentifier.indexOf("v")!==-1?(d.receiveVideoStats.googFrameHeightReceived=u.frameHeight+"",d.receiveVideoStats.googFrameWidthReceived=u.frameWidth+"",d.receiveVideoStats.googFrameRateDecoded=u.framesPerSecond+"",d.receiveVideoStats.googFrameRateOutput=u.framesPerSecond+"",d.receiveVideoStats.googFrameRateReceived=u.framesPerSecond+"",d.receiveVideoStats.googFramesDecoded=u.framesDecoded+"",d.receiveVideoStats.googFrameReceived=u.framesReceived+""):u.remoteSource&&u.type&&u.type==="track"&&u.trackIdentifier&&u.trackIdentifier.indexOf("a")!==-1&&(d.receiveAudioStats.audioOutputLevel=u.audioLevel+""):!u.isRemote&&u.type&&u.type==="outboundrtp"&&u.mediaType&&u.mediaType==="audio"?(d.sendAudioStats.id=u.id+"send",d.sendAudioStats.type=u.type+"",d.sendAudioStats.mediaType=u.mediaType+"",d.sendAudioStats.packetsSent=u.packetsSent+"",d.sendAudioStats.bytesSent=u.bytesSent+""):!u.isRemote&&u.type&&u.type==="outboundrtp"&&u.mediaType&&u.mediaType==="video"?(d.sendVideoStats.id=u.id+"send",d.sendVideoStats.type=u.type+"",d.sendVideoStats.mediaType=u.mediaType+"",d.sendVideoStats.packetsSent=u.packetsSent+"",d.sendVideoStats.bytesSent=u.bytesSent+"",d.sendVideoStats.googRtt=u.roundTripTime+"",d.sendVideoStats.googPlisReceived=u.pliCount+"",d.sendVideoStats.googFirsReceived=u.firCount+"",d.sendVideoStats.googNacksReceived=u.nackCount+""):!u.remoteSource&&u.type&&u.type==="track"&&u.framesSent&&u.framesSent!==0&&(d.sendVideoStats.googFrameHeightSent=u.frameHeight+"",d.sendVideoStats.googFrameHeightInput=u.frameHeight+"",d.sendVideoStats.googFrameWidthSent=u.frameWidth+"",d.sendVideoStats.googFrameWidthInput=u.frameWidth+"",d.sendVideoStats.googFramesEncoded=u.framesSent+"",d.sendVideoStats.googFrameRateSent=u.framesPerSecond+"")}),d.config.isSubscriber?(T.push(d.receiveVideoStats),T.push(d.receiveAudioStats)):(T.push(d.sendAudioStats),T.push(d.sendVideoStats)),T.push({id:"time",startTime:d.connectedTime,timestamp:Date.now()}),a&&a(T)})},r.prototype.getStatsRate=function(a){this.getStats(a)},r.prototype.initPeecConnection=function(a){var d=a.stunServerUrl,T=a.turnServer,C=a.iceServers;return this.pcConfig={iceServers:[]},C instanceof Array?this.pcConfig.iceServers=a.iceServers:d&&(d instanceof Array?d.map(function(v){typeof v=="string"&&v!==""&&this.pcConfig.iceServers.push({urls:v})}):typeof d=="string"&&d!==""&&this.pcConfig.iceServers.push({urls:d})),T&&(T instanceof Array?T.map(function(v){typeof v.url=="string"&&v.url!==""&&this.pcConfig.iceServers.push({username:v.username,credential:v.credential,url:v.url})}):T.mode!=="auto"&&T.mode!=="manual"||(T.udpport&&this.pcConfig.iceServers.push({username:T.username,credential:T.credential,credentialType:"password",urls:"turn:"+T.url+":"+T.udpport+"?transport=udp"}),typeof T.tcpport=="string"&&T.tcpport!==""&&this.pcConfig.iceServers.push({username:T.username,credential:T.credential,credentialType:"password",urls:"turn:"+T.url+":"+T.tcpport+"?transport=tcp"}),T.forceturn===!0&&(this.pcConfig.iceTransportPolicy="relay"))),new s.RTCPeerConnection(this.pcConfig)},r.prototype._ontrack=function(a){this.onaddstream&&this.onaddstream(a,"ontrack")},r.prototype._onaddstream=function(a){this.onaddstream&&this.onaddstream(a,"onaddstream")},r.prototype._oniceconnectionstatechange=function(a){a.currentTarget.iceConnectionState==="connected"&&(this.state=g.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(a.currentTarget.iceConnectionState)},r.prototype._onicecandidate=function(a){!this.candidate&&a&&(this.candidate=a.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},r.prototype.setLocalSDP=function(a){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:a.sdp,type:"offer"})),this.state=g.PREPARING_OFFER,a},r.prototype.editLocalSDP=function(a){return a.sdp=this.setBandWidth(a.sdp),a.sdp=this.reviseOpus(a.sdp),a.sdp=this.addCandidate(a.sdp),a},r.prototype.setSendRecv=function(a){return a=(a=(a=a.replace(/a=recvonly\r\n/g,`a=sendrecv\r
`)).replace(/a=sendonly\r\n/g,`a=sendrecv\r
`)).replace(/a=inactive\r\n/g,`a=sendrecv\r
`)},r.prototype.setBandWidth=function(a){var d,T,C=this.config,v=C.codec,u=C.minVideoBW,b=C.maxVideoBW,R=C.maxAudioBW,D=C.clientId;if((d=a.match(/m=video.*\r\n/))&&u&&b){T=d[0]+"b=AS:"+b+`\r
`;var _=0,j=0;v==="h264"?(_=a.search(/a=rtpmap:(\d+) H264\/90000\r\n/),j=a.search(/H264\/90000\r\n/)):v==="vp8"?(_=a.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),j=a.search(/VP8\/90000\r\n/)):v==="vp9"&&(_=a.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),j=a.search(/VP9\/90000\r\n/)),_!==-1&&j!==-1&&j-_>10&&(T=T+"a=fmtp:"+a.slice(_+9,j-1)+" x-google-min-bitrate="+u+`\r
`),a=a.replace(d[0],T),y.default.debug("["+D+"]Set Video Bitrate - min:"+u+" max:"+b)}return(d=a.match(/m=audio.*\r\n/))&&R&&(T=d[0]+"b=AS:"+R+`\r
`,a=a.replace(d[0],T)),a},r.prototype.reviseOpus=function(a){return a=(a=a.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},r.prototype.addCandidate=function(a){return a+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`},r.prototype.sendOffer=function(a){this.config.callback(JSON.stringify({sdp:a.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=g.OFFER_SENT},r}();H.default=m},function(z,H,I){var E=I(65),f=I(66),S=I(34),g=I(67);z.exports=function(y,s){return E(y)||f(y,s)||S(y,s)||g()}},function(z,H,I){var E,f,S;f=this,S=function(){var g,y=this;function s(T){y.console&&(y.console.error?y.console.error(T):y.console.log&&y.console.log(T))}function m(T,C,v,u){var b=u||s,R=T.createShader(v);return T.shaderSource(R,C),T.compileShader(R),T.getShaderParameter(R,T.COMPILE_STATUS)?R:(b("*** Error compiling shader '"+R+"':"+T.getShaderInfoLog(R)),T.deleteShader(R),null)}function r(T,C,v,u,b){var R=b||s,D=T.createProgram();return C.forEach(function(_){T.attachShader(D,_)}),v&&v.forEach(function(_,j){T.bindAttribLocation(D,u?u[j]:j,_)}),T.linkProgram(D),T.getProgramParameter(D,T.LINK_STATUS)?D:(R("Error in program linking:"+T.getProgramInfoLog(D)),T.deleteProgram(D),null)}(g=g||y)===g.top&&(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));var a,d=["VERTEX_SHADER","FRAGMENT_SHADER"];return!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(a=HTMLCanvasElement.prototype.getContext,function(){var T=arguments,C=T[0];return C==="webgl"&&((T=[].slice.call(arguments))[0]="experimental-webgl"),a.apply(this,T)})),{createProgram:r,createProgramFromSources:function(T,C,v,u,b){for(var R=[],D=0;D<C.length;++D)R.push(m(T,C[D],T[d[D]],b));return r(T,R,v,u,b)}}},(E=function(){return S.call(f)}.apply(H,[]))===void 0||(z.exports=E)},function(z,H,I){var E=this&&this.__awaiter||function(r,a,d,T){return new(d||(d=Promise))(function(C,v){function u(D){try{R(T.next(D))}catch(_){v(_)}}function b(D){try{R(T.throw(D))}catch(_){v(_)}}function R(D){var _;D.done?C(D.value):(_=D.value,_ instanceof d?_:new d(function(j){j(_)})).then(u,b)}R((T=T.apply(r,a||[])).next())})},f=this&&this.__generator||function(r,a){var d,T,C,v,u={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return v={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function b(R){return function(D){return function(_){if(d)throw new TypeError("Generator is already executing.");for(;u;)try{if(d=1,T&&(C=2&_[0]?T.return:_[0]?T.throw||((C=T.return)&&C.call(T),0):T.next)&&!(C=C.call(T,_[1])).done)return C;switch(T=0,C&&(_=[2&_[0],C.value]),_[0]){case 0:case 1:C=_;break;case 4:return u.label++,{value:_[1],done:!1};case 5:u.label++,T=_[1],_=[0];continue;case 7:_=u.ops.pop(),u.trys.pop();continue;default:if(C=u.trys,!((C=C.length>0&&C[C.length-1])||_[0]!==6&&_[0]!==2)){u=0;continue}if(_[0]===3&&(!C||_[1]>C[0]&&_[1]<C[3])){u.label=_[1];break}if(_[0]===6&&u.label<C[1]){u.label=C[1],C=_;break}if(C&&u.label<C[2]){u.label=C[2],u.ops.push(_);break}C[2]&&u.ops.pop(),u.trys.pop();continue}_=a.call(r,u)}catch(j){_=[6,j],T=0}finally{d=C=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([R,D])}}},S=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(H,"__esModule",{value:!0});var g=I(68),y=I(5),s=S(I(0));H.getSupportedCodec=function(r){return E(void 0,void 0,void 0,function(){var a,d,T,C,v;return f(this,function(u){switch(u.label){case 0:return a={video:[],audio:[]},typeof window!="undefined"?[3,1]:(s.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{d=g.createRTCPeerConnection({iceServers:[]})}catch(b){return s.default.error("Failed to init RTCPeerConnection",b),[2,Promise.reject(b)]}return d?[3,2]:(s.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(a)]);case 2:return r&&r.stream?[3,7]:(T={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},C=void 0,(y.isSafari()||y.isFireFox()||y.isWeChatBrowser())&&d.addTransceiver?(d.addTransceiver("audio"),d.addTransceiver("video"),[4,d.createOffer()]):[3,4]);case 3:return C=u.sent(),[3,6];case 4:return[4,new Promise(function(b,R){var D=setTimeout(function(){R("CREATEOFFER_TIMEOUT")},3e3);d.createOffer(function(_){clearTimeout(D),b(_)},function(_){clearTimeout(D),R(_)},T)})];case 5:C=u.sent(),u.label=6;case 6:return d.close(),v=C.sdp,[2,m(v)];case 7:return r.stream.getTracks&&d.addTrack?r.stream.getTracks().forEach(function(b){d.addTrack(b,r.stream)}):d.addStream(r.stream),C=void 0,y.isSafari()||y.isFireFox()?[4,d.createOffer()]:[3,9];case 8:return C=u.sent(),[3,11];case 9:return[4,new Promise(function(b,R){d.createOffer(b,R)})];case 10:C=u.sent(),u.label=11;case 11:return d.close(),v=C.sdp,[2,m(v)]}})})};var m=function(r){var a={video:[],audio:[]};return r.match(/ VP8/i)&&a.video.push("VP8"),r.match(/ VP9/i)&&a.video.push("VP9"),r.match(/ H264/i)&&a.video.push("H264"),r.match(/ opus/i)&&a.audio.push("OPUS"),Promise.resolve(a)}},function(z,H,I){var E=this&&this.__awaiter||function(y,s,m,r){return new(m||(m=Promise))(function(a,d){function T(u){try{v(r.next(u))}catch(b){d(b)}}function C(u){try{v(r.throw(u))}catch(b){d(b)}}function v(u){var b;u.done?a(u.value):(b=u.value,b instanceof m?b:new m(function(R){R(b)})).then(T,C)}v((r=r.apply(y,s||[])).next())})},f=this&&this.__generator||function(y,s){var m,r,a,d,T={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return d={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function C(v){return function(u){return function(b){if(m)throw new TypeError("Generator is already executing.");for(;T;)try{if(m=1,r&&(a=2&b[0]?r.return:b[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,b[1])).done)return a;switch(r=0,a&&(b=[2&b[0],a.value]),b[0]){case 0:case 1:a=b;break;case 4:return T.label++,{value:b[1],done:!1};case 5:T.label++,r=b[1],b=[0];continue;case 7:b=T.ops.pop(),T.trys.pop();continue;default:if(a=T.trys,!((a=a.length>0&&a[a.length-1])||b[0]!==6&&b[0]!==2)){T=0;continue}if(b[0]===3&&(!a||b[1]>a[0]&&b[1]<a[3])){T.label=b[1];break}if(b[0]===6&&T.label<a[1]){T.label=a[1],a=b;break}if(a&&T.label<a[2]){T.label=a[2],T.ops.push(b);break}a[2]&&T.ops.pop(),T.trys.pop();continue}b=s.call(y,T)}catch(R){b=[6,R],r=0}finally{m=a=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([v,u])}}};Object.defineProperty(H,"__esModule",{value:!0});var S=I(10);function g(y){for(var s="",m=0;m<y.length;m+=1)s+=String.fromCharCode(y[m]);return window.btoa(s)}H.encryptRSA=function(y){return E(void 0,void 0,void 0,function(){var s,m,r,a;return f(this,function(d){switch(d.label){case 0:return s=S.base64ToUint8Array(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),[4,window.crypto.subtle.importKey("spki",s,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])];case 1:return m=d.sent(),T=y,r=new TextEncoder().encode(T),[4,window.crypto.subtle.encrypt({name:"RSA-OAEP"},m,r)];case 2:return a=d.sent(),[2,g(new Uint8Array(a))]}var T})})}},function(z,H,I){var E=this&&this.__awaiter||function(a,d,T,C){return new(T||(T=Promise))(function(v,u){function b(_){try{D(C.next(_))}catch(j){u(j)}}function R(_){try{D(C.throw(_))}catch(j){u(j)}}function D(_){var j;_.done?v(_.value):(j=_.value,j instanceof T?j:new T(function(q){q(j)})).then(b,R)}D((C=C.apply(a,d||[])).next())})},f=this&&this.__generator||function(a,d){var T,C,v,u,b={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return u={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function R(D){return function(_){return function(j){if(T)throw new TypeError("Generator is already executing.");for(;b;)try{if(T=1,C&&(v=2&j[0]?C.return:j[0]?C.throw||((v=C.return)&&v.call(C),0):C.next)&&!(v=v.call(C,j[1])).done)return v;switch(C=0,v&&(j=[2&j[0],v.value]),j[0]){case 0:case 1:v=j;break;case 4:return b.label++,{value:j[1],done:!1};case 5:b.label++,C=j[1],j=[0];continue;case 7:j=b.ops.pop(),b.trys.pop();continue;default:if(v=b.trys,!((v=v.length>0&&v[v.length-1])||j[0]!==6&&j[0]!==2)){b=0;continue}if(j[0]===3&&(!v||j[1]>v[0]&&j[1]<v[3])){b.label=j[1];break}if(j[0]===6&&b.label<v[1]){b.label=v[1],v=j;break}if(v&&b.label<v[2]){b.label=v[2],b.ops.push(j);break}v[2]&&b.ops.pop(),b.trys.pop();continue}j=d.call(a,b)}catch(q){j=[6,q],C=0}finally{T=v=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}([D,_])}}},S=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(H,"__esModule",{value:!0});var g=S(I(0)),y=I(75),s=I(24),m=I(1),r=I(27);H.addLiveStreamingCapability=function(a,d){var T=this,C=function(v){var u=v.type;if(!a.joinInfo)return new s.AgoraRTCError(s.AgoraRTCErrorCode.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();switch(u){case r.LiveStreamingServiceMode.INJECT:return a._injectStreamingClient||(a._injectStreamingClient=new y.AgoraRTCLiveStreamingClient(a.joinInfo),a._injectStreamingClient.onInjectStatusChange=function(b,R,D){a.gatewayClient.dispatchEvent({type:"streamInjectedStatus",url:D,status:b})}),a._injectStreamingClient;case r.LiveStreamingServiceMode.RAW:return a._liveRawStreamingClient||(a._liveRawStreamingClient=new y.AgoraRTCLiveStreamingClient(a.joinInfo),a._liveRawStreamingClient.setGatewayConnectionState(a.getConnectionState()),a.on("connection-state-change",function(b){a._liveRawStreamingClient.setGatewayConnectionState(b.curState),b.prevState==="CONNECTING"&&b.curState==="CONNECTED"&&a._liveRawStreamingClient&&a._liveRawStreamingClient.resetAllTask()}),a._liveRawStreamingClient.onLiveStreamError=function(b,R){g.default.error("LIVE_STREAMING_ERROR",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:b,reason:R.code})},a._liveRawStreamingClient.onLiveStreamWarning=function(b,R){g.default.warning("LIVE_STREAMING_WARNING",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:b,reason:R.code})}),a._liveRawStreamingClient;case r.LiveStreamingServiceMode.TRANSCODE:return a._liveTranscodeStreamingClient||(a._liveTranscodeStreamingClient=new y.AgoraRTCLiveStreamingClient(a.joinInfo),a._liveTranscodeStreamingClient.setGatewayConnectionState(a.getConnectionState()),a.on("connection-state-change",function(b){a._liveTranscodeStreamingClient.setGatewayConnectionState(b.curState),b.prevState==="CONNECTING"&&b.curState==="CONNECTED"&&a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.resetAllTask()}),a._liveTranscodeStreamingClient.onLiveStreamError=function(b,R){g.default.error("LIVE_STREAMING_ERROR",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:b,reason:R.code})},a._liveTranscodeStreamingClient.onLiveStreamWarning=function(b,R){g.default.warning("LIVE_STREAMING_WARNING",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:b,reason:R})}),a._liveTranscodeStreamingClient}};a.gatewayClient.addEventListener("join",function(v){a._injectStreamingClient&&a._injectStreamingClient.resetAllTask()}),a.gatewayClient.addEventListener("stream-unpublished",function(v){v.options&&v.options.streamType===0&&(a._liveRawStreamingClient&&a._liveRawStreamingClient.resetAllTask(),a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.resetAllTask())}),a.gatewayClient.addEventListener("stream-published",function(v){}),a.startLiveStreaming=function(v,u){g.default.debug("startLiveStreaming");var b=m.report.reportApiInvoke(d.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});if(a.gatewayClient&&a.gatewayClient.role==="audience"){var R={code:403,reason:"AUDIENCE_STREAMING_FORBIDDEN"};throw b(R),R}var D=a._startLiveStreaming(v,u);return D.then(function(_){b(null,_)}).catch(function(_){g.default.error("LIVE_STREAMING_ERROR",_.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:v,reason:_.code}),b(_)}),D},a._startLiveStreaming=function(v,u){return E(T,void 0,void 0,function(){var b;return f(this,function(R){switch(R.label){case 0:return u||(d.codec==="vp8"&&g.default.warning("VP8 is not supported by raw_streaming. Subscriber side will suffer"),d.codec==="vp9"&&g.default.warning("VP9 is not supported by raw_streaming. Subscriber side will suffer"),d.mode==="rtc"&&g.default.warning("RTC mode is not supported by raw_streaming. Subscriber side will suffer")),(a._liveRawStreamingClient&&a._liveRawStreamingClient.haveUrl(v)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.haveUrl(v))&&new s.AgoraRTCError(s.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw(),b=u?r.LiveStreamingServiceMode.TRANSCODE:r.LiveStreamingServiceMode.RAW,[4,C({type:b}).startLiveStreamingTask(v,b)];case 1:return R.sent(),a.gatewayClient.dispatchEvent({type:"liveStreamingStarted",url:v}),[2]}})})},a.setLiveTranscoding=function(v){g.default.debug("setLiveTranscoding: "+JSON.stringify(v));var u=m.report.reportApiInvoke(d.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"}),b=C({type:r.LiveStreamingServiceMode.TRANSCODE});return b.setTranscodingConfig(v).then(function(){a.gatewayClient.dispatchEvent({type:"liveTranscodingUpdated"}),u(null)}).catch(function(R){g.default.error("SET_LIVE_TRANSCODING_ERROR",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",reason:R.code}),u(R)})},a.stopLiveStreaming=function(v){var u=m.report.reportApiInvoke(d.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"}),b=a._stopLiveStreaming(v);return b.then(function(R){u(null,R)}).catch(function(R){g.default.error("STOP_LIVE_STREAMING_ERROR",R.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:v,reason:R.code}),u(R)}),b},a._stopLiveStreaming=function(v){return E(this,void 0,void 0,function(){var u;return f(this,function(b){switch(b.label){case 0:return g.default.debug("stopLiveStreaming: "+JSON.stringify(v)),u=[a._liveRawStreamingClient,a._liveTranscodeStreamingClient],[4,Promise.all(u.map(function(R){return R&&R.haveUrl(v)&&R.stopLiveStreamingTask(v)}))];case 1:return b.sent(),g.default.debug("stopLiveStreaming sucess: "+JSON.stringify(v)),a.gatewayClient.dispatchEvent({type:"liveStreamingStopped",url:v}),[2]}})})},a.addInjectStreamUrl=function(v,u){var b=m.report.reportApiInvoke(d.sessionId,{name:"Client.addInjectStreamUrl",options:[v,u],tag:"tracer"});if(a.gatewayClient.role==="audience"){var R={code:403,reason:"AUDIENCE_INJECTING_FORBIDDEN"};throw b(R),R}var D=a._addInjectStreamUrl(v,u);return D.then(function(_){b(null,_)}).catch(function(_){g.default.error("ADD_INJECT_STREAM_ERROR",_.toString()),b(_)}),D},a._addInjectStreamUrl=function(v,u){return E(T,void 0,void 0,function(){var b;return f(this,function(R){switch(R.label){case 0:return(b=C({type:r.LiveStreamingServiceMode.INJECT})).setInjectStreamConfig(u,0),[4,b.startLiveStreamingTask(v,r.LiveStreamingServiceMode.INJECT)];case 1:return R.sent(),[2]}})})},a.removeInjectStreamUrl=function(v){return E(this,void 0,void 0,function(){var u,b;return f(this,function(R){return u=m.report.reportApiInvoke(d.sessionId,{name:"Client.removeInjectStreamUrl",options:[v],tag:"tracer"}),(b=a._removeInjectStreamUrl(v)).then(function(D){u(null,D)}).catch(function(D){g.default.error("REMOVE_INJECT_STREAM_ERROR",D.toString()),u(D)}),[2,b]})})},a._removeInjectStreamUrl=function(v){return E(T,void 0,void 0,function(){return f(this,function(u){switch(u.label){case 0:return[4,C({type:r.LiveStreamingServiceMode.INJECT}).stopLiveStreamingTask(v)];case 1:return u.sent(),[2]}})})},a._terminateLiveStreaming=function(){return E(T,void 0,void 0,function(){return f(this,function(v){return[a._injectStreamingClient,a._liveRawStreamingClient,a._liveTranscodeStreamingClient].forEach(function(u){u&&u.terminate()}),[2]})})}}},function(z,H,I){var E=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(H,"__esModule",{value:!0});var f=E(I(4)),S=E(I(0)),g=I(10);H.default=function(y,s){s===void 0&&(s={width:160,height:120,framerate:15});var m=s.width,r=s.height,a=s.framerate,d=y.stream;if(!d)throw f.default.INVALID_LOCAL_STREAM;if(!d.getVideoTracks()[0])throw f.default.HIGH_STREAM_NOT_VIDEO_TRACE;var T=d.getVideoTracks()[0];S.default.debug("Start getLowStream");var C=document.createElement("video"),v=document.createElement("canvas");C.setAttribute("style","display:none"),C.setAttribute("muted",""),C.muted=!0,C.setAttribute("autoplay",""),C.autoplay=!0,C.setAttribute("playsinline",""),v.setAttribute("style","display:none"),v.setAttribute("width",m.toString()),v.setAttribute("height",r.toString());var u=v.getContext("2d");if(!u)throw new Error("not get canvas context");C.srcObject=d,document.body.append(C),document.body.append(v),C.play(),S.default.debug("Start render lowStream");var b=g.audioTimerLoop(function(){return function(){if(C.paused&&C.play(),C.videoHeight>2&&C.videoWidth>2){var _=C.videoWidth,j=C.videoHeight/_,q=v.width*j;Math.abs(q-v.height)>=2&&(S.default.debug("adjust low stream resolution",v.width+"x"+v.height+" -> "+v.width+"x"+q),v.height=q)}u.drawImage(C,0,0,v.width,v.height);var B=y.stream;if(B){var W=B.getVideoTracks()[0];T!==W&&(S.default.debug("adjust low stream track"),C.srcObject=B,T=W)}}()},a),R=v.captureStream(a),D=R.getVideoTracks()[0];return D.requestFrame&&D.requestFrame(),R.clean=function(){S.default.debug("Start clean lowStream"),b(),(C||C.parentNode||C.parentNode.removeChild)&&C.parentNode.removeChild(C),(v||v.parentNode||v.parentNode.removeChild)&&v.parentNode.removeChild(v),S.default.debug("Clean lowStream")},R}},function(z,H){var I=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(I){var E=new Uint8Array(16);z.exports=function(){return I(E),E}}else{var f=new Array(16);z.exports=function(){for(var S,g=0;g<16;g++)(3&g)==0&&(S=4294967296*Math.random()),f[g]=S>>>((3&g)<<3)&255;return f}}},function(z,H){for(var I=[],E=0;E<256;++E)I[E]=(E+256).toString(16).substr(1);z.exports=function(f,S){var g=S||0,y=I;return[y[f[g++]],y[f[g++]],y[f[g++]],y[f[g++]],"-",y[f[g++]],y[f[g++]],"-",y[f[g++]],y[f[g++]],"-",y[f[g++]],y[f[g++]],"-",y[f[g++]],y[f[g++]],y[f[g++]],y[f[g++]],y[f[g++]],y[f[g++]]].join("")}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*!
 * protobuf.js v6.10.0 (c) 2016, daniel wirtz
 * compiled wed, 15 jul 2020 23:34:13 utc
 * licensed under the bsd-3-clause license
 * see: https://github.com/dcodeio/protobuf.js for details
 */(function(undefined$1){(function(z,H,I){var E=function f(S){var g=H[S];return g||z[S][0].call(g=H[S]={exports:{}},f,g,g.exports),g.exports}(I[0]);E.util.global.protobuf=E,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(61)],(__WEBPACK_AMD_DEFINE_RESULT__=function(f){return f&&f.isLong&&(E.util.Long=f,E.configure()),E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))===undefined$1||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=E)})({1:[function(z,H,I){H.exports=function(E,f){for(var S=new Array(arguments.length-1),g=0,y=2,s=!0;y<arguments.length;)S[g++]=arguments[y++];return new Promise(function(m,r){S[g]=function(a){if(s)if(s=!1,a)r(a);else{for(var d=new Array(arguments.length-1),T=0;T<d.length;)d[T++]=arguments[T];m.apply(null,d)}};try{E.apply(f||null,S)}catch(a){s&&(s=!1,r(a))}})}},{}],2:[function(z,H,I){var E=I;E.length=function(y){var s=y.length;if(!s)return 0;for(var m=0;--s%4>1&&y.charAt(s)==="=";)++m;return Math.ceil(3*y.length)/4-m};for(var f=new Array(64),S=new Array(123),g=0;g<64;)S[f[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;E.encode=function(y,s,m){for(var r,a=null,d=[],T=0,C=0;s<m;){var v=y[s++];switch(C){case 0:d[T++]=f[v>>2],r=(3&v)<<4,C=1;break;case 1:d[T++]=f[r|v>>4],r=(15&v)<<2,C=2;break;case 2:d[T++]=f[r|v>>6],d[T++]=f[63&v],C=0}T>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,d)),T=0)}return C&&(d[T++]=f[r],d[T++]=61,C===1&&(d[T++]=61)),a?(T&&a.push(String.fromCharCode.apply(String,d.slice(0,T))),a.join("")):String.fromCharCode.apply(String,d.slice(0,T))},E.decode=function(y,s,m){for(var r,a=m,d=0,T=0;T<y.length;){var C=y.charCodeAt(T++);if(C===61&&d>1)break;if((C=S[C])===undefined$1)throw Error("invalid encoding");switch(d){case 0:r=C,d=1;break;case 1:s[m++]=r<<2|(48&C)>>4,r=C,d=2;break;case 2:s[m++]=(15&r)<<4|(60&C)>>2,r=C,d=3;break;case 3:s[m++]=(3&r)<<6|C,d=0}}if(d===1)throw Error("invalid encoding");return m-a},E.test=function(y){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(y)}},{}],3:[function(z,H,I){function E(f,S){typeof f=="string"&&(S=f,f=undefined$1);var g=[];function y(m){if(typeof m!="string"){var r=s();if(E.verbose&&console.log("codegen: "+r),r="return "+r,m){for(var a=Object.keys(m),d=new Array(a.length+1),T=new Array(a.length),C=0;C<a.length;)d[C]=a[C],T[C]=m[a[C++]];return d[C]=r,Function.apply(null,d).apply(null,T)}return Function(r)()}for(var v=new Array(arguments.length-1),u=0;u<v.length;)v[u]=arguments[++u];if(u=0,m=m.replace(/%([%dfijs])/g,function(b,R){var D=v[u++];switch(R){case"d":case"f":return String(Number(D));case"i":return String(Math.floor(D));case"j":return JSON.stringify(D);case"s":return String(D)}return"%"}),u!==v.length)throw Error("parameter count mismatch");return g.push(m),y}function s(m){return"function "+(m||S||"")+"("+(f&&f.join(",")||"")+`){
  `+g.join(`
  `)+`
}`}return y.toString=s,y}H.exports=E,E.verbose=!1},{}],4:[function(z,H,I){function E(){this._listeners={}}H.exports=E,E.prototype.on=function(f,S,g){return(this._listeners[f]||(this._listeners[f]=[])).push({fn:S,ctx:g||this}),this},E.prototype.off=function(f,S){if(f===undefined$1)this._listeners={};else if(S===undefined$1)this._listeners[f]=[];else for(var g=this._listeners[f],y=0;y<g.length;)g[y].fn===S?g.splice(y,1):++y;return this},E.prototype.emit=function(f){var S=this._listeners[f];if(S){for(var g=[],y=1;y<arguments.length;)g.push(arguments[y++]);for(y=0;y<S.length;)S[y].fn.apply(S[y++].ctx,g)}return this}},{}],5:[function(z,H,I){H.exports=S;var E=z(1),f=z(7)("fs");function S(g,y,s){return typeof y=="function"?(s=y,y={}):y||(y={}),s?!y.xhr&&f&&f.readFile?f.readFile(g,function(m,r){return m&&typeof XMLHttpRequest!="undefined"?S.xhr(g,y,s):m?s(m):s(null,y.binary?r:r.toString("utf8"))}):S.xhr(g,y,s):E(S,this,g,y)}S.xhr=function(g,y,s){var m=new XMLHttpRequest;m.onreadystatechange=function(){if(m.readyState!==4)return undefined$1;if(m.status!==0&&m.status!==200)return s(Error("status "+m.status));if(y.binary){var r=m.response;if(!r){r=[];for(var a=0;a<m.responseText.length;++a)r.push(255&m.responseText.charCodeAt(a))}return s(null,typeof Uint8Array!="undefined"?new Uint8Array(r):r)}return s(null,m.responseText)},y.binary&&("overrideMimeType"in m&&m.overrideMimeType("text/plain; charset=x-user-defined"),m.responseType="arraybuffer"),m.open("GET",g),m.send()}},{1:1,7:7}],6:[function(z,H,I){function E(s){return typeof Float32Array!="undefined"?function(){var m=new Float32Array([-0]),r=new Uint8Array(m.buffer),a=r[3]===128;function d(u,b,R){m[0]=u,b[R]=r[0],b[R+1]=r[1],b[R+2]=r[2],b[R+3]=r[3]}function T(u,b,R){m[0]=u,b[R]=r[3],b[R+1]=r[2],b[R+2]=r[1],b[R+3]=r[0]}function C(u,b){return r[0]=u[b],r[1]=u[b+1],r[2]=u[b+2],r[3]=u[b+3],m[0]}function v(u,b){return r[3]=u[b],r[2]=u[b+1],r[1]=u[b+2],r[0]=u[b+3],m[0]}s.writeFloatLE=a?d:T,s.writeFloatBE=a?T:d,s.readFloatLE=a?C:v,s.readFloatBE=a?v:C}():function(){function m(a,d,T,C){var v=d<0?1:0;if(v&&(d=-d),d===0)a(1/d>0?0:2147483648,T,C);else if(isNaN(d))a(2143289344,T,C);else if(d>34028234663852886e22)a((v<<31|2139095040)>>>0,T,C);else if(d<11754943508222875e-54)a((v<<31|Math.round(d/1401298464324817e-60))>>>0,T,C);else{var u=Math.floor(Math.log(d)/Math.LN2);a((v<<31|u+127<<23|8388607&Math.round(d*Math.pow(2,-u)*8388608))>>>0,T,C)}}function r(a,d,T){var C=a(d,T),v=2*(C>>31)+1,u=C>>>23&255,b=8388607&C;return u===255?b?NaN:v*(1/0):u===0?1401298464324817e-60*v*b:v*Math.pow(2,u-150)*(b+8388608)}s.writeFloatLE=m.bind(null,f),s.writeFloatBE=m.bind(null,S),s.readFloatLE=r.bind(null,g),s.readFloatBE=r.bind(null,y)}(),typeof Float64Array!="undefined"?function(){var m=new Float64Array([-0]),r=new Uint8Array(m.buffer),a=r[7]===128;function d(u,b,R){m[0]=u,b[R]=r[0],b[R+1]=r[1],b[R+2]=r[2],b[R+3]=r[3],b[R+4]=r[4],b[R+5]=r[5],b[R+6]=r[6],b[R+7]=r[7]}function T(u,b,R){m[0]=u,b[R]=r[7],b[R+1]=r[6],b[R+2]=r[5],b[R+3]=r[4],b[R+4]=r[3],b[R+5]=r[2],b[R+6]=r[1],b[R+7]=r[0]}function C(u,b){return r[0]=u[b],r[1]=u[b+1],r[2]=u[b+2],r[3]=u[b+3],r[4]=u[b+4],r[5]=u[b+5],r[6]=u[b+6],r[7]=u[b+7],m[0]}function v(u,b){return r[7]=u[b],r[6]=u[b+1],r[5]=u[b+2],r[4]=u[b+3],r[3]=u[b+4],r[2]=u[b+5],r[1]=u[b+6],r[0]=u[b+7],m[0]}s.writeDoubleLE=a?d:T,s.writeDoubleBE=a?T:d,s.readDoubleLE=a?C:v,s.readDoubleBE=a?v:C}():function(){function m(a,d,T,C,v,u){var b=C<0?1:0;if(b&&(C=-C),C===0)a(0,v,u+d),a(1/C>0?0:2147483648,v,u+T);else if(isNaN(C))a(0,v,u+d),a(2146959360,v,u+T);else if(C>17976931348623157e292)a(0,v,u+d),a((b<<31|2146435072)>>>0,v,u+T);else{var R;if(C<22250738585072014e-324)a((R=C/5e-324)>>>0,v,u+d),a((b<<31|R/4294967296)>>>0,v,u+T);else{var D=Math.floor(Math.log(C)/Math.LN2);D===1024&&(D=1023),a(4503599627370496*(R=C*Math.pow(2,-D))>>>0,v,u+d),a((b<<31|D+1023<<20|1048576*R&1048575)>>>0,v,u+T)}}}function r(a,d,T,C,v){var u=a(C,v+d),b=a(C,v+T),R=2*(b>>31)+1,D=b>>>20&2047,_=4294967296*(1048575&b)+u;return D===2047?_?NaN:R*(1/0):D===0?5e-324*R*_:R*Math.pow(2,D-1075)*(_+4503599627370496)}s.writeDoubleLE=m.bind(null,f,0,4),s.writeDoubleBE=m.bind(null,S,4,0),s.readDoubleLE=r.bind(null,g,0,4),s.readDoubleBE=r.bind(null,y,4,0)}(),s}function f(s,m,r){m[r]=255&s,m[r+1]=s>>>8&255,m[r+2]=s>>>16&255,m[r+3]=s>>>24}function S(s,m,r){m[r]=s>>>24,m[r+1]=s>>>16&255,m[r+2]=s>>>8&255,m[r+3]=255&s}function g(s,m){return(s[m]|s[m+1]<<8|s[m+2]<<16|s[m+3]<<24)>>>0}function y(s,m){return(s[m]<<24|s[m+1]<<16|s[m+2]<<8|s[m+3])>>>0}H.exports=E(E)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(z){}return null}module.exports=inquire},{}],8:[function(z,H,I){var E=I,f=E.isAbsolute=function(g){return/^(?:\/|\w+:)/.test(g)},S=E.normalize=function(g){var y=(g=g.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),s=f(g),m="";s&&(m=y.shift()+"/");for(var r=0;r<y.length;)y[r]===".."?r>0&&y[r-1]!==".."?y.splice(--r,2):s?y.splice(r,1):++r:y[r]==="."?y.splice(r,1):++r;return m+y.join("/")};E.resolve=function(g,y,s){return s||(y=S(y)),f(y)?y:(s||(g=S(g)),(g=g.replace(/(?:\/|^)[^/]+$/,"")).length?S(g+"/"+y):y)}},{}],9:[function(z,H,I){H.exports=function(E,f,S){var g=S||8192,y=g>>>1,s=null,m=g;return function(r){if(r<1||r>y)return E(r);m+r>g&&(s=E(g),m=0);var a=f.call(s,m,m+=r);return 7&m&&(m=1+(7|m)),a}}},{}],10:[function(z,H,I){var E=I;E.length=function(f){for(var S=0,g=0,y=0;y<f.length;++y)(g=f.charCodeAt(y))<128?S+=1:g<2048?S+=2:(64512&g)==55296&&(64512&f.charCodeAt(y+1))==56320?(++y,S+=4):S+=3;return S},E.read=function(f,S,g){if(g-S<1)return"";for(var y,s=null,m=[],r=0;S<g;)(y=f[S++])<128?m[r++]=y:y>191&&y<224?m[r++]=(31&y)<<6|63&f[S++]:y>239&&y<365?(y=((7&y)<<18|(63&f[S++])<<12|(63&f[S++])<<6|63&f[S++])-65536,m[r++]=55296+(y>>10),m[r++]=56320+(1023&y)):m[r++]=(15&y)<<12|(63&f[S++])<<6|63&f[S++],r>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,m)),r=0);return s?(r&&s.push(String.fromCharCode.apply(String,m.slice(0,r))),s.join("")):String.fromCharCode.apply(String,m.slice(0,r))},E.write=function(f,S,g){for(var y,s,m=g,r=0;r<f.length;++r)(y=f.charCodeAt(r))<128?S[g++]=y:y<2048?(S[g++]=y>>6|192,S[g++]=63&y|128):(64512&y)==55296&&(64512&(s=f.charCodeAt(r+1)))==56320?(y=65536+((1023&y)<<10)+(1023&s),++r,S[g++]=y>>18|240,S[g++]=y>>12&63|128,S[g++]=y>>6&63|128,S[g++]=63&y|128):(S[g++]=y>>12|224,S[g++]=y>>6&63|128,S[g++]=63&y|128);return g-m}},{}],11:[function(z,H,I){var E=I,f=z(14),S=z(33);function g(s,m,r,a){if(m.resolvedType)if(m.resolvedType instanceof f){s("switch(d%s){",a);for(var d=m.resolvedType.values,T=Object.keys(d),C=0;C<T.length;++C)m.repeated&&d[T[C]]===m.typeDefault&&s("default:"),s("case%j:",T[C])("case %i:",d[T[C]])("m%s=%j",a,d[T[C]])("break");s("}")}else s('if(typeof d%s!=="object")',a)("throw TypeError(%j)",m.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",a,r,a);else{var v=!1;switch(m.type){case"double":case"float":s("m%s=Number(d%s)",a,a);break;case"uint32":case"fixed32":s("m%s=d%s>>>0",a,a);break;case"int32":case"sint32":case"sfixed32":s("m%s=d%s|0",a,a);break;case"uint64":v=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":s("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",a,a,v)('else if(typeof d%s==="string")',a)("m%s=parseInt(d%s,10)",a,a)('else if(typeof d%s==="number")',a)("m%s=d%s",a,a)('else if(typeof d%s==="object")',a)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",a,a,a,v?"true":"");break;case"bytes":s('if(typeof d%s==="string")',a)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",a,a,a)("else if(d%s.length)",a)("m%s=d%s",a,a);break;case"string":s("m%s=String(d%s)",a,a);break;case"bool":s("m%s=Boolean(d%s)",a,a)}}return s}function y(s,m,r,a){if(m.resolvedType)m.resolvedType instanceof f?s("d%s=o.enums===String?types[%i].values[m%s]:m%s",a,r,a,a):s("d%s=types[%i].toObject(m%s,o)",a,r,a);else{var d=!1;switch(m.type){case"double":case"float":s("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",a,a,a,a);break;case"uint64":d=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":s('if(typeof m%s==="number")',a)("d%s=o.longs===String?String(m%s):m%s",a,a,a)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",a,a,a,a,d?"true":"",a);break;case"bytes":s("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",a,a,a,a,a);break;default:s("d%s=m%s",a,a)}}return s}E.fromObject=function(s){var m=s.fieldsArray,r=S.codegen(["d"],s.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!m.length)return r("return new this.ctor");r("var m=new this.ctor");for(var a=0;a<m.length;++a){var d=m[a].resolve(),T=S.safeProp(d.name);d.map?(r("if(d%s){",T)('if(typeof d%s!=="object")',T)("throw TypeError(%j)",d.fullName+": object expected")("m%s={}",T)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",T),g(r,d,a,T+"[ks[i]]")("}")("}")):d.repeated?(r("if(d%s){",T)("if(!Array.isArray(d%s))",T)("throw TypeError(%j)",d.fullName+": array expected")("m%s=[]",T)("for(var i=0;i<d%s.length;++i){",T),g(r,d,a,T+"[i]")("}")("}")):(d.resolvedType instanceof f||r("if(d%s!=null){",T),g(r,d,a,T),d.resolvedType instanceof f||r("}"))}return r("return m")},E.toObject=function(s){var m=s.fieldsArray.slice().sort(S.compareFieldsById);if(!m.length)return S.codegen()("return {}");for(var r=S.codegen(["m","o"],s.name+"$toObject")("if(!o)")("o={}")("var d={}"),a=[],d=[],T=[],C=0;C<m.length;++C)m[C].partOf||(m[C].resolve().repeated?a:m[C].map?d:T).push(m[C]);if(a.length){for(r("if(o.arrays||o.defaults){"),C=0;C<a.length;++C)r("d%s=[]",S.safeProp(a[C].name));r("}")}if(d.length){for(r("if(o.objects||o.defaults){"),C=0;C<d.length;++C)r("d%s={}",S.safeProp(d[C].name));r("}")}if(T.length){for(r("if(o.defaults){"),C=0;C<T.length;++C){var v=T[C],u=S.safeProp(v.name);if(v.resolvedType instanceof f)r("d%s=o.enums===String?%j:%j",u,v.resolvedType.valuesById[v.typeDefault],v.typeDefault);else if(v.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",v.typeDefault.low,v.typeDefault.high,v.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",u)("}else")("d%s=o.longs===String?%j:%i",u,v.typeDefault.toString(),v.typeDefault.toNumber());else if(v.bytes){var b="["+Array.prototype.slice.call(v.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",u,String.fromCharCode.apply(String,v.typeDefault))("else{")("d%s=%s",u,b)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",u,u)("}")}else r("d%s=%j",u,v.typeDefault)}r("}")}var R=!1;for(C=0;C<m.length;++C){v=m[C];var D=s._fieldsArray.indexOf(v);u=S.safeProp(v.name),v.map?(R||(R=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",u,u)("d%s={}",u)("for(var j=0;j<ks2.length;++j){"),y(r,v,D,u+"[ks2[j]]")("}")):v.repeated?(r("if(m%s&&m%s.length){",u,u)("d%s=[]",u)("for(var j=0;j<m%s.length;++j){",u),y(r,v,D,u+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",u,v.name),y(r,v,D,u),v.partOf&&r("if(o.oneofs)")("d%s=%j",S.safeProp(v.partOf.name),v.name)),r("}")}return r("return d")}},{14:14,33:33}],12:[function(z,H,I){H.exports=function(y){var s=S.codegen(["r","l"],y.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(y.fieldsArray.filter(function(C){return C.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");y.group&&s("if((t&7)===4)")("break"),s("switch(t>>>3){");for(var m=0;m<y.fieldsArray.length;++m){var r=y._fieldsArray[m].resolve(),a=r.resolvedType instanceof E?"int32":r.type,d="m"+S.safeProp(r.name);s("case %i:",r.id),r.map?(s("if(%s===util.emptyObject)",d)("%s={}",d)("var c2 = r.uint32()+r.pos"),f.defaults[r.keyType]!==undefined$1?s("k=%j",f.defaults[r.keyType]):s("k=null"),f.defaults[a]!==undefined$1?s("value=%j",f.defaults[a]):s("value=null"),s("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),f.basic[a]===undefined$1?s("value=types[%i].decode(r,r.uint32())",m):s("value=r.%s()",a),s("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),f.long[r.keyType]!==undefined$1?s('%s[typeof k==="object"?util.longToHash(k):k]=value',d):s("%s[k]=value",d)):r.repeated?(s("if(!(%s&&%s.length))",d,d)("%s=[]",d),f.packed[a]!==undefined$1&&s("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",d,a)("}else"),f.basic[a]===undefined$1?s(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",d,m):s("%s.push(r.%s())",d,a)):f.basic[a]===undefined$1?s(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",d,m):s("%s=r.%s()",d,a),s("break")}for(s("default:")("r.skipType(t&7)")("break")("}")("}"),m=0;m<y._fieldsArray.length;++m){var T=y._fieldsArray[m];T.required&&s("if(!m.hasOwnProperty(%j))",T.name)("throw util.ProtocolError(%j,{instance:m})",g(T))}return s("return m")};var E=z(14),f=z(32),S=z(33);function g(y){return"missing required '"+y.name+"'"}},{14:14,32:32,33:33}],13:[function(z,H,I){H.exports=function(y){for(var s,m=S.codegen(["m","w"],y.name+"$encode")("if(!w)")("w=Writer.create()"),r=y.fieldsArray.slice().sort(S.compareFieldsById),a=0;a<r.length;++a){var d=r[a].resolve(),T=y._fieldsArray.indexOf(d),C=d.resolvedType instanceof E?"int32":d.type,v=f.basic[C];s="m"+S.safeProp(d.name),d.map?(m("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",s,d.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",s)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(d.id<<3|2)>>>0,8|f.mapKey[d.keyType],d.keyType),v===undefined$1?m("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",T,s):m(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|v,C,s),m("}")("}")):d.repeated?(m("if(%s!=null&&%s.length){",s,s),d.packed&&f.packed[C]!==undefined$1?m("w.uint32(%i).fork()",(d.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",s)("w.%s(%s[i])",C,s)("w.ldelim()"):(m("for(var i=0;i<%s.length;++i)",s),v===undefined$1?g(m,d,T,s+"[i]"):m("w.uint32(%i).%s(%s[i])",(d.id<<3|v)>>>0,C,s)),m("}")):(d.optional&&m("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",s,d.name),v===undefined$1?g(m,d,T,s):m("w.uint32(%i).%s(%s)",(d.id<<3|v)>>>0,C,s))}return m("return w")};var E=z(14),f=z(32),S=z(33);function g(y,s,m,r){return s.resolvedType.group?y("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",m,r,(s.id<<3|3)>>>0,(s.id<<3|4)>>>0):y("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",m,r,(s.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(z,H,I){H.exports=g;var E=z(22);((g.prototype=Object.create(E.prototype)).constructor=g).className="Enum";var f=z(21),S=z(33);function g(y,s,m,r,a){if(E.call(this,y,m),s&&typeof s!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=a||{},this.reserved=undefined$1,s)for(var d=Object.keys(s),T=0;T<d.length;++T)typeof s[d[T]]=="number"&&(this.valuesById[this.values[d[T]]=s[d[T]]]=d[T])}g.fromJSON=function(y,s){var m=new g(y,s.values,s.options,s.comment,s.comments);return m.reserved=s.reserved,m},g.prototype.toJSON=function(y){var s=!!y&&Boolean(y.keepComments);return S.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined$1,"comment",s?this.comment:undefined$1,"comments",s?this.comments:undefined$1])},g.prototype.add=function(y,s,m){if(!S.isString(y))throw TypeError("name must be a string");if(!S.isInteger(s))throw TypeError("id must be an integer");if(this.values[y]!==undefined$1)throw Error("duplicate name '"+y+"' in "+this);if(this.isReservedId(s))throw Error("id "+s+" is reserved in "+this);if(this.isReservedName(y))throw Error("name '"+y+"' is reserved in "+this);if(this.valuesById[s]!==undefined$1){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+s+" in "+this);this.values[y]=s}else this.valuesById[this.values[y]=s]=y;return this.comments[y]=m||null,this},g.prototype.remove=function(y){if(!S.isString(y))throw TypeError("name must be a string");var s=this.values[y];if(s==null)throw Error("name '"+y+"' does not exist in "+this);return delete this.valuesById[s],delete this.values[y],delete this.comments[y],this},g.prototype.isReservedId=function(y){return f.isReservedId(this.reserved,y)},g.prototype.isReservedName=function(y){return f.isReservedName(this.reserved,y)}},{21:21,22:22,33:33}],15:[function(z,H,I){H.exports=m;var E=z(22);((m.prototype=Object.create(E.prototype)).constructor=m).className="Field";var f,S=z(14),g=z(32),y=z(33),s=/^required|optional|repeated$/;function m(r,a,d,T,C,v,u){if(y.isObject(T)?(u=C,v=T,T=C=undefined$1):y.isObject(C)&&(u=v,v=C,C=undefined$1),E.call(this,r,v),!y.isInteger(a)||a<0)throw TypeError("id must be a non-negative integer");if(!y.isString(d))throw TypeError("type must be a string");if(T!==undefined$1&&!s.test(T=T.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(C!==undefined$1&&!y.isString(C))throw TypeError("extend must be a string");this.rule=T&&T!=="optional"?T:undefined$1,this.type=d,this.id=a,this.extend=C||undefined$1,this.required=T==="required",this.optional=!this.required,this.repeated=T==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!y.Long&&g.long[d]!==undefined$1,this.bytes=d==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=u}m.fromJSON=function(r,a){return new m(r,a.id,a.type,a.rule,a.extend,a.options,a.comment)},Object.defineProperty(m.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}}),m.prototype.setOption=function(r,a,d){return r==="packed"&&(this._packed=null),E.prototype.setOption.call(this,r,a,d)},m.prototype.toJSON=function(r){var a=!!r&&Boolean(r.keepComments);return y.toObject(["rule",this.rule!=="optional"&&this.rule||undefined$1,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",a?this.comment:undefined$1])},m.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=g.defaults[this.type])===undefined$1&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof f?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof S&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==!0&&(this.options.packed===undefined$1||!this.resolvedType||this.resolvedType instanceof S)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined$1)),this.long)this.typeDefault=y.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var r;y.base64.test(this.typeDefault)?y.base64.decode(this.typeDefault,r=y.newBuffer(y.base64.length(this.typeDefault)),0):y.utf8.write(this.typeDefault,r=y.newBuffer(y.utf8.length(this.typeDefault)),0),this.typeDefault=r}return this.map?this.defaultValue=y.emptyObject:this.repeated?this.defaultValue=y.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof f&&(this.parent.ctor.prototype[this.name]=this.defaultValue),E.prototype.resolve.call(this)},m.d=function(r,a,d,T){return typeof a=="function"?a=y.decorateType(a).name:a&&typeof a=="object"&&(a=y.decorateEnum(a).name),function(C,v){y.decorateType(C.constructor).add(new m(v,r,a,d,{default:T}))}},m._configure=function(r){f=r}},{14:14,22:22,32:32,33:33}],16:[function(z,H,I){var E=H.exports=z(17);E.build="light",E.load=function(f,S,g){return typeof S=="function"?(g=S,S=new E.Root):S||(S=new E.Root),S.load(f,g)},E.loadSync=function(f,S){return S||(S=new E.Root),S.loadSync(f)},E.encoder=z(13),E.decoder=z(12),E.verifier=z(36),E.converter=z(11),E.ReflectionObject=z(22),E.Namespace=z(21),E.Root=z(26),E.Enum=z(14),E.Type=z(31),E.Field=z(15),E.OneOf=z(23),E.MapField=z(18),E.Service=z(30),E.Method=z(20),E.Message=z(19),E.wrappers=z(37),E.types=z(32),E.util=z(33),E.ReflectionObject._configure(E.Root),E.Namespace._configure(E.Type,E.Service,E.Enum),E.Root._configure(E.Type),E.Field._configure(E.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(z,H,I){var E=I;function f(){E.util._configure(),E.Writer._configure(E.BufferWriter),E.Reader._configure(E.BufferReader)}E.build="minimal",E.Writer=z(38),E.BufferWriter=z(39),E.Reader=z(24),E.BufferReader=z(25),E.util=z(35),E.rpc=z(28),E.roots=z(27),E.configure=f,f()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(z,H,I){H.exports=g;var E=z(15);((g.prototype=Object.create(E.prototype)).constructor=g).className="MapField";var f=z(32),S=z(33);function g(y,s,m,r,a,d){if(E.call(this,y,s,r,undefined$1,undefined$1,a,d),!S.isString(m))throw TypeError("keyType must be a string");this.keyType=m,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(y,s){return new g(y,s.id,s.keyType,s.type,s.options,s.comment)},g.prototype.toJSON=function(y){var s=!!y&&Boolean(y.keepComments);return S.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",s?this.comment:undefined$1])},g.prototype.resolve=function(){if(this.resolved)return this;if(f.mapKey[this.keyType]===undefined$1)throw Error("invalid key type: "+this.keyType);return E.prototype.resolve.call(this)},g.d=function(y,s,m){return typeof m=="function"?m=S.decorateType(m).name:m&&typeof m=="object"&&(m=S.decorateEnum(m).name),function(r,a){S.decorateType(r.constructor).add(new g(a,y,s,m))}}},{15:15,32:32,33:33}],19:[function(z,H,I){H.exports=f;var E=z(35);function f(S){if(S)for(var g=Object.keys(S),y=0;y<g.length;++y)this[g[y]]=S[g[y]]}f.create=function(S){return this.$type.create(S)},f.encode=function(S,g){return this.$type.encode(S,g)},f.encodeDelimited=function(S,g){return this.$type.encodeDelimited(S,g)},f.decode=function(S){return this.$type.decode(S)},f.decodeDelimited=function(S){return this.$type.decodeDelimited(S)},f.verify=function(S){return this.$type.verify(S)},f.fromObject=function(S){return this.$type.fromObject(S)},f.toObject=function(S,g){return this.$type.toObject(S,g)},f.prototype.toJSON=function(){return this.$type.toObject(this,E.toJSONOptions)}},{35:35}],20:[function(z,H,I){H.exports=S;var E=z(22);((S.prototype=Object.create(E.prototype)).constructor=S).className="Method";var f=z(33);function S(g,y,s,m,r,a,d,T){if(f.isObject(r)?(d=r,r=a=undefined$1):f.isObject(a)&&(d=a,a=undefined$1),y!==undefined$1&&!f.isString(y))throw TypeError("type must be a string");if(!f.isString(s))throw TypeError("requestType must be a string");if(!f.isString(m))throw TypeError("responseType must be a string");E.call(this,g,d),this.type=y||"rpc",this.requestType=s,this.requestStream=!!r||undefined$1,this.responseType=m,this.responseStream=!!a||undefined$1,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=T}S.fromJSON=function(g,y){return new S(g,y.type,y.requestType,y.responseType,y.requestStream,y.responseStream,y.options,y.comment)},S.prototype.toJSON=function(g){var y=!!g&&Boolean(g.keepComments);return f.toObject(["type",this.type!=="rpc"&&this.type||undefined$1,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",y?this.comment:undefined$1])},S.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),E.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(z,H,I){H.exports=r;var E=z(22);((r.prototype=Object.create(E.prototype)).constructor=r).className="Namespace";var f,S,g,y=z(15),s=z(33);function m(d,T){if(!d||!d.length)return undefined$1;for(var C={},v=0;v<d.length;++v)C[d[v].name]=d[v].toJSON(T);return C}function r(d,T){E.call(this,d,T),this.nested=undefined$1,this._nestedArray=null}function a(d){return d._nestedArray=null,d}r.fromJSON=function(d,T){return new r(d,T.options).addJSON(T.nested)},r.arrayToJSON=m,r.isReservedId=function(d,T){if(d){for(var C=0;C<d.length;++C)if(typeof d[C]!="string"&&d[C][0]<=T&&d[C][1]>T)return!0}return!1},r.isReservedName=function(d,T){if(d){for(var C=0;C<d.length;++C)if(d[C]===T)return!0}return!1},Object.defineProperty(r.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=s.toArray(this.nested))}}),r.prototype.toJSON=function(d){return s.toObject(["options",this.options,"nested",m(this.nestedArray,d)])},r.prototype.addJSON=function(d){if(d)for(var T,C=Object.keys(d),v=0;v<C.length;++v)T=d[C[v]],this.add((T.fields!==undefined$1?f.fromJSON:T.values!==undefined$1?g.fromJSON:T.methods!==undefined$1?S.fromJSON:T.id!==undefined$1?y.fromJSON:r.fromJSON)(C[v],T));return this},r.prototype.get=function(d){return this.nested&&this.nested[d]||null},r.prototype.getEnum=function(d){if(this.nested&&this.nested[d]instanceof g)return this.nested[d].values;throw Error("no such enum: "+d)},r.prototype.add=function(d){if(!(d instanceof y&&d.extend!==undefined$1||d instanceof f||d instanceof g||d instanceof S||d instanceof r))throw TypeError("object must be a valid nested object");if(this.nested){var T=this.get(d.name);if(T){if(!(T instanceof r&&d instanceof r)||T instanceof f||T instanceof S)throw Error("duplicate name '"+d.name+"' in "+this);for(var C=T.nestedArray,v=0;v<C.length;++v)d.add(C[v]);this.remove(T),this.nested||(this.nested={}),d.setOptions(T.options,!0)}}else this.nested={};return this.nested[d.name]=d,d.onAdd(this),a(this)},r.prototype.remove=function(d){if(!(d instanceof E))throw TypeError("object must be a ReflectionObject");if(d.parent!==this)throw Error(d+" is not a member of "+this);return delete this.nested[d.name],Object.keys(this.nested).length||(this.nested=undefined$1),d.onRemove(this),a(this)},r.prototype.define=function(d,T){if(s.isString(d))d=d.split(".");else if(!Array.isArray(d))throw TypeError("illegal path");if(d&&d.length&&d[0]==="")throw Error("path must be relative");for(var C=this;d.length>0;){var v=d.shift();if(C.nested&&C.nested[v]){if(!((C=C.nested[v])instanceof r))throw Error("path conflicts with non-namespace objects")}else C.add(C=new r(v))}return T&&C.addJSON(T),C},r.prototype.resolveAll=function(){for(var d=this.nestedArray,T=0;T<d.length;)d[T]instanceof r?d[T++].resolveAll():d[T++].resolve();return this.resolve()},r.prototype.lookup=function(d,T,C){if(typeof T=="boolean"?(C=T,T=undefined$1):T&&!Array.isArray(T)&&(T=[T]),s.isString(d)&&d.length){if(d===".")return this.root;d=d.split(".")}else if(!d.length)return this;if(d[0]==="")return this.root.lookup(d.slice(1),T);var v=this.get(d[0]);if(v){if(d.length===1){if(!T||T.indexOf(v.constructor)>-1)return v}else if(v instanceof r&&(v=v.lookup(d.slice(1),T,!0)))return v}else for(var u=0;u<this.nestedArray.length;++u)if(this._nestedArray[u]instanceof r&&(v=this._nestedArray[u].lookup(d,T,!0)))return v;return this.parent===null||C?null:this.parent.lookup(d,T)},r.prototype.lookupType=function(d){var T=this.lookup(d,[f]);if(!T)throw Error("no such type: "+d);return T},r.prototype.lookupEnum=function(d){var T=this.lookup(d,[g]);if(!T)throw Error("no such Enum '"+d+"' in "+this);return T},r.prototype.lookupTypeOrEnum=function(d){var T=this.lookup(d,[f,g]);if(!T)throw Error("no such Type or Enum '"+d+"' in "+this);return T},r.prototype.lookupService=function(d){var T=this.lookup(d,[S]);if(!T)throw Error("no such Service '"+d+"' in "+this);return T},r._configure=function(d,T,C){f=d,S=T,g=C}},{15:15,22:22,33:33}],22:[function(z,H,I){H.exports=S,S.className="ReflectionObject";var E,f=z(33);function S(g,y){if(!f.isString(g))throw TypeError("name must be a string");if(y&&!f.isObject(y))throw TypeError("options must be an object");this.options=y,this.parsedOptions=null,this.name=g,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(S.prototype,{root:{get:function(){for(var g=this;g.parent!==null;)g=g.parent;return g}},fullName:{get:function(){for(var g=[this.name],y=this.parent;y;)g.unshift(y.name),y=y.parent;return g.join(".")}}}),S.prototype.toJSON=function(){throw Error()},S.prototype.onAdd=function(g){this.parent&&this.parent!==g&&this.parent.remove(this),this.parent=g,this.resolved=!1;var y=g.root;y instanceof E&&y._handleAdd(this)},S.prototype.onRemove=function(g){var y=g.root;y instanceof E&&y._handleRemove(this),this.parent=null,this.resolved=!1},S.prototype.resolve=function(){return this.resolved||this.root instanceof E&&(this.resolved=!0),this},S.prototype.getOption=function(g){return this.options?this.options[g]:undefined$1},S.prototype.setOption=function(g,y,s){return s&&this.options&&this.options[g]!==undefined$1||((this.options||(this.options={}))[g]=y),this},S.prototype.setParsedOption=function(g,y,s){this.parsedOptions||(this.parsedOptions=[]);var m=this.parsedOptions;if(s){var r=m.find(function(T){return Object.prototype.hasOwnProperty.call(T,g)});if(r){var a=r[g];f.setProperty(a,s,y)}else(r={})[g]=f.setProperty({},s,y),m.push(r)}else{var d={};d[g]=y,m.push(d)}return this},S.prototype.setOptions=function(g,y){if(g)for(var s=Object.keys(g),m=0;m<s.length;++m)this.setOption(s[m],g[s[m]],y);return this},S.prototype.toString=function(){var g=this.constructor.className,y=this.fullName;return y.length?g+" "+y:g},S._configure=function(g){E=g}},{33:33}],23:[function(z,H,I){H.exports=g;var E=z(22);((g.prototype=Object.create(E.prototype)).constructor=g).className="OneOf";var f=z(15),S=z(33);function g(s,m,r,a){if(Array.isArray(m)||(r=m,m=undefined$1),E.call(this,s,r),m!==undefined$1&&!Array.isArray(m))throw TypeError("fieldNames must be an Array");this.oneof=m||[],this.fieldsArray=[],this.comment=a}function y(s){if(s.parent)for(var m=0;m<s.fieldsArray.length;++m)s.fieldsArray[m].parent||s.parent.add(s.fieldsArray[m])}g.fromJSON=function(s,m){return new g(s,m.oneof,m.options,m.comment)},g.prototype.toJSON=function(s){var m=!!s&&Boolean(s.keepComments);return S.toObject(["options",this.options,"oneof",this.oneof,"comment",m?this.comment:undefined$1])},g.prototype.add=function(s){if(!(s instanceof f))throw TypeError("field must be a Field");return s.parent&&s.parent!==this.parent&&s.parent.remove(s),this.oneof.push(s.name),this.fieldsArray.push(s),s.partOf=this,y(this),this},g.prototype.remove=function(s){if(!(s instanceof f))throw TypeError("field must be a Field");var m=this.fieldsArray.indexOf(s);if(m<0)throw Error(s+" is not a member of "+this);return this.fieldsArray.splice(m,1),(m=this.oneof.indexOf(s.name))>-1&&this.oneof.splice(m,1),s.partOf=null,this},g.prototype.onAdd=function(s){E.prototype.onAdd.call(this,s);for(var m=0;m<this.oneof.length;++m){var r=s.get(this.oneof[m]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}y(this)},g.prototype.onRemove=function(s){for(var m,r=0;r<this.fieldsArray.length;++r)(m=this.fieldsArray[r]).parent&&m.parent.remove(m);E.prototype.onRemove.call(this,s)},g.d=function(){for(var s=new Array(arguments.length),m=0;m<arguments.length;)s[m]=arguments[m++];return function(r,a){S.decorateType(r.constructor).add(new g(a,s)),Object.defineProperty(r,a,{get:S.oneOfGetter(s),set:S.oneOfSetter(s)})}}},{15:15,22:22,33:33}],24:[function(z,H,I){H.exports=s;var E,f=z(35),S=f.LongBits,g=f.utf8;function y(v,u){return RangeError("index out of range: "+v.pos+" + "+(u||1)+" > "+v.len)}function s(v){this.buf=v,this.pos=0,this.len=v.length}var m,r=typeof Uint8Array!="undefined"?function(v){if(v instanceof Uint8Array||Array.isArray(v))return new s(v);throw Error("illegal buffer")}:function(v){if(Array.isArray(v))return new s(v);throw Error("illegal buffer")},a=function(){return f.Buffer?function(v){return(s.create=function(u){return f.Buffer.isBuffer(u)?new E(u):r(u)})(v)}:r};function d(){var v=new S(0,0),u=0;if(!(this.len-this.pos>4)){for(;u<3;++u){if(this.pos>=this.len)throw y(this);if(v.lo=(v.lo|(127&this.buf[this.pos])<<7*u)>>>0,this.buf[this.pos++]<128)return v}return v.lo=(v.lo|(127&this.buf[this.pos++])<<7*u)>>>0,v}for(;u<4;++u)if(v.lo=(v.lo|(127&this.buf[this.pos])<<7*u)>>>0,this.buf[this.pos++]<128)return v;if(v.lo=(v.lo|(127&this.buf[this.pos])<<28)>>>0,v.hi=(v.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return v;if(u=0,this.len-this.pos>4){for(;u<5;++u)if(v.hi=(v.hi|(127&this.buf[this.pos])<<7*u+3)>>>0,this.buf[this.pos++]<128)return v}else for(;u<5;++u){if(this.pos>=this.len)throw y(this);if(v.hi=(v.hi|(127&this.buf[this.pos])<<7*u+3)>>>0,this.buf[this.pos++]<128)return v}throw Error("invalid varint encoding")}function T(v,u){return(v[u-4]|v[u-3]<<8|v[u-2]<<16|v[u-1]<<24)>>>0}function C(){if(this.pos+8>this.len)throw y(this,8);return new S(T(this.buf,this.pos+=4),T(this.buf,this.pos+=4))}s.create=a(),s.prototype._slice=f.Array.prototype.subarray||f.Array.prototype.slice,s.prototype.uint32=(m=4294967295,function(){if(m=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(m=(m|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(m=(m|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(m=(m|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(m=(m|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return m;if((this.pos+=5)>this.len)throw this.pos=this.len,y(this,10);return m}),s.prototype.int32=function(){return 0|this.uint32()},s.prototype.sint32=function(){var v=this.uint32();return v>>>1^-(1&v)|0},s.prototype.bool=function(){return this.uint32()!==0},s.prototype.fixed32=function(){if(this.pos+4>this.len)throw y(this,4);return T(this.buf,this.pos+=4)},s.prototype.sfixed32=function(){if(this.pos+4>this.len)throw y(this,4);return 0|T(this.buf,this.pos+=4)},s.prototype.float=function(){if(this.pos+4>this.len)throw y(this,4);var v=f.float.readFloatLE(this.buf,this.pos);return this.pos+=4,v},s.prototype.double=function(){if(this.pos+8>this.len)throw y(this,4);var v=f.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,v},s.prototype.bytes=function(){var v=this.uint32(),u=this.pos,b=this.pos+v;if(b>this.len)throw y(this,v);return this.pos+=v,Array.isArray(this.buf)?this.buf.slice(u,b):u===b?new this.buf.constructor(0):this._slice.call(this.buf,u,b)},s.prototype.string=function(){var v=this.bytes();return g.read(v,0,v.length)},s.prototype.skip=function(v){if(typeof v=="number"){if(this.pos+v>this.len)throw y(this,v);this.pos+=v}else do if(this.pos>=this.len)throw y(this);while(128&this.buf[this.pos++]);return this},s.prototype.skipType=function(v){switch(v){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(v=7&this.uint32())!=4;)this.skipType(v);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+v+" at offset "+this.pos)}return this},s._configure=function(v){E=v,s.create=a(),E._configure();var u=f.Long?"toLong":"toNumber";f.merge(s.prototype,{int64:function(){return d.call(this)[u](!1)},uint64:function(){return d.call(this)[u](!0)},sint64:function(){return d.call(this).zzDecode()[u](!1)},fixed64:function(){return C.call(this)[u](!0)},sfixed64:function(){return C.call(this)[u](!1)}})}},{35:35}],25:[function(z,H,I){H.exports=S;var E=z(24);(S.prototype=Object.create(E.prototype)).constructor=S;var f=z(35);function S(g){E.call(this,g)}S._configure=function(){f.Buffer&&(S.prototype._slice=f.Buffer.prototype.slice)},S.prototype.string=function(){var g=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+g,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+g,this.len))},S._configure()},{24:24,35:35}],26:[function(z,H,I){H.exports=a;var E=z(21);((a.prototype=Object.create(E.prototype)).constructor=a).className="Root";var f,S,g,y=z(15),s=z(14),m=z(23),r=z(33);function a(v){E.call(this,"",v),this.deferred=[],this.files=[]}function d(){}a.fromJSON=function(v,u){return u||(u=new a),v.options&&u.setOptions(v.options),u.addJSON(v.nested)},a.prototype.resolvePath=r.path.resolve,a.prototype.fetch=r.fetch,a.prototype.load=function v(u,b,R){typeof b=="function"&&(R=b,b=undefined$1);var D=this;if(!R)return r.asPromise(v,D,u,b);var _=R===d;function j(N,l){if(R){var t=R;if(R=null,_)throw N;t(N,l)}}function q(N){var l=N.lastIndexOf("google/protobuf/");if(l>-1){var t=N.substring(l);if(t in g)return t}return null}function B(N,l){try{if(r.isString(l)&&l.charAt(0)==="{"&&(l=JSON.parse(l)),r.isString(l)){S.filename=N;var t,x=S(l,D,b),o=0;if(x.imports)for(;o<x.imports.length;++o)(t=q(x.imports[o])||D.resolvePath(N,x.imports[o]))&&W(t);if(x.weakImports)for(o=0;o<x.weakImports.length;++o)(t=q(x.weakImports[o])||D.resolvePath(N,x.weakImports[o]))&&W(t,!0)}else D.setOptions(l.options).addJSON(l.nested)}catch(h){j(h)}_||k||j(null,D)}function W(N,l){if(!(D.files.indexOf(N)>-1))if(D.files.push(N),N in g)_?B(N,g[N]):(++k,setTimeout(function(){--k,B(N,g[N])}));else if(_){var t;try{t=r.fs.readFileSync(N).toString("utf8")}catch(x){return void(l||j(x))}B(N,t)}else++k,D.fetch(N,function(x,o){--k,R&&(x?l?k||j(null,D):j(x):B(N,o))})}var k=0;r.isString(u)&&(u=[u]);for(var p,n=0;n<u.length;++n)(p=D.resolvePath("",u[n]))&&W(p);return _?D:(k||j(null,D),undefined$1)},a.prototype.loadSync=function(v,u){if(!r.isNode)throw Error("not supported");return this.load(v,u,d)},a.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(v){return"'extend "+v.extend+"' in "+v.parent.fullName}).join(", "));return E.prototype.resolveAll.call(this)};var T=/^[A-Z]/;function C(v,u){var b=u.parent.lookup(u.extend);if(b){var R=new y(u.fullName,u.id,u.type,u.rule,undefined$1,u.options);return R.declaringField=u,u.extensionField=R,b.add(R),!0}return!1}a.prototype._handleAdd=function(v){if(v instanceof y)v.extend===undefined$1||v.extensionField||C(0,v)||this.deferred.push(v);else if(v instanceof s)T.test(v.name)&&(v.parent[v.name]=v.values);else if(!(v instanceof m)){if(v instanceof f)for(var u=0;u<this.deferred.length;)C(0,this.deferred[u])?this.deferred.splice(u,1):++u;for(var b=0;b<v.nestedArray.length;++b)this._handleAdd(v._nestedArray[b]);T.test(v.name)&&(v.parent[v.name]=v)}},a.prototype._handleRemove=function(v){if(v instanceof y){if(v.extend!==undefined$1)if(v.extensionField)v.extensionField.parent.remove(v.extensionField),v.extensionField=null;else{var u=this.deferred.indexOf(v);u>-1&&this.deferred.splice(u,1)}}else if(v instanceof s)T.test(v.name)&&delete v.parent[v.name];else if(v instanceof E){for(var b=0;b<v.nestedArray.length;++b)this._handleRemove(v._nestedArray[b]);T.test(v.name)&&delete v.parent[v.name]}},a._configure=function(v,u,b){f=v,S=u,g=b}},{14:14,15:15,21:21,23:23,33:33}],27:[function(z,H,I){H.exports={}},{}],28:[function(z,H,I){I.Service=z(29)},{29:29}],29:[function(z,H,I){H.exports=f;var E=z(35);function f(S,g,y){if(typeof S!="function")throw TypeError("rpcImpl must be a function");E.EventEmitter.call(this),this.rpcImpl=S,this.requestDelimited=Boolean(g),this.responseDelimited=Boolean(y)}(f.prototype=Object.create(E.EventEmitter.prototype)).constructor=f,f.prototype.rpcCall=function S(g,y,s,m,r){if(!m)throw TypeError("request must be specified");var a=this;if(!r)return E.asPromise(S,a,g,y,s,m);if(!a.rpcImpl)return setTimeout(function(){r(Error("already ended"))},0),undefined$1;try{return a.rpcImpl(g,y[a.requestDelimited?"encodeDelimited":"encode"](m).finish(),function(d,T){if(d)return a.emit("error",d,g),r(d);if(T===null)return a.end(!0),undefined$1;if(!(T instanceof s))try{T=s[a.responseDelimited?"decodeDelimited":"decode"](T)}catch(C){return a.emit("error",C,g),r(C)}return a.emit("data",T,g),r(null,T)})}catch(d){return a.emit("error",d,g),setTimeout(function(){r(d)},0),undefined$1}},f.prototype.end=function(S){return this.rpcImpl&&(S||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(z,H,I){H.exports=y;var E=z(21);((y.prototype=Object.create(E.prototype)).constructor=y).className="Service";var f=z(20),S=z(33),g=z(28);function y(m,r){E.call(this,m,r),this.methods={},this._methodsArray=null}function s(m){return m._methodsArray=null,m}y.fromJSON=function(m,r){var a=new y(m,r.options);if(r.methods)for(var d=Object.keys(r.methods),T=0;T<d.length;++T)a.add(f.fromJSON(d[T],r.methods[d[T]]));return r.nested&&a.addJSON(r.nested),a.comment=r.comment,a},y.prototype.toJSON=function(m){var r=E.prototype.toJSON.call(this,m),a=!!m&&Boolean(m.keepComments);return S.toObject(["options",r&&r.options||undefined$1,"methods",E.arrayToJSON(this.methodsArray,m)||{},"nested",r&&r.nested||undefined$1,"comment",a?this.comment:undefined$1])},Object.defineProperty(y.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=S.toArray(this.methods))}}),y.prototype.get=function(m){return this.methods[m]||E.prototype.get.call(this,m)},y.prototype.resolveAll=function(){for(var m=this.methodsArray,r=0;r<m.length;++r)m[r].resolve();return E.prototype.resolve.call(this)},y.prototype.add=function(m){if(this.get(m.name))throw Error("duplicate name '"+m.name+"' in "+this);return m instanceof f?(this.methods[m.name]=m,m.parent=this,s(this)):E.prototype.add.call(this,m)},y.prototype.remove=function(m){if(m instanceof f){if(this.methods[m.name]!==m)throw Error(m+" is not a member of "+this);return delete this.methods[m.name],m.parent=null,s(this)}return E.prototype.remove.call(this,m)},y.prototype.create=function(m,r,a){for(var d,T=new g.Service(m,r,a),C=0;C<this.methodsArray.length;++C){var v=S.lcFirst((d=this._methodsArray[C]).resolve().name).replace(/[^$\w_]/g,"");T[v]=S.codegen(["r","c"],S.isReserved(v)?v+"_":v)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return T}},{20:20,21:21,28:28,33:33}],31:[function(z,H,I){H.exports=R;var E=z(21);((R.prototype=Object.create(E.prototype)).constructor=R).className="Type";var f=z(14),S=z(23),g=z(15),y=z(18),s=z(30),m=z(19),r=z(24),a=z(38),d=z(33),T=z(13),C=z(12),v=z(36),u=z(11),b=z(37);function R(_,j){E.call(this,_,j),this.fields={},this.oneofs=undefined$1,this.extensions=undefined$1,this.reserved=undefined$1,this.group=undefined$1,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function D(_){return _._fieldsById=_._fieldsArray=_._oneofsArray=null,delete _.encode,delete _.decode,delete _.verify,_}Object.defineProperties(R.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var _=Object.keys(this.fields),j=0;j<_.length;++j){var q=this.fields[_[j]],B=q.id;if(this._fieldsById[B])throw Error("duplicate id "+B+" in "+this);this._fieldsById[B]=q}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=R.generateConstructor(this)())},set:function(_){var j=_.prototype;j instanceof m||((_.prototype=new m).constructor=_,d.merge(_.prototype,j)),_.$type=_.prototype.$type=this,d.merge(_,m,!0),this._ctor=_;for(var q=0;q<this.fieldsArray.length;++q)this._fieldsArray[q].resolve();var B={};for(q=0;q<this.oneofsArray.length;++q)B[this._oneofsArray[q].resolve().name]={get:d.oneOfGetter(this._oneofsArray[q].oneof),set:d.oneOfSetter(this._oneofsArray[q].oneof)};q&&Object.defineProperties(_.prototype,B)}}}),R.generateConstructor=function(_){for(var j,q=d.codegen(["p"],_.name),B=0;B<_.fieldsArray.length;++B)(j=_._fieldsArray[B]).map?q("this%s={}",d.safeProp(j.name)):j.repeated&&q("this%s=[]",d.safeProp(j.name));return q("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},R.fromJSON=function(_,j){var q=new R(_,j.options);q.extensions=j.extensions,q.reserved=j.reserved;for(var B=Object.keys(j.fields),W=0;W<B.length;++W)q.add((j.fields[B[W]].keyType!==void 0?y.fromJSON:g.fromJSON)(B[W],j.fields[B[W]]));if(j.oneofs)for(B=Object.keys(j.oneofs),W=0;W<B.length;++W)q.add(S.fromJSON(B[W],j.oneofs[B[W]]));if(j.nested)for(B=Object.keys(j.nested),W=0;W<B.length;++W){var k=j.nested[B[W]];q.add((k.id!==undefined$1?g.fromJSON:k.fields!==undefined$1?R.fromJSON:k.values!==undefined$1?f.fromJSON:k.methods!==undefined$1?s.fromJSON:E.fromJSON)(B[W],k))}return j.extensions&&j.extensions.length&&(q.extensions=j.extensions),j.reserved&&j.reserved.length&&(q.reserved=j.reserved),j.group&&(q.group=!0),j.comment&&(q.comment=j.comment),q},R.prototype.toJSON=function(_){var j=E.prototype.toJSON.call(this,_),q=!!_&&Boolean(_.keepComments);return d.toObject(["options",j&&j.options||undefined$1,"oneofs",E.arrayToJSON(this.oneofsArray,_),"fields",E.arrayToJSON(this.fieldsArray.filter(function(B){return!B.declaringField}),_)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined$1,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined$1,"group",this.group||undefined$1,"nested",j&&j.nested||undefined$1,"comment",q?this.comment:undefined$1])},R.prototype.resolveAll=function(){for(var _=this.fieldsArray,j=0;j<_.length;)_[j++].resolve();var q=this.oneofsArray;for(j=0;j<q.length;)q[j++].resolve();return E.prototype.resolveAll.call(this)},R.prototype.get=function(_){return this.fields[_]||this.oneofs&&this.oneofs[_]||this.nested&&this.nested[_]||null},R.prototype.add=function(_){if(this.get(_.name))throw Error("duplicate name '"+_.name+"' in "+this);if(_ instanceof g&&_.extend===undefined$1){if(this._fieldsById?this._fieldsById[_.id]:this.fieldsById[_.id])throw Error("duplicate id "+_.id+" in "+this);if(this.isReservedId(_.id))throw Error("id "+_.id+" is reserved in "+this);if(this.isReservedName(_.name))throw Error("name '"+_.name+"' is reserved in "+this);return _.parent&&_.parent.remove(_),this.fields[_.name]=_,_.message=this,_.onAdd(this),D(this)}return _ instanceof S?(this.oneofs||(this.oneofs={}),this.oneofs[_.name]=_,_.onAdd(this),D(this)):E.prototype.add.call(this,_)},R.prototype.remove=function(_){if(_ instanceof g&&_.extend===undefined$1){if(!this.fields||this.fields[_.name]!==_)throw Error(_+" is not a member of "+this);return delete this.fields[_.name],_.parent=null,_.onRemove(this),D(this)}if(_ instanceof S){if(!this.oneofs||this.oneofs[_.name]!==_)throw Error(_+" is not a member of "+this);return delete this.oneofs[_.name],_.parent=null,_.onRemove(this),D(this)}return E.prototype.remove.call(this,_)},R.prototype.isReservedId=function(_){return E.isReservedId(this.reserved,_)},R.prototype.isReservedName=function(_){return E.isReservedName(this.reserved,_)},R.prototype.create=function(_){return new this.ctor(_)},R.prototype.setup=function(){for(var _=this.fullName,j=[],q=0;q<this.fieldsArray.length;++q)j.push(this._fieldsArray[q].resolve().resolvedType);this.encode=T(this)({Writer:a,types:j,util:d}),this.decode=C(this)({Reader:r,types:j,util:d}),this.verify=v(this)({types:j,util:d}),this.fromObject=u.fromObject(this)({types:j,util:d}),this.toObject=u.toObject(this)({types:j,util:d});var B=b[_];if(B){var W=Object.create(this);W.fromObject=this.fromObject,this.fromObject=B.fromObject.bind(W),W.toObject=this.toObject,this.toObject=B.toObject.bind(W)}return this},R.prototype.encode=function(_,j){return this.setup().encode(_,j)},R.prototype.encodeDelimited=function(_,j){return this.encode(_,j&&j.len?j.fork():j).ldelim()},R.prototype.decode=function(_,j){return this.setup().decode(_,j)},R.prototype.decodeDelimited=function(_){return _ instanceof r||(_=r.create(_)),this.decode(_,_.uint32())},R.prototype.verify=function(_){return this.setup().verify(_)},R.prototype.fromObject=function(_){return this.setup().fromObject(_)},R.prototype.toObject=function(_,j){return this.setup().toObject(_,j)},R.d=function(_){return function(j){d.decorateType(j,_)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(z,H,I){var E=I,f=z(33),S=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(y,s){var m=0,r={};for(s|=0;m<y.length;)r[S[m+s]]=y[m++];return r}E.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),E.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",f.emptyArray,null]),E.long=g([0,0,0,1,1],7),E.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),E.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(z,H,I){var E,f,S=H.exports=z(35),g=z(27);S.codegen=z(3),S.fetch=z(5),S.path=z(8),S.fs=S.inquire("fs"),S.toArray=function(a){if(a){for(var d=Object.keys(a),T=new Array(d.length),C=0;C<d.length;)T[C]=a[d[C++]];return T}return[]},S.toObject=function(a){for(var d={},T=0;T<a.length;){var C=a[T++],v=a[T++];v!==undefined$1&&(d[C]=v)}return d};var y=/\\/g,s=/"/g;S.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},S.safeProp=function(a){return!/^[$\w_]+$/.test(a)||S.isReserved(a)?'["'+a.replace(y,"\\\\").replace(s,'\\"')+'"]':"."+a},S.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var m=/_([a-z])/g;S.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(m,function(d,T){return T.toUpperCase()})},S.compareFieldsById=function(a,d){return a.id-d.id},S.decorateType=function(a,d){if(a.$type)return d&&a.$type.name!==d&&(S.decorateRoot.remove(a.$type),a.$type.name=d,S.decorateRoot.add(a.$type)),a.$type;E||(E=z(31));var T=new E(d||a.name);return S.decorateRoot.add(T),T.ctor=a,Object.defineProperty(a,"$type",{value:T,enumerable:!1}),Object.defineProperty(a.prototype,"$type",{value:T,enumerable:!1}),T};var r=0;S.decorateEnum=function(a){if(a.$type)return a.$type;f||(f=z(14));var d=new f("Enum"+r++,a);return S.decorateRoot.add(d),Object.defineProperty(a,"$type",{value:d,enumerable:!1}),d},S.setProperty=function(a,d,T){if(typeof a!="object")throw TypeError("dst must be an object");if(!d)throw TypeError("path must be specified");return function C(v,u,b){var R=u.shift();if(u.length>0)v[R]=C(v[R]||{},u,b);else{var D=v[R];D&&(b=[].concat(D).concat(b)),v[R]=b}return v}(a,d=d.split("."),T)},Object.defineProperty(S,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(z(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(z,H,I){H.exports=f;var E=z(35);function f(s,m){this.lo=s>>>0,this.hi=m>>>0}var S=f.zero=new f(0,0);S.toNumber=function(){return 0},S.zzEncode=S.zzDecode=function(){return this},S.length=function(){return 1};var g=f.zeroHash="\0\0\0\0\0\0\0\0";f.fromNumber=function(s){if(s===0)return S;var m=s<0;m&&(s=-s);var r=s>>>0,a=(s-r)/4294967296>>>0;return m&&(a=~a>>>0,r=~r>>>0,++r>4294967295&&(r=0,++a>4294967295&&(a=0))),new f(r,a)},f.from=function(s){if(typeof s=="number")return f.fromNumber(s);if(E.isString(s)){if(!E.Long)return f.fromNumber(parseInt(s,10));s=E.Long.fromString(s)}return s.low||s.high?new f(s.low>>>0,s.high>>>0):S},f.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var m=1+~this.lo>>>0,r=~this.hi>>>0;return m||(r=r+1>>>0),-(m+4294967296*r)}return this.lo+4294967296*this.hi},f.prototype.toLong=function(s){return E.Long?new E.Long(0|this.lo,0|this.hi,Boolean(s)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(s)}};var y=String.prototype.charCodeAt;f.fromHash=function(s){return s===g?S:new f((y.call(s,0)|y.call(s,1)<<8|y.call(s,2)<<16|y.call(s,3)<<24)>>>0,(y.call(s,4)|y.call(s,5)<<8|y.call(s,6)<<16|y.call(s,7)<<24)>>>0)},f.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},f.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},f.prototype.zzDecode=function(){var s=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},f.prototype.length=function(){var s=this.lo,m=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?m===0?s<16384?s<128?1:2:s<2097152?3:4:m<16384?m<128?5:6:m<2097152?7:8:r<128?9:10}},{35:35}],35:[function(z,H,I){var E=I;function f(g,y,s){for(var m=Object.keys(y),r=0;r<m.length;++r)g[m[r]]!==undefined$1&&s||(g[m[r]]=y[m[r]]);return g}function S(g){function y(s,m){if(!(this instanceof y))return new y(s,m);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,y):Object.defineProperty(this,"stack",{value:new Error().stack||""}),m&&f(this,m)}return(y.prototype=Object.create(Error.prototype)).constructor=y,Object.defineProperty(y.prototype,"name",{get:function(){return g}}),y.prototype.toString=function(){return this.name+": "+this.message},y}E.asPromise=z(1),E.base64=z(2),E.EventEmitter=z(4),E.float=z(6),E.inquire=z(7),E.utf8=z(10),E.pool=z(9),E.LongBits=z(34),E.isNode=Boolean(global!==void 0&&global&&global.process&&global.process.versions&&global.process.versions.node),E.global=E.isNode&&global||typeof window!="undefined"&&window||typeof self!="undefined"&&self||this,E.emptyArray=Object.freeze?Object.freeze([]):[],E.emptyObject=Object.freeze?Object.freeze({}):{},E.isInteger=Number.isInteger||function(g){return typeof g=="number"&&isFinite(g)&&Math.floor(g)===g},E.isString=function(g){return typeof g=="string"||g instanceof String},E.isObject=function(g){return g&&typeof g=="object"},E.isset=E.isSet=function(g,y){var s=g[y];return!(s==null||!g.hasOwnProperty(y))&&(typeof s!="object"||(Array.isArray(s)?s.length:Object.keys(s).length)>0)},E.Buffer=function(){try{var g=E.inquire("buffer").Buffer;return g.prototype.utf8Write?g:null}catch{return null}}(),E._Buffer_from=null,E._Buffer_allocUnsafe=null,E.newBuffer=function(g){return typeof g=="number"?E.Buffer?E._Buffer_allocUnsafe(g):new E.Array(g):E.Buffer?E._Buffer_from(g):typeof Uint8Array=="undefined"?g:new Uint8Array(g)},E.Array=typeof Uint8Array!="undefined"?Uint8Array:Array,E.Long=E.global.dcodeIO&&E.global.dcodeIO.Long||E.global.Long||E.inquire("long"),E.key2Re=/^true|false|0|1$/,E.key32Re=/^-?(?:0|[1-9][0-9]*)$/,E.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,E.longToHash=function(g){return g?E.LongBits.from(g).toHash():E.LongBits.zeroHash},E.longFromHash=function(g,y){var s=E.LongBits.fromHash(g);return E.Long?E.Long.fromBits(s.lo,s.hi,y):s.toNumber(Boolean(y))},E.merge=f,E.lcFirst=function(g){return g.charAt(0).toLowerCase()+g.substring(1)},E.newError=S,E.ProtocolError=S("ProtocolError"),E.oneOfGetter=function(g){for(var y={},s=0;s<g.length;++s)y[g[s]]=1;return function(){for(var m=Object.keys(this),r=m.length-1;r>-1;--r)if(y[m[r]]===1&&this[m[r]]!==undefined$1&&this[m[r]]!==null)return m[r]}},E.oneOfSetter=function(g){return function(y){for(var s=0;s<g.length;++s)g[s]!==y&&delete this[g[s]]}},E.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},E._configure=function(){var g=E.Buffer;g?(E._Buffer_from=g.from!==Uint8Array.from&&g.from||function(y,s){return new g(y,s)},E._Buffer_allocUnsafe=g.allocUnsafe||function(y){return new g(y)}):E._Buffer_from=E._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(z,H,I){H.exports=function(s){var m=f.codegen(["m"],s.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=s.oneofsArray,a={};r.length&&m("var p={}");for(var d=0;d<s.fieldsArray.length;++d){var T=s._fieldsArray[d].resolve(),C="m"+f.safeProp(T.name);if(T.optional&&m("if(%s!=null&&m.hasOwnProperty(%j)){",C,T.name),T.map)m("if(!util.isObject(%s))",C)("return%j",S(T,"object"))("var k=Object.keys(%s)",C)("for(var i=0;i<k.length;++i){"),y(m,T,"k[i]"),g(m,T,d,C+"[k[i]]")("}");else if(T.repeated)m("if(!Array.isArray(%s))",C)("return%j",S(T,"array"))("for(var i=0;i<%s.length;++i){",C),g(m,T,d,C+"[i]")("}");else{if(T.partOf){var v=f.safeProp(T.partOf.name);a[T.partOf.name]===1&&m("if(p%s===1)",v)("return%j",T.partOf.name+": multiple values"),a[T.partOf.name]=1,m("p%s=1",v)}g(m,T,d,C)}T.optional&&m("}")}return m("return null")};var E=z(14),f=z(33);function S(s,m){return s.name+": "+m+(s.repeated&&m!=="array"?"[]":s.map&&m!=="object"?"{k:"+s.keyType+"}":"")+" expected"}function g(s,m,r,a){if(m.resolvedType)if(m.resolvedType instanceof E){s("switch(%s){",a)("default:")("return%j",S(m,"enum value"));for(var d=Object.keys(m.resolvedType.values),T=0;T<d.length;++T)s("case %i:",m.resolvedType.values[d[T]]);s("break")("}")}else s("{")("var e=types[%i].verify(%s);",r,a)("if(e)")("return%j+e",m.name+".")("}");else switch(m.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":s("if(!util.isInteger(%s))",a)("return%j",S(m,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":s("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",a,a,a,a)("return%j",S(m,"integer|Long"));break;case"float":case"double":s('if(typeof %s!=="number")',a)("return%j",S(m,"number"));break;case"bool":s('if(typeof %s!=="boolean")',a)("return%j",S(m,"boolean"));break;case"string":s("if(!util.isString(%s))",a)("return%j",S(m,"string"));break;case"bytes":s('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',a,a,a)("return%j",S(m,"buffer"))}return s}function y(s,m,r){switch(m.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":s("if(!util.key32Re.test(%s))",r)("return%j",S(m,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":s("if(!util.key64Re.test(%s))",r)("return%j",S(m,"integer|Long key"));break;case"bool":s("if(!util.key2Re.test(%s))",r)("return%j",S(m,"boolean key"))}return s}},{14:14,33:33}],37:[function(z,H,I){var E=I,f=z(19);E[".google.protobuf.Any"]={fromObject:function(S){if(S&&S["@type"]){var g=S["@type"].substring(S["@type"].lastIndexOf("/")+1),y=this.lookup(g);if(y){var s=S["@type"].charAt(0)==="."?S["@type"].substr(1):S["@type"];return s.indexOf("/")===-1&&(s="/"+s),this.create({type_url:s,value:y.encode(y.fromObject(S)).finish()})}}return this.fromObject(S)},toObject:function(S,g){var y="",s="";if(g&&g.json&&S.type_url&&S.value){s=S.type_url.substring(S.type_url.lastIndexOf("/")+1),y=S.type_url.substring(0,S.type_url.lastIndexOf("/")+1);var m=this.lookup(s);m&&(S=m.decode(S.value))}if(!(S instanceof this.ctor)&&S instanceof f){var r=S.$type.toObject(S,g);return y===""&&(y="type.googleapis.com/"),s=y+(S.$type.fullName[0]==="."?S.$type.fullName.substr(1):S.$type.fullName),r["@type"]=s,r}return this.toObject(S,g)}}},{19:19}],38:[function(z,H,I){H.exports=a;var E,f=z(35),S=f.LongBits,g=f.base64,y=f.utf8;function s(R,D,_){this.fn=R,this.len=D,this.next=undefined$1,this.val=_}function m(){}function r(R){this.head=R.head,this.tail=R.tail,this.len=R.len,this.next=R.states}function a(){this.len=0,this.head=new s(m,0,0),this.tail=this.head,this.states=null}var d=function(){return f.Buffer?function(){return(a.create=function(){return new E})()}:function(){return new a}};function T(R,D,_){D[_]=255&R}function C(R,D){this.len=R,this.next=undefined$1,this.val=D}function v(R,D,_){for(;R.hi;)D[_++]=127&R.lo|128,R.lo=(R.lo>>>7|R.hi<<25)>>>0,R.hi>>>=7;for(;R.lo>127;)D[_++]=127&R.lo|128,R.lo=R.lo>>>7;D[_++]=R.lo}function u(R,D,_){D[_]=255&R,D[_+1]=R>>>8&255,D[_+2]=R>>>16&255,D[_+3]=R>>>24}a.create=d(),a.alloc=function(R){return new f.Array(R)},f.Array!==Array&&(a.alloc=f.pool(a.alloc,f.Array.prototype.subarray)),a.prototype._push=function(R,D,_){return this.tail=this.tail.next=new s(R,D,_),this.len+=D,this},C.prototype=Object.create(s.prototype),C.prototype.fn=function(R,D,_){for(;R>127;)D[_++]=127&R|128,R>>>=7;D[_]=R},a.prototype.uint32=function(R){return this.len+=(this.tail=this.tail.next=new C((R>>>=0)<128?1:R<16384?2:R<2097152?3:R<268435456?4:5,R)).len,this},a.prototype.int32=function(R){return R<0?this._push(v,10,S.fromNumber(R)):this.uint32(R)},a.prototype.sint32=function(R){return this.uint32((R<<1^R>>31)>>>0)},a.prototype.uint64=function(R){var D=S.from(R);return this._push(v,D.length(),D)},a.prototype.int64=a.prototype.uint64,a.prototype.sint64=function(R){var D=S.from(R).zzEncode();return this._push(v,D.length(),D)},a.prototype.bool=function(R){return this._push(T,1,R?1:0)},a.prototype.fixed32=function(R){return this._push(u,4,R>>>0)},a.prototype.sfixed32=a.prototype.fixed32,a.prototype.fixed64=function(R){var D=S.from(R);return this._push(u,4,D.lo)._push(u,4,D.hi)},a.prototype.sfixed64=a.prototype.fixed64,a.prototype.float=function(R){return this._push(f.float.writeFloatLE,4,R)},a.prototype.double=function(R){return this._push(f.float.writeDoubleLE,8,R)};var b=f.Array.prototype.set?function(R,D,_){D.set(R,_)}:function(R,D,_){for(var j=0;j<R.length;++j)D[_+j]=R[j]};a.prototype.bytes=function(R){var D=R.length>>>0;if(!D)return this._push(T,1,0);if(f.isString(R)){var _=a.alloc(D=g.length(R));g.decode(R,_,0),R=_}return this.uint32(D)._push(b,D,R)},a.prototype.string=function(R){var D=y.length(R);return D?this.uint32(D)._push(y.write,D,R):this._push(T,1,0)},a.prototype.fork=function(){return this.states=new r(this),this.head=this.tail=new s(m,0,0),this.len=0,this},a.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new s(m,0,0),this.len=0),this},a.prototype.ldelim=function(){var R=this.head,D=this.tail,_=this.len;return this.reset().uint32(_),_&&(this.tail.next=R.next,this.tail=D,this.len+=_),this},a.prototype.finish=function(){for(var R=this.head.next,D=this.constructor.alloc(this.len),_=0;R;)R.fn(R.val,D,_),_+=R.len,R=R.next;return D},a._configure=function(R){E=R,a.create=d(),E._configure()}},{35:35}],39:[function(z,H,I){H.exports=S;var E=z(38);(S.prototype=Object.create(E.prototype)).constructor=S;var f=z(35);function S(){E.call(this)}function g(y,s,m){y.length<40?f.utf8.write(y,s,m):s.utf8Write?s.utf8Write(y,m):s.write(y,m)}S._configure=function(){S.alloc=f._Buffer_allocUnsafe,S.writeBytesBuffer=f.Buffer&&f.Buffer.prototype instanceof Uint8Array&&f.Buffer.prototype.set.name==="set"?function(y,s,m){s.set(y,m)}:function(y,s,m){if(y.copy)y.copy(s,m,0,y.length);else for(var r=0;r<y.length;)s[m++]=y[r++]}},S.prototype.bytes=function(y){f.isString(y)&&(y=f._Buffer_from(y,"base64"));var s=y.length>>>0;return this.uint32(s),s&&this._push(S.writeBytesBuffer,s,y),this},S.prototype.string=function(y){var s=f.Buffer.byteLength(y);return this.uint32(s),s&&this._push(g,s,y),this},S._configure()},{35:35,38:38}]},{},[16])})()}).call(this,__webpack_require__(33),__webpack_require__(60)(module))},function(z,H){z.exports=function(I){return I.webpackPolyfill||(I.deprecate=function(){},I.paths=[],I.children||(I.children=[]),Object.defineProperty(I,"loaded",{enumerable:!0,get:function(){return I.l}}),Object.defineProperty(I,"id",{enumerable:!0,get:function(){return I.i}}),I.webpackPolyfill=1),I}},function(z,H){z.exports=E;var I=null;try{I=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function E(p,n,N){this.low=0|p,this.high=0|n,this.unsigned=!!N}function f(p){return(p&&p.__isLong__)===!0}E.prototype.__isLong__,Object.defineProperty(E.prototype,"__isLong__",{value:!0}),E.isLong=f;var S={},g={};function y(p,n){var N,l,t;return n?(t=0<=(p>>>=0)&&p<256)&&(l=g[p])?l:(N=m(p,(0|p)<0?-1:0,!0),t&&(g[p]=N),N):(t=-128<=(p|=0)&&p<128)&&(l=S[p])?l:(N=m(p,p<0?-1:0,!1),t&&(S[p]=N),N)}function s(p,n){if(isNaN(p))return n?R:b;if(n){if(p<0)return R;if(p>=C)return B}else{if(p<=-v)return W;if(p+1>=v)return q}return p<0?s(-p,n).neg():m(p%T|0,p/T|0,n)}function m(p,n,N){return new E(p,n,N)}E.fromInt=y,E.fromNumber=s,E.fromBits=m;var r=Math.pow;function a(p,n,N){if(p.length===0)throw Error("empty string");if(p==="NaN"||p==="Infinity"||p==="+Infinity"||p==="-Infinity")return b;if(typeof n=="number"?(N=n,n=!1):n=!!n,(N=N||10)<2||36<N)throw RangeError("radix");var l;if((l=p.indexOf("-"))>0)throw Error("interior hyphen");if(l===0)return a(p.substring(1),n,N).neg();for(var t=s(r(N,8)),x=b,o=0;o<p.length;o+=8){var h=Math.min(8,p.length-o),L=parseInt(p.substring(o,o+h),N);if(h<8){var M=s(r(N,h));x=x.mul(M).add(s(L))}else x=(x=x.mul(t)).add(s(L))}return x.unsigned=n,x}function d(p,n){return typeof p=="number"?s(p,n):typeof p=="string"?a(p,n):m(p.low,p.high,typeof n=="boolean"?n:p.unsigned)}E.fromString=a,E.fromValue=d;var T=4294967296,C=T*T,v=C/2,u=y(1<<24),b=y(0);E.ZERO=b;var R=y(0,!0);E.UZERO=R;var D=y(1);E.ONE=D;var _=y(1,!0);E.UONE=_;var j=y(-1);E.NEG_ONE=j;var q=m(-1,2147483647,!1);E.MAX_VALUE=q;var B=m(-1,-1,!0);E.MAX_UNSIGNED_VALUE=B;var W=m(0,-2147483648,!1);E.MIN_VALUE=W;var k=E.prototype;k.toInt=function(){return this.unsigned?this.low>>>0:this.low},k.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},k.toString=function(p){if((p=p||10)<2||36<p)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(W)){var n=s(p),N=this.div(n),l=N.mul(n).sub(this);return N.toString(p)+l.toInt().toString(p)}return"-"+this.neg().toString(p)}for(var t=s(r(p,6),this.unsigned),x=this,o="";;){var h=x.div(t),L=(x.sub(h.mul(t)).toInt()>>>0).toString(p);if((x=h).isZero())return L+o;for(;L.length<6;)L="0"+L;o=""+L+o}},k.getHighBits=function(){return this.high},k.getHighBitsUnsigned=function(){return this.high>>>0},k.getLowBits=function(){return this.low},k.getLowBitsUnsigned=function(){return this.low>>>0},k.getNumBitsAbs=function(){if(this.isNegative())return this.eq(W)?64:this.neg().getNumBitsAbs();for(var p=this.high!=0?this.high:this.low,n=31;n>0&&(p&1<<n)==0;n--);return this.high!=0?n+33:n+1},k.isZero=function(){return this.high===0&&this.low===0},k.eqz=k.isZero,k.isNegative=function(){return!this.unsigned&&this.high<0},k.isPositive=function(){return this.unsigned||this.high>=0},k.isOdd=function(){return(1&this.low)==1},k.isEven=function(){return(1&this.low)==0},k.equals=function(p){return f(p)||(p=d(p)),(this.unsigned===p.unsigned||this.high>>>31!=1||p.high>>>31!=1)&&this.high===p.high&&this.low===p.low},k.eq=k.equals,k.notEquals=function(p){return!this.eq(p)},k.neq=k.notEquals,k.ne=k.notEquals,k.lessThan=function(p){return this.comp(p)<0},k.lt=k.lessThan,k.lessThanOrEqual=function(p){return this.comp(p)<=0},k.lte=k.lessThanOrEqual,k.le=k.lessThanOrEqual,k.greaterThan=function(p){return this.comp(p)>0},k.gt=k.greaterThan,k.greaterThanOrEqual=function(p){return this.comp(p)>=0},k.gte=k.greaterThanOrEqual,k.ge=k.greaterThanOrEqual,k.compare=function(p){if(f(p)||(p=d(p)),this.eq(p))return 0;var n=this.isNegative(),N=p.isNegative();return n&&!N?-1:!n&&N?1:this.unsigned?p.high>>>0>this.high>>>0||p.high===this.high&&p.low>>>0>this.low>>>0?-1:1:this.sub(p).isNegative()?-1:1},k.comp=k.compare,k.negate=function(){return!this.unsigned&&this.eq(W)?W:this.not().add(D)},k.neg=k.negate,k.add=function(p){f(p)||(p=d(p));var n=this.high>>>16,N=65535&this.high,l=this.low>>>16,t=65535&this.low,x=p.high>>>16,o=65535&p.high,h=p.low>>>16,L=0,M=0,G=0,Q=0;return G+=(Q+=t+(65535&p.low))>>>16,M+=(G+=l+h)>>>16,L+=(M+=N+o)>>>16,L+=n+x,m((G&=65535)<<16|(Q&=65535),(L&=65535)<<16|(M&=65535),this.unsigned)},k.subtract=function(p){return f(p)||(p=d(p)),this.add(p.neg())},k.sub=k.subtract,k.multiply=function(p){if(this.isZero())return b;if(f(p)||(p=d(p)),I)return m(I.mul(this.low,this.high,p.low,p.high),I.get_high(),this.unsigned);if(p.isZero())return b;if(this.eq(W))return p.isOdd()?W:b;if(p.eq(W))return this.isOdd()?W:b;if(this.isNegative())return p.isNegative()?this.neg().mul(p.neg()):this.neg().mul(p).neg();if(p.isNegative())return this.mul(p.neg()).neg();if(this.lt(u)&&p.lt(u))return s(this.toNumber()*p.toNumber(),this.unsigned);var n=this.high>>>16,N=65535&this.high,l=this.low>>>16,t=65535&this.low,x=p.high>>>16,o=65535&p.high,h=p.low>>>16,L=65535&p.low,M=0,G=0,Q=0,J=0;return Q+=(J+=t*L)>>>16,G+=(Q+=l*L)>>>16,Q&=65535,G+=(Q+=t*h)>>>16,M+=(G+=N*L)>>>16,G&=65535,M+=(G+=l*h)>>>16,G&=65535,M+=(G+=t*o)>>>16,M+=n*L+N*h+l*o+t*x,m((Q&=65535)<<16|(J&=65535),(M&=65535)<<16|(G&=65535),this.unsigned)},k.mul=k.multiply,k.divide=function(p){if(f(p)||(p=d(p)),p.isZero())throw Error("division by zero");var n,N,l;if(I)return this.unsigned||this.high!==-2147483648||p.low!==-1||p.high!==-1?m((this.unsigned?I.div_u:I.div_s)(this.low,this.high,p.low,p.high),I.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?R:b;if(this.unsigned){if(p.unsigned||(p=p.toUnsigned()),p.gt(this))return R;if(p.gt(this.shru(1)))return _;l=R}else{if(this.eq(W))return p.eq(D)||p.eq(j)?W:p.eq(W)?D:(n=this.shr(1).div(p).shl(1)).eq(b)?p.isNegative()?D:j:(N=this.sub(p.mul(n)),l=n.add(N.div(p)));if(p.eq(W))return this.unsigned?R:b;if(this.isNegative())return p.isNegative()?this.neg().div(p.neg()):this.neg().div(p).neg();if(p.isNegative())return this.div(p.neg()).neg();l=b}for(N=this;N.gte(p);){n=Math.max(1,Math.floor(N.toNumber()/p.toNumber()));for(var t=Math.ceil(Math.log(n)/Math.LN2),x=t<=48?1:r(2,t-48),o=s(n),h=o.mul(p);h.isNegative()||h.gt(N);)h=(o=s(n-=x,this.unsigned)).mul(p);o.isZero()&&(o=D),l=l.add(o),N=N.sub(h)}return l},k.div=k.divide,k.modulo=function(p){return f(p)||(p=d(p)),I?m((this.unsigned?I.rem_u:I.rem_s)(this.low,this.high,p.low,p.high),I.get_high(),this.unsigned):this.sub(this.div(p).mul(p))},k.mod=k.modulo,k.rem=k.modulo,k.not=function(){return m(~this.low,~this.high,this.unsigned)},k.and=function(p){return f(p)||(p=d(p)),m(this.low&p.low,this.high&p.high,this.unsigned)},k.or=function(p){return f(p)||(p=d(p)),m(this.low|p.low,this.high|p.high,this.unsigned)},k.xor=function(p){return f(p)||(p=d(p)),m(this.low^p.low,this.high^p.high,this.unsigned)},k.shiftLeft=function(p){return f(p)&&(p=p.toInt()),(p&=63)==0?this:p<32?m(this.low<<p,this.high<<p|this.low>>>32-p,this.unsigned):m(0,this.low<<p-32,this.unsigned)},k.shl=k.shiftLeft,k.shiftRight=function(p){return f(p)&&(p=p.toInt()),(p&=63)==0?this:p<32?m(this.low>>>p|this.high<<32-p,this.high>>p,this.unsigned):m(this.high>>p-32,this.high>=0?0:-1,this.unsigned)},k.shr=k.shiftRight,k.shiftRightUnsigned=function(p){if(f(p)&&(p=p.toInt()),(p&=63)===0)return this;var n=this.high;return p<32?m(this.low>>>p|n<<32-p,n>>>p,this.unsigned):m(p===32?n:n>>>p-32,0,this.unsigned)},k.shru=k.shiftRightUnsigned,k.shr_u=k.shiftRightUnsigned,k.toSigned=function(){return this.unsigned?m(this.low,this.high,!1):this},k.toUnsigned=function(){return this.unsigned?this:m(this.low,this.high,!0)},k.toBytes=function(p){return p?this.toBytesLE():this.toBytesBE()},k.toBytesLE=function(){var p=this.high,n=this.low;return[255&n,n>>>8&255,n>>>16&255,n>>>24,255&p,p>>>8&255,p>>>16&255,p>>>24]},k.toBytesBE=function(){var p=this.high,n=this.low;return[p>>>24,p>>>16&255,p>>>8&255,255&p,n>>>24,n>>>16&255,n>>>8&255,255&n]},E.fromBytes=function(p,n,N){return N?E.fromBytesLE(p,n):E.fromBytesBE(p,n)},E.fromBytesLE=function(p,n){return new E(p[0]|p[1]<<8|p[2]<<16|p[3]<<24,p[4]|p[5]<<8|p[6]<<16|p[7]<<24,n)},E.fromBytesBE=function(p,n){return new E(p[4]<<24|p[5]<<16|p[6]<<8|p[7],p[0]<<24|p[1]<<16|p[2]<<8|p[3],n)}},function(z){z.exports=JSON.parse('{"PeerPublishStatus":408,"JoinChannelTimeout":407,"OnUpdateStream":356,"OnRemoveStream":355,"OnAddVideoStream":353,"OnAddAudioStream":352,"FirstAudioDecode":351,"FirstVideoDecode":350,"FirstAudioReceived":349,"FirstVideoReceived":348,"ReqUserAccount":196,"ApiInvoke":41,"RequestProxyWorkerManager":36,"RequestProxyAppCenter":35,"VideoSendingStopped":34,"AudioSendingStopped":33,"StreamSwitch":32,"FirstFrame":31,"Publish":30,"Subscribe":29,"JoinGateway":28,"JoinChooseServer":27,"Session":26,"APWorkerEvent":160,"WorkerEvent":156,"JoinWebProxyAP":700,"WebSocketQuit":671}')},function(z){z.exports=JSON.parse('{"nested":{"protobuf":{"nested":{"Session":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"version":{"type":"string","id":11},"browser":{"type":"string","id":12},"appid":{"type":"string","id":13},"mode":{"type":"string","id":14},"extend":{"type":"string","id":15},"process":{"type":"string","id":16},"build":{"type":"string","id":17},"ipv6":{"type":"string","id":18},"sourceHost":{"type":"string","id":19},"sourcePath":{"type":"string","id":20},"collectorHost":{"type":"string","id":21},"collectorName":{"type":"string","id":22}}},"JoinChooseServer":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"chooseServerAddr":{"type":"string","id":11},"chooseServerAddrList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"chooseServerIp":{"type":"string","id":15}}},"JoinGateway":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"gatewayAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"firstSuccess":{"type":"bool","id":14}}},"Subscribe":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"video":{"type":"bool","id":16},"audio":{"type":"bool","id":17},"subscribeRequestid":{"type":"int32","id":18},"p2pid":{"type":"int32","id":19}}},"Publish":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"videoName":{"type":"string","id":16},"audioName":{"type":"string","id":17},"screenName":{"type":"string","id":18},"video":{"type":"bool","id":19},"audio":{"type":"bool","id":20},"publishRequestid":{"type":"int32","id":21},"p2pid":{"type":"int32","id":22},"screenshare":{"type":"bool","id":23}}},"FirstFrame":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"extend":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"width":{"type":"int64","id":13},"height":{"type":"int64","id":14}}},"StreamSwitch":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"isDual":{"type":"bool","id":11}}},"AudioSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"VideoSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"RequestProxyAppCenter":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"APAddr":{"type":"string","id":11},"workerManagerList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"extend":{"type":"string","id":15},"response":{"type":"string","id":16}}},"RequestProxyWorkerManager":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"workerManagerAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"extend":{"type":"string","id":14},"response":{"type":"string","id":15}}},"ApiInvoke":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"apiName":{"type":"string","id":9},"errorCode":{"type":"string","id":10},"options":{"type":"string","id":11},"execElapse":{"type":"int64","id":12},"execStates":{"type":"string","id":13},"execResult":{"type":"string","id":14},"invokeId":{"type":"int64","id":15}}},"ReqUserAccount":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"serverAddress":{"type":"string","id":10},"stringUid":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"extend":{"type":"string","id":13}}},"FirstVideoReceived":{"fields":{"lts":{"type":"int64","id":1},"peer":{"type":"int64","id":2},"elapse":{"type":"int64","id":3},"sid":{"type":"string","id":4},"cname":{"type":"string","id":5},"cid":{"type":"int64","id":6},"uid":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstAudioReceived":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstVideoDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"videowidth":{"type":"int32","id":9},"videoheight":{"type":"int32","id":10},"subscribeRequestid":{"type":"int32","id":11},"p2pid":{"type":"int32","id":12},"subscribeElapse":{"type":"int64","id":13}}},"FirstAudioDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"OnAddAudioStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnAddVideoStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnRemoveStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnUpdateStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"audio":{"type":"bool","id":8},"video":{"type":"bool","id":9}}},"JoinChannelTimeout":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"timeout":{"type":"int32","id":7}}},"PeerPublishStatus":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"peer":{"type":"int64","id":6},"elapse":{"type":"int64","id":7},"peerPublishDuration":{"type":"int64","id":8},"joinChannelSuccessElapse":{"type":"int64","id":9},"subscribeElapse":{"type":"int64","id":10},"audiotag":{"type":"int32","id":11},"videotag":{"type":"int32","id":12},"screensharetag":{"type":"int32","id":13},"firsttimetag":{"type":"int32","id":14}}},"WebSocketQuit":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"succ":{"type":"int32","id":7},"errorCode":{"type":"string","id":8},"ip":{"type":"string","id":9}}},"Message":{"fields":{"id":{"type":"int64","id":1},"msg":{"type":"bytes","id":2}}},"ProtoRaws":{"fields":{"sendTs":{"type":"int64","id":1},"payloads":{"rule":"repeated","type":"Message","id":2},"vid":{"type":"int32","id":3}}},"APWorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"ec":{"type":"int32","id":10},"sc":{"type":"int32","id":11},"serverIp":{"type":"string","id":12},"firstSuccess":{"type":"bool","id":13},"responseTime":{"type":"int32","id":14},"serviceName":{"type":"string","id":15},"responseDetail":{"type":"string","id":16}}},"WorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"command":{"type":"string","id":10},"actionType":{"type":"string","id":11},"url":{"type":"string","id":12},"payload":{"type":"string","id":13},"serverCode":{"type":"int32","id":14},"code":{"type":"int32","id":15},"traceId":{"type":"string","id":16},"workerType":{"type":"int32","id":17},"responseTime":{"type":"int32","id":18},"requestId":{"type":"int64","id":19},"packIndex":{"type":"int32","id":20},"requestByUser":{"type":"bool","id":21},"tid":{"type":"string","id":22}}},"JoinWebProxyAP":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"sucess":{"type":"int32","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"apServerAddr":{"type":"string","id":10},"turnServerAddrList":{"type":"string","id":11},"errorCode":{"type":"string","id":12}}}}}}}')},function(z,H,I){var E=function(f){var S=Object.prototype,g=S.hasOwnProperty,y=typeof Symbol=="function"?Symbol:{},s=y.iterator||"@@iterator",m=y.asyncIterator||"@@asyncIterator",r=y.toStringTag||"@@toStringTag";function a(l,t,x,o){var h=t&&t.prototype instanceof C?t:C,L=Object.create(h.prototype),M=new p(o||[]);return L._invoke=function(G,Q,J){var O="suspendedStart";return function(w,U){if(O==="executing")throw new Error("Generator is already running");if(O==="completed"){if(w==="throw")throw U;return N()}for(J.method=w,J.arg=U;;){var $=J.delegate;if($){var Y=B($,J);if(Y){if(Y===T)continue;return Y}}if(J.method==="next")J.sent=J._sent=J.arg;else if(J.method==="throw"){if(O==="suspendedStart")throw O="completed",J.arg;J.dispatchException(J.arg)}else J.method==="return"&&J.abrupt("return",J.arg);O="executing";var Z=d(G,Q,J);if(Z.type==="normal"){if(O=J.done?"completed":"suspendedYield",Z.arg===T)continue;return{value:Z.arg,done:J.done}}Z.type==="throw"&&(O="completed",J.method="throw",J.arg=Z.arg)}}}(l,x,M),L}function d(l,t,x){try{return{type:"normal",arg:l.call(t,x)}}catch(o){return{type:"throw",arg:o}}}f.wrap=a;var T={};function C(){}function v(){}function u(){}var b={};b[s]=function(){return this};var R=Object.getPrototypeOf,D=R&&R(R(n([])));D&&D!==S&&g.call(D,s)&&(b=D);var _=u.prototype=C.prototype=Object.create(b);function j(l){["next","throw","return"].forEach(function(t){l[t]=function(x){return this._invoke(t,x)}})}function q(l,t){var x;this._invoke=function(o,h){function L(){return new t(function(M,G){(function Q(J,O,w,U){var $=d(l[J],l,O);if($.type!=="throw"){var Y=$.arg,Z=Y.value;return Z&&typeof Z=="object"&&g.call(Z,"__await")?t.resolve(Z.__await).then(function(re){Q("next",re,w,U)},function(re){Q("throw",re,w,U)}):t.resolve(Z).then(function(re){Y.value=re,w(Y)},function(re){return Q("throw",re,w,U)})}U($.arg)})(o,h,M,G)})}return x=x?x.then(L,L):L()}}function B(l,t){var x=l.iterator[t.method];if(x===void 0){if(t.delegate=null,t.method==="throw"){if(l.iterator.return&&(t.method="return",t.arg=void 0,B(l,t),t.method==="throw"))return T;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var o=d(x,l.iterator,t.arg);if(o.type==="throw")return t.method="throw",t.arg=o.arg,t.delegate=null,T;var h=o.arg;return h?h.done?(t[l.resultName]=h.value,t.next=l.nextLoc,t.method!=="return"&&(t.method="next",t.arg=void 0),t.delegate=null,T):h:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,T)}function W(l){var t={tryLoc:l[0]};1 in l&&(t.catchLoc=l[1]),2 in l&&(t.finallyLoc=l[2],t.afterLoc=l[3]),this.tryEntries.push(t)}function k(l){var t=l.completion||{};t.type="normal",delete t.arg,l.completion=t}function p(l){this.tryEntries=[{tryLoc:"root"}],l.forEach(W,this),this.reset(!0)}function n(l){if(l){var t=l[s];if(t)return t.call(l);if(typeof l.next=="function")return l;if(!isNaN(l.length)){var x=-1,o=function h(){for(;++x<l.length;)if(g.call(l,x))return h.value=l[x],h.done=!1,h;return h.value=void 0,h.done=!0,h};return o.next=o}}return{next:N}}function N(){return{value:void 0,done:!0}}return v.prototype=_.constructor=u,u.constructor=v,u[r]=v.displayName="GeneratorFunction",f.isGeneratorFunction=function(l){var t=typeof l=="function"&&l.constructor;return!!t&&(t===v||(t.displayName||t.name)==="GeneratorFunction")},f.mark=function(l){return Object.setPrototypeOf?Object.setPrototypeOf(l,u):(l.__proto__=u,r in l||(l[r]="GeneratorFunction")),l.prototype=Object.create(_),l},f.awrap=function(l){return{__await:l}},j(q.prototype),q.prototype[m]=function(){return this},f.AsyncIterator=q,f.async=function(l,t,x,o,h){h===void 0&&(h=Promise);var L=new q(a(l,t,x,o),h);return f.isGeneratorFunction(t)?L:L.next().then(function(M){return M.done?M.value:L.next()})},j(_),_[r]="Generator",_[s]=function(){return this},_.toString=function(){return"[object Generator]"},f.keys=function(l){var t=[];for(var x in l)t.push(x);return t.reverse(),function o(){for(;t.length;){var h=t.pop();if(h in l)return o.value=h,o.done=!1,o}return o.done=!0,o}},f.values=n,p.prototype={constructor:p,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!l)for(var t in this)t.charAt(0)==="t"&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var t=this;function x(Q,J){return L.type="throw",L.arg=l,t.next=Q,J&&(t.method="next",t.arg=void 0),!!J}for(var o=this.tryEntries.length-1;o>=0;--o){var h=this.tryEntries[o],L=h.completion;if(h.tryLoc==="root")return x("end");if(h.tryLoc<=this.prev){var M=g.call(h,"catchLoc"),G=g.call(h,"finallyLoc");if(M&&G){if(this.prev<h.catchLoc)return x(h.catchLoc,!0);if(this.prev<h.finallyLoc)return x(h.finallyLoc)}else if(M){if(this.prev<h.catchLoc)return x(h.catchLoc,!0)}else{if(!G)throw new Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return x(h.finallyLoc)}}}},abrupt:function(l,t){for(var x=this.tryEntries.length-1;x>=0;--x){var o=this.tryEntries[x];if(o.tryLoc<=this.prev&&g.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var h=o;break}}h&&(l==="break"||l==="continue")&&h.tryLoc<=t&&t<=h.finallyLoc&&(h=null);var L=h?h.completion:{};return L.type=l,L.arg=t,h?(this.method="next",this.next=h.finallyLoc,T):this.complete(L)},complete:function(l,t){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&t&&(this.next=t),T},finish:function(l){for(var t=this.tryEntries.length-1;t>=0;--t){var x=this.tryEntries[t];if(x.finallyLoc===l)return this.complete(x.completion,x.afterLoc),k(x),T}},catch:function(l){for(var t=this.tryEntries.length-1;t>=0;--t){var x=this.tryEntries[t];if(x.tryLoc===l){var o=x.completion;if(o.type==="throw"){var h=o.arg;k(x)}return h}}throw new Error("illegal catch attempt")},delegateYield:function(l,t,x){return this.delegate={iterator:n(l),resultName:t,nextLoc:x},this.method==="next"&&(this.arg=void 0),T}},f}(z.exports);try{regeneratorRuntime=E}catch{Function("r","regeneratorRuntime = r")(E)}},function(z,H){z.exports=function(I){if(Array.isArray(I))return I}},function(z,H){z.exports=function(I,E){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(I)){var f=[],S=!0,g=!1,y=void 0;try{for(var s,m=I[Symbol.iterator]();!(S=(s=m.next()).done)&&(f.push(s.value),!E||f.length!==E);S=!0);}catch(r){g=!0,y=r}finally{try{S||m.return==null||m.return()}finally{if(g)throw y}}return f}}},function(z,H){z.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(z,H,I){Object.defineProperty(H,"__esModule",{value:!0});var E=typeof window=="object"&&window.RTCPeerConnection,f=typeof window=="object"&&window.webkitRTCPeerConnection,S=typeof window=="object"&&window.mozRTCPeerConnection;H.createRTCPeerConnection=function(g){var y=E||f||S;return y?new y(g):null}},function(z,H,I){var E;/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(f){function S(){}var g=S.prototype,y=f.EventEmitter;function s(r,a){for(var d=r.length;d--;)if(r[d].listener===a)return d;return-1}function m(r){return function(){return this[r].apply(this,arguments)}}g.getListeners=function(r){var a,d,T=this._getEvents();if(r instanceof RegExp)for(d in a={},T)T.hasOwnProperty(d)&&r.test(d)&&(a[d]=T[d]);else a=T[r]||(T[r]=[]);return a},g.flattenListeners=function(r){var a,d=[];for(a=0;a<r.length;a+=1)d.push(r[a].listener);return d},g.getListenersAsObject=function(r){var a,d=this.getListeners(r);return d instanceof Array&&((a={})[r]=d),a||d},g.addListener=function(r,a){if(!function v(u){return typeof u=="function"||u instanceof RegExp||!(!u||typeof u!="object")&&v(u.listener)}(a))throw new TypeError("listener must be a function");var d,T=this.getListenersAsObject(r),C=typeof a=="object";for(d in T)T.hasOwnProperty(d)&&s(T[d],a)===-1&&T[d].push(C?a:{listener:a,once:!1});return this},g.on=m("addListener"),g.addOnceListener=function(r,a){return this.addListener(r,{listener:a,once:!0})},g.once=m("addOnceListener"),g.defineEvent=function(r){return this.getListeners(r),this},g.defineEvents=function(r){for(var a=0;a<r.length;a+=1)this.defineEvent(r[a]);return this},g.removeListener=function(r,a){var d,T,C=this.getListenersAsObject(r);for(T in C)C.hasOwnProperty(T)&&(d=s(C[T],a))!==-1&&C[T].splice(d,1);return this},g.off=m("removeListener"),g.addListeners=function(r,a){return this.manipulateListeners(!1,r,a)},g.removeListeners=function(r,a){return this.manipulateListeners(!0,r,a)},g.manipulateListeners=function(r,a,d){var T,C,v=r?this.removeListener:this.addListener,u=r?this.removeListeners:this.addListeners;if(typeof a!="object"||a instanceof RegExp)for(T=d.length;T--;)v.call(this,a,d[T]);else for(T in a)a.hasOwnProperty(T)&&(C=a[T])&&(typeof C=="function"?v.call(this,T,C):u.call(this,T,C));return this},g.removeEvent=function(r){var a,d=typeof r,T=this._getEvents();if(d==="string")delete T[r];else if(r instanceof RegExp)for(a in T)T.hasOwnProperty(a)&&r.test(a)&&delete T[a];else delete this._events;return this},g.removeAllListeners=m("removeEvent"),g.emitEvent=function(r,a){var d,T,C,v,u=this.getListenersAsObject(r);for(v in u)if(u.hasOwnProperty(v))for(d=u[v].slice(0),C=0;C<d.length;C++)(T=d[C]).once===!0&&this.removeListener(r,T.listener),T.listener.apply(this,a||[])===this._getOnceReturnValue()&&this.removeListener(r,T.listener);return this},g.trigger=m("emitEvent"),g.emit=function(r){var a=Array.prototype.slice.call(arguments,1);return this.emitEvent(r,a)},g.setOnceReturnValue=function(r){return this._onceReturnValue=r,this},g._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},g._getEvents=function(){return this._events||(this._events={})},S.noConflict=function(){return f.EventEmitter=y,S},(E=function(){return S}.call(f,I,f,z))===void 0||(z.exports=E)})(typeof window!="undefined"?window:this||{})},function(z,H,I){var E=I(35);z.exports=function(f){if(Array.isArray(f))return E(f)}},function(z,H){z.exports=function(I){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(I))return Array.from(I)}},function(z,H){z.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(z,H,I){(function(E){var f;z.exports=(f=f||function(S,g){var y;if(typeof window!="undefined"&&window.crypto&&(y=window.crypto),typeof self!="undefined"&&self.crypto&&(y=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(y=globalThis.crypto),!y&&typeof window!="undefined"&&window.msCrypto&&(y=window.msCrypto),!y&&E!==void 0&&E.crypto&&(y=E.crypto),!y)try{y=I(74)}catch{}var s=function(){if(y){if(typeof y.getRandomValues=="function")try{return y.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof y.randomBytes=="function")try{return y.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function _(){}return function(j){var q;return _.prototype=j,q=new _,_.prototype=null,q}}(),r={},a=r.lib={},d=a.Base={extend:function(_){var j=m(this);return _&&j.mixIn(_),j.hasOwnProperty("init")&&this.init!==j.init||(j.init=function(){j.$super.init.apply(this,arguments)}),j.init.prototype=j,j.$super=this,j},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var j in _)_.hasOwnProperty(j)&&(this[j]=_[j]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}},T=a.WordArray=d.extend({init:function(_,j){_=this.words=_||[],this.sigBytes=j!=null?j:4*_.length},toString:function(_){return(_||v).stringify(this)},concat:function(_){var j=this.words,q=_.words,B=this.sigBytes,W=_.sigBytes;if(this.clamp(),B%4)for(var k=0;k<W;k++){var p=q[k>>>2]>>>24-k%4*8&255;j[B+k>>>2]|=p<<24-(B+k)%4*8}else for(var n=0;n<W;n+=4)j[B+n>>>2]=q[n>>>2];return this.sigBytes+=W,this},clamp:function(){var _=this.words,j=this.sigBytes;_[j>>>2]&=4294967295<<32-j%4*8,_.length=S.ceil(j/4)},clone:function(){var _=d.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var j=[],q=0;q<_;q+=4)j.push(s());return new T.init(j,_)}}),C=r.enc={},v=C.Hex={stringify:function(_){for(var j=_.words,q=_.sigBytes,B=[],W=0;W<q;W++){var k=j[W>>>2]>>>24-W%4*8&255;B.push((k>>>4).toString(16)),B.push((15&k).toString(16))}return B.join("")},parse:function(_){for(var j=_.length,q=[],B=0;B<j;B+=2)q[B>>>3]|=parseInt(_.substr(B,2),16)<<24-B%8*4;return new T.init(q,j/2)}},u=C.Latin1={stringify:function(_){for(var j=_.words,q=_.sigBytes,B=[],W=0;W<q;W++){var k=j[W>>>2]>>>24-W%4*8&255;B.push(String.fromCharCode(k))}return B.join("")},parse:function(_){for(var j=_.length,q=[],B=0;B<j;B++)q[B>>>2]|=(255&_.charCodeAt(B))<<24-B%4*8;return new T.init(q,j)}},b=C.Utf8={stringify:function(_){try{return decodeURIComponent(escape(u.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return u.parse(unescape(encodeURIComponent(_)))}},R=a.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new T.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=b.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var j,q=this._data,B=q.words,W=q.sigBytes,k=this.blockSize,p=W/(4*k),n=(p=_?S.ceil(p):S.max((0|p)-this._minBufferSize,0))*k,N=S.min(4*n,W);if(n){for(var l=0;l<n;l+=k)this._doProcessBlock(B,l);j=B.splice(0,n),q.sigBytes-=N}return new T.init(j,N)},clone:function(){var _=d.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0}),D=(a.Hasher=R.extend({cfg:d.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){return _&&this._append(_),this._doFinalize()},blockSize:16,_createHelper:function(_){return function(j,q){return new _.init(q).finalize(j)}},_createHmacHelper:function(_){return function(j,q){return new D.HMAC.init(_,q).finalize(j)}}}),r.algo={});return r}(Math),f)}).call(this,I(33))},function(z,H){},function(z,H,I){var E=this&&this.__assign||function(){return(E=Object.assign||function(u){for(var b,R=1,D=arguments.length;R<D;R++)for(var _ in b=arguments[R])Object.prototype.hasOwnProperty.call(b,_)&&(u[_]=b[_]);return u}).apply(this,arguments)},f=this&&this.__awaiter||function(u,b,R,D){return new(R||(R=Promise))(function(_,j){function q(k){try{W(D.next(k))}catch(p){j(p)}}function B(k){try{W(D.throw(k))}catch(p){j(p)}}function W(k){var p;k.done?_(k.value):(p=k.value,p instanceof R?p:new R(function(n){n(p)})).then(q,B)}W((D=D.apply(u,b||[])).next())})},S=this&&this.__generator||function(u,b){var R,D,_,j,q={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return j={next:B(0),throw:B(1),return:B(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function B(W){return function(k){return function(p){if(R)throw new TypeError("Generator is already executing.");for(;q;)try{if(R=1,D&&(_=2&p[0]?D.return:p[0]?D.throw||((_=D.return)&&_.call(D),0):D.next)&&!(_=_.call(D,p[1])).done)return _;switch(D=0,_&&(p=[2&p[0],_.value]),p[0]){case 0:case 1:_=p;break;case 4:return q.label++,{value:p[1],done:!1};case 5:q.label++,D=p[1],p=[0];continue;case 7:p=q.ops.pop(),q.trys.pop();continue;default:if(_=q.trys,!((_=_.length>0&&_[_.length-1])||p[0]!==6&&p[0]!==2)){q=0;continue}if(p[0]===3&&(!_||p[1]>_[0]&&p[1]<_[3])){q.label=p[1];break}if(p[0]===6&&q.label<_[1]){q.label=_[1],_=p;break}if(_&&q.label<_[2]){q.label=_[2],q.ops.push(p);break}_[2]&&q.ops.pop(),q.trys.pop();continue}p=b.call(u,q)}catch(n){p=[6,n],D=0}finally{R=_=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([W,k])}}},g=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(H,"__esModule",{value:!0});var y=I(76),s=I(27),m=I(95),r=I(20),a=I(24),d=I(31),T=g(I(0)),C=g(I(37)),v=function(){function u(b){this.retryTimeout=1e4,this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.taskMutex=new m.PromiseMutex("LS"),this.cancelToken=C.default.CancelToken.source(),this.injectConfig=E({},s.DEFAULT_INJECT_CONFIG),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Map,this.spec=b}return Object.defineProperty(u.prototype,"isNeedReset",{get:function(){for(var b=this,R=0,D=Array.from(this.streamingTasks.values());R<D.length;R++){var _=D[R];if(_.mode===s.LiveStreamingServiceMode.INJECT||_.mode===s.LiveStreamingServiceMode.TRANSCODE&&(this.transcodingConfig&&(this.transcodingConfig.userConfigs||this.transcodingConfig.transcodingUsers)||[]).find(function(j){return j.uid===b.spec.uid}))return!0}return!1},enumerable:!0,configurable:!0}),u.prototype.setTranscodingConfig=function(b){return f(this,void 0,void 0,function(){var R,D,_,j,q,B=this;return S(this,function(W){switch(W.label){case 0:(R=E(E({},s.DEFAULT_TRANSCODING_CONFIG),b)).transcodingUsers||(R.transcodingUsers=R.userConfigs),R.videoCodecProfile!==66&&R.videoCodecProfile!==77&&R.videoCodecProfile!==100&&(T.default.debug("["+this.spec.clientId+"] set transcoding config, fix video codec profile: "+R.videoCodecProfile+" -> 100"),R.videoCodecProfile=100),R.transcodingUsers&&(R.transcodingUsers=R.transcodingUsers.map(function(k){return E(E(E({},s.DEFAULT_LIVE_STREAMING_TRANSCODING_USER),k),{zOrder:k.zOrder?k.zOrder+1:1})})),R.images&&(R.images=R.images.map(function(k){return E(E({},s.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK),k)}));try{s.isLiveStreamingTranscodingConfig(R)}catch(k){throw k}return R.transcodingUsers&&(R.userConfigs=R.transcodingUsers.map(function(k){return E({},k)}),R.userCount=R.transcodingUsers.length,delete R.transcodingUsers),D=(R.userConfigs||[]).map(function(k){return typeof k.uid=="number"?Promise.resolve(k.uid):r.getUserAccount(B.spec,null,k.uid)}),[4,this.taskMutex.lock()];case 1:return _=W.sent(),[4,Promise.all(D)];case 2:if(W.sent().forEach(function(k,p){R.userConfigs&&R.userConfigs[p]&&(R.userConfigs[p].uid=k&&k.uid||k)}),this.transcodingConfig=R,!this.connection)return _(),[2];W.label=3;case 3:return W.trys.push([3,5,,6]),[4,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(this.streamingTasks.values()).map(function(k){return k.taskId}).join("#")})];case 4:return j=W.sent(),_(),T.default.debug("["+this.spec.clientId+"] update live transcoding config success, code: "+j.code+", config:",JSON.stringify(this.transcodingConfig)),[3,6];case 5:if(q=W.sent(),_(),!q.data||!q.data.retry)throw q;return q.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(function(k){T.default.warning("["+B.spec.clientId+"] live streaming receive error",q.toString(),"try to republish",k.url),B.startLiveStreamingTask(k.url,k.mode,q).then(function(){T.default.debug("["+B.spec.clientId+"] live streaming republish "+k.url+" success")}).catch(function(p){T.default.error("["+B.spec.clientId+"] live streaming republish failed",k.url,p.toString()),B.onLiveStreamError&&B.onLiveStreamError(k.url,p)})}),[3,6];case 6:return[2]}})})},u.prototype.setInjectStreamConfig=function(b,R){this.injectConfig=Object.assign({},this.injectConfig,b),this.injectLoopTimes=R},u.prototype.startLiveStreamingTask=function(b,R,D){return f(this,void 0,void 0,function(){var _,j,q,B,W,k,p,n,N=this;return S(this,function(l){switch(l.label){case 0:return Array.from(this.streamingTasks.values()).find(function(t){return t.mode===s.LiveStreamingServiceMode.INJECT})&&R===s.LiveStreamingServiceMode.INJECT?[2,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw()]:(_={command:"PublishStream",ts:Date.now(),url:b,uid:this.spec.uid.toString(),autoDestroyTime:30},T.default.debug("["+this.spec.clientId+"] start live streaming "+b+", mode: "+R),[4,this.taskMutex.lock()]);case 1:if(j=l.sent(),!this.transcodingConfig&&R===s.LiveStreamingServiceMode.TRANSCODE)throw j(),new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(!this.connection&&D)return j(),[2];if(this.streamingTasks.get(b)&&!D)return j(),[2,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw()];if(!this.transcodingConfig&&R===s.LiveStreamingServiceMode.TRANSCODE)throw j(),new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");l.label=2;case 2:return l.trys.push([2,5,,6]),this.connection?[3,4]:(q=this,[4,this.connect(R)]);case 3:q.connection=l.sent(),l.label=4;case 4:return[3,6];case 5:throw B=l.sent(),j(),B;case 6:switch(R){case s.LiveStreamingServiceMode.TRANSCODE:_.transcodingConfig=E({},this.transcodingConfig);break;case s.LiveStreamingServiceMode.RAW:break;case s.LiveStreamingServiceMode.INJECT:_={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:b,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(_.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,W=this.lastTaskId++,l.label=7;case 7:return l.trys.push([7,9,,14]),k=new Promise(function(t,x){d.wait(N.retryTimeout).then(function(){if(D)return x(D);var o=N.statusError.get(b);return o?(N.statusError.delete(b),x(o)):void 0})}),[4,Promise.race([this.connection.request("request",{clientRequest:_},!0,{url:b,command:"PublishStream",workerType:R===s.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!D,tid:W.toString()}),k])];case 8:return p=l.sent(),this.isStartingStreamingTask=!1,T.default.debug("["+this.spec.clientId+"] live streaming started, code: "+p.code),this.streamingTasks.set(b,{clientRequest:_,mode:R,url:b,taskId:W}),j(),[3,14];case 9:if(n=l.sent(),j(),this.isStartingStreamingTask=!1,!n.data||!n.data.retry||D)throw n;return n.data.changeAddress?[3,11]:[4,this.startLiveStreamingTask(b,R,n)];case 10:return[2,l.sent()];case 11:return this.connection.tryNextAddress(),[4,this.startLiveStreamingTask(b,R,n)];case 12:return[2,l.sent()];case 13:return[3,14];case 14:return[2]}})})},u.prototype.stopLiveStreamingTask=function(b){var R=this;return new Promise(function(D,_){var j=R.streamingTasks.get(b);if(!j||!R.connection)return new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var q=j.mode;j.abortTask=function(){T.default.debug("["+R.spec.clientId+"] stop live streaming success(worker exception)"),R.streamingTasks.delete(b),D()},T.default.debug("stop live streaming task request: "+JSON.stringify(b)),R.connection.request("request",{clientRequest:{command:q===s.LiveStreamingServiceMode.INJECT?"UninjectStream":"UnpublishStream",url:j.url}},!1,{url:b,command:"UnPublishStream",workerType:q===s.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!0,tid:(R.lastTaskId++).toString()}).then(function(B){T.default.debug("["+R.spec.clientId+"] stop live streaming success, code: "+B.code),R.streamingTasks.delete(b),R.streamingTasks.size===0&&q!==s.LiveStreamingServiceMode.INJECT&&(R.connection.close(),R.connection=void 0),D()}).catch(_)})},u.prototype.controlInjectStream=function(b,R,D,_){return f(this,void 0,void 0,function(){var j;return S(this,function(q){switch(q.label){case 0:if(!(j=this.streamingTasks.get(b))||!this.connection||j.mode!==s.LiveStreamingServiceMode.INJECT)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"can not find inject stream task to control");return[4,this.connection.request("request",{clientRequest:{command:"ControlStream",url:b,control:R,audioVolume:D,position:_}})];case 1:return[2,q.sent().serverResponse]}})})},u.prototype.resetAllTask=function(){var b=this,R=Array.from(this.streamingTasks.values());this.terminate();for(var D=function(B){_.startLiveStreamingTask(B.url,B.mode).catch(function(W){b.onLiveStreamError&&b.onLiveStreamError(B.url,W)})},_=this,j=0,q=R;j<q.length;j++)D(q[j])},u.prototype.setGatewayConnectionState=function(b){this.connection&&(this.connection.gatewayConnectionState=b)},u.prototype.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=C.default.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},u.prototype.connect=function(b){return f(this,void 0,void 0,function(){var R,D=this;return S(this,function(_){switch(_.label){case 0:if(this.connection)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"live streaming connection has already connected");return[4,d.getLiveStreamingWorkerMangerResult(b,this.spec,this.cancelToken.token)];case 1:return R=_.sent(),this.uapResponse=R,this.connection=new y.AgoraLiveStreamingUapSignal(R.workerToken,this.spec,b),this.connection.on(s.LiveStreamingUapSignalEvents.WARNING,function(j,q){return D.onLiveStreamWarning&&D.onLiveStreamWarning(q,j)}),this.connection.on(s.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,function(j){return D.handlePublishStreamServer(j)}),this.connection.on(s.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,function(j){return D.handleInjectStreamServerStatus(j)}),this.connection.on(s.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS,function(j,q){if(!D.connection)return q(new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not get new live streaming address list"));d.getLiveStreamingWorkerMangerResult(b,D.spec,D.cancelToken.token).then(function(B){D.uapResponse=B,j(B.addressList)}).catch(q)}),[4,this.connection.init(R.addressList)];case 2:return _.sent(),[2,this.connection]}})})},u.prototype.handlePublishStreamServer=function(b){var R=this,D=b.serverStatus&&b.serverStatus.url;if(!D)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"empty url",{code:b.code});var _=this.streamingTasks.get(D);switch(b.code){case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var j=new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:b.code});if(_)return T.default.error(j.toString()),this.onLiveStreamError&&this.onLiveStreamError(D,j);if(!this.isStartingStreamingTask)return;this.statusError.set(D,j);case s.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case s.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(!this.connection||this.streamingTasks.size===0)return;this.connection.tryNextAddress();for(var q=Array.from(this.streamingTasks.values()),B=function(n){if(n.abortTask)return n.abortTask(),"continue";T.default.warning("["+W.spec.clientId+"] publish stream status code",b.code,"try to republish",n.url),W.startLiveStreamingTask(n.url,n.mode,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:b.code})).then(function(){T.default.debug("["+R.spec.clientId+"] republish live stream success",n.url)}).catch(function(N){T.default.error(N.toString()),R.onLiveStreamError&&R.onLiveStreamError(n.url,N)})},W=this,k=0,p=q;k<p.length;k++)B(p[k]);return}},u.prototype.handleInjectStreamServerStatus=function(b){var R=Number(b.uid),D=b.serverStatus&&b.serverStatus.url;switch(b.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,R,D));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,R,D),void this.streamingTasks.delete(D);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,R,D),void this.streamingTasks.delete(D);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,R,D),void this.streamingTasks.delete(D);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,R,D),void this.streamingTasks.delete(D);default:return void T.default.debug("inject stream server status",b)}},u.prototype.haveUrl=function(b){return this.streamingTasks.has(b)||void 0},u}();H.AgoraRTCLiveStreamingClient=v},function(z,H,I){var E,f=this&&this.__extends||(E=function(R,D){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,j){_.__proto__=j}||function(_,j){for(var q in j)j.hasOwnProperty(q)&&(_[q]=j[q])})(R,D)},function(R,D){function _(){this.constructor=R}E(R,D),R.prototype=D===null?Object.create(D):(_.prototype=D.prototype,new _)}),S=this&&this.__assign||function(){return(S=Object.assign||function(R){for(var D,_=1,j=arguments.length;_<j;_++)for(var q in D=arguments[_])Object.prototype.hasOwnProperty.call(D,q)&&(R[q]=D[q]);return R}).apply(this,arguments)},g=this&&this.__awaiter||function(R,D,_,j){return new(_||(_=Promise))(function(q,B){function W(n){try{p(j.next(n))}catch(N){B(N)}}function k(n){try{p(j.throw(n))}catch(N){B(N)}}function p(n){var N;n.done?q(n.value):(N=n.value,N instanceof _?N:new _(function(l){l(N)})).then(W,k)}p((j=j.apply(R,D||[])).next())})},y=this&&this.__generator||function(R,D){var _,j,q,B,W={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return B={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function k(p){return function(n){return function(N){if(_)throw new TypeError("Generator is already executing.");for(;W;)try{if(_=1,j&&(q=2&N[0]?j.return:N[0]?j.throw||((q=j.return)&&q.call(j),0):j.next)&&!(q=q.call(j,N[1])).done)return q;switch(j=0,q&&(N=[2&N[0],q.value]),N[0]){case 0:case 1:q=N;break;case 4:return W.label++,{value:N[1],done:!1};case 5:W.label++,j=N[1],N=[0];continue;case 7:N=W.ops.pop(),W.trys.pop();continue;default:if(q=W.trys,!((q=q.length>0&&q[q.length-1])||N[0]!==6&&N[0]!==2)){W=0;continue}if(N[0]===3&&(!q||N[1]>q[0]&&N[1]<q[3])){W.label=N[1];break}if(N[0]===6&&W.label<q[1]){W.label=q[1],q=N;break}if(q&&W.label<q[2]){W.label=q[2],W.ops.push(N);break}q[2]&&W.ops.pop(),W.trys.pop();continue}N=D.call(R,W)}catch(l){N=[6,l],j=0}finally{_=q=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([p,n])}}},s=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(H,"__esModule",{value:!0});var m=I(27),r=I(77),a=I(36),d=I(24),T=I(2),C=s(I(0)),v=I(1),u=I(31),b=function(R){function D(_,j,q){var B=R.call(this)||this;return B._gatewayConnectionState="CONNECTED",B.reconnectMode="retry",B.reqId=0,B.commandReqId=0,B.waitingResponseList=[],B.handleWebSocketOpen=function(){B.reconnectMode="retry",B.startPingPong()},B.handleWebSocketMessage=function(W){if(W.data){var k=JSON.parse(W.data);if(k.requestId)B.emit("@"+k.requestId,k);else if(B.serviceMode===m.LiveStreamingServiceMode.INJECT)B.emit(m.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,k);else{v.report.requestWorkerEvent(B.spec.sid,{actionType:"status",serverCode:k.code,workerType:B.serviceMode===m.LiveStreamingServiceMode.TRANSCODE?1:2});var p=k.serverStatus&&k.serverStatus.url;p&&B.waitingResponseList.includes(p)&&k.code===200&&B.emit(p),B.emit(m.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,k)}}},B.spec=j,B.token=_,B.serviceMode=q,B.websocket=new r.AgoraWebSocketManager("live-streaming"),B.websocket.on(m.WebSocketManagerEvents.CONNECTED,B.handleWebSocketOpen),B.websocket.on(m.WebSocketManagerEvents.ON_MESSAGE,B.handleWebSocketMessage),B.websocket.on(m.WebSocketManagerEvents.REQUEST_NEW_URLS,function(W,k){a.emitAsPromise(B,m.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS).then(W).catch(k)}),B.websocket.on(m.WebSocketManagerEvents.RECONNECTING,function(){B.websocket.reconnectMode=B.reconnectMode}),B}return f(D,R),Object.defineProperty(D.prototype,"gatewayConnectionState",{get:function(){return this._gatewayConnectionState},set:function(_){this._gatewayConnectionState=_,_==="CONNECTED"&&this.emit("gateway-connected",_)},enumerable:!0,configurable:!0}),D.prototype.init=function(_){return this.websocket.init(_)},D.prototype.request=function(_,j,q,B){return g(this,void 0,void 0,function(){var W,k,p,n,N,l,t,x,o,h,L=this;return y(this,function(M){switch(M.label){case 0:if(this.reqId+=1,W=this.reqId,_==="request"&&(this.commandReqId+=1),k=this.commandReqId,!W||!this.websocket)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR);if(p=T.VERSION,this.websocket.state==="closed")throw new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_DISCONNECT);return n=function(){return new Promise(function(G,Q){var J=function(){L.gatewayConnectionState==="CONNECTED"&&L.websocket.state==="connected"&&(L.off("gateway-connected",J),L.websocket.off(m.WebSocketManagerEvents.CONNECTED,J),G(void 0))};L.on("gateway-connected",J),L.websocket.once(m.WebSocketManagerEvents.CLOSED,function(){return Q(new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_ABORT))}),L.websocket.on(m.WebSocketManagerEvents.CONNECTED,J)})},this.websocket.state==="connected"&&this.gatewayConnectionState==="CONNECTED"?[3,2]:[4,n()];case 1:M.sent(),M.label=2;case 2:N=Promise.race([new Promise(function(G,Q){var J=function(){Q(new d.AgoraRTCError(d.AgoraRTCErrorCode.WS_ABORT))};L.websocket.once(m.WebSocketManagerEvents.RECONNECTING,J),L.websocket.once(m.WebSocketManagerEvents.CLOSED,J),L.once("@"+W,function(O){G(O)})}),u.wait(T.getParameter("LIVE_STREAMING_TIMEOUT")).then(function(){return!1})]),(l=S({command:_,sdkVersion:p,seq:W,requestId:W,allocate:q,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},j)).clientRequest&&(l.clientRequest.workerToken=this.token),B&&v.report.requestWorkerEvent(this.spec.sid,S(S({},B),{requestId:k,actionType:"request",payload:JSON.stringify(j.clientRequest),serverCode:0,code:0})),t=Date.now(),this.websocket.sendMessage(l),x=null,M.label=3;case 3:return M.trys.push([3,5,,8]),[4,N];case 4:return x=M.sent(),[3,8];case 5:if(o=M.sent(),this.websocket.state==="closed")throw o;return[4,n()];case 6:return M.sent(),[4,this.request(_,j,q,B)];case 7:return[2,M.sent()];case 8:if(x===!1)throw h=new d.AgoraRTCError(d.AgoraRTCErrorCode.NETWORK_TIMEOUT,(j&&j.clientRequest&&j.clientRequest.command)+" timeout",{changeAddress:!0,retry:!0}),this.emit(m.LiveStreamingUapSignalEvents.WARNING,h,B&&B.url||"unknown url"),B&&v.report.requestWorkerEvent(this.spec.sid,S(S({},B),{requestId:k,actionType:"response",payload:"TIMEOUT",serverCode:0,success:0,responseTime:Date.now()-t})),h;return B&&v.report.requestWorkerEvent(this.spec.sid,S(S({},B),{requestId:k,actionType:"response",payload:JSON.stringify(x.serverResponse),serverCode:x.code,success:x.code===200,responseTime:Date.now()-t})),x.code===200?[3,10]:[4,this.handleResponseError(x)];case 9:M.sent(),M.label=10;case 10:return[2,x]}})})},D.prototype.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},D.prototype.close=function(){var _=T.VERSION==="__VERSION__"?"0.0.1":T.VERSION;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:_,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},D.prototype.handleResponseError=function(_){return g(this,void 0,void 0,function(){var j,q,B,W,k=this;return y(this,function(p){switch(C.default.debug("[live-streaming] receive response error "+_.code),_.code){case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return C.default.warning("live stream response already exists stream"),j=_.serverResponse.url,this.emit(m.LiveStreamingUapSignalEvents.WARNING,"live stream response already exists stream, code 454",j),this.waitingResponseList.includes(j)||this.waitingResponseList.push(j),[2,new Promise(function(n,N){k.once(j,function(){k.waitingResponseList.splice(k.waitingResponseList.indexOf(j),1),n()}),setTimeout(function(){k.waitingResponseList.splice(k.waitingResponseList.indexOf(j),1),N(new d.AgoraRTCError(d.AgoraRTCErrorCode.TIMEOUT,"live stream timeout waiting 454",{code:_.code}))},1e4)})];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_BAD_STREAM:case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:_.code}).throw()];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE:throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{retry:!0,changeAddress:!0});case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(_.serverResponse.command==="UnpublishStream"||_.serverResponse.command==="UninjectStream")return[2];throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:_.code}).throw()];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return q=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE),[2,this.emit(m.LiveStreamingUapSignalEvents.WARNING,q,_.serverResponse.url)];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return q=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FREQUENT_REQUEST),[2,this.emit(m.LiveStreamingUapSignalEvents.WARNING,q,_.serverResponse.url)];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:_.code}).throw()];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return q=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),[2,this.emit(m.LiveStreamingUapSignalEvents.WARNING,q,_.serverResponse.url)];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:_.code}).throw()];case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case m.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(_.serverResponse.command==="UnpublishStream"||_.serverResponse.command==="UninjectStream")return[2];throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case m.LIVE_STREAM_ERROR_CODE.ERROR_FAIL_SEND_MESSAGE:if(_.serverResponse.command==="UnpublishStream"||_.serverResponse.command==="UninjectStream")return[2];if(_.serverResponse.command==="UpdateTranscoding"||_.serverResponse.command==="ControlStream")return[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:_.code}).throw()];throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case m.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case m.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case m.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case m.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return B=_.serverResponse.url,this.waitingResponseList.includes(B)||this.waitingResponseList.push(B),W=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:_.code}),this.emit(m.LiveStreamingUapSignalEvents.WARNING,W,B),[2,new Promise(function(n,N){k.once(B,function(){k.waitingResponseList.splice(k.waitingResponseList.indexOf(B),1),n()}),setTimeout(function(){k.waitingResponseList.splice(k.waitingResponseList.indexOf(B),1),N(W)},1e4)})]}return[2]})})},D.prototype.startPingPong=function(){var _=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(function(){_.websocket.state==="connected"&&_.request("ping",{}).catch(function(){})},6e3)},D}(a.EventEmitter);H.AgoraLiveStreamingUapSignal=b},function(z,H,I){var E,f=this&&this.__extends||(E=function(C,v){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,b){u.__proto__=b}||function(u,b){for(var R in b)b.hasOwnProperty(R)&&(u[R]=b[R])})(C,v)},function(C,v){function u(){this.constructor=C}E(C,v),C.prototype=v===null?Object.create(v):(u.prototype=v.prototype,new u)}),S=this&&this.__awaiter||function(C,v,u,b){return new(u||(u=Promise))(function(R,D){function _(B){try{q(b.next(B))}catch(W){D(W)}}function j(B){try{q(b.throw(B))}catch(W){D(W)}}function q(B){var W;B.done?R(B.value):(W=B.value,W instanceof u?W:new u(function(k){k(W)})).then(_,j)}q((b=b.apply(C,v||[])).next())})},g=this&&this.__generator||function(C,v){var u,b,R,D,_={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return D={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function j(q){return function(B){return function(W){if(u)throw new TypeError("Generator is already executing.");for(;_;)try{if(u=1,b&&(R=2&W[0]?b.return:W[0]?b.throw||((R=b.return)&&R.call(b),0):b.next)&&!(R=R.call(b,W[1])).done)return R;switch(b=0,R&&(W=[2&W[0],R.value]),W[0]){case 0:case 1:R=W;break;case 4:return _.label++,{value:W[1],done:!1};case 5:_.label++,b=W[1],W=[0];continue;case 7:W=_.ops.pop(),_.trys.pop();continue;default:if(R=_.trys,!((R=R.length>0&&R[R.length-1])||W[0]!==6&&W[0]!==2)){_=0;continue}if(W[0]===3&&(!R||W[1]>R[0]&&W[1]<R[3])){_.label=W[1];break}if(W[0]===6&&_.label<R[1]){_.label=R[1],R=W;break}if(R&&_.label<R[2]){_.label=R[2],_.ops.push(W);break}R[2]&&_.ops.pop(),_.trys.pop();continue}W=v.call(C,_)}catch(k){W=[6,k],b=0}finally{u=R=0}if(5&W[0])throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}([q,B])}}},y=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(H,"__esModule",{value:!0});var s=I(24),m=I(36),r=I(31),a=I(27),d=y(I(0)),T=function(C){function v(u){var b=C.call(this)||this;return b.connectionID=0,b.currentURLIndex=0,b.reconnectMode="tryNext",b._state="closed",b.retryConfig=r.DEFAULT_RETRY_CONFIG,b.reconnectCount=0,b.name=u,b}return f(v,C),Object.defineProperty(v.prototype,"url",{get:function(){return this.websocket?this.websocket.url:null},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"state",{get:function(){return this._state},set:function(u){u!==this._state&&(this._state=u,this._state==="reconnecting"?this.emit(a.WebSocketManagerEvents.RECONNECTING,this.reconnectMode):this._state==="connected"?this.emit(a.WebSocketManagerEvents.CONNECTED):this._state==="closed"?this.emit(a.WebSocketManagerEvents.CLOSED):this._state==="failed"&&this.emit(a.WebSocketManagerEvents.FAILED))},enumerable:!0,configurable:!0}),v.prototype.init=function(u){var b=this;return new Promise(function(R,D){b.urls=u;var _=b.urls[b.currentURLIndex];b.state="connecting",b.createWebSocketConnection(_).then(R).catch(D),b.once(a.WebSocketManagerEvents.CLOSED,function(){return D(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT))}),b.once(a.WebSocketManagerEvents.CONNECTED,function(){return R()})})},v.prototype.close=function(u,b){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var R=this.websocket;b?setTimeout(function(){return R.close()},500):R.close(),this.websocket=void 0}this.state=u?"failed":"closed"},v.prototype.reconnect=function(u){if(this.websocket){u!==void 0&&(this.reconnectMode=u);var b=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),b&&b.bind(this.websocket)({code:9999})}else d.default.warning("["+this.name+"] can not reconnect, no websocket")},v.prototype.sendMessage=function(u){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ABORT,"websocket is not ready");var b=JSON.stringify(u);try{this.websocket.send(b)}catch(R){throw new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ERR,"send websocket message error"+R.toString())}},v.prototype.createWebSocketConnection=function(u){return S(this,void 0,void 0,function(){var b,R=this;return g(this,function(D){return this.connectionID+=1,b=this.connectionID,[2,new Promise(function(_,j){R.websocket&&(R.websocket.onclose=null,R.websocket.close()),d.default.debug("["+R.name+"] start connect, url: "+u);try{R.websocket=new WebSocket(u),R.websocket.binaryType="arraybuffer"}catch(B){var q=new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ERR,"init websocket failed! Error: "+B.toString());return d.default.error("["+R.name+"]"+q),void j(q)}r.wait(5e3).then(function(){b===R.connectionID&&R.websocket&&R.websocket.readyState!==WebSocket.OPEN&&R.websocket&&R.websocket.close()}),R.websocket.onopen=function(){d.default.debug("["+R.name+"] websockect opened:",u),R.reconnectMode="retry",R.state="connected",R.reconnectCount=0,_()},R.websocket.onclose=function(B){return S(R,void 0,void 0,function(){var W,k;return g(this,function(p){switch(p.label){case 0:return d.default.debug("["+this.name+"] websocket close "+(this.websocket&&this.websocket.url)+", code: "+B.code+", reason: "+B.reason+", current mode: "+this.reconnectMode),this.reconnectCount<this.retryConfig.maxRetryCount?(this.state==="connected"&&(this.state="reconnecting"),W=m.emitAsInvokerNoResponse(this,a.WebSocketManagerEvents.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,[4,this.reconnectWithAction(W)]):[3,2];case 1:return k=p.sent(),this.state==="closed"?(d.default.debug("["+this.connectionID+"] ws is closed, no need to reconnect"),[2]):k?(_(),[3,3]):(j(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT,"websocket reconnect failed: "+B.code)),this.close(!0),[2]);case 2:j(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT,"websocket close: "+B.code)),this.close(),p.label=3;case 3:return[2]}})})},R.websocket.onmessage=function(B){R.emit(a.WebSocketManagerEvents.ON_MESSAGE,B)}})]})})},v.prototype.reconnectWithAction=function(u,b){return S(this,void 0,void 0,function(){var R,D,_,j;return g(this,function(q){switch(q.label){case 0:return!b&&this.reconnectCount>=this.retryConfig.maxRetryCount?[2,!1]:this.urls?this.state==="closed"?[2,!1]:(R=r.getRetryWaitTime(this.reconnectCount,this.retryConfig),d.default.debug("["+this.name+"] wait "+R+"ms to reconnect websocket, mode: "+u),[4,r.wait(R)]):[2,!1];case 1:if(q.sent(),this.state==="closed")return[2,!1];this.reconnectCount+=1,q.label=2;case 2:return q.trys.push([2,12,,14]),u!=="retry"?[3,4]:(_=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(_)]);case 3:return q.sent(),[3,11];case 4:return u!=="tryNext"?[3,8]:(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length?[4,this.reconnectWithAction("recover")]:[3,6]);case 5:return[2,q.sent()];case 6:return d.default.debug("["+this.name+"] websocket url length: "+this.urls.length+" current index: "+this.currentURLIndex),_=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(_)];case 7:return q.sent(),[3,11];case 8:return u!=="recover"?[3,11]:(d.default.debug("["+this.name+"] request new urls"),D=this,[4,m.emitAsPromise(this,a.WebSocketManagerEvents.REQUEST_NEW_URLS)]);case 9:return D.urls=q.sent(),this.currentURLIndex=0,_=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(_)];case 10:q.sent(),q.label=11;case 11:return[2,!0];case 12:return j=q.sent(),d.default.error("["+this.name+"] reconnect failed",j.toString()),[4,this.reconnectWithAction(u)];case 13:return[2,q.sent()];case 14:return[2]}})})},v}(m.EventEmitter);H.AgoraWebSocketManager=T},function(z,H,I){var E=I(18),f=I(38),S=I(79),g=I(44);function y(m){var r=new S(m),a=f(S.prototype.request,r);return E.extend(a,S.prototype,r),E.extend(a,r),a}var s=y(I(41));s.Axios=S,s.create=function(m){return y(g(s.defaults,m))},s.Cancel=I(45),s.CancelToken=I(93),s.isCancel=I(40),s.all=function(m){return Promise.all(m)},s.spread=I(94),z.exports=s,z.exports.default=s},function(z,H,I){var E=I(18),f=I(39),S=I(80),g=I(81),y=I(44);function s(m){this.defaults=m,this.interceptors={request:new S,response:new S}}s.prototype.request=function(m){typeof m=="string"?(m=arguments[1]||{}).url=arguments[0]:m=m||{},(m=y(this.defaults,m)).method?m.method=m.method.toLowerCase():this.defaults.method?m.method=this.defaults.method.toLowerCase():m.method="get";var r=[g,void 0],a=Promise.resolve(m);for(this.interceptors.request.forEach(function(d){r.unshift(d.fulfilled,d.rejected)}),this.interceptors.response.forEach(function(d){r.push(d.fulfilled,d.rejected)});r.length;)a=a.then(r.shift(),r.shift());return a},s.prototype.getUri=function(m){return m=y(this.defaults,m),f(m.url,m.params,m.paramsSerializer).replace(/^\?/,"")},E.forEach(["delete","get","head","options"],function(m){s.prototype[m]=function(r,a){return this.request(E.merge(a||{},{method:m,url:r}))}}),E.forEach(["post","put","patch"],function(m){s.prototype[m]=function(r,a,d){return this.request(E.merge(d||{},{method:m,url:r,data:a}))}}),z.exports=s},function(z,H,I){var E=I(18);function f(){this.handlers=[]}f.prototype.use=function(S,g){return this.handlers.push({fulfilled:S,rejected:g}),this.handlers.length-1},f.prototype.eject=function(S){this.handlers[S]&&(this.handlers[S]=null)},f.prototype.forEach=function(S){E.forEach(this.handlers,function(g){g!==null&&S(g)})},z.exports=f},function(z,H,I){var E=I(18),f=I(82),S=I(40),g=I(41);function y(s){s.cancelToken&&s.cancelToken.throwIfRequested()}z.exports=function(s){return y(s),s.headers=s.headers||{},s.data=f(s.data,s.headers,s.transformRequest),s.headers=E.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),E.forEach(["delete","get","head","post","put","patch","common"],function(m){delete s.headers[m]}),(s.adapter||g.adapter)(s).then(function(m){return y(s),m.data=f(m.data,m.headers,s.transformResponse),m},function(m){return S(m)||(y(s),m&&m.response&&(m.response.data=f(m.response.data,m.response.headers,s.transformResponse))),Promise.reject(m)})}},function(z,H,I){var E=I(18);z.exports=function(f,S,g){return E.forEach(g,function(y){f=y(f,S)}),f}},function(z,H){var I,E,f=z.exports={};function S(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}function y(u){if(I===setTimeout)return setTimeout(u,0);if((I===S||!I)&&setTimeout)return I=setTimeout,setTimeout(u,0);try{return I(u,0)}catch{try{return I.call(null,u,0)}catch{return I.call(this,u,0)}}}(function(){try{I=typeof setTimeout=="function"?setTimeout:S}catch{I=S}try{E=typeof clearTimeout=="function"?clearTimeout:g}catch{E=g}})();var s,m=[],r=!1,a=-1;function d(){r&&s&&(r=!1,s.length?m=s.concat(m):a=-1,m.length&&T())}function T(){if(!r){var u=y(d);r=!0;for(var b=m.length;b;){for(s=m,m=[];++a<b;)s&&s[a].run();a=-1,b=m.length}s=null,r=!1,function(R){if(E===clearTimeout)return clearTimeout(R);if((E===g||!E)&&clearTimeout)return E=clearTimeout,clearTimeout(R);try{E(R)}catch{try{return E.call(null,R)}catch{return E.call(this,R)}}}(u)}}function C(u,b){this.fun=u,this.array=b}function v(){}f.nextTick=function(u){var b=new Array(arguments.length-1);if(arguments.length>1)for(var R=1;R<arguments.length;R++)b[R-1]=arguments[R];m.push(new C(u,b)),m.length!==1||r||y(T)},C.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=v,f.addListener=v,f.once=v,f.off=v,f.removeListener=v,f.removeAllListeners=v,f.emit=v,f.prependListener=v,f.prependOnceListener=v,f.listeners=function(u){return[]},f.binding=function(u){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(u){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(z,H,I){var E=I(18);z.exports=function(f,S){E.forEach(f,function(g,y){y!==S&&y.toUpperCase()===S.toUpperCase()&&(f[S]=g,delete f[y])})}},function(z,H,I){var E=I(43);z.exports=function(f,S,g){var y=g.config.validateStatus;!y||y(g.status)?f(g):S(E("Request failed with status code "+g.status,g.config,null,g.request,g))}},function(z,H,I){z.exports=function(E,f,S,g,y){return E.config=f,S&&(E.code=S),E.request=g,E.response=y,E.isAxiosError=!0,E.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},E}},function(z,H,I){var E=I(88),f=I(89);z.exports=function(S,g){return S&&!E(g)?f(S,g):g}},function(z,H,I){z.exports=function(E){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(E)}},function(z,H,I){z.exports=function(E,f){return f?E.replace(/\/+$/,"")+"/"+f.replace(/^\/+/,""):E}},function(z,H,I){var E=I(18),f=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];z.exports=function(S){var g,y,s,m={};return S&&E.forEach(S.split(`
`),function(r){if(s=r.indexOf(":"),g=E.trim(r.substr(0,s)).toLowerCase(),y=E.trim(r.substr(s+1)),g){if(m[g]&&f.indexOf(g)>=0)return;m[g]=g==="set-cookie"?(m[g]?m[g]:[]).concat([y]):m[g]?m[g]+", "+y:y}}),m}},function(z,H,I){var E=I(18);z.exports=E.isStandardBrowserEnv()?function(){var f,S=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a");function y(s){var m=s;return S&&(g.setAttribute("href",m),m=g.href),g.setAttribute("href",m),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return f=y(window.location.href),function(s){var m=E.isString(s)?y(s):s;return m.protocol===f.protocol&&m.host===f.host}}():function(){return!0}},function(z,H,I){var E=I(18);z.exports=E.isStandardBrowserEnv()?{write:function(f,S,g,y,s,m){var r=[];r.push(f+"="+encodeURIComponent(S)),E.isNumber(g)&&r.push("expires="+new Date(g).toGMTString()),E.isString(y)&&r.push("path="+y),E.isString(s)&&r.push("domain="+s),m===!0&&r.push("secure"),document.cookie=r.join("; ")},read:function(f){var S=document.cookie.match(new RegExp("(^|;\\s*)("+f+")=([^;]*)"));return S?decodeURIComponent(S[3]):null},remove:function(f){this.write(f,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(z,H,I){var E=I(45);function f(S){if(typeof S!="function")throw new TypeError("executor must be a function.");var g;this.promise=new Promise(function(s){g=s});var y=this;S(function(s){y.reason||(y.reason=new E(s),g(y.reason))})}f.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},f.source=function(){var S;return{token:new f(function(g){S=g}),cancel:S}},z.exports=f},function(z,H,I){z.exports=function(E){return function(f){return E.apply(null,f)}}},function(z,H,I){var E=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(H,"__esModule",{value:!0});var f=E(I(0)),S=1,g=function(){function y(s){this.lockingPromise=Promise.resolve(),this.locks=0,this.name="",this.lockId=S++,s&&(this.name=s),f.default.debug("[lock-"+this.name+"-"+this.lockId+"] is created.")}return Object.defineProperty(y.prototype,"isLocked",{get:function(){return this.locks>0},enumerable:!0,configurable:!0}),y.prototype.lock=function(){var s,m=this;this.locks+=1,f.default.debug("[lock-"+this.name+"-"+this.lockId+"] is locked, current queue "+this.locks+".");var r=new Promise(function(d){s=function(){m.locks-=1,f.default.debug("[lock-"+m.name+"-"+m.lockId+"] is not locked, current queue "+m.locks+"."),d()}}),a=this.lockingPromise.then(function(){return s});return this.lockingPromise=this.lockingPromise.then(function(){return r}),a},y}();H.PromiseMutex=g},function(z,H,I){I.r(H);var E=I(2),f=I(0),S=I(1),g=I(8),y=I(5),s=function(){};s.prototype.set=function(ee,A){["BatteryLevel"].indexOf(ee)>-1&&(this[ee]=A)};var m=function(){var ee=S.report.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),A=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,fe=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,Ee=window.WebSocket,ge=!!A&&!!fe&&!!Ee,he=!1;y.isChrome()&&y.getBrowserVersion()>=58&&y.getBrowserOS()!=="iOS"&&(he=!0),y.isFireFox()&&y.getBrowserVersion()>=56&&(he=!0),y.isOpera()&&y.getBrowserVersion()>=45&&(he=!0),y.isSafari()&&y.getBrowserVersion()>=11&&(he=!0),y.isEdge()&&(he=!0),(y.isWeChatBrowser()||y.isQQBrowser())&&y.getBrowserOS()!=="iOS"&&(he=!0),y.isSupportedPC()||y.isSupportedMobile()||(he=!1);var _e=ge&&he;return ee(null,_e),_e},r=new function(){var ee=Object(g.b)();return ee.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},ee.state=ee.states.UNINIT,ee.batteryManager=null,ee._init=function(A,fe){ee.state=ee.states.INITING,navigator.getBattery?navigator.getBattery().then(function(Ee){ee.batteryManager=Ee,A&&setTimeout(function(){A()},0)}).catch(function(Ee){f.default.debug("navigator.getBattery is disabled",Ee),A&&A()}):(ee.state=ee.states.INITED,A&&A())},ee._getBatteryStats=function(){var A={};return ee.batteryManager&&ee.batteryManager.level?A.BatteryLevel=Math.floor(100*ee.batteryManager.level):A.BatteryLevel="UNSUPPORTED",A},ee.getStats=function(A,fe){var Ee=new s,ge=ee._getBatteryStats();ge&&ge.BatteryLevel&&Ee.set("BatteryLevel",ge.BatteryLevel),A&&A(Ee)},ee._init(),ee},a=I(22),d=I(19),T=I(26),C=I(53),v=I(9),u=["live","rtc","web","interop","h264_interop","web-only"],b=["vp8","vp9","h264"],R=["aes-128-gcm","aes-256-gcm","aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-256-gcm2","aes-128-gcm2"],D=I(11),_=I.n(D),j=I(7),q=I.n(j),B=I(13),W=I(4),k=I(10),p=I(20),n=I(6),N=I(14),l={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},t={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},x=function(ee){var A={remoteStreamStorage:{},localStreamStorage:{}};return A.gatewayClient=ee,A.checkAudioOutputLevel=function(fe){return!(fe&&parseInt(fe.audioRecvBytesDelta)>0&&parseInt(fe.audioDecodingNormalDelta)>0&&parseInt(fe.audioOutputLevel)===0)},A.checkAudioIntputLevel=function(fe){return!fe||parseInt(fe.audioInputLevel)!==0},A.checkFramerateInput=function(fe,Ee){if(!fe||!Ee.attributes)return!0;var ge=parseInt(Ee.attributes.maxFrameRate),he=parseInt(fe.googFrameRateInput);return!ge||!he||!(ge>10&&he<5||ge<10&&ge>=5&&he<=1)},A.checkFramerateSent=function(fe){return!(fe&&parseInt(fe.googFrameRateInput)>5&&parseInt(fe.googFrameRateSent)<=1)},A.checkSendVideoBitrate=function(fe){return!fe||parseInt(fe.videoSendBytesDelta)!==0},A.checkSendAudioBitrate=function(fe){return!fe||parseInt(fe.audioSendBytesDelta)!==0},A.checkVideoDecode=function(fe){return!fe||parseInt(fe.videoRecvBytesDelta)===0||parseInt(fe.googFrameRateDecoded)!==0},A.checkAudioDecode=function(fe){return!fe||parseInt(fe.audioRecvBytesDelta)===0||parseInt(fe.audioDecodingNormalDelta)!==0},A.record=function(fe,Ee,ge,he,_e){ge[fe]||(ge[fe]={isPrevNormal:!0,record:[]});var c=ge[fe],P=A["check"+fe](Ee,_e);if(c.record.push(P),c.record.length>=5){c.isCurNormal=c.record.indexOf(!0)!==-1;var F=t[fe];c.isPrevNormal&&!c.isCurNormal&&A.gatewayClient.dispatchEvent({type:"exception",code:F,msg:l[F],uid:he}),!c.isPrevNormal&&c.isCurNormal&&A.gatewayClient.dispatchEvent({type:"exception",code:F+2e3,msg:l[F+2e3],uid:he}),c.isPrevNormal=c.isCurNormal,c.record=[]}},A.setLocalStats=function(fe){var Ee={};Object.keys(fe).map(function(ge){var he=fe[ge],_e=A.gatewayClient.localStreams[parseInt(ge)],c=A.localStreamStorage[ge]||{};_e&&_e.hasVideo()&&(A.record("SendVideoBitrate",he.videoStats,c,ge),A.record("FramerateInput",he.videoStats,c,ge,_e),A.record("FramerateSent",he.videoStats,c,ge)),_e&&_e.hasAudio()&&(A.record("AudioIntputLevel",he.audioStats,c,ge),A.record("SendAudioBitrate",he.audioStats,c,ge)),Ee[ge]=c}),A.localStreamStorage=Ee},A.setRemoteStats=function(fe){var Ee={};Object.keys(fe).map(function(ge){var he=fe[ge],_e=ee.remoteStreams[ge],c=A.remoteStreamStorage[ge]||{};_e&&_e.hasVideo()&&_e.isPlaying()&&A.record("VideoDecode",he.videoStats,c,ge),_e&&_e.hasAudio()&&_e.isPlaying()&&(A.record("AudioOutputLevel",he.audioStats,c,ge),A.record("AudioDecode",he.audioStats,c,ge)),Ee[ge]=c}),A.remoteStreamStorage=Ee},A};function o(ee){if(typeof Symbol=="undefined"||ee[Symbol.iterator]==null){if(Array.isArray(ee)||(ee=function(c,P){if(!!c){if(typeof c=="string")return h(c,P);var F=Object.prototype.toString.call(c).slice(8,-1);if(F==="Object"&&c.constructor&&(F=c.constructor.name),F==="Map"||F==="Set")return Array.from(F);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return h(c,P)}}(ee))){var A=0,fe=function(){};return{s:fe,n:function(){return A>=ee.length?{done:!0}:{done:!1,value:ee[A++]}},e:function(c){throw c},f:fe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ee,ge,he=!0,_e=!1;return{s:function(){Ee=ee[Symbol.iterator]()},n:function(){var c=Ee.next();return he=c.done,c},e:function(c){_e=!0,ge=c},f:function(){try{he||Ee.return==null||Ee.return()}finally{if(_e)throw ge}}}}function h(ee,A){(A==null||A>ee.length)&&(A=ee.length);for(var fe=0,Ee=new Array(A);fe<A;fe++)Ee[fe]=ee[fe];return Ee}var L,M=I(3),G=new function(){var ee=Object(g.b)();return ee.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},ee.state=ee.states.UNINIT,ee.type=null,ee.lastConnectedAt=null,ee.lastDisconnectedAt=null,ee.lastTypeChangedAt=null,ee.networkChangeTimer=null,ee._init=function(A,fe){if(ee.state=ee.states.INITING,navigator.connection&&navigator.connection.addEventListener){var Ee=ee._getNetworkInfo();ee.type=Ee&&Ee.type,ee.state=ee.states.INITED,A&&A()}else ee.state=ee.states.UNINIT,fe&&fe("DO_NOT_SUPPORT")},ee._getNetworkInfo=function(){return navigator.connection},ee._reloadNetworkInfo=function(){var A=ee._getNetworkInfo(),fe=A&&A.type||"UNSUPPORTED",Ee=Date.now();if(fe!==ee.type){ee.lastTypeChangedAt=Ee,fe=="none"?ee.lastDisconnectedAt=Ee:ee.type=="none"&&(ee.lastConnectedAt=Ee),ee.type=fe;var ge={type:"networkTypeChanged",networkType:fe};ee.dispatchEvent(ge)}},ee.getStats=function(A,fe){var Ee={},ge=ee._getNetworkInfo();ge&&(Ee.NetworkType=ge.type||"UNSUPPORTED"),setTimeout(function(){A(Ee)},0)},ee._init(function(){navigator.connection.addEventListener("change",function(){ee._reloadNetworkInfo()}),ee.networkChangeTimer=setInterval(function(){ee._reloadNetworkInfo()},5e3)},function(A){}),ee},Q=I(55),J=I(16),O=I(56),w=I.n(O),U=I(21),$=function(){return(L||L||(L=(window.location.protocol.split(":")[0]||"").toUpperCase()))==="HTTPS"},Y=function(){return window.isSecureContext!==void 0},Z="host",re=function(ee){var A={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServers:[],useProxyServer:!1,useLocalAccessPoint:!1};if(A.mode=ee.mode,A.codec=ee.codec,A.clientId=Object(k.generateSessionId)().slice(0,5),A.uintUid=null,A.customReportCount=0,ee=q()({},ee),A.aespassword=null,A.aesmode="none",A.hasPublished=!1,A.getSessionId=function(){return ee.sessionId},A.startChannelMediaRelay=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(V){if(V)return P&&P(V);P&&P()},name:"Client.startChannelMediaRelay",options:arguments,tag:"tracer"});if(!(c instanceof v.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var X=c.getSrcChannelMediaInfo(),ne=c.getDestChannelMediaInfos();if(Object(M.isEmpty)(X))throw"srcChannelMediaInfo should not be empty";if(Object(M.isEmpty)(ne)||ne.length===0)throw"destChannelMediaInfos should not be empty";if(!Object(k.is32Uint)(X.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(M.isValidChannelName)(X.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(X.token&&!Object(M.isValidToken)(X.token))throw"Invalid token in srcChannelMediaInfo";if(ne.forEach(function(V){if(!Object(k.is32Uint)(V.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(M.isValidChannelName)(V.channelName))throw"Invalid channelName in destChannelMediaInfo";if(V.token&&!Object(M.isValidToken)(V.token))throw"Invalid token in destChannelMediaInfo"}),A.gatewayClient.state!==B.a.CONNECTED)throw"startChannelMediaRelay should be used after join";A.gatewayClient.startChannelMediaRelay(c).then(function(){F&&F()}).catch(function(V){F&&F(V)})},A.updateChannelMediaRelay=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(V){if(V)return P&&P(V);P&&P()},name:"Client.updateChannelMediaRelay",options:arguments,tag:"tracer"});if(!(c instanceof v.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var X=c.getSrcChannelMediaInfo(),ne=c.getDestChannelMediaInfos();if(Object(M.isEmpty)(X))throw"srcChannelMediaInfo should not be empty";if(Object(M.isEmpty)(ne)||ne.length===0)throw"destChannelMediaInfos should not be empty";if(!Object(k.is32Uint)(X.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(M.isValidChannelName)(X.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(X.token&&!Object(M.isValidToken)(X.token))throw"Invalid token in srcChannelMediaInfo";if(ne.forEach(function(V){if(!Object(k.is32Uint)(V.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(M.isValidChannelName)(V.channelName))throw"Invalid channelName in destChannelMediaInfo";if(V.token&&!Object(M.isValidToken)(V.token))throw"Invalid token in destChannelMediaInfo"}),A.gatewayClient.state!==B.a.CONNECTED)throw"updateChannelMediaRelay should be used after join";A.gatewayClient.updateChannelMediaRelay(c).then(function(){F&&F()}).catch(function(V){F&&F(V)})},A.stopChannelMediaRelay=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{callback:function(F){if(F)return c&&c(F);c&&c()},name:"Client.stopChannelMediaRelay",options:arguments,tag:"tracer"});A.gatewayClient.stopChannelMediaRelay().then(function(){P&&P()}).catch(function(F){P&&P(F)})},A.getConnectionState=function(){var c=S.report.reportApiInvoke(ee.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),P=B.a.connetionStateMap[A.gatewayClient.state];return c(),P},A.setClientRole=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:P,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Object(M.checkValidEnum)(c,"setClientRole",[Z,"audience"]),A.mode==="rtc"){var X="RTC mode can not use setClientRole";return f.default.warning("[".concat(A.clientId,"] ").concat(X)),F&&F(X)}A.gatewayClient&&A.gatewayClient.state===B.a.CONNECTED?(c==="audience"&&(this.highStreamState===0?this._unpublish(this.highStream,function(){F&&F(null,{role:c})},function(ne){F&&F(ne)}):A.gatewayClient.setClientRole("audience",F)),c===Z&&A.gatewayClient.setClientRole(Z,F)):(A.gatewayClient.role=c,F&&F(null,{role:c}))},A.getGatewayInfo=function(c){if(A.gatewayClient.state!==B.a.CONNECTED){var P="Client is not in connected state";return f.default.error("[".concat(A.clientId,"] ").concat(P)),void c(P)}A.gatewayClient.getGatewayInfo(function(F){c(null,F)},c)},A.renewToken=function(c,P,F){var X=S.report.reportApiInvoke(ee.sessionId,{callback:function(ne,V){if(ne)return f.default.error("Failed to renew token ".concat(ne),V),F&&F(ne);P&&P(V)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Object(M.isValidToken)(c))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return A.gatewayClient?A.key?(A.key=c,void A.gatewayClient.renewToken(c,function(ne){return X(null,ne)},X)):(f.default.error("[".concat(A.clientId,"] renewToken should not be called before user join")),X(W.default.INVALID_OPERATION)):(f.default.error("[".concat(A.clientId,"] renewToken Failed. GatewayClient not Exist")),X(W.default.INVALID_OPERATION))},A.setLowStreamParameter=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});Object(M.checkValidObject)(c,"param");var F=c.width,X=c.height,ne=c.framerate,V=c.bitrate;Object(M.isEmpty)(F)||Object(M.checkValidNumber)(F,"width"),Object(M.isEmpty)(X)||Object(M.checkValidNumber)(X,"height"),Object(M.isEmpty)(ne)||Object(M.checkValidNumber)(ne,"framerate"),Object(M.isEmpty)(V)||Object(M.checkValidNumber)(V,"bitrate",1,1e7),(!F&&X||F&&!X)&&f.default.warning("[".concat(A.clientId,"] The width and height parameters take effect only when both are set")),A.lowStreamParameter=c,P()},A.init=function(c,P,F){var X=S.report.reportApiInvoke(ee.sessionId,{callback:function(ne,V){if(ne)return F&&F(ne);P&&P(V)},name:"Client.init",options:arguments,tag:"tracer"});Object(M.checkValidString)(c),Object(y.isChromeKernel)()&&Object(y.getChromeKernelVersion)()<=48?F?X(W.default.BAD_ENVIRONMENT):Object(k.popBanTip)():(ee.appId=c,ee.sessionId=Object(k.generateSessionId)(),X())},A.setTurnServer=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(A.gatewayClient&&A.gatewayClient.state!==B.a.DISCONNECTED)throw new Error("Set turn server before join channel");if(A.useProxyServer)throw new Error("You have already set the proxy");if(A.useLocalAccessPoint)throw new Error("You have already set the local proxy");c instanceof Array||(c=[c]);var F=[];c.map(function(X,ne){Object(M.checkValidObject)(X,"turnServer");var V=X.turnServerURL,K=X.username,te=X.password,ae=X.udpport,de=X.forceturn,oe=X.tcpport;if(Object(M.checkValidString)(V,"turnServerURL"),Object(M.checkValidString)(K,"username"),Object(M.checkValidString)(te,"password"),Object(M.checkValidString)(ae,"udpport"),parseInt(ae)===0)throw new Error("udpport should not be ".concat(ae));Object(M.isEmpty)(de)||Object(M.checkValidBoolean)(de,"forceturn");var pe={mode:"manual"};if(pe.url=V,pe.udpport=ae,pe.username=K,pe.credential=te,pe.forceturn=de||!1,!Object(M.isEmpty)(oe)){if(Object(M.checkValidString)(oe,"tcpport"),parseInt(oe)===0)throw new Error("tcpport should not be ".concat(oe));pe.tcpport=oe,f.default.info("[".concat(A.clientId,"] Set turnserver[").concat(ne,"] tcpurl. ").concat(pe.url,":").concat(pe.tcpport))}f.default.info("[".concat(A.clientId,"] Set turnserver[").concat(ne,"] udpurl. ").concat(pe.url,":").concat(pe.udpport,",username: ").concat(pe.username)),F.push(pe)}),A.turnServers=F,P()},A.setProxyServer=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(A.gatewayClient&&A.gatewayClient.state!==B.a.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!c)throw new Error("Do not set the proxyServer parameter as empty");if(A.useProxyServer)throw new Error("You have already set the proxy");if(A.useLocalAccessPoint)throw new Error("You have already set the local proxy");Object(M.checkValidString)(c,"proxyServer"),A.proxyServer=c,S.report.setProxyServer(c),f.default.setProxyServer(c),P()},A.startProxyServer=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(A.gatewayClient&&A.gatewayClient.state!==B.a.DISCONNECTED)throw new Error("Start proxy server before join channel");if(A.proxyServer)throw new Error("You have already set the proxy");if(A.useLocalAccessPoint)throw new Error("You have already set the local proxy");A.useProxyServer=!0,A.proxyServerType=c||1,P()},A.stopProxyServer=function(){var c=S.report.reportApiInvoke(ee.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(A.gatewayClient&&A.gatewayClient.state!==B.a.DISCONNECTED)throw new Error("Stop proxy server after leave channel");S.report.setProxyServer(),f.default.setProxyServer(),A.turnServers=[],A.proxyServer=null,A.useProxyServer=!1,A.proxyServerType=null,c()},A.setEncryptionSecret=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Object(M.checkValidString)(c,"password");var F=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");F.test(c)||f.default.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer,
      `),A.aespassword=c,P()},A.setEncryptionMode=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Object(M.checkValidString)(c,"encryptionMode"),R.indexOf(c)===-1)throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb" | "sm4-128-ecb" | "aes-128-gcm" | "aes-256-gcm" | "aes-128-gcm2" | "aes-256-gcm2"');var X=["aes-128-gcm2","aes-256-gcm2"];if(X.indexOf(c)!==-1){if(!P||!(P instanceof Uint8Array&&P.length===32))throw Error("salt must be an Uint8Array and exactly equal to 32 bytes")}else if(P)throw new Error("Only ".concat("aes-128-gcm2"," and ").concat("aes-256-gcm2"," support use salt"));P&&(A.aesSalt=Object(k.uint8ArrayToBase64)(P)),A.aesmode=c,F()},A.configPublisher=function(c){var P=S.report.reportApiInvoke(ee.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});Object(M.checkValidObject)(c,"config");var F=c.width,X=c.height,ne=c.framerate,V=c.bitrate,K=c.publisherUrl;Object(M.checkValidNumber)(F,"width"),Object(M.checkValidNumber)(X,"height"),Object(M.checkValidNumber)(ne,"framerate"),Object(M.checkValidNumber)(V,"bitrate",1,1e7),K&&Object(M.checkValidString)(K,"publisherUrl"),A.gatewayClient.configPublisher(c),P()},A.enableDualStream=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(X,ne){if(X)return P&&P(X);c&&c(ne)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return Object(y.getBrowserOS)()==="iOS"?(S.report.streamSwitch(ee.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),F(W.default.IOS_NOT_SUPPORT)):Object(y.isWeChatBrowser)()?(S.report.streamSwitch(ee.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),F(W.default.WECHAT_NOT_SUPPORT)):(S.report.streamSwitch(ee.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!0}),A.isDualStream=!0,A.highStream&&(A.highStream.isDualStream=!0),void(A.highStreamState===0?A._publishLowStream(function(X){return F(null,X)},function(X){f.default.warning("[".concat(A.clientId,"]"),X),F(W.default.ENABLE_DUALSTREAM_FAILED)}):A.highStreamState===1?F(W.default.STILL_ON_PUBLISHING):F(null)))},A.disableDualStream=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(X,ne){if(X)return P&&P(X);c&&c(ne)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});S.report.streamSwitch(ee.sessionId,{lts:new Date().getTime(),isdual:!1,succ:!0}),A.isDualStream=!1,A.highStream&&(A.highStream.isDualStream=!1),A.highStreamState===0?A._unpublishLowStream(function(){A.highStream.lowStream=null,F()},function(X){f.default.warning("[".concat(A.clientId,"]"),X),F(W.default.DISABLE_DUALSTREAM_FAILED)}):A.highStreamState===1?F(W.default.STILL_ON_PUBLISHING):F()},A._getLowStream=function(c,P){A.lowStream?c(A.lowStream):A._createLowStream(function(F){A.lowStream=F,c(A.lowStream)},P)},A._createLowStream=function(c,P){if(A.highStream&&A.highStream.stream){var F=q()({},A.highStream.params);if(F.streamID+=1,F.audio=!1,F.video)if(A.highStream.stream.getVideoTracks()[0]){var X=new a.a(F);X.isLowStream=!0,X.streamId=A.highStream.getId()+1;var ne={};A.lowStreamParameter&&(ne=q()({},A.lowStreamParameter)),ne.width&&ne.height||(ne.width=160,ne.height=120),ne.framerate=ne.framerate||15,ne.bitrate=ne.bitrate||50,X.setVideoProfileCustomPlus(ne);try{var V=w()(A.highStream,{width:X.videoConstraint.width.ideal,height:X.videoConstraint.height.ideal,framerate:X.videoConstraint.frameRate});return X.stream=V,A.highStream.lowStream=X,A.highStream.userMuteVideo&&X.muteVideo(),c&&c(X)}catch(K){return P&&P(K)}}else P&&P(W.default.HIGH_STREAM_NOT_VIDEO_TRACE);else P&&P(W.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else P&&P(W.default.HIGH_STREAM_NOT_VIDEO_TRACE)},A._publishLowStream=function(c,P){return A.lowStreamState!==2?P&&P(W.default.LOW_STREAM_ALREADY_PUBLISHED):A.highStream&&A.highStream.hasScreen()?P&&P(W.default.SHARING_SCREEN_NOT_SUPPORT):void A._getLowStream(function(F){A.lowStreamState=1,A.gatewayClient.publish(F,{streamType:1},function(){A.lowStreamState=0,c&&c()},function(X){A.lowStreamState===1&&(A.lowStreamState=2),f.default.debug("[".concat(A.clientId,"] publish low stream failed")),P&&P(X)})},P)},A._unpublishLowStream=function(c,P){if(A.lowStreamState!==0)return P&&P(W.default.LOW_STREAM_NOT_YET_PUBLISHED);A.lowStream&&(A.gatewayClient.unpublish(A.lowStream,{streamType:1},function(){},function(F){f.default.debug("[".concat(A.clientId,"] unpublish low stream failed")),P&&P(F)}),A.lowStream.close(),A.lowStream=null,A.lowStreamState=2,c&&c())},A.join=function(c,P,F,X,ne,V){X&&typeof X=="function"&&(V=ne,ne=X,X=null);var K=m(),te=Object(y.getBrowserInfo)();f.default.debug(te,",Support: "+K);var ae=$(),de="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",oe=Y()?window.isSecureContext:"Browser Not Support",pe=function(){f.default.warning(de)};Y()?window.isSecureContext||pe():ae||pe();var ve=S.report.reportApiInvoke(ee.sessionId,{callback:function(ye,be){if(ye)return V&&V(ye);ne&&ne(be)},name:"Client.join",options:arguments,getStates:function(){return{isHttps:ae,isSecureContext:oe}},tag:"tracer"});if(c&&!Object(M.isValidToken)(c))return f.default.warning("[".concat(A.clientId,"] Param channelKey should be string")),ve(W.default.INVALID_PARAMETER);if(!Object(M.isValidChannelName)(P))return f.default.error("Invalid Channel Name ".concat(P)),f.default.warning("[".concat(A.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),ve(W.default.INVALID_PARAMETER);if(typeof P=="string"&&P==="")return f.default.warning("[".concat(A.clientId,"] Param channel should not be empty")),ve(W.default.INVALID_PARAMETER);if(X&&!Object(M.isValidString)(X))return f.default.warning("[".concat(A.clientId,"] optionalInfo should be string")),ve(W.default.INVALID_PARAMETER);if(F&&!Object(k.is32Uint)(F)&&!Object(M.isValidString)(F,1,255))return f.default.error("Invalid UID ".concat(F," ").concat(_()(F))),f.default.warning("[".concat(A.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is 32Uint")),ve(W.default.INVALID_PARAMETER);if(typeof F=="string"&&F.length==0)return f.default.warning("[".concat(A.clientId,"] String uid should not be empty")),ve(W.default.INVALID_PARAMETER);if(typeof F=="string"&&F.length>256)return f.default.warning("[".concat(A.clientId,"] Length of string uid should be less than 255")),ve(W.default.INVALID_PARAMETER);f.default.stopWaitJoin(),A.highStream=null,A.lowStream=null,A.lowStreamParameter=null,A.isDualStream=!1,A.highStreamState=2,A.lowStreamState=2;var Re=Date.now(),Ie=setTimeout(function(){if(A.gatewayClient.hasJoined!=1){f.default.debug("[".concat(A.clientId,"] The time to join the channel is greater than 5 seconds "));var ye=Date.now();S.report.joinChannelTimeOut({lts:ye,sid:ee.sessionId,cname:P,cid:Se&&Se.cid,uid:Se.uid||(typeof F=="string"?void 0:F),elapse:ye-Re,timeout:5})}},5e3),Se={clientId:A.clientId,appId:ee.appId,sid:ee.sessionId,cname:P,uid:F,turnServers:A.turnServers.concat(),proxyServer:A.proxyServer,token:c||ee.appId,useProxyServer:A.useProxyServer,useLocalAccessPoint:A.useLocalAccessPoint,proxyServerType:A.proxyServerType,optionalInfo:X};if(typeof F=="string"&&(Se.stringUid=F,A.uintUid?(Se.uid=A.uintUid,delete A.uintUid):Se.uid=0),A.aespassword&&A.aesmode!=="none"&&q()(Se,{aespassword:A.aespassword,aesmode:A.aesmode}),A.aesSalt&&(Se.aes_salt=A.aesSalt),S.report.sessionInit(ee.sessionId,{lts:new Date().getTime(),cname:P,appid:ee.appId,mode:ee.mode,succ:!0}),A.onSuccess=function(ye){clearTimeout(Ie),A.rtcStatsCollector.startNetworkQualityTimer(),A.onSuccess=null,ve(null,ye)},A.onFailure=function(ye){return ve(ye)},A.channel=P,A.gatewayClient.state!==B.a.DISCONNECTED)return f.default.error("[".concat(A.clientId,"] Client already in connecting/connected state")),ve(W.default.INVALID_OPERATION),void S.report.joinGateway(ee.sessionId,{lts:Date.now(),succ:!1,ec:W.default.INVALID_OPERATION,addr:null});A.gatewayClient.state=B.a.CONNECTING;var Te=function(ye,be){f.default.info("[".concat(A.clientId,"] Joining channel: ").concat(P)),A.gatewayClient.dispatchEvent({type:"config-distribute",config:be,joinInfo:Se}),A.key=c||ee.appId,Se.cid=ye.cid,Se.uid||(Se.uid=ye.uid),Se.vid=ye.vid,Se.clientId=A.clientId,Se.apResponse=ye.res,ye.uni_lbs_ip&&ye.uni_lbs_ip[1]&&(Se.uni_lbs_ip=ye.uni_lbs_ip[1]),Se.gatewayAddr=ye.gateway_addr,A.joinInfo=Se,A.gatewayClient.join(Se,A.key,function(Ae){f.default.info("[".concat(A.clientId,"] Join channel ").concat(P," success, join with uid: ").concat(Ae,".")),A.onSuccess=null,A.rtcStatsCollector.startNetworkQualityTimer(),ve(null,Ae)},function(Ae){return ve(Ae)})};Se.stringUid&&!Se.uid?(A.userAccountReq&&!A.userAccountReq.isFinished()&&A.userAccountReq.cancel(),A.userAccountReq=Object(p.getUserAccount)(Se,A.gatewayClient),A.userAccountReq.then(function(ye){f.default.debug("getUserAccount Success ".concat(ye.url," ").concat(Se.stringUid," => ").concat(ye.uid)),Se.uid=ye.uid,Object(p.getGatewayList)(Se,Te,function(be){return ve(be)})}).catch(function(ye){f.default.error("getUserAccount rejected",ye),ve(ye)})):Object(p.getGatewayList)(Se,Te,function(ye){return ve(ye)})},A.renewChannelKey=function(c,P,F){var X=S.report.reportApiInvoke(ee.sessionId,{callback:function(ne,V){if(ne)return F&&F(ne);P&&P(V)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Object(M.checkValidString)(c,"key",1,2047),A.key===void 0?(f.default.error("[".concat(A.clientId,"] renewChannelKey should not be called before user join")),X(W.default.INVALID_OPERATION)):(A.key=c,A.gatewayClient.joinInfo.token=c,A.gatewayClient.key=c,A.gatewayClient.recover(),X())},A.leave=function(c,P){A.gatewayClient.isFirstSuccess=!0,A.gatewayClient.hasInvokeLeave=!0;var F=!1,X=S.report.reportApiInvoke(ee.sessionId,{callback:function(ne,V){if(ne)return P&&P(ne);A.gatewayClient.reconnectingCS=!1,A.gatewayClient.state=B.a.DISCONNECTED,clearTimeout(Object(p._getReconnectCSTimer)(A.clientId)),A._renewSession(),A.rtcStatsCollector.clearNetworkQualityTimer(),c&&c(V)},name:"Client.leave",options:arguments,tag:"tracer"});f.default.info("[".concat(A.clientId,"] Leaving channel")),A.userAccountReq&&!A.userAccountReq.isFinished()&&(A.userAccountReq.cancel(),A.gatewayClient.state===B.a.CONNECTING&&(A.gatewayClient.state=B.a.DISCONNECTED)),A._terminateLiveStreaming(),A.gatewayClient.leave(function(ne){F=!0,X(null,ne)},X),setTimeout(function(){F||(A.gatewayClient.socket&&(A.gatewayClient.socket.close(),A.gatewayClient.socket=null),A.gatewayClient.state=B.a.DISCONNECTED,X(null,"LEAVE_MSG_TIMEOUT"))},Object(E.getParameter)("LEAVE_MSG_TIMEOUT"))},A._renewSession=function(){var c=Object(k.generateSessionId)();if(f.default.debug("renewSession ".concat(ee.sessionId," => ").concat(c)),ee.sessionId=c,A.gatewayClient.peerPublishDurationMap.clear(),A.joinInfo&&(A.joinInfo.sid=c),A.gatewayClient&&(A.gatewayClient.joinInfo&&(A.gatewayClient.joinInfo.sid=c),A.gatewayClient.localStreams))for(var P in A.gatewayClient.localStreams){var F=A.gatewayClient.localStreams[P];F&&(F.sid=c)}},A._publish=function(c,P,F,X){if(A.highStreamState!==2)return f.default.warning("[".concat(A.clientId,"] Can't publish stream when stream already publish ").concat(c.getId())),F&&F(W.default.STREAM_ALREADY_PUBLISHED);if(A.turnServers.length===0&&Object(E.getParameter)("FORCE_TURN")&&!Object(E.getParameter)("TURN_ENABLE_TCP")&&!Object(E.getParameter)("TURN_ENABLE_UDP"))throw new Error("force TURN With No TURN Configuration");f.default.info("[".concat(A.clientId,"] Publishing stream, uid ").concat(c.getId())),A.highStream=c,A.highStreamState=1,A.highStream.streamId=A.joinInfo.stringUid||A.joinInfo.uid,A.hasPublished=!1;var ne=function(V,K,te){A.gatewayClient.publish(V,{streamType:0},function(){V.sid=ee.sessionId,A.highStreamState=0,f.default.info("[".concat(A.clientId,"] Publish success, uid: ").concat(V.getId())),A.highStream&&(A.highStream.isDualStream=A.isDualStream),A.isDualStream?A._publishLowStream(function(){K&&K()},function(ae){f.default.warning("[".concat(A.clientId,"] "),ae),J.a.replaceWithCanvasTrack(V).then(function(){K&&K()})}):J.a.replaceWithCanvasTrack(V).then(function(){K&&K()})},te)};A.gatewayClient.role!=="audience"||A.mode!=="live"||X?ne(c,P,F):A.gatewayClient.setClientRole(Z,function(V){if(V)return F&&F(V);ne(c,P,F)})},A._unpublish=function(c,P,F,X){if(A.highStreamState!==0)return f.default.warning("[".concat(A.clientId,"] Can't unpublish stream when stream not publish")),F&&F(W.default.STREAM_NOT_YET_PUBLISHED);f.default.info("[".concat(A.clientId,"] Unpublish stream, uid ").concat(c.getId()));var ne=function(V,K,te){A.isDualStream&&A.lowStream&&A._unpublishLowStream(null,te),A.gatewayClient.unpublish(V,{streamType:0},function(){A.highStreamState=2,f.default.info("[".concat(A.clientId,"] Unpublish stream success, uid: ").concat(V.getId())),A.gatewayClient.dispatchEvent({type:"stream-unpublished",stream:V}),K&&K()},function(ae){f.default.info("[".concat(A.clientId,"] Unpublish stream fail, uid: ").concat(V.getId())),te&&te(ae)})};A.gatewayClient.role!==Z||A.mode!=="live"||X?ne(c,P,F):A.gatewayClient.setClientRole("audience",function(V){if(V)return F&&F(V);ne(c,P,F)})},A.publish=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(X,ne){if(X)return A.highStreamState===1&&X!=="REQUEST_ABORT"&&(A.highStreamState=2),P&&P(X)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!P}});A.highStreamState===2?c._hasVideoTracks()||c._hasAudioTracks()?(A.gatewayClient.publishRequestId=Object(k.generateId)(),A._publish(c,function(X){return F(null,X)},function(X){return F(X)})):F(W.default.NO_TRACK_IN_STREAM):F(W.default.STREAM_ALREADY_PUBLISHED)},A.unpublish=function(c,P,F){var X=S.report.reportApiInvoke(ee.sessionId,{callback:function(ne,V){if(ne)return P&&P(ne);F&&F(V)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!P}});A.highStreamState===0?(A.gatewayClient.publishRequestId=null,A._unpublish(c,function(ne){return X(null,ne)},function(ne){return X(ne)})):X(W.default.STREAM_NOT_YET_PUBLISHED)},A.subscribe=function(c,P,F){var X=S.report.reportApiInvoke(ee.sessionId,{callback:function(K,te){if(K)return F&&F(K)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:P,onFailure:!!F}});typeof P=="function"&&(F=P,P=null),Object(M.checkValidObject)(c,"stream"),Object(M.isEmpty)(P)||(Object(M.checkValidObject)(P,"options"),Object(M.isEmpty)(P.video)||Object(M.checkValidBoolean)(P.video,"options.video"),Object(M.isEmpty)(P.audio)||Object(M.checkValidBoolean)(P.audio,"options.audio"));var ne={video:!0,audio:!0};if(!Object(M.isEmpty)(P)){if(Object(y.isSafari)()&&(!P.video||!P.audio)){var V="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return f.default.error("[".concat(A.clientId,"] "),V),void X(V)}if(!Object(M.isEmpty)(P.video)&&!Object(M.isValidBoolean)(P.video)||!Object(M.isEmpty)(P.audio)&&!Object(M.isValidBoolean)(P.audio)||P.audio===!1&&P.video===!1)return V="INVALID_PARAMETER ".concat(JSON.stringify(P)),f.default.error("[".concat(A.clientId,"] "),V),void X(V)}c.subscribeOptions?(q()(c.subscribeOptions,ne,P),A.gatewayClient.subscribeChange(c,function(K){return X(null,K)},X)):(A.gatewayClient.subscribeRequestId.set(c.getId(),Object(k.generateId)()),c.subscribeOptions=q()({},ne,P),A.gatewayClient.subscribe(c,function(K){return X(null,K)},X))},A.unsubscribe=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{callback:function(X,ne){if(X)return P&&P(X)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!P}});f.default.info("[".concat(A.clientId,"] Unsubscribe stream, uid: ").concat(c.getId())),A.gatewayClient.subscribeRequestId.delete(c.getId()),A.gatewayClient.unsubscribe(c,function(X){return F(null,X)},F)},A.setRemoteVideoStreamType=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:P}});Object(M.checkValidEnum)(P,"streamType",[0,1]),A.gatewayClient.setRemoteVideoStreamType(c,P),F()},A.setStreamFallbackOption=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:P}});Object(M.checkValidEnum)(P,"fallbackType",[0,1,2]),A.gatewayClient.setStreamFallbackOption(c,P),F()},A.enableAudioVolumeIndicator=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});c=c||2e3,P=P||3,Object(M.checkValidNumber)(P,"smooth",1,100),Object(M.checkValidNumber)(c,"interval",50,1e5),A.audioVolumeIndication=A.audioVolumeIndication||{enabled:!0},A.audioVolumeIndication.interval=c,A.audioVolumeIndication.smooth=P,A.audioVolumeIndication={interval:c,smooth:P},f.default.info("[".concat(A.clientId,"] enableAudioVolumeIndicator interval ").concat(c," smooth ").concat(P)),A.gatewayClient.enableAudioVolumeIndicator(c,P),F()},A.getNetworkStats=function(c,P){return f.default.deprecate("[".concat(A.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),G.getStats(c,P)},A.getSystemStats=function(c,P){return r.getStats(c,P)},A.getRecordingDevices=function(c,P){return d.a.getRecordingDevices(c,P)},A.getPlayoutDevices=function(c,P){return d.a.getPlayoutDevices(c,P)},A.getCameras=function(c,P){return d.a.getCameras(c,P)},A.getRemoteAudioStats=function(c,P){return A.rtcStatsCollector.getRemoteAudioStats(c,P)},A.getLocalAudioStats=function(c,P){return A.rtcStatsCollector.getLocalAudioStats(c,P)},A.getRemoteVideoStats=function(c,P){return A.rtcStatsCollector.getRemoteVideoStats(c,P)},A.getLocalVideoStats=function(c,P){return A.rtcStatsCollector.getLocalVideoStats(c,P)},A._getRemoteVideoQualityStats=function(c,P){return A.rtcStatsCollector.getRemoteVideoQualityStats(c,P)},A._getRemoteAudioQualityStats=function(c,P){return A.rtcStatsCollector.getRemoteAudioQualityStats(c,P)},A.getTransportStats=function(c,P){return A.rtcStatsCollector.getTransportStats(function(F){return G.getStats(function(X){var ne=q()({},F,X);c&&c(ne)},P)},P)},A.getSessionStats=function(c,P){return A.rtcStatsCollector.getSessionStats(c,P)},A.onNetworkQuality=function(){return A.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},A.sendMetadata=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.sendMetadata",tag:"tracer",callback:function(X){if(X)return P&&P(X);P&&P()}});A.gatewayClient.sendMetadata(c,F)},A.sendCustomReportMessage=function(c,P,F,X,ne,V){Object(E.getParameter)("CR")?A.customReportCount>Object(E.getParameter)("CRL")?V&&V("REPORT_LIMITED"):(A.gatewayClient.hasJoined||(f.default.WARNING("Should invoke Client.sendCustomReportMessage after join"),V&&V("REPORT_BEFORE_JOINED")),A.customReportTimer||(A.customReportTimer=setInterval(function(){A.customReportCount=0},Object(E.getParameter)("CRI"))),Object(M.checkValidString)(c,"reportId",0,100,!1),Object(M.checkValidString)(P,"category",0,100,!1),Object(M.checkValidString)(F,"event",0,100,!1),Object(M.checkValidString)(X,"label",0,100,!1),Object(M.checkValidNumber)(ne,"value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),A.customReportCount++,S.report.sendCustomReportMessage(ee.sessionId,{reportId:c,category:P,event:F,label:X,value:ne,lts:Date.now()},function(K){K?V&&V("REPORT_FAILED"):V&&V()})):V&&V("REPORT_FORBIDDEN")},A.setLocalAccessPoints=function(c,P){var F=S.report.reportApiInvoke(ee.sessionId,{name:"Client.setLocalAccessPoints",tag:"tracer"});if(Object(M.checkValidArray)(c,"serverList"),Object(M.checkValidString)(P,"domain"),A.useProxyServer)throw new Error("You have already set the proxy");var X=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;c=c.map(function(ne){return X.test(ne)?"".concat(ne.replace(/\./g,"-"),".").concat(P):ne}),A.useLocalAccessPoint=!0,Object(E.setParameter)("WEBCS_DOMAIN",c),Object(E.setParameter)("WEBCS_DOMAIN_BACKUP_LIST",c),Object(E.setParameter)("GATEWAY_DOMAINS",[P]),Object(E.setParameter)("EVENT_REPORT_DOMAIN",c[Math.floor(Math.random()*c.length)]),Object(E.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",c[Math.floor(Math.random()*c.length)]),Object(E.setParameter)("LOG_UPLOAD_SERVER","".concat(c[Math.floor(Math.random()*c.length)],":6444")),F()},ee.clientId=A.clientId,A.gatewayClient=Object(B.a)(ee),A.listenerLoggerTimer=null,A.listenerLoggerCache=[],A.on=function(c,P){A.gatewayClient.on(c,P),A.listenerLoggerCache.push("".concat(c).concat(P.name?":"+P.name:"")),A.listenerLoggerTimer?clearTimeout(A.listenerLoggerTimer):f.default.info("[".concat(A.clientId,"] Adding event handler on ").concat(c)),A.listenerLoggerTimer=setTimeout(function(){A.listenerLoggerCache.length&&(A.listenerLoggerTimer=null,f.default.info("[".concat(A.clientId,"] Added event handler on ").concat(A.listenerLoggerCache.join(", "))),A.listenerLoggerCache=[])},0)},A.off=function(c,P){f.default.info("remove event handler from [".concat(c,"]")),A.gatewayClient.removeEventListener(c,P)},A.rtcStatsCollector=function(c){var P=Object(g.b)();return P.gatewayClient=c,P.exceptionMonitor=new x(c),P.localStats={},P.remoteStats={},P.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},P.getRemoteAudioStats=function(F){var X=P.gatewayClient.traffic_stats,ne={};for(var V in P.remoteStats){var K={},te=P.remoteStats[V];if(Object(n.b)(K,"End2EndDelay",te.peer_delay&&te.peer_delay.audio_delay),Object(n.b)(K,"TransportDelay",te.peer_delay&&te.peer_delay.e2e_delay),Object(n.b)(K,"PacketLossRate",te.peer_delay&&te.peer_delay.e2e_audio_lost_ratio_400ms),Object(n.b)(K,"RecvLevel",te.audioStats&&te.audioStats.audioOutputLevel),Object(n.b)(K,"RecvBitrate",te.audioRecvBitrate),Object(n.b)(K,"CodecType",te.audioStats&&te.audioStats.googCodecName),Object(n.b)(K,"MuteState",te.audioDisabled),Object(n.b)(K,"TotalFreezeTime",te.audioStats&&te.audioStats.audioTotalFreezeTime),Object(n.b)(K,"TotalPlayDuration",te.audioStats&&te.audioStats.audioTotalPlayDuration),X&&X.peer_delay){var ae=X.peer_delay.find(function(oe){return oe.peer_uid==V});if(ae){var de=ae.peer_publish_audio_duration+(Date.now()-X.timestamp);Object(n.b)(K,"AudioPublishDuration",de)}else Object(n.b)(K,"AudioPublishDuration",-1)}ne[V]=K}F&&F(ne)},P.getLocalAudioStats=function(F){var X={};for(var ne in P.localStats){var V={},K=P.localStats[ne];Object(n.b)(V,"RecordingLevel",K.audioStats&&K.audioStats.audioInputLevel),Object(n.b)(V,"SendLevel",K.audioStats&&K.audioStats.totalAudioEnergy),Object(n.b)(V,"SamplingRate",K.audioStats&&K.audioStats.totalSamplesDuration),Object(n.b)(V,"SendBitrate",K.audioSendBitrate),Object(n.b)(V,"CodecType",K.audioStats&&K.audioStats.googCodecName),Object(n.b)(V,"MuteState",K.audioDisabled),Object(n.b)(V,"audioSendPacketsLost",K.audioStats&&K.audioStats.packetsLost);var te=P.gatewayClient.localStreams[ne];te&&te.isPlaying()&&Object(n.b)(V,"MuteState",te.userMuteAudio?"1":"0"),X[ne]=V}F&&F(X)},P.getRemoteVideoStats=function(F){var X=P.gatewayClient.traffic_stats,ne={};for(var V in P.remoteStats){var K={},te=P.remoteStats[V];if(Object(n.b)(K,"End2EndDelay",te.peer_delay&&te.peer_delay.video_delay),Object(n.b)(K,"TransportDelay",te.peer_delay&&te.peer_delay.e2e_delay),Object(n.b)(K,"PacketLossRate",te.peer_delay&&te.peer_delay.e2e_video_lost_ratio_400ms),Object(n.b)(K,"RecvBitrate",te.videoRecvBitrate),Object(n.b)(K,"RecvResolutionWidth",te.videoStats&&te.videoStats.googFrameWidthReceived),Object(n.b)(K,"RecvResolutionHeight",te.videoStats&&te.videoStats.googFrameHeightReceived),Object(n.b)(K,"RenderResolutionWidth",te.videoStats&&te.videoStats.renderRemoteWidth),Object(n.b)(K,"RenderResolutionHeight",te.videoStats&&te.videoStats.renderRemoteHeight),Object(n.b)(K,"RenderFrameRate",te.videoStats&&te.videoStats.googFrameRateOutput),Object(n.b)(K,"MuteState",te.videoDisabled),Object(n.b)(K,"TotalFreezeTime",te.videoStats&&te.videoStats.videoTotalFreezeTime),Object(n.b)(K,"TotalPlayDuration",te.videoStats&&te.videoStats.videoTotalPlayDuration),X&&X.peer_delay){var ae=X.peer_delay.find(function(oe){return oe.peer_uid==V});if(ae){var de=ae.peer_publish_video_duration+(Date.now()-X.timestamp);Object(n.b)(K,"VideoPublishDuration",de)}else Object(n.b)(K,"VideoPublishDuration",-1)}ne[V]=K}F&&F(ne)},P.getLocalVideoStats=function(F){var X={};for(var ne in P.localStats){var V={},K=P.localStats[ne];Object(n.b)(V,"TargetSendBitrate",K.videoTargetSendBitrate),Object(n.b)(V,"SendFrameRate",K.videoStats&&K.videoStats.googFrameRateSent),Object(n.b)(V,"SendBitrate",K.videoSendBitrate),Object(n.b)(V,"SendResolutionWidth",K.videoStats&&K.videoStats.googFrameWidthSent),Object(n.b)(V,"SendResolutionHeight",K.videoStats&&K.videoStats.googFrameHeightSent),Object(n.b)(V,"CaptureResolutionWidth",K.videoStats&&K.videoStats.googFrameWidthInput),Object(n.b)(V,"CaptureResolutionHeight",K.videoStats&&K.videoStats.googFrameHeightInput),Object(n.b)(V,"EncodeDelay",K.videoStats&&K.videoStats.googAvgEncodeMs),Object(n.b)(V,"MuteState",K.videoDisabled),Object(n.b)(V,"TotalFreezeTime",K.videoStats&&K.videoStats.videoTotalFreezeTime),Object(n.b)(V,"TotalDuration",K.videoStats&&K.videoStats.videoTotalPlayDuration),Object(n.b)(V,"CaptureFrameRate",K.videoStats&&K.videoStats.googFrameRateSent),Object(n.b)(V,"videoSendPacketsLost",K.videoStats&&K.videoStats.packetsLost),K.videoStats&&!K.videoStats.googFrameWidthInput&&Object(n.b)(V,"CaptureResolutionWidth",K.videoStats&&K.videoStats.renderLocalWidth),K.videoStats&&!K.videoStats.googFrameHeightInput&&Object(n.b)(V,"CaptureResolutionHeight",K.videoStats&&K.videoStats.renderLocalHeight),X[ne]=V}F&&F(X)},P.getRemoteVideoQualityStats=function(F){var X={};for(var ne in P.remoteStats){var V={},K=P.remoteStats[ne];Object(n.b)(V,"videoReceiveDelay",K.videoStats&&K.videoStats.googCurrentDelayMs),Object(n.b)(V,"VideoFreezeRate",K.videoStats&&K.videoStats.videoFreezeRate),Object(n.b)(V,"FirstFrameTime",K.firstFrameTime),X[ne]=V}F&&F(X)},P.getRemoteAudioQualityStats=function(F){var X={};for(var ne in P.remoteStats){var V={},K=P.remoteStats[ne];Object(n.b)(V,"audioReceiveDelay",K.audioStats&&K.audioStats.googCurrentDelayMs),Object(n.b)(V,"AudioFreezeRate",K.videoStats&&K.videoStats.videoFreezeRate),X[ne]=V}F&&F(X)},P.getTransportStats=function(F){var X={},ne={},V=P.gatewayClient.traffic_stats,K=V.peer_delay;if(Object(n.b)(X,"OutgoingAvailableBandwidth",P.gatewayClient.OutgoingAvailableBandwidth/1e3),Object(n.b)(X,"RTT",V&&2*V.access_delay),K){var te,ae=o(K);try{for(ae.s();!(te=ae.n()).done;){var de=te.value;de.downlink_estimate_bandwidth&&(ne[de.peer_uid]=de.downlink_estimate_bandwidth/1e3+"")}}catch(oe){ae.e(oe)}finally{ae.f()}}X.IncomingAvailableBandwidth=ne,F&&F(X)},P.getSessionStats=function(F){var X={},ne=P.gatewayClient.traffic_stats,V=P.gatewayClient.socket,K=0,te=0;for(var ae in P.remoteStats)(de=P.remoteStats[ae])&&de.videoStats&&de.videoStats.videoRecvBytesDelta&&(te+=parseInt(de.videoStats.videoRecvBytesDelta)),de&&de.audioStats&&de.audioStats.audioRecvBytesDelta&&(te+=parseInt(de.audioStats.audioRecvBytesDelta));for(var ae in P.localStats){var de;(de=P.localStats[ae])&&de.videoStats&&de.videoStats.videoSendBytesDelta&&(K+=parseInt(de.videoStats.videoSendBytesDelta)),de&&de.audioStats&&de.audioStats.audioSendBytesDelta&&(K+=parseInt(de.audioStats.audioSendBytesDelta))}var oe=K+P.session.WSSendBytesDelta+P.session.HTTPSendBytesDelta,pe=te+P.session.WSRecvBytesDelta+P.session.HTTPRecvBytesDelta,ve=P.session.sendBytes+Object(N.getHTTPSendBytes)(),Re=P.session.recvBytes+Object(N.getHTTPRecvBytes)();P.gatewayClient.socket&&P.gatewayClient.socket.state===P.gatewayClient.CONNECTED&&(ve+=V.getSendBytes(),Re+=V.getRecvBytes());var Ie=1;ne.peer_delay&&(Ie=ne.peer_delay.length,Ie+=1),V?Object(n.b)(X,"Duration",V.getDuration()):Object(n.b)(X,"Duration",0),Object(n.b)(X,"UserCount",Ie),Object(n.b)(X,"SendBytes",ve),Object(n.b)(X,"RecvBytes",Re),Object(n.b)(X,"SendBitrate",8*oe/1e3),Object(n.b)(X,"RecvBitrate",8*pe/1e3),F&&F(X)},P.isLocalVideoFreeze=function(F,X){var ne=0,V=0;if(!F||!X)return!1;if(Object(y.isChrome)()||Object(y.isOpera)())ne=F.googFrameRateInput,V=F.googFrameRateSent;else if(Object(y.isSafari)())ne=parseInt(F.framerateMean),V=parseInt(F.framesEncoded)-parseInt(X.framesEncoded);else{if(!Object(y.isFireFox)())return!1;ne=parseInt(F.framerateMean),V=parseInt(F.framesEncoded)-parseInt(X.framesEncoded)}return ne>5&&V<3},P.isRemoteVideoFreeze=function(F,X){var ne=0,V=0;if(!F||!X)return!1;if(Object(y.isChrome)()||Object(y.isOpera)())ne=F.googFrameRateReceived,V=F.googFrameRateDecoded;else if(Object(y.isSafari)())ne=F.framerateMean,V=parseInt(F.framesDecoded)-parseInt(X.framesDecoded);else{if(!Object(y.isFireFox)())return!1;ne=parseInt(F.framesReceived)-parseInt(X.framesReceived),V=parseInt(F.framesDecoded)-parseInt(X.framesDecoded)}return ne>5&&ne<10&&V<3||ne>10&&ne<20&&V<4||ne>20&&V<5},P.isAudioFreeze=function(F){if(Object(y.isChrome)()&&F){if(F.googDecodingPLC&&F.googDecodingPLCCNG&&F.googDecodingCTN)return(parseInt(F.googDecodingPLC)+parseInt(F.googDecodingPLCCNG))/parseInt(F.googDecodingCTN)>.2}else if((Object(y.isSafari)()||Object(y.isFireFox)())&&F.packetsLost&&F.packetsReceived)return parseInt(F.packetsLost)/(parseInt(F.packetsLost)+parseInt(F.packetsReceived))>.2;return!1},P.isAudioDecodeFailed=function(F){return!!((Object(y.isChrome)()||Object(y.isOpera)())&&F&&parseInt(F.bytesReceived)>0&&parseInt(F.googDecodingNormal)===0)},P.startNetworkQualityTimer=function(){P.clearNetworkQualityTimer(),P.networkQualityTimer=setInterval(function(){if(P.gatewayClient.state===B.a.CONNECTED&&navigator.onLine){var F=P.gatewayClient.traffic_stats;P.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:P.networkQualityTrans(F.uplink_network_quality),downlinkNetworkQuality:P.networkQualityTrans(F.downlink_network_quality)})}else P.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3)},P.clearNetworkQualityTimer=function(){P.networkQualityTimer&&clearInterval(P.networkQualityTimer)},P.networkQualityTrans=function(F){return F>=0&&F<.17?1:F>=.17&&F<.36?2:F>=.36&&F<.59?3:F>=.59&&F<=1?4:F>1?5:0},P.getStatsTimer=setInterval(function(){var F=P.gatewayClient.traffic_stats,X=Date.now();P.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(P.localStats).length&&P.exceptionMonitor.setLocalStats(P.localStats),Object.keys(P.remoteStats).length&&P.exceptionMonitor.setRemoteStats(P.remoteStats);var ne={};Object.keys(P.gatewayClient.remoteStreams).forEach(function(te){var ae=P.gatewayClient.remoteStreams[te],de=P.remoteStats[te],oe={id:te,updatedAt:X};ne[te]=oe,oe.firstFrameTime=ae.firstFrameTime,de?(oe.audioTotalPlayDuration=de.audioTotalPlayDuration+1,oe.audioTotalFreezeTime=de.audioTotalFreezeTime,oe.isAudioFreeze=!1,oe.isAudioDecodeFailed=!1,oe.videoTotalPlayDuration=de.videoTotalPlayDuration+1,oe.videoTotalFreezeTime=de.videoTotalFreezeTime,oe.isVideoFreeze=!1):(oe.audioTotalPlayDuration=1,oe.audioTotalFreezeTime=0,oe.videoTotalPlayDuration=1,oe.videoTotalFreezeTime=0);var pe=F&&F.peer_delay&&F.peer_delay.find(function(ve){return ve.peer_uid==te});pe&&(oe.peer_delay=pe),ae&&(ae.isPlaying()&&(oe.audioDisabled=ae.userMuteAudio||ae.peerMuteAudio?"1":"0",oe.videoDisabled=ae.userMuteVideo||ae.peerMuteVideo?"1":"0"),de&&de.peer_delay&&pe&&de.peer_delay.stream_type!==pe.stream_type&&P.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:te,streamType:pe.stream_type}),ae.pc&&ae.pc.state=="established"&&ae.pc.getStats(function(ve){if(oe.pcStats=ve,oe.audioStats=ve.find(function(ye){return ye.mediaType=="audio"&&(ye.id.indexOf("_recv")>-1||ye.id.toLowerCase().indexOf("inbound")>-1)}),oe.videoStats=ve.find(function(ye){return ye.mediaType=="video"&&(ye.id.indexOf("_recv")>-1||ye.id.toLowerCase().indexOf("inbound")>-1)}),de&&de.audioStats&&oe.audioStats){var Re=parseInt(oe.audioStats.bytesReceived)-parseInt(de.audioStats.bytesReceived),Ie=parseInt(oe.audioStats.googDecodingNormal)-parseInt(de.audioStats.googDecodingNormal);if(oe.audioStats.audioRecvBytesDelta=Re,oe.audioStats.audioDecodingNormalDelta=Ie,P.session.recvBytes+=Re,isFinite(Re)&&oe.audioStats.timestamp){var Se=oe.audioStats.timestamp.getTime()-de.audioStats.timestamp.getTime();oe.audioRecvBitrate=Math.floor(8*Re/Se)}P.isAudioFreeze(oe.audioStats)&&oe.audioTotalPlayDuration>10&&(oe.audioTotalFreezeTime++,oe.isAudioFreeze=!0),P.isAudioDecodeFailed(oe.audioStats)&&oe.audioTotalPlayDuration>10&&(oe.isAudioDecodeFailed=!0),oe.audioStats.audioTotalFreezeTime=oe.audioTotalFreezeTime,oe.audioStats.audioTotalPlayDuration=oe.audioTotalPlayDuration,oe.audioStats.audioFreezeRate=Math.ceil(100*oe.audioTotalFreezeTime/oe.audioTotalPlayDuration)}if(de&&de.videoStats&&oe.videoStats){var Te=parseInt(oe.videoStats.bytesReceived)-parseInt(de.videoStats.bytesReceived);oe.videoStats.videoRecvBytesDelta=Te,P.session.recvBytes+=Te,isFinite(Te)&&oe.videoStats.timestamp&&(Se=oe.videoStats.timestamp.getTime()-de.videoStats.timestamp.getTime(),oe.videoRecvBitrate=Math.floor(8*Te/Se)),P.isRemoteVideoFreeze(oe.videoStats,de.videoStats)&&(oe.videoTotalFreezeTime++,oe.isVideoFreeze=!0),oe.videoStats.videoTotalFreezeTime=oe.videoTotalFreezeTime,oe.videoStats.videoTotalPlayDuration=oe.videoTotalPlayDuration,oe.videoStats.videoFreezeRate=Math.ceil(100*oe.videoTotalFreezeTime/oe.videoTotalPlayDuration),ae.player&&ae.player.video&&ae.player.video.videoWidth&&ae.player.video.videoHeight?(oe.videoStats.renderRemoteWidth=ae.player.video.videoWidth,oe.videoStats.renderRemoteHeight=ae.player.video.videoHeight):(oe.videoStats.renderRemoteWidth=ae.videoWidth||oe.videoStats.googFrameWidthReceived,oe.videoStats.renderRemoteHeight=ae.videoHeight||oe.videoStats.googFrameHeightReceived)}}))}),P.remoteStats=ne;var V={};if(Object.keys(P.gatewayClient.localStreams).forEach(function(te){var ae=P.gatewayClient.localStreams[te],de=P.localStats[te],oe={id:te,updatedAt:X};V[te]=oe,de?(oe.videoTotalPlayDuration=de.videoTotalPlayDuration+1,oe.videoTotalFreezeTime=de.videoTotalFreezeTime,oe.isVideoFreeze=!1):(oe.videoTotalPlayDuration=1,oe.videoTotalFreezeTime=0),ae&&(ae.isPlaying()&&(oe.audioDisabled=ae.userMuteAudio?"1":"0",oe.videoDisabled=ae.userMuteVideo?"1":"0"),ae.video&&ae.attributes.maxVideoBW?oe.videoTargetSendBitrate=ae.attributes.maxVideoBW:ae.video&&ae.screenAttributes&&(oe.videoTargetSendBitrate=ae.screenAttributes.maxVideoBW),ae.pc&&ae.pc.state=="established"&&ae.pc.getStats(function(pe){if(oe.pcStats=pe.reverse(),oe.audioStats=pe.find(function(Se){return Se.mediaType=="audio"&&(Se.id.indexOf("_send")>-1||Se.id.toLowerCase().indexOf("outbound")>-1)}),oe.videoStats=pe.find(function(Se){return Se.mediaType=="video"&&(Se.id.indexOf("_send")>-1||Se.id.toLowerCase().indexOf("outbound")>-1)}),oe.audioStats&&de&&de.audioStats){var ve=parseInt(oe.audioStats.bytesSent)-parseInt(de.audioStats.bytesSent);if(oe.audioStats.audioSendBytesDelta=ve,P.session.sendBytes+=ve,isFinite(ve)&&oe.audioStats.timestamp){var Re=oe.audioStats.timestamp.getTime()-de.audioStats.timestamp.getTime();oe.audioSendBitrate=Math.floor(8*ve/Re)}}if(oe.videoStats&&de&&de.videoStats){var Ie=parseInt(oe.videoStats.bytesSent)-parseInt(de.videoStats.bytesSent);oe.videoStats.videoSendBytesDelta=Ie,P.session.sendBytes+=Ie,isFinite(Ie)&&oe.videoStats.timestamp&&(Re=oe.videoStats.timestamp.getTime()-de.videoStats.timestamp.getTime(),oe.videoSendBitrate=Math.floor(8*Ie/Re)),P.isLocalVideoFreeze(oe.videoStats,de.videoStats)&&(oe.videoTotalFreezeTime++,oe.isVideoFreeze=!0),oe.videoStats.videoTotalFreezeTime=oe.videoTotalFreezeTime,oe.videoStats.videoTotalPlayDuration=oe.videoTotalPlayDuration,oe.videoStats.videoFreezeRate=Math.ceil(100*oe.videoTotalFreezeTime/oe.videoTotalPlayDuration),oe.videoStats.renderLocalWidth=ae.videoWidth||oe.videoStats.googFrameWidthSent,oe.videoStats.renderLocalHeight=ae.videoHeight||oe.videoStats.googFrameHeightSent}}))}),P.localStats=V,P.session.HTTPSendBytesDelta=Object(N.getHTTPSendBytes)()-P.session.HTTPSendBytes,P.session.HTTPSendBytes=Object(N.getHTTPSendBytes)(),P.session.HTTPRecvBytesDelta=Object(N.getHTTPRecvBytes)()-P.session.HTTPRecvBytes,P.session.HTTPRecvBytes=Object(N.getHTTPRecvBytes)(),P.gatewayClient.socket&&P.gatewayClient.socket.state===P.gatewayClient.CONNECTED){var K=P.gatewayClient.socket;P.session.WSSendBytesDelta=K.getSendBytes()-P.session.WSSendBytes,P.session.WSSendBytes=K.getSendBytes(),P.session.WSRecvBytesDelta=K.getRecvBytes()-P.session.WSRecvBytes,P.session.WSRecvBytes=K.getRecvBytes()}},1e3),P.gatewayClient.on("join",function(){P.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}}),P}(A.gatewayClient),A.configDistributManager=function(c){var P={};return P.client=c,P.client.gatewayClient&&P.client.gatewayClient.on("config-distribute",function(F){var X=F.joinInfo,ne=F.config;if(ne){Object(M.isEmpty)(ne.uploadLog)||(Object(E.setParameter)("UPLOAD_LOG",ne.uploadLog),S.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:ne.uploadLog}})()),Object(M.isEmpty)(ne.dualStream)||(c.isDualStream=ne.dualStream,S.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"dualStream",value:ne.dualStream}})()),Object(M.isEmpty)(ne.streamFallbackOption)||P.client.gatewayClient&&P.client.gatewayClient.on("stream-subscribed",function(V){var K=V.stream;K?(P.client.gatewayClient.setStreamFallbackOption(K,ne.streamFallbackOption),S.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:ne.streamFallbackOption,streamId:K.getId()}})()):S.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:ne.streamFallbackOption,streamId:K.getId(),err:"invalid stream"}})()});try{f.default.debug("[".concat(c.clientId,"] setParameter in distribution: ").concat(JSON.stringify(ne))),Object.keys(ne).map(function(V){return Object(E.setParameter)(V,ne[V])})}catch{f.default.debug("[".concat(c.clientId,"] setParameter in distribution failed: ").concat(JSON.stringify(ne)))}}}),P}(A),Object(Q.addLiveStreamingCapability)(A,ee),ee.areaCode){var fe=ee,Ee=fe.areaCode,ge=fe.excludedArea,he=Object(U.getAreaCodeByConfig)({areaCode:Ee,excludedArea:ge});Object(E.setParameter)("AREA_SETTING",he);var _e=Object(U.getAreaDomainConfig)(he);Object.keys(_e).map(function(c){var P=_e[c];c=="LOG_UPLOAD_SERVER"||c=="EVENT_REPORT_DOMAIN"||c=="EVENT_REPORT_BACKUP_DOMAIN"||c=="NGINX"?Object(E.setParameter)(c,P[0]):Object(E.setParameter)(c,P)})}return Object(M.isEmpty)(ee.turnServer)||A.setTurnServer(ee.turnServer),Object(M.isEmpty)(ee.proxyServer)||A.setProxyServer(ee.proxyServer),A.mode==="live"&&(A.gatewayClient.role="audience"),A.mode==="rtc"&&(A.gatewayClient.role=Z),A.gatewayClient.on("onMultiIP",function(c){A.gatewayClient.closeGateway(),A.gatewayClient.socket=void 0,A.gatewayClient.hasChangeBGPAddress=!0,A.joinInfo.multiIP=c.option,A.gatewayClient.state=B.a.CONNECTING;var P=function(F){f.default.info("[".concat(A.clientId,"] Joining channel: ").concat(A.channel)),A.joinInfo.cid=F.cid,A.joinInfo.uid||(A.joinInfo.uid=F.uid),A.joinInfo.uni_lbs_ip=F.uni_lbs_ip,A.joinInfo.gatewayAddr=F.gateway_addr,A.onSuccess?A.gatewayClient.join(A.joinInfo,A.key,function(X){f.default.info("[".concat(A.clientId,"] Join channel ").concat(A.channel," success"));var ne=A.onSuccess;A.onSuccess=null,A.onFailure=null,ne(X)},A.onFailure):(A.gatewayClient.joinInfo=q()({},A.joinInfo),A.gatewayClient.rejoin())};A.joinInfo.stringUid&&!A.joinInfo.uid?(A.userAccountReq&&!A.userAccountReq.isFinished()&&A.userAccountReq.cancel(),A.userAccountReq=Object(p.getUserAccount)(joinInfo,A.gatewayClient),A.userAccountReq.then(function(F){f.default.error("getUserAccount Success ".concat(F.url," ").concat(joinInfo.stringUid," => ").concat(F.uid)),A.joinInfo.uid=F.uid,Object(p.getGatewayList)(A.joinInfo,P,A.onFailure)}).catch(function(F){f.default.error("getUserAccount rejected",F),A.onFailure(F)})):Object(p.getGatewayList)(A.joinInfo,P,A.onFailure)}),A.gatewayClient.on("rejoin-start",function(){A._renewSession(),S.report.sessionInit(ee.sessionId,{lts:new Date().getTime(),extend:{rejoin:!0},cname:A.channel,appid:ee.appId,mode:ee.mode,succ:!0})}),A.gatewayClient.on("recover",function(){A._renewSession(),f.default.debug("[".concat(A.clientId,"]"),"recover",ee.sessionId),S.report.sessionInit(ee.sessionId,{lts:new Date().getTime(),extend:{recover:!0},cname:A.channel,appid:ee.appId,mode:ee.mode,succ:!0})}),A.gatewayClient.on("rejoin",function(){var c=A.highStreamState;if(f.default.debug("[".concat(A.clientId,"] Client local stream preState: ").concat(c)),A.onSuccess){var P=A.onSuccess;A.onSuccess=null,A.onFailure=null,P(A.joinInfo.uid)}!A.highStream||c!==0&&c!==1||(f.default.info("[".concat(A.clientId,"] publish after rejoin")),A.highStreamState=2,A.lowStreamState=2,A.publish(A.highStream,function(F){F&&f.default.info("[".concat(A.clientId,"] "),F)}))}),A.gatewayClient.on("streamPublished",function(c){A.hasPublished||(A.hasPublished=!0,A.gatewayClient.dispatchEvent({type:"stream-published",stream:c.stream,proxy:c.proxy}))}),A.gatewayClient.on("pubP2PLost",function(c){f.default.debug("[".concat(A.clientId,"] Start reconnect local peerConnection: ").concat(A.highStream.getId())),A.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:A.highStream.getId()}),A.highStreamState===1&&(A.highStreamState=0,A.lowStreamState=0),A._unpublish(A.highStream,function(){A._publish(A.highStream,function(){f.default.debug("[".concat(A.clientId,"] Reconnect local peerConnection success: ").concat(A.highStream.getId())),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:A.highStream.getId(),success:!0,reason:""})},function(P){f.default.debug("[".concat(A.clientId,"] Reconnect local peerConnection failed: ").concat(P)),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:A.highStream.getId(),success:!1,reason:P})},!0)},function(P){f.default.debug("[".concat(A.clientId,"] Reconnect local peerConnection failed: ").concat(P)),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:A.highStream.getId(),success:!1,reason:P})},!0)}),A.gatewayClient.on("subP2PLost",function(c){f.default.debug("[".concat(A.clientId,"] Start reconnect remote peerConnection: ").concat(c.stream.getId()," ").concat(c.stream.subscribeOptions)),A.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:c.stream.getId()});var P=c.stream.subscribeOptions;f.default.debug("[".concat(A.clientId,"]"),"Re-subscribe stream",JSON.stringify(P)),A.gatewayClient.unsubscribe(c.stream,function(){c.stream.subscribeOptions=P,A.gatewayClient.subscribe(c.stream,function(){f.default.debug("[".concat(A.clientId,"] Reconnect remote peerConnection success: ").concat(c.stream.getId())),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:c.stream.getId(),success:!0,reason:""})},function(F){f.default.debug("[".concat(A.clientId,"] Reconnect remote peerConnection failed: "),F),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:c.stream.getId(),success:!1,reason:F})})},function(F){f.default.debug("[".concat(A.clientId,"] Reconnect remote peerConnection failed: "),F),A.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:c.stream.getId(),success:!1,reason:F})})}),G.on("networkTypeChanged",function(c){A.gatewayClient&&A.gatewayClient.dispatchEvent(c);var P=q()({},c,{type:"network-type-changed"});A.gatewayClient.dispatchEvent(P)}),d.a.on("recordingDeviceChanged",function(c){A.gatewayClient&&A.gatewayClient.dispatchEvent(c);var P=q()({},c,{type:"recording-device-changed"});A.gatewayClient.dispatchEvent(P)}),d.a.on("playoutDeviceChanged",function(c){A.gatewayClient&&A.gatewayClient.dispatchEvent(c);var P=q()({},c,{type:"playout-device-changed"});A.gatewayClient.dispatchEvent(P)}),d.a.on("cameraChanged",function(c){A.gatewayClient&&A.gatewayClient.dispatchEvent(c);var P=q()({},c,{type:"camera-changed"});A.gatewayClient.dispatchEvent(P)}),A.gatewayClient.on("streamTypeChange",function(c){var P=q()({},c,{type:"stream-type-changed"});A.gatewayClient.dispatchEvent(P),S.report.reportApiInvoke(ee.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(c))}),A},ce={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},ue=function(ee){switch(ee){case"h264_interop":return"h264";default:return"vp8"}},se=function(ee){return u.indexOf(ee.mode)===-1?W.default.INVALID_CLIENT_MODE:b.indexOf(ee.codec)===-1?W.default.INVALID_CLIENT_CODEC:ee.mode=="h264_interop"&&ee.codec!=="h264"&&W.default.CLIENT_MODE_CODEC_MISMATCH},ie=function(ee){switch(ee.mode){case"interop":case"h264_interop":ee.mode="live";break;case"web-only":ee.mode="rtc"}},me=d.a.getDevices,i=T.a.getScreenSources,le=JSON.parse(JSON.stringify(E.SUPPORT_RESOLUTION_LIST));H.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:ce,createClient:function(ee){var A=S.report.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(ee=q()({},ee||{})).codec||(ee.codec=ue(ee.mode));var fe=se(ee);if(fe)throw f.default.error("Invalid parameter setting MODE: ".concat(ee.mode," CODEC: ").concat(ee.codec," ERROR ").concat(fe)),A(fe),new Error(fe);return f.default.info("Creating client, MODE: ".concat(ee.mode," CODEC: ").concat(ee.codec)),ie(ee),A(null,ee),re(ee)},createStream:a.b,Logger:f.default,report:S.report,getDevices:me,getScreenSources:i,getParameter:E.getParameter,setParameter:E.setParameter,checkSystemRequirements:m,getSupportedCodec:C.getSupportedCodec,ChannelMediaRelayConfiguration:v.ChannelMediaRelayConfiguration,VERSION:E.VERSION,BUILD:E.BUILD,PROFILE_TABLE:le,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2,AREAS:U.AREAS,AREA_VERSION:"global"}}]).default})})(AgoraRTCSDK_min$2);var AgoraRTCSDK_min=getDefaultExportFromCjs(AgoraRTCSDK_min$2.exports),AgoraRTCSDK_min$1=_mergeNamespaces({__proto__:null,default:AgoraRTCSDK_min},[AgoraRTCSDK_min$2.exports]);export{AgoraRTCSDK_min$1 as A};
