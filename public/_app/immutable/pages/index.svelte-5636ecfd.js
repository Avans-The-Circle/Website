import{S as Q,i as X,s as Y,e as v,t as S,c as g,a as b,h as y,d as _,g as O,J as d,k as $,m as C,b as k,f as P,K as ce,L as F,j as ie,M as pe,N as ve,n as K,w as ge,O as be,P as Ee,x as M,y as L,Q as Ie,R as ue,z as J,T as ke,r as A,p as W,C as B,U as Se}from"../chunks/index-2f69105a.js";function fe(c,e,n){const t=c.slice();return t[3]=e[n],t}function de(c){let e,n;return{c(){e=v("h1"),n=S("Disconnected")},l(t){e=g(t,"H1",{});var s=b(e);n=y(s,"Disconnected"),s.forEach(_)},m(t,s){O(t,e,s),d(e,n)},d(t){t&&_(e)}}}function _e(c){let e,n,t,s,o,i,u,m,p,f=c[2],l=[];for(let a=0;a<f.length;a+=1)l[a]=me(fe(c,f,a));return{c(){e=v("div");for(let a=0;a<l.length;a+=1)l[a].c();t=$(),s=v("div"),o=v("input"),i=$(),u=v("input"),this.h()},l(a){e=g(a,"DIV",{class:!0,id:!0,style:!0});var h=b(e);for(let E=0;E<l.length;E+=1)l[E].l(h);h.forEach(_),t=C(a),s=g(a,"DIV",{class:!0,style:!0});var r=b(s);o=g(r,"INPUT",{class:!0,type:!0}),i=C(r),u=g(r,"INPUT",{class:!0,type:!0}),r.forEach(_),this.h()},h(){k(e,"class","overflow-auto"),k(e,"id",n="chatContainer-"+c[4]),P(e,"max-height","40vh"),k(o,"class","d-inline-block"),k(o,"type","text"),k(u,"class","d-inline-block"),k(u,"type","submit"),k(s,"class","position-absolute bottom-0"),P(s,"bottom","0")},m(a,h){O(a,e,h);for(let r=0;r<l.length;r+=1)l[r].m(e,null);O(a,t,h),O(a,s,h),d(s,o),ce(o,c[3]),d(s,i),d(s,u),m||(p=[F(o,"input",c[7]),F(u,"click",c[5])],m=!0)},p(a,h){if(h&4){f=a[2];let r;for(r=0;r<f.length;r+=1){const E=fe(a,f,r);l[r]?l[r].p(E,h):(l[r]=me(E),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=f.length}h&8&&o.value!==a[3]&&ce(o,a[3])},d(a){a&&_(e),pe(l,a),a&&_(t),a&&_(s),m=!1,ve(p)}}}function me(c){let e,n,t=c[3].sender+"",s,o,i,u,m=c[3].message+"",p,f;return{c(){e=v("div"),n=v("label"),s=S(t),o=S(">"),i=$(),u=v("label"),p=S(m),f=$(),this.h()},l(l){e=g(l,"DIV",{});var a=b(e);n=g(a,"LABEL",{class:!0});var h=b(n);s=y(h,t),o=y(h,">"),h.forEach(_),i=C(a),u=g(a,"LABEL",{});var r=b(u);p=y(r,m),r.forEach(_),f=C(a),a.forEach(_),this.h()},h(){k(n,"class","fw-bold")},m(l,a){O(l,e,a),d(e,n),d(n,s),d(n,o),d(e,i),d(e,u),d(u,p),d(e,f)},p(l,a){a&4&&t!==(t=l[3].sender+"")&&ie(s,t),a&4&&m!==(m=l[3].message+"")&&ie(p,m)},d(l){l&&_(e)}}}function ye(c){let e,n,t=(c[1]===void 0||c[1].readyState!==WebSocket.OPEN)&&de(),s=c[0]!=="-1"&&_e(c);return{c(){e=v("div"),t&&t.c(),n=$(),s&&s.c(),this.h()},l(o){e=g(o,"DIV",{class:!0,style:!0});var i=b(e);t&&t.l(i),n=C(i),s&&s.l(i),i.forEach(_),this.h()},h(){k(e,"class","bg-info position-relative"),P(e,"height","calc(100% - 2.4rem)")},m(o,i){O(o,e,i),t&&t.m(e,null),d(e,n),s&&s.m(e,null)},p(o,[i]){o[1]===void 0||o[1].readyState!==WebSocket.OPEN?t||(t=de(),t.c(),t.m(e,n)):t&&(t.d(1),t=null),o[0]!=="-1"?s?s.p(o,i):(s=_e(o),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i:K,o:K,d(o){o&&_(e),t&&t.d(),s&&s.d()}}}function Ne(c,e,n){let t,s="",o=[];const i=Math.round(Math.random()*1e10);let{streamId:u=""}=e,m="";ge(()=>{const h=()=>{n(1,t=new WebSocket("ws://localhost:8080"))};h(),t.addEventListener("open",()=>{console.log("[websocket_opened]"),t.send(JSON.stringify({type:"OPEN_CONNECTION",streamId:u}))}),n(1,t.onclose=function(r){n(6,m=""),r.wasClean?console.log(`[websocket_close] Connection closed cleanly, code=${r.code} reason=${r.reason}`):console.log("[websocket_close] Connection died"),h()},t),n(1,t.onerror=function(r){console.error(`[websocket_error] ${r.message}`)},t),n(1,t.onmessage=function(r){console.log(`[websocket_message] Data received from server: ${r.data}`);const E=JSON.parse(r.data);switch(E.type){case"CHAT_MESSAGE":o.push(E),n(2,o),n(6,m),n(0,u),n(1,t),setTimeout(()=>{l()},250),console.log("messages: ",o);break;case"CONFIRM_CONNECTION":n(6,m=E.streamId);break}},t)});function p(){return!(t===void 0||t.readyState!==WebSocket.OPEN)}async function f(){if(!p()){console.error("Websocket not connected.",t),alert("Chat server connection issue. Check console for more info.");return}t.send(JSON.stringify({type:"SEND_MESSAGE",sender:"Je moeder",message:s})),n(3,s="")}const l=()=>{const h=document.getElementById(`chatContainer-${i}`);h.scroll({top:h.scrollHeight,behavior:"smooth"})};function a(){s=this.value,n(3,s)}return c.$$set=h=>{"streamId"in h&&n(0,u=h.streamId)},c.$$.update=()=>{c.$$.dirty&67&&p()&&m!==u&&(t.send(JSON.stringify({type:"OPEN_CONNECTION",streamId:u})),n(2,o=[]))},[u,t,o,s,i,f,m,a]}class Oe extends Q{constructor(e){super(),X(this,e,Ne,ye,Y,{streamId:0})}}function $e(c){let e;return{c(){e=S("123")},l(n){e=y(n,"123")},m(n,t){O(n,e,t)},d(n){n&&_(e)}}}function Ce(c){let e,n;return{c(){e=v("h1"),n=S("Disconnected...")},l(t){e=g(t,"H1",{});var s=b(e);n=y(s,"Disconnected..."),s.forEach(_)},m(t,s){O(t,e,s),d(e,n)},d(t){t&&_(e)}}}function we(c){let e,n,t,s,o,i,u,m,p,f,l,a,h,r,E,j,V,w,q,H,z,Z;function x(I,N){return I[0]==="-1"?Ce:$e}let R=x(c),D=R(c);function he(I){c[2](I)}let ee={};return c[0]!==void 0&&(ee.streamId=c[0]),w=new Oe({props:ee}),be.push(()=>Ee(w,"streamId",he)),{c(){e=v("div"),n=v("select"),t=v("option"),s=S("Disconnected"),o=v("option"),i=S("Stream 1"),u=v("option"),m=S("Stream 2"),p=v("option"),f=S("Stream 3"),l=v("option"),a=S("Stream 4"),h=$(),r=v("div"),E=v("div"),D.c(),j=$(),V=v("div"),M(w.$$.fragment),this.h()},l(I){e=g(I,"DIV",{class:!0,style:!0});var N=b(e);n=g(N,"SELECT",{class:!0,"aria-label":!0});var T=b(n);t=g(T,"OPTION",{});var te=b(t);s=y(te,"Disconnected"),te.forEach(_),o=g(T,"OPTION",{});var ne=b(o);i=y(ne,"Stream 1"),ne.forEach(_),u=g(T,"OPTION",{});var se=b(u);m=y(se,"Stream 2"),se.forEach(_),p=g(T,"OPTION",{});var le=b(p);f=y(le,"Stream 3"),le.forEach(_),l=g(T,"OPTION",{});var oe=b(l);a=y(oe,"Stream 4"),oe.forEach(_),T.forEach(_),h=C(N),r=g(N,"DIV",{class:!0,style:!0});var U=b(r);E=g(U,"DIV",{class:!0});var ae=b(E);D.l(ae),ae.forEach(_),j=C(U),V=g(U,"DIV",{class:!0});var re=b(V);L(w.$$.fragment,re),re.forEach(_),U.forEach(_),N.forEach(_),this.h()},h(){t.__value="-1",t.value=t.__value,o.__value="1",o.value=o.__value,u.__value="2",u.value=u.__value,p.__value="3",p.value=p.__value,l.__value="4",l.value=l.__value,k(n,"class","form-select"),k(n,"aria-label","Please select a stream..."),c[0]===void 0&&Ie(()=>c[1].call(n)),k(E,"class","col-8"),k(V,"class","col-4"),k(r,"class","row"),P(r,"height","100%"),k(e,"class","col-6"),P(e,"height","49vh"),P(e,"padding","0")},m(I,N){O(I,e,N),d(e,n),d(n,t),d(t,s),d(n,o),d(o,i),d(n,u),d(u,m),d(n,p),d(p,f),d(n,l),d(l,a),ue(n,c[0]),d(e,h),d(e,r),d(r,E),D.m(E,null),d(r,j),d(r,V),J(w,V,null),H=!0,z||(Z=F(n,"change",c[1]),z=!0)},p(I,[N]){N&1&&ue(n,I[0]),R!==(R=x(I))&&(D.d(1),D=R(I),D&&(D.c(),D.m(E,null)));const T={};!q&&N&1&&(q=!0,T.streamId=I[0],ke(()=>q=!1)),w.$set(T)},i(I){H||(A(w.$$.fragment,I),H=!0)},o(I){W(w.$$.fragment,I),H=!1},d(I){I&&_(e),D.d(),B(w),z=!1,Z()}}}function De(c,e,n){let t="-1";function s(){t=Se(this),n(0,t)}function o(i){t=i,n(0,t)}return[t,s,o]}class G extends Q{constructor(e){super(),X(this,e,De,we,Y,{})}}function Te(c){let e,n,t,s,o,i,u,m,p;return n=new G({}),s=new G({}),i=new G({}),m=new G({}),{c(){e=v("div"),M(n.$$.fragment),t=$(),M(s.$$.fragment),o=$(),M(i.$$.fragment),u=$(),M(m.$$.fragment),this.h()},l(f){e=g(f,"DIV",{class:!0,style:!0});var l=b(e);L(n.$$.fragment,l),t=C(l),L(s.$$.fragment,l),o=C(l),L(i.$$.fragment,l),u=C(l),L(m.$$.fragment,l),l.forEach(_),this.h()},h(){k(e,"class","row"),P(e,"margin","0")},m(f,l){O(f,e,l),J(n,e,null),d(e,t),J(s,e,null),d(e,o),J(i,e,null),d(e,u),J(m,e,null),p=!0},p:K,i(f){p||(A(n.$$.fragment,f),A(s.$$.fragment,f),A(i.$$.fragment,f),A(m.$$.fragment,f),p=!0)},o(f){W(n.$$.fragment,f),W(s.$$.fragment,f),W(i.$$.fragment,f),W(m.$$.fragment,f),p=!1},d(f){f&&_(e),B(n),B(s),B(i),B(m)}}}class Ve extends Q{constructor(e){super(),X(this,e,null,Te,Y,{})}}export{Ve as default};
